<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>AVR32 UC3 - FSACCESS Services: play_list.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>play_list.c</h1><a href="a00038.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*This file has been prepared for Doxygen automatic documentation generation.*/</span>
<a name="l00014"></a>00014 <span class="comment">/* Copyright (c) 2009 Atmel Corporation. All rights reserved.</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
<a name="l00017"></a>00017 <span class="comment"> * modification, are permitted provided that the following conditions are met:</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * 1. Redistributions of source code must retain the above copyright notice, this</span>
<a name="l00020"></a>00020 <span class="comment"> * list of conditions and the following disclaimer.</span>
<a name="l00021"></a>00021 <span class="comment"> *</span>
<a name="l00022"></a>00022 <span class="comment"> * 2. Redistributions in binary form must reproduce the above copyright notice,</span>
<a name="l00023"></a>00023 <span class="comment"> * this list of conditions and the following disclaimer in the documentation</span>
<a name="l00024"></a>00024 <span class="comment"> * and/or other materials provided with the distribution.</span>
<a name="l00025"></a>00025 <span class="comment"> *</span>
<a name="l00026"></a>00026 <span class="comment"> * 3. The name of Atmel may not be used to endorse or promote products derived</span>
<a name="l00027"></a>00027 <span class="comment"> * from this software without specific prior written permission.</span>
<a name="l00028"></a>00028 <span class="comment"> *</span>
<a name="l00029"></a>00029 <span class="comment"> * 4. This software may only be redistributed and used in connection with an Atmel</span>
<a name="l00030"></a>00030 <span class="comment"> * AVR product.</span>
<a name="l00031"></a>00031 <span class="comment"> *</span>
<a name="l00032"></a>00032 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY ATMEL "AS IS" AND ANY EXPRESS OR IMPLIED</span>
<a name="l00033"></a>00033 <span class="comment"> * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF</span>
<a name="l00034"></a>00034 <span class="comment"> * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT ARE</span>
<a name="l00035"></a>00035 <span class="comment"> * EXPRESSLY AND SPECIFICALLY DISCLAIMED. IN NO EVENT SHALL ATMEL BE LIABLE FOR</span>
<a name="l00036"></a>00036 <span class="comment"> * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
<a name="l00037"></a>00037 <span class="comment"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span>
<a name="l00038"></a>00038 <span class="comment"> * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span>
<a name="l00039"></a>00039 <span class="comment"> * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00040"></a>00040 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<a name="l00041"></a>00041 <span class="comment"> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE</span>
<a name="l00042"></a>00042 <span class="comment"> *</span>
<a name="l00043"></a>00043 <span class="comment"> */</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="comment">//_____  I N C L U D E S ___________________________________________________</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include "<a class="code" href="a00016.html" title="FAT configuration file.">conf_explorer.h</a>"</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include "<a class="code" href="a00037.html" title="FAT 12/16/32 Services.">navigation.h</a>"</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include "<a class="code" href="a00023.html" title="FAT 12/16/32 Services.">file.h</a>"</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include "<a class="code" href="a00041.html" title="FAT 12/16/32 text reader service.">reader_txt.h</a>"</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include "<a class="code" href="a00039.html" title="Play list Services.">play_list.h</a>"</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="comment">// Check configuration</span>
<a name="l00056"></a>00056 <span class="preprocessor">#ifndef PL_READONLY</span>
<a name="l00057"></a><a class="code" href="a00038.html#62b5e2d461423679288c3fc8fe1097d1">00057</a> <span class="preprocessor"></span><span class="preprocessor">#  define PL_READONLY   DISABLED</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span>
<a name="l00060"></a>00060 <span class="preprocessor">#if( PL_READONLY == DISABLED )</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span><span class="preprocessor">#   error the modification of play list file is not available</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span>
<a name="l00064"></a>00064 <span class="preprocessor">#if defined(PLAYLIST_USE_NON_BLOCKING_FUNCTION_SET) &amp;&amp; \</span>
<a name="l00065"></a>00065 <span class="preprocessor">    PLAYLIST_USE_NON_BLOCKING_FUNCTION_SET == ENABLED</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span><span class="preprocessor">#include "audio_interface.h"</span>
<a name="l00067"></a>00067 <span class="preprocessor">#if !defined(AI_ASYNC_STACK_NB_ELEMENTS) || AI_ASYNC_STACK_NB_ELEMENTS &lt; 1</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span><span class="preprocessor">#error This version of the play_list.c file needs a context that can support \</span>
<a name="l00069"></a>00069 <span class="preprocessor">at least 1 element. Therefore, AI_ASYNC_STACK_NB_ELEMENTS must be defined with \</span>
<a name="l00070"></a>00070 <span class="preprocessor">a value greater or equals to 1.</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span>
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="comment">//_____ D E F I N I T I O N S ______________________________________________</span>
<a name="l00076"></a>00076 
<a name="l00078"></a><a class="code" href="a00038.html#0c3455f08337dedcd64aa31097ef1918">00078</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> {
<a name="l00079"></a><a class="code" href="a00038.html#0c3455f08337dedcd64aa31097ef191882c25c5ebd4edbe7e072ab5ac19be681">00079</a>    <a class="code" href="a00038.html#0c3455f08337dedcd64aa31097ef191882c25c5ebd4edbe7e072ab5ac19be681">E_PL_M3U</a>,
<a name="l00080"></a><a class="code" href="a00038.html#0c3455f08337dedcd64aa31097ef19189ff6e70f8e629623469089e5807a6751">00080</a>    <a class="code" href="a00038.html#0c3455f08337dedcd64aa31097ef19189ff6e70f8e629623469089e5807a6751">E_PL_PLS</a>,
<a name="l00081"></a><a class="code" href="a00038.html#0c3455f08337dedcd64aa31097ef1918ca681f93854b4e08980ee12b7ef1abcd">00081</a>    <a class="code" href="a00038.html#0c3455f08337dedcd64aa31097ef1918ca681f93854b4e08980ee12b7ef1abcd">E_PL_SMP</a>
<a name="l00082"></a>00082 } <a class="code" href="a00038.html#0c3455f08337dedcd64aa31097ef1918" title="Type of playlist file.">E_pl_type</a>;
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 
<a name="l00085"></a><a class="code" href="a00038.html#ddc3fb7e481bcf02c8c6057b43c0a8d7">00085</a>                   Bool        <a class="code" href="a00038.html#ddc3fb7e481bcf02c8c6057b43c0a8d7" title="play list file is opened">pl_g_list_is_open</a> = FALSE; 
<a name="l00086"></a><a class="code" href="a00038.html#56182ff5f21080cdc39eb8270b329ea4">00086</a> _MEM_TYPE_SLOW_   <a class="code" href="a00038.html#0c3455f08337dedcd64aa31097ef1918" title="Type of playlist file.">E_pl_type</a>   <a class="code" href="a00038.html#56182ff5f21080cdc39eb8270b329ea4" title="Type of the play list.">pl_g_list_type</a>;            
<a name="l00087"></a><a class="code" href="a00038.html#a18a22be8e8c964836b6d3abe35fe2d0">00087</a> _MEM_TYPE_SLOW_   U16         <a class="code" href="a00038.html#a18a22be8e8c964836b6d3abe35fe2d0" title="Number of file included in play list.">pl_g_u16_list_size</a>    = 0; 
<a name="l00088"></a><a class="code" href="a00038.html#43c5d67b8ebe2758b7362f58b755351c">00088</a> _MEM_TYPE_SLOW_   U16         <a class="code" href="a00038.html#43c5d67b8ebe2758b7362f58b755351c" title="Current file selected in play list (0= no file selected, 1= first file).">pl_g_u16_list_sel</a>     = 0; 
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 <span class="preprocessor">#if( PL_READONLY == DISABLED )</span>
<a name="l00091"></a><a class="code" href="a00038.html#da525c5a94216aa2c7980ae097424b3d">00091</a> <span class="preprocessor"></span>                  Bool        <a class="code" href="a00038.html#da525c5a94216aa2c7980ae097424b3d" title="If TRUE then the current play list file is modified but it is not saved.">pl_g_list_is_modify</a>;       
<a name="l00092"></a><a class="code" href="a00038.html#d94e57810cfe431db7a638d79b188a7b">00092</a>                   Bool        <a class="code" href="a00038.html#d94e57810cfe431db7a638d79b188a7b" title="If FALSE then the play list modification is autorized.">pl_g_list_is_readonly</a>;     
<a name="l00093"></a><a class="code" href="a00038.html#19ec89ed8b80790dfa2403cde5f8b2ce">00093</a>                   Bool        <a class="code" href="a00038.html#19ec89ed8b80790dfa2403cde5f8b2ce" title="If TRUE then authorize to copy the play list file in case of an undo on modifications...">pl_g_list_undo</a>;            
<a name="l00094"></a><a class="code" href="a00038.html#a351d7cd2bb575811ad1be1b9509cef1">00094</a> _MEM_TYPE_SLOW_   <a class="code" href="a00003.html">Fs_index</a>    <a class="code" href="a00038.html#a351d7cd2bb575811ad1be1b9509cef1" title="File system index on the copy file of play list file (undo option must be ENABLE)...">copyfile_index</a>;            
<a name="l00095"></a>00095 <span class="preprocessor">#endif</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span>
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 <span class="comment">//_____ D E C L A R A T I O N S ____________________________________________</span>
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 Bool  <a class="code" href="a00038.html#91909ac1c0efb364b14637df0dc516fa" title="This function creates a copy of the play list in case of a restore action.">pl_main_modify</a>       ( <span class="keywordtype">void</span> );
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 <span class="comment">//********************* MAIN functions *********************</span>
<a name="l00104"></a>00104 
<a name="l00105"></a>00105 
<a name="l00110"></a><a class="code" href="a00039.html#9dfed43a52815cf4c80eaaeee7b3f06b">00110</a> Bool   <a class="code" href="a00038.html#9dfed43a52815cf4c80eaaeee7b3f06b" title="This function checks if a play list file is already opened.">pl_main_isopen</a>( <span class="keywordtype">void</span> )
<a name="l00111"></a>00111 {
<a name="l00112"></a>00112    <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#2608de0a1dd13c482d1fb2179a8e8570" title="The play list isn&amp;#39;t opened.">FS_ERR_PL_NOT_OPEN</a>;
<a name="l00113"></a>00113    <span class="keywordflow">return</span> <a class="code" href="a00038.html#ddc3fb7e481bcf02c8c6057b43c0a8d7" title="play list file is opened">pl_g_list_is_open</a>;
<a name="l00114"></a>00114 }
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 
<a name="l00121"></a><a class="code" href="a00039.html#c17b4ba78b0f72b5a27a5b9170b8b99a">00121</a> Bool  <a class="code" href="a00038.html#c17b4ba78b0f72b5a27a5b9170b8b99a" title="This function checks if the play list file is modified.">pl_main_ismodify</a>( <span class="keywordtype">void</span> )
<a name="l00122"></a>00122 {
<a name="l00123"></a>00123 <span class="preprocessor">#if( PL_READONLY == DISABLED )</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span>   <span class="keywordflow">return</span> <a class="code" href="a00038.html#da525c5a94216aa2c7980ae097424b3d" title="If TRUE then the current play list file is modified but it is not saved.">pl_g_list_is_modify</a>;
<a name="l00125"></a>00125 <span class="preprocessor">#else</span>
<a name="l00126"></a>00126 <span class="preprocessor"></span>   <span class="keywordflow">return</span> FALSE;
<a name="l00127"></a>00127 <span class="preprocessor">#endif</span>
<a name="l00128"></a>00128 <span class="preprocessor"></span>}
<a name="l00129"></a>00129 
<a name="l00130"></a>00130 
<a name="l00131"></a>00131 <span class="preprocessor">#if( PL_READONLY == DISABLED )</span>
<a name="l00140"></a><a class="code" href="a00039.html#28596b7211516825f03e2b6528b8c982">00140</a> <span class="preprocessor">Bool  pl_main_new( const FS_STRING sz_name , Bool b_undo )</span>
<a name="l00141"></a>00141 <span class="preprocessor"></span>{
<a name="l00142"></a>00142    <span class="keywordflow">if</span>( <a class="code" href="a00038.html#9dfed43a52815cf4c80eaaeee7b3f06b" title="This function checks if a play list file is already opened.">pl_main_isopen</a>() )
<a name="l00143"></a>00143       <span class="keywordflow">return</span> FALSE;
<a name="l00144"></a>00144 
<a name="l00145"></a>00145    <span class="comment">// Create an empty text file</span>
<a name="l00146"></a>00146    <span class="keywordflow">if</span>( !<a class="code" href="a00040.html#ef8e9a323aab9e3c839130f47a79453a" title="Create a new text file.">reader_txt_new</a>( sz_name, <a class="code" href="a00043.html#06075fdf01ba0cb5926bfe54e1bfc91e">UNI_TYPE_UTF16BE</a> ))
<a name="l00147"></a>00147       <span class="keywordflow">return</span> FALSE;
<a name="l00148"></a>00148    <a class="code" href="a00040.html#1859333aec56b71c6126da66452231c1" title="Close text file.">reader_txt_close</a>();
<a name="l00149"></a>00149 
<a name="l00150"></a>00150    <span class="comment">// Load the play list file</span>
<a name="l00151"></a>00151    <span class="keywordflow">return</span> <a class="code" href="a00038.html#2d95d9d024a3e2055cebd7879eed875f" title="This function opens the current selected file in the current navigator.">pl_main_open</a>( b_undo );
<a name="l00152"></a>00152 }
<a name="l00153"></a>00153 <span class="preprocessor">#endif</span>
<a name="l00154"></a>00154 <span class="preprocessor"></span>
<a name="l00155"></a>00155 
<a name="l00163"></a><a class="code" href="a00039.html#2d95d9d024a3e2055cebd7879eed875f">00163</a> Bool   <a class="code" href="a00038.html#2d95d9d024a3e2055cebd7879eed875f" title="This function opens the current selected file in the current navigator.">pl_main_open</a>( Bool b_undo )
<a name="l00164"></a>00164 {
<a name="l00165"></a>00165    U8 nav_id_save;
<a name="l00166"></a>00166 
<a name="l00167"></a>00167    <span class="keywordflow">if</span>( <a class="code" href="a00038.html#9dfed43a52815cf4c80eaaeee7b3f06b" title="This function checks if a play list file is already opened.">pl_main_isopen</a>() )
<a name="l00168"></a>00168       <span class="keywordflow">return</span> FALSE;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170    <span class="comment">// Select the play list file in "play list" navigator</span>
<a name="l00171"></a>00171    nav_id_save = <a class="code" href="a00036.html#4a9efd8a5ff4c599be7994c009f0fb5f" title="This function returns the navigation identifier used.">nav_get</a>();            <span class="comment">// Save current navigator</span>
<a name="l00172"></a>00172    <a class="code" href="a00036.html#3b58f8c4afeb6714cd2c7eb61058da0d" title="This function copys the navigator information to another navigator.">nav_copy</a>( FS_NAV_ID_PLAYLIST );
<a name="l00173"></a>00173    <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( FS_NAV_ID_PLAYLIST );
<a name="l00174"></a>00174 
<a name="l00175"></a>00175    <span class="comment">// Make sure the selected file is a playlist</span>
<a name="l00176"></a>00176    <span class="keywordflow">if</span>( <a class="code" href="a00036.html#4a3e65b107c26de2f7ff4fb1d2a854e3" title="This function checks the extension of selected file.">nav_file_checkext</a>(<span class="stringliteral">"m3u"</span>) )
<a name="l00177"></a>00177    {
<a name="l00178"></a>00178       <a class="code" href="a00038.html#56182ff5f21080cdc39eb8270b329ea4" title="Type of the play list.">pl_g_list_type</a> = <a class="code" href="a00038.html#0c3455f08337dedcd64aa31097ef191882c25c5ebd4edbe7e072ab5ac19be681">E_PL_M3U</a>;
<a name="l00179"></a>00179    }<span class="keywordflow">else</span>
<a name="l00180"></a>00180    <span class="keywordflow">if</span>( <a class="code" href="a00036.html#4a3e65b107c26de2f7ff4fb1d2a854e3" title="This function checks the extension of selected file.">nav_file_checkext</a>(<span class="stringliteral">"pls"</span>) )
<a name="l00181"></a>00181    {
<a name="l00182"></a>00182       <a class="code" href="a00038.html#56182ff5f21080cdc39eb8270b329ea4" title="Type of the play list.">pl_g_list_type</a> = <a class="code" href="a00038.html#0c3455f08337dedcd64aa31097ef19189ff6e70f8e629623469089e5807a6751">E_PL_PLS</a>;
<a name="l00183"></a>00183    }<span class="keywordflow">else</span>
<a name="l00184"></a>00184    <span class="keywordflow">if</span>( <a class="code" href="a00036.html#4a3e65b107c26de2f7ff4fb1d2a854e3" title="This function checks the extension of selected file.">nav_file_checkext</a>(<span class="stringliteral">"smp"</span>) )
<a name="l00185"></a>00185    {
<a name="l00186"></a>00186       <a class="code" href="a00038.html#56182ff5f21080cdc39eb8270b329ea4" title="Type of the play list.">pl_g_list_type</a> = <a class="code" href="a00038.html#0c3455f08337dedcd64aa31097ef1918ca681f93854b4e08980ee12b7ef1abcd">E_PL_SMP</a>;
<a name="l00187"></a>00187    }<span class="keywordflow">else</span>
<a name="l00188"></a>00188       <span class="keywordflow">goto</span> pl_main_open_end;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190    <span class="comment">// Open list</span>
<a name="l00191"></a>00191 <span class="preprocessor">#if( PL_READONLY == DISABLED )</span>
<a name="l00192"></a>00192 <span class="preprocessor"></span>   <a class="code" href="a00038.html#19ec89ed8b80790dfa2403cde5f8b2ce" title="If TRUE then authorize to copy the play list file in case of an undo on modifications...">pl_g_list_undo</a>          = b_undo;
<a name="l00193"></a>00193    <a class="code" href="a00038.html#da525c5a94216aa2c7980ae097424b3d" title="If TRUE then the current play list file is modified but it is not saved.">pl_g_list_is_modify</a>     = FALSE;
<a name="l00194"></a>00194    <a class="code" href="a00038.html#d94e57810cfe431db7a638d79b188a7b" title="If FALSE then the play list modification is autorized.">pl_g_list_is_readonly</a>   = <a class="code" href="a00036.html#414f55acdda5d91d87d0959155c4e615" title="This function checks the write protection of disk and the attribut &amp;quot;read only&amp;quot;...">nav_file_isreadonly</a>();
<a name="l00195"></a>00195    <span class="keywordflow">if</span>( <a class="code" href="a00038.html#d94e57810cfe431db7a638d79b188a7b" title="If FALSE then the play list modification is autorized.">pl_g_list_is_readonly</a> )
<a name="l00196"></a>00196    {
<a name="l00197"></a>00197       <span class="keywordflow">if</span>( !<a class="code" href="a00040.html#ee4bf4e140c9a4893547bf41459e57f3" title="Open a selected text file in the current navigator.">reader_txt_open</a>( TRUE ))
<a name="l00198"></a>00198          <span class="keywordflow">goto</span> pl_main_open_end;
<a name="l00199"></a>00199    }<span class="keywordflow">else</span>{
<a name="l00200"></a>00200       <span class="keywordflow">if</span>( !<a class="code" href="a00040.html#ee4bf4e140c9a4893547bf41459e57f3" title="Open a selected text file in the current navigator.">reader_txt_open</a>( FALSE ))
<a name="l00201"></a>00201          <span class="keywordflow">goto</span> pl_main_open_end;
<a name="l00202"></a>00202    }
<a name="l00203"></a>00203 <span class="preprocessor">#else</span>
<a name="l00204"></a>00204 <span class="preprocessor"></span>    <span class="keywordflow">if</span>( !<a class="code" href="a00040.html#ee4bf4e140c9a4893547bf41459e57f3" title="Open a selected text file in the current navigator.">reader_txt_open</a>( TRUE ))
<a name="l00205"></a>00205        <span class="keywordflow">goto</span> pl_main_open_end;
<a name="l00206"></a>00206 <span class="preprocessor">#endif</span>
<a name="l00207"></a>00207 <span class="preprocessor"></span>
<a name="l00208"></a>00208    <span class="comment">// Compute the number of file in list</span>
<a name="l00209"></a>00209    <a class="code" href="a00038.html#a18a22be8e8c964836b6d3abe35fe2d0" title="Number of file included in play list.">pl_g_u16_list_size</a>    = 0;
<a name="l00210"></a>00210    <span class="keywordflow">while</span>( 0 == <a class="code" href="a00022.html#bed52ba7230c6eecf100a3709b9ed74e" title="This function checks the end of file.">file_eof</a>() )
<a name="l00211"></a>00211    {
<a name="l00212"></a>00212       <span class="keywordflow">if</span>( <a class="code" href="a00038.html#f01e79587fade6bdd9afc994843d364c" title="This function reads and checks the next line.">pl_main_readline</a>(<a class="code" href="a00039.html#96aa34c741e50dd5fb675ccdbac9e8f02472a994994b0c26b1fcebc9e2b06032">PL_MAIN_READLINE_OPT_CHECKLINE</a>,0,NULL,NULL) )
<a name="l00213"></a>00213          <a class="code" href="a00038.html#a18a22be8e8c964836b6d3abe35fe2d0" title="Number of file included in play list.">pl_g_u16_list_size</a>++;   <span class="comment">// Add a file</span>
<a name="l00214"></a>00214    }
<a name="l00215"></a>00215 
<a name="l00216"></a>00216    <span class="comment">// Go to at the beginning of text file</span>
<a name="l00217"></a>00217    <a class="code" href="a00040.html#4f6bbd93a0b11365b77518a22b1ae098" title="This function goes at the beginning of file and read the text header.">reader_txt_beg</a>();
<a name="l00218"></a>00218 
<a name="l00219"></a>00219    <a class="code" href="a00038.html#43c5d67b8ebe2758b7362f58b755351c" title="Current file selected in play list (0= no file selected, 1= first file).">pl_g_u16_list_sel</a>    = 0;     <span class="comment">// Don't select a file</span>
<a name="l00220"></a>00220    <a class="code" href="a00038.html#ddc3fb7e481bcf02c8c6057b43c0a8d7" title="play list file is opened">pl_g_list_is_open</a>    = TRUE;  <span class="comment">// Play list file is opened</span>
<a name="l00221"></a>00221    <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( nav_id_save );    <span class="comment">// Re select the previous navigator</span>
<a name="l00222"></a>00222    <a class="code" href="a00036.html#7ad0aa092d133a156651abe5d871b8eb" title="This function resets the selection pointer, so &amp;quot;no file selected&amp;quot; in file...">nav_filelist_reset</a>();
<a name="l00223"></a>00223 
<a name="l00224"></a>00224 pl_main_open_end:
<a name="l00225"></a>00225    <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( nav_id_save );    <span class="comment">// Re select the previous navigator</span>
<a name="l00226"></a>00226    <span class="keywordflow">return</span> <a class="code" href="a00038.html#ddc3fb7e481bcf02c8c6057b43c0a8d7" title="play list file is opened">pl_g_list_is_open</a>;
<a name="l00227"></a>00227 }
<a name="l00228"></a>00228 
<a name="l00229"></a>00229 
<a name="l00235"></a>00235 <span class="preprocessor">#if( PL_READONLY == DISABLED )</span>
<a name="l00236"></a><a class="code" href="a00039.html#f36810c870399b35945b36efd7da532b">00236</a> <span class="preprocessor"></span>Bool   <a class="code" href="a00038.html#f36810c870399b35945b36efd7da532b" title="This function saves the play list file.">pl_main_save</a>( <span class="keywordtype">void</span> )
<a name="l00237"></a>00237 {
<a name="l00238"></a>00238    _MEM_TYPE_SLOW_ <a class="code" href="a00003.html">Fs_index</a> index;
<a name="l00239"></a>00239    U8 nav_id_save;
<a name="l00240"></a>00240    U16 u16_pos;
<a name="l00241"></a>00241 
<a name="l00242"></a>00242    <span class="comment">// Check if the play list file is opened and modified</span>
<a name="l00243"></a>00243    <span class="keywordflow">if</span>( !<a class="code" href="a00038.html#9dfed43a52815cf4c80eaaeee7b3f06b" title="This function checks if a play list file is already opened.">pl_main_isopen</a>() )
<a name="l00244"></a>00244       <span class="keywordflow">return</span> FALSE;
<a name="l00245"></a>00245    <span class="keywordflow">if</span>( !<a class="code" href="a00038.html#da525c5a94216aa2c7980ae097424b3d" title="If TRUE then the current play list file is modified but it is not saved.">pl_g_list_is_modify</a> )
<a name="l00246"></a>00246       <span class="keywordflow">return</span> TRUE;
<a name="l00247"></a>00247    <a class="code" href="a00038.html#da525c5a94216aa2c7980ae097424b3d" title="If TRUE then the current play list file is modified but it is not saved.">pl_g_list_is_modify</a> = FALSE;
<a name="l00248"></a>00248 
<a name="l00249"></a>00249    <span class="comment">// Check if a undo file exists</span>
<a name="l00250"></a>00250    <span class="keywordflow">if</span>( !<a class="code" href="a00038.html#19ec89ed8b80790dfa2403cde5f8b2ce" title="If TRUE then authorize to copy the play list file in case of an undo on modifications...">pl_g_list_undo</a> )
<a name="l00251"></a>00251       <span class="keywordflow">return</span> TRUE;
<a name="l00252"></a>00252 
<a name="l00253"></a>00253    <span class="comment">// Remove original copy of play list file</span>
<a name="l00254"></a>00254    nav_id_save = <a class="code" href="a00036.html#4a9efd8a5ff4c599be7994c009f0fb5f" title="This function returns the navigation identifier used.">nav_get</a>();
<a name="l00255"></a>00255    <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( FS_NAV_ID_PLAYLIST );
<a name="l00256"></a>00256    u16_pos = <a class="code" href="a00038.html#43c5d67b8ebe2758b7362f58b755351c" title="Current file selected in play list (0= no file selected, 1= first file).">pl_g_u16_list_sel</a>;           <span class="comment">// Save position in play list</span>
<a name="l00257"></a>00257    <a class="code" href="a00022.html#7f4f3b65455595cb5be0f7cd7d12e02d" title="This function closes the file.">file_close</a>();                          <span class="comment">// Close list</span>
<a name="l00258"></a>00258    index = <a class="code" href="a00036.html#47882923fca657fb23001d23b6b5369d" title="This function returns a small index on the selected file.">nav_getindex</a>();                <span class="comment">// Save the pointer on play list file</span>
<a name="l00259"></a>00259    <a class="code" href="a00038.html#ddc3fb7e481bcf02c8c6057b43c0a8d7" title="play list file is opened">pl_g_list_is_open</a> = FALSE;
<a name="l00260"></a>00260    <span class="keywordflow">if</span>( <a class="code" href="a00036.html#503f8d42be2b70cb554589ac7974ed78" title="This function selects a file in the navigator via a file index.">nav_gotoindex</a>( &amp;<a class="code" href="a00038.html#a351d7cd2bb575811ad1be1b9509cef1" title="File system index on the copy file of play list file (undo option must be ENABLE)...">copyfile_index</a> ) ) <span class="comment">// Go to the copy of file</span>
<a name="l00261"></a>00261       <a class="code" href="a00036.html#8cf46891df029a9f3b62503d2c3cc065" title="This function deletes the selected file or directory.">nav_file_del</a>( TRUE );               <span class="comment">// Remove the copy</span>
<a name="l00262"></a>00262    <a class="code" href="a00036.html#503f8d42be2b70cb554589ac7974ed78" title="This function selects a file in the navigator via a file index.">nav_gotoindex</a>( &amp;index );               <span class="comment">// Re select play list file</span>
<a name="l00263"></a>00263    <a class="code" href="a00038.html#2d95d9d024a3e2055cebd7879eed875f" title="This function opens the current selected file in the current navigator.">pl_main_open</a>( TRUE );                  <span class="comment">// Re open play list file</span>
<a name="l00264"></a>00264    <a class="code" href="a00038.html#6762440ecae73bb09b47f5c6eadf41bf" title="This function goes to a position in the play list.">pl_nav_setpos</a>(u16_pos);                <span class="comment">// Restort position in play list</span>
<a name="l00265"></a>00265    <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( nav_id_save );
<a name="l00266"></a>00266 
<a name="l00267"></a>00267    <span class="keywordflow">return</span> TRUE;
<a name="l00268"></a>00268 }
<a name="l00269"></a>00269 <span class="preprocessor">#endif</span>
<a name="l00270"></a>00270 <span class="preprocessor"></span>
<a name="l00271"></a>00271 
<a name="l00277"></a><a class="code" href="a00039.html#731915be2d7a8637628d7c7de0976a58">00277</a> Bool   <a class="code" href="a00038.html#731915be2d7a8637628d7c7de0976a58" title="This function closes the play list and selects this one in current navigator.">pl_main_close</a>( <span class="keywordtype">void</span> )
<a name="l00278"></a>00278 {
<a name="l00279"></a>00279    _MEM_TYPE_SLOW_ <a class="code" href="a00003.html">Fs_index</a> index;
<a name="l00280"></a>00280    U8 nav_id_save;
<a name="l00281"></a>00281 
<a name="l00282"></a>00282    <span class="keywordflow">if</span>( !<a class="code" href="a00038.html#9dfed43a52815cf4c80eaaeee7b3f06b" title="This function checks if a play list file is already opened.">pl_main_isopen</a>() )
<a name="l00283"></a>00283       <span class="keywordflow">return</span> FALSE;
<a name="l00284"></a>00284 
<a name="l00285"></a>00285    <span class="comment">// Close play list</span>
<a name="l00286"></a>00286    nav_id_save = <a class="code" href="a00036.html#4a9efd8a5ff4c599be7994c009f0fb5f" title="This function returns the navigation identifier used.">nav_get</a>();
<a name="l00287"></a>00287    <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( FS_NAV_ID_PLAYLIST );
<a name="l00288"></a>00288    <a class="code" href="a00022.html#7f4f3b65455595cb5be0f7cd7d12e02d" title="This function closes the file.">file_close</a>();
<a name="l00289"></a>00289 
<a name="l00290"></a>00290 <span class="preprocessor">#if( PL_READONLY == DISABLED )</span>
<a name="l00291"></a>00291 <span class="preprocessor"></span>   <span class="keywordflow">if</span>( <a class="code" href="a00038.html#da525c5a94216aa2c7980ae097424b3d" title="If TRUE then the current play list file is modified but it is not saved.">pl_g_list_is_modify</a> )
<a name="l00292"></a>00292    {
<a name="l00293"></a>00293       <span class="keywordflow">if</span>( <a class="code" href="a00038.html#19ec89ed8b80790dfa2403cde5f8b2ce" title="If TRUE then authorize to copy the play list file in case of an undo on modifications...">pl_g_list_undo</a> )
<a name="l00294"></a>00294       {
<a name="l00295"></a>00295          U16 size_name;
<a name="l00296"></a>00296          <a class="code" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> sz_name;
<a name="l00297"></a>00297 
<a name="l00298"></a>00298          <span class="comment">//** Play list modified but not saved, then restore previous list</span>
<a name="l00299"></a>00299          <span class="comment">// Get name of play list</span>
<a name="l00300"></a>00300          <a class="code" href="a00036.html#3793ff44e6ad17641ecb8903115bd683" title="This function selects the LENGTH string mode for all routines with FS_STRING parameter...">nav_string_length_enable</a>();
<a name="l00301"></a>00301          <a class="code" href="a00036.html#10603c2fe89bd66a17cfe3bb49a3fa14" title="This function returns the name of selected file or checks the string with the name...">nav_file_name</a>( (<a class="code" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a>)&amp;size_name, 1, <a class="code" href="a00024.html#a07ca9c4f511c7e1f326c27aeecb7178">FS_NAME_GET</a>, FALSE );
<a name="l00302"></a>00302          <a class="code" href="a00036.html#1f44afef13599e2e881e601e36f66d18" title="This function deselects the LENGTH string mode for all routines with FS_STRING parameter...">nav_string_length_disable</a>();
<a name="l00303"></a>00303          sz_name = PLAYLIST_BUF_ALLOC( size_name* (<a class="code" href="a00020.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>? 2 : 1 ) );
<a name="l00304"></a>00304          <span class="keywordflow">if</span>( NULL != sz_name )
<a name="l00305"></a>00305          {
<a name="l00306"></a>00306             <span class="keywordflow">if</span>( <a class="code" href="a00036.html#10603c2fe89bd66a17cfe3bb49a3fa14" title="This function returns the name of selected file or checks the string with the name...">nav_file_name</a>( sz_name, size_name, <a class="code" href="a00024.html#a07ca9c4f511c7e1f326c27aeecb7178">FS_NAME_GET</a>, FALSE ) )
<a name="l00307"></a>00307             {
<a name="l00308"></a>00308                <span class="comment">// Delete current play list</span>
<a name="l00309"></a>00309                <span class="keywordflow">if</span>( <a class="code" href="a00036.html#8cf46891df029a9f3b62503d2c3cc065" title="This function deletes the selected file or directory.">nav_file_del</a>( TRUE ) )             <span class="comment">// Remove copy file</span>
<a name="l00310"></a>00310                {
<a name="l00311"></a>00311                   <a class="code" href="a00036.html#503f8d42be2b70cb554589ac7974ed78" title="This function selects a file in the navigator via a file index.">nav_gotoindex</a>( &amp;<a class="code" href="a00038.html#a351d7cd2bb575811ad1be1b9509cef1" title="File system index on the copy file of play list file (undo option must be ENABLE)...">copyfile_index</a> );   <span class="comment">// Select copy play list</span>
<a name="l00312"></a>00312                   <a class="code" href="a00036.html#db4a11790eddec97933f80ea44dbefa8" title="This function renames the selected directory or file.">nav_file_rename</a>( sz_name );         <span class="comment">// rename copy play list</span>
<a name="l00313"></a>00313                }
<a name="l00314"></a>00314             }
<a name="l00315"></a>00315             PLAYLIST_BUF_FREE( sz_name );
<a name="l00316"></a>00316          }
<a name="l00317"></a>00317       }
<a name="l00318"></a>00318    }
<a name="l00319"></a>00319 <span class="preprocessor">#endif</span>
<a name="l00320"></a>00320 <span class="preprocessor"></span>
<a name="l00321"></a>00321    <span class="comment">// Select the play list file in current navigator</span>
<a name="l00322"></a>00322    index = <a class="code" href="a00036.html#47882923fca657fb23001d23b6b5369d" title="This function returns a small index on the selected file.">nav_getindex</a>();       <span class="comment">// Save a pointer on play list file</span>
<a name="l00323"></a>00323    <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( nav_id_save );
<a name="l00324"></a>00324    <a class="code" href="a00036.html#503f8d42be2b70cb554589ac7974ed78" title="This function selects a file in the navigator via a file index.">nav_gotoindex</a>( &amp;index );
<a name="l00325"></a>00325    <a class="code" href="a00038.html#ddc3fb7e481bcf02c8c6057b43c0a8d7" title="play list file is opened">pl_g_list_is_open</a> = FALSE;
<a name="l00326"></a>00326    <span class="keywordflow">return</span> TRUE;
<a name="l00327"></a>00327 }
<a name="l00328"></a>00328 
<a name="l00329"></a>00329 
<a name="l00330"></a>00330 <span class="preprocessor">#if( PL_READONLY == DISABLED )</span>
<a name="l00336"></a><a class="code" href="a00038.html#91909ac1c0efb364b14637df0dc516fa">00336</a> <span class="preprocessor">Bool   pl_main_modify( void )</span>
<a name="l00337"></a>00337 <span class="preprocessor"></span>{
<a name="l00338"></a>00338    _MEM_TYPE_SLOW_ U8 name_copyfile[]=<span class="stringliteral">"~copy.m3u"</span>;
<a name="l00339"></a>00339    _MEM_TYPE_SLOW_ <a class="code" href="a00003.html">Fs_index</a> index;
<a name="l00340"></a>00340    U8 nav_id_save;
<a name="l00341"></a>00341    U16 u16_pos;
<a name="l00342"></a>00342    U8 status;
<a name="l00343"></a>00343    Bool b_copy_finish = FALSE;
<a name="l00344"></a>00344 
<a name="l00345"></a>00345    <span class="keywordflow">if</span>( !<a class="code" href="a00038.html#9dfed43a52815cf4c80eaaeee7b3f06b" title="This function checks if a play list file is already opened.">pl_main_isopen</a>() )
<a name="l00346"></a>00346       <span class="keywordflow">return</span> FALSE;
<a name="l00347"></a>00347    <span class="keywordflow">if</span>( <a class="code" href="a00038.html#da525c5a94216aa2c7980ae097424b3d" title="If TRUE then the current play list file is modified but it is not saved.">pl_g_list_is_modify</a> )
<a name="l00348"></a>00348       <span class="keywordflow">return</span> TRUE;
<a name="l00349"></a>00349    <span class="comment">// If an error occurs during copy process then the play list file is set in read only mode</span>
<a name="l00350"></a>00350    <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#cfc23d6e284392ade8af2e2158c60652" title="Impossible to modify the play list.">FS_ERR_PL_READ_ONLY</a>;
<a name="l00351"></a>00351    <span class="keywordflow">if</span>( <a class="code" href="a00038.html#d94e57810cfe431db7a638d79b188a7b" title="If FALSE then the play list modification is autorized.">pl_g_list_is_readonly</a> )
<a name="l00352"></a>00352       <span class="keywordflow">return</span> FALSE;
<a name="l00353"></a>00353    <span class="keywordflow">if</span>( !<a class="code" href="a00038.html#19ec89ed8b80790dfa2403cde5f8b2ce" title="If TRUE then authorize to copy the play list file in case of an undo on modifications...">pl_g_list_undo</a> )
<a name="l00354"></a>00354    {
<a name="l00355"></a>00355       <a class="code" href="a00038.html#da525c5a94216aa2c7980ae097424b3d" title="If TRUE then the current play list file is modified but it is not saved.">pl_g_list_is_modify</a> = TRUE;
<a name="l00356"></a>00356       <span class="keywordflow">return</span> TRUE;
<a name="l00357"></a>00357    }
<a name="l00358"></a>00358 
<a name="l00359"></a>00359    <span class="comment">// Save information about current play list file</span>
<a name="l00360"></a>00360    nav_id_save = <a class="code" href="a00036.html#4a9efd8a5ff4c599be7994c009f0fb5f" title="This function returns the navigation identifier used.">nav_get</a>();
<a name="l00361"></a>00361    <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( FS_NAV_ID_PLAYLIST );
<a name="l00362"></a>00362    u16_pos = <a class="code" href="a00038.html#43c5d67b8ebe2758b7362f58b755351c" title="Current file selected in play list (0= no file selected, 1= first file).">pl_g_u16_list_sel</a>;           <span class="comment">// Save position in play list</span>
<a name="l00363"></a>00363    <a class="code" href="a00022.html#7f4f3b65455595cb5be0f7cd7d12e02d" title="This function closes the file.">file_close</a>();                          <span class="comment">// Close list</span>
<a name="l00364"></a>00364    <a class="code" href="a00038.html#ddc3fb7e481bcf02c8c6057b43c0a8d7" title="play list file is opened">pl_g_list_is_open</a> = FALSE;
<a name="l00365"></a>00365    index = <a class="code" href="a00036.html#47882923fca657fb23001d23b6b5369d" title="This function returns a small index on the selected file.">nav_getindex</a>();                <span class="comment">// Get pointer on play list</span>
<a name="l00366"></a>00366 
<a name="l00367"></a>00367    <span class="comment">// Copy play list file in a temporary file</span>
<a name="l00368"></a>00368 <span class="preprocessor">#if( (FS_ASCII == ENABLED) &amp;&amp; (FS_UNICODE == ENABLED) )</span>
<a name="l00369"></a>00369 <span class="preprocessor"></span>   <a class="code" href="a00036.html#7489cf6b312750301cb7df5b915b436a" title="This function selects the ASCII mode for all routines with FS_STRING parameter.">nav_string_ascii</a>();                    <span class="comment">// copy file name stored in ASCII</span>
<a name="l00370"></a>00370 <span class="preprocessor">#endif</span>
<a name="l00371"></a>00371 <span class="preprocessor"></span>   <span class="keywordflow">if</span>( !<a class="code" href="a00036.html#13a6b054cd7e59bd3e916702f35f7dde" title="This function updates the COPY navigator with the selected file.">nav_file_copy</a>())
<a name="l00372"></a>00372       <span class="keywordflow">goto</span> pl_main_modify_end;
<a name="l00373"></a>00373    <span class="keywordflow">if</span>( !<a class="code" href="a00036.html#b55eb40d89b96055f71e71533380fdd0" title="This function pastes the selected file in COPY navigator in the file list of the...">nav_file_paste_start</a>( name_copyfile ) )
<a name="l00374"></a>00374    {
<a name="l00375"></a>00375       <span class="keywordflow">if</span>( <a class="code" href="a00024.html#620feae4af460b0f591356b6408e7b45" title="The file is already existed.">FS_ERR_FILE_EXIST</a> != <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a>)
<a name="l00376"></a>00376          <span class="keywordflow">goto</span> pl_main_modify_end;
<a name="l00377"></a>00377       <span class="comment">// File exist then delete</span>
<a name="l00378"></a>00378       <span class="keywordflow">if</span>( !<a class="code" href="a00036.html#8cf46891df029a9f3b62503d2c3cc065" title="This function deletes the selected file or directory.">nav_file_del</a>(TRUE) )
<a name="l00379"></a>00379          <span class="keywordflow">goto</span> pl_main_modify_end;
<a name="l00380"></a>00380       <span class="comment">// Retry paste</span>
<a name="l00381"></a>00381       <span class="keywordflow">if</span>( !<a class="code" href="a00036.html#b55eb40d89b96055f71e71533380fdd0" title="This function pastes the selected file in COPY navigator in the file list of the...">nav_file_paste_start</a>( name_copyfile ) )
<a name="l00382"></a>00382          <span class="keywordflow">goto</span> pl_main_modify_end;
<a name="l00383"></a>00383    }
<a name="l00384"></a>00384    <span class="comment">// Run paste</span>
<a name="l00385"></a>00385    <span class="keywordflow">do</span>{
<a name="l00386"></a>00386       status = <a class="code" href="a00036.html#c3bfe1b329ff30efaaad183cffa49f03" title="This function executes the copy file.">nav_file_paste_state</a>(FALSE);  <span class="comment">// Copy running</span>
<a name="l00387"></a>00387    }<span class="keywordflow">while</span>( <a class="code" href="a00024.html#a2e2285edc2ee3ef3a4ba10af70524ef">COPY_BUSY</a> == status );
<a name="l00388"></a>00388    <span class="keywordflow">if</span>( <a class="code" href="a00024.html#49311dbf1b3e2f5d778938655895b17a">COPY_FINISH</a> != status )
<a name="l00389"></a>00389       <span class="keywordflow">goto</span> pl_main_modify_end;
<a name="l00390"></a>00390    <span class="comment">// Save pointer on copy file</span>
<a name="l00391"></a>00391    <a class="code" href="a00038.html#a351d7cd2bb575811ad1be1b9509cef1" title="File system index on the copy file of play list file (undo option must be ENABLE)...">copyfile_index</a> = <a class="code" href="a00036.html#47882923fca657fb23001d23b6b5369d" title="This function returns a small index on the selected file.">nav_getindex</a>();
<a name="l00392"></a>00392    b_copy_finish = TRUE;
<a name="l00393"></a>00393 
<a name="l00394"></a>00394 pl_main_modify_end:
<a name="l00395"></a>00395    <span class="comment">// Restore the play list file</span>
<a name="l00396"></a>00396 <span class="preprocessor">#if( (FS_ASCII == ENABLED) &amp;&amp; (FS_UNICODE == ENABLED) )</span>
<a name="l00397"></a>00397 <span class="preprocessor"></span>   <a class="code" href="a00036.html#69ee3def8525352e53819df1f975dd86" title="This function selects the UNICODE mode for all routines with FS_STRING parameter...">nav_string_unicode</a>();
<a name="l00398"></a>00398 <span class="preprocessor">#endif</span>
<a name="l00399"></a>00399 <span class="preprocessor"></span>   <a class="code" href="a00036.html#503f8d42be2b70cb554589ac7974ed78" title="This function selects a file in the navigator via a file index.">nav_gotoindex</a>( &amp;index );               <span class="comment">// Go to original play list file</span>
<a name="l00400"></a>00400    <a class="code" href="a00038.html#2d95d9d024a3e2055cebd7879eed875f" title="This function opens the current selected file in the current navigator.">pl_main_open</a>( TRUE );                  <span class="comment">// Re open play list file</span>
<a name="l00401"></a>00401    <a class="code" href="a00038.html#da525c5a94216aa2c7980ae097424b3d" title="If TRUE then the current play list file is modified but it is not saved.">pl_g_list_is_modify</a> = b_copy_finish;
<a name="l00402"></a>00402    <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( nav_id_save );
<a name="l00403"></a>00403    <a class="code" href="a00038.html#6762440ecae73bb09b47f5c6eadf41bf" title="This function goes to a position in the play list.">pl_nav_setpos</a>(u16_pos);                <span class="comment">// Restort position in play list</span>
<a name="l00404"></a>00404    <span class="keywordflow">return</span> <a class="code" href="a00038.html#da525c5a94216aa2c7980ae097424b3d" title="If TRUE then the current play list file is modified but it is not saved.">pl_g_list_is_modify</a>;
<a name="l00405"></a>00405 }
<a name="l00406"></a>00406 <span class="preprocessor">#endif</span>
<a name="l00407"></a>00407 <span class="preprocessor"></span>
<a name="l00408"></a>00408 
<a name="l00409"></a>00409 <span class="comment">//********************* Play list navigation functions *********************</span>
<a name="l00410"></a>00410 
<a name="l00411"></a>00411 
<a name="l00416"></a><a class="code" href="a00039.html#ed3d15a8053fda6c27415dc86cd8b4c7">00416</a> U16 <a class="code" href="a00038.html#ed3d15a8053fda6c27415dc86cd8b4c7" title="Return the number of files in play list.">pl_nav_getnbfile</a>( <span class="keywordtype">void</span> )
<a name="l00417"></a>00417 {
<a name="l00418"></a>00418   <span class="keywordflow">return</span> <a class="code" href="a00038.html#a18a22be8e8c964836b6d3abe35fe2d0" title="Number of file included in play list.">pl_g_u16_list_size</a>;
<a name="l00419"></a>00419 }
<a name="l00420"></a>00420 
<a name="l00421"></a>00421 
<a name="l00426"></a><a class="code" href="a00039.html#c0002b15d45c8e76617857c69611cf72">00426</a> U16 <a class="code" href="a00038.html#c0002b15d45c8e76617857c69611cf72" title="Return the position in the play list.">pl_nav_getpos</a>( <span class="keywordtype">void</span> )
<a name="l00427"></a>00427 {
<a name="l00428"></a>00428    <span class="keywordflow">return</span> <a class="code" href="a00038.html#43c5d67b8ebe2758b7362f58b755351c" title="Current file selected in play list (0= no file selected, 1= first file).">pl_g_u16_list_sel</a>;
<a name="l00429"></a>00429 }
<a name="l00430"></a>00430 
<a name="l00435"></a><a class="code" href="a00039.html#0350caecfa4644339ab48b935c50a130">00435</a> Bool <a class="code" href="a00038.html#0350caecfa4644339ab48b935c50a130" title="This function checks the end of the play list.">pl_nav_eol</a>( <span class="keywordtype">void</span> )
<a name="l00436"></a>00436 {
<a name="l00437"></a>00437    <span class="keywordflow">return</span> (<a class="code" href="a00038.html#a18a22be8e8c964836b6d3abe35fe2d0" title="Number of file included in play list.">pl_g_u16_list_size</a> == <a class="code" href="a00038.html#43c5d67b8ebe2758b7362f58b755351c" title="Current file selected in play list (0= no file selected, 1= first file).">pl_g_u16_list_sel</a>);
<a name="l00438"></a>00438 }
<a name="l00439"></a>00439 
<a name="l00444"></a><a class="code" href="a00039.html#6762440ecae73bb09b47f5c6eadf41bf">00444</a> Bool  <a class="code" href="a00038.html#6762440ecae73bb09b47f5c6eadf41bf" title="This function goes to a position in the play list.">pl_nav_setpos</a>( U16 u16_position )
<a name="l00445"></a>00445 {
<a name="l00446"></a>00446    U8 nav_id_save;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448    <span class="keywordflow">if</span>( (0 == u16_position )
<a name="l00449"></a>00449    ||  (<a class="code" href="a00038.html#a18a22be8e8c964836b6d3abe35fe2d0" title="Number of file included in play list.">pl_g_u16_list_size</a> &lt; u16_position) )
<a name="l00450"></a>00450    {
<a name="l00451"></a>00451       <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#4dc7fa3cedd22ae7885138f8f9a65973" title="You are outside of the play list.">FS_ERR_PL_OUT_LST</a>;
<a name="l00452"></a>00452       <span class="keywordflow">return</span> FALSE;
<a name="l00453"></a>00453    }
<a name="l00454"></a>00454 
<a name="l00455"></a>00455    <span class="keywordflow">if</span>( <a class="code" href="a00038.html#43c5d67b8ebe2758b7362f58b755351c" title="Current file selected in play list (0= no file selected, 1= first file).">pl_g_u16_list_sel</a> == u16_position )
<a name="l00456"></a>00456       <span class="keywordflow">return</span> TRUE;
<a name="l00457"></a>00457 
<a name="l00458"></a>00458    <span class="comment">// Reset previous selection</span>
<a name="l00459"></a>00459    <a class="code" href="a00036.html#7ad0aa092d133a156651abe5d871b8eb" title="This function resets the selection pointer, so &amp;quot;no file selected&amp;quot; in file...">nav_filelist_reset</a>();
<a name="l00460"></a>00460 
<a name="l00461"></a>00461    <span class="comment">// Go to play list file navigator</span>
<a name="l00462"></a>00462    nav_id_save = <a class="code" href="a00036.html#4a9efd8a5ff4c599be7994c009f0fb5f" title="This function returns the navigation identifier used.">nav_get</a>();
<a name="l00463"></a>00463    <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( FS_NAV_ID_PLAYLIST );
<a name="l00464"></a>00464 
<a name="l00465"></a>00465    <span class="keywordflow">if</span>( <a class="code" href="a00038.html#43c5d67b8ebe2758b7362f58b755351c" title="Current file selected in play list (0= no file selected, 1= first file).">pl_g_u16_list_sel</a> &gt; u16_position )
<a name="l00466"></a>00466    {
<a name="l00467"></a>00467       <span class="comment">// Go to at the beginning of text file</span>
<a name="l00468"></a>00468       <a class="code" href="a00040.html#4f6bbd93a0b11365b77518a22b1ae098" title="This function goes at the beginning of file and read the text header.">reader_txt_beg</a>();
<a name="l00469"></a>00469       <a class="code" href="a00038.html#43c5d67b8ebe2758b7362f58b755351c" title="Current file selected in play list (0= no file selected, 1= first file).">pl_g_u16_list_sel</a>    = 0;
<a name="l00470"></a>00470    }
<a name="l00471"></a>00471    <span class="keywordflow">while</span>( <a class="code" href="a00038.html#43c5d67b8ebe2758b7362f58b755351c" title="Current file selected in play list (0= no file selected, 1= first file).">pl_g_u16_list_sel</a> != u16_position )
<a name="l00472"></a>00472    {
<a name="l00473"></a>00473       <a class="code" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> sz_path;
<a name="l00474"></a>00474       Bool next_pos = FALSE;
<a name="l00475"></a>00475 
<a name="l00476"></a>00476       <span class="keywordflow">if</span>( 0 != <a class="code" href="a00022.html#bed52ba7230c6eecf100a3709b9ed74e" title="This function checks the end of file.">file_eof</a>() )
<a name="l00477"></a>00477       {
<a name="l00478"></a>00478          <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( nav_id_save ); <span class="comment">// Re select the previous navigator</span>
<a name="l00479"></a>00479          <span class="keywordflow">return</span> FALSE;
<a name="l00480"></a>00480       }
<a name="l00481"></a>00481       <span class="keywordflow">if</span> (<a class="code" href="a00038.html#43c5d67b8ebe2758b7362f58b755351c" title="Current file selected in play list (0= no file selected, 1= first file).">pl_g_u16_list_sel</a>+1 == u16_position)
<a name="l00482"></a>00482       {
<a name="l00483"></a>00483         next_pos = <a class="code" href="a00038.html#f01e79587fade6bdd9afc994843d364c" title="This function reads and checks the next line.">pl_main_readline</a>(<a class="code" href="a00039.html#96aa34c741e50dd5fb675ccdbac9e8f034ea6e58645123ef355dd4177002e268">PL_MAIN_READLINE_OPT_GOTOPATH</a>, nav_id_save, &amp;sz_path, NULL);
<a name="l00484"></a>00484         <span class="keywordflow">if</span> (sz_path)
<a name="l00485"></a>00485           PLAYLIST_BUF_FREE(sz_path);
<a name="l00486"></a>00486       }
<a name="l00487"></a>00487       <span class="keywordflow">else</span>
<a name="l00488"></a>00488         next_pos = <a class="code" href="a00038.html#f01e79587fade6bdd9afc994843d364c" title="This function reads and checks the next line.">pl_main_readline</a>(<a class="code" href="a00039.html#96aa34c741e50dd5fb675ccdbac9e8f02472a994994b0c26b1fcebc9e2b06032">PL_MAIN_READLINE_OPT_CHECKLINE</a>, 0, NULL, NULL);
<a name="l00489"></a>00489       <span class="keywordflow">if</span> (next_pos)
<a name="l00490"></a>00490          <a class="code" href="a00038.html#43c5d67b8ebe2758b7362f58b755351c" title="Current file selected in play list (0= no file selected, 1= first file).">pl_g_u16_list_sel</a>++; <span class="comment">// Add a file</span>
<a name="l00491"></a>00491    }
<a name="l00492"></a>00492    <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( nav_id_save ); <span class="comment">// Re select the previous navigator</span>
<a name="l00493"></a>00493    <span class="keywordflow">return</span> TRUE;
<a name="l00494"></a>00494 }
<a name="l00495"></a>00495 
<a name="l00502"></a><a class="code" href="a00039.html#67266b7870a55bef0d8dfa38e94a9e23">00502</a> Bool <a class="code" href="a00038.html#0702e322eb3f0ab2bb4ac574cb51f31e" title="This function read the playliost&amp;#39;s entry at a specific position.">pl_nav_readentry</a>(U16 u16_position, <a class="code" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> *sz_path, U16 *u16_size_line )
<a name="l00503"></a>00503 {
<a name="l00504"></a>00504   U8 nav_id_save;
<a name="l00505"></a>00505   U16 u16_current_pos;
<a name="l00506"></a>00506   U32 u32_file_pos;
<a name="l00507"></a>00507 
<a name="l00508"></a>00508   <span class="comment">// Set output to NULL to specify if there is an error</span>
<a name="l00509"></a>00509   *sz_path = NULL;
<a name="l00510"></a>00510 
<a name="l00511"></a>00511   <span class="comment">// Position out of range</span>
<a name="l00512"></a>00512   <span class="keywordflow">if</span> ((0 == u16_position)
<a name="l00513"></a>00513    || (<a class="code" href="a00038.html#a18a22be8e8c964836b6d3abe35fe2d0" title="Number of file included in play list.">pl_g_u16_list_size</a> &lt; u16_position))
<a name="l00514"></a>00514   {
<a name="l00515"></a>00515      <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#4dc7fa3cedd22ae7885138f8f9a65973" title="You are outside of the play list.">FS_ERR_PL_OUT_LST</a>;
<a name="l00516"></a>00516      <span class="keywordflow">return</span> FALSE;
<a name="l00517"></a>00517   }
<a name="l00518"></a>00518 
<a name="l00519"></a>00519   <span class="comment">// Go to play list file navigator</span>
<a name="l00520"></a>00520   nav_id_save = <a class="code" href="a00036.html#4a9efd8a5ff4c599be7994c009f0fb5f" title="This function returns the navigation identifier used.">nav_get</a>();
<a name="l00521"></a>00521   <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>(FS_NAV_ID_PLAYLIST);
<a name="l00522"></a>00522 
<a name="l00523"></a>00523   <span class="comment">// Save current file position</span>
<a name="l00524"></a>00524   u32_file_pos = <a class="code" href="a00022.html#2a08b2cfeeb2b4064f3b2fcd6829c8da" title="This function returns the position in the file.">file_getpos</a>();
<a name="l00525"></a>00525 
<a name="l00526"></a>00526   <span class="keywordflow">if</span> (<a class="code" href="a00038.html#43c5d67b8ebe2758b7362f58b755351c" title="Current file selected in play list (0= no file selected, 1= first file).">pl_g_u16_list_sel</a> &gt; u16_position)
<a name="l00527"></a>00527   {
<a name="l00528"></a>00528     <span class="comment">// Go to the beginning of the text file</span>
<a name="l00529"></a>00529     <a class="code" href="a00040.html#4f6bbd93a0b11365b77518a22b1ae098" title="This function goes at the beginning of file and read the text header.">reader_txt_beg</a>();
<a name="l00530"></a>00530     u16_current_pos = 0;
<a name="l00531"></a>00531   }
<a name="l00532"></a>00532   <span class="keywordflow">else</span>
<a name="l00533"></a>00533   {
<a name="l00534"></a>00534     u16_current_pos = <a class="code" href="a00038.html#43c5d67b8ebe2758b7362f58b755351c" title="Current file selected in play list (0= no file selected, 1= first file).">pl_g_u16_list_sel</a>;
<a name="l00535"></a>00535   }
<a name="l00536"></a>00536 
<a name="l00537"></a>00537   <span class="keywordflow">while</span>(u16_current_pos != u16_position)
<a name="l00538"></a>00538   {
<a name="l00539"></a>00539     <span class="keywordflow">if</span> (<a class="code" href="a00022.html#bed52ba7230c6eecf100a3709b9ed74e" title="This function checks the end of file.">file_eof</a>())
<a name="l00540"></a>00540     {
<a name="l00541"></a>00541       <span class="comment">// Restore file position</span>
<a name="l00542"></a>00542       <a class="code" href="a00022.html#2599f935c7e1b69f2650e0943091ddca" title="This function changes the position in the file.">file_seek</a>(u32_file_pos, <a class="code" href="a00023.html#5b33d405a458db1db212d345b21454f8" title="start at the beginning">FS_SEEK_SET</a>);
<a name="l00543"></a>00543       <span class="comment">// Reselect the previous navigator</span>
<a name="l00544"></a>00544       <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>(nav_id_save);
<a name="l00545"></a>00545       <span class="keywordflow">return</span> FALSE;
<a name="l00546"></a>00546     }
<a name="l00547"></a>00547     <span class="keywordflow">if</span> (u16_current_pos+1 == u16_position)
<a name="l00548"></a>00548     {
<a name="l00549"></a>00549       <span class="keywordflow">if</span> (<a class="code" href="a00038.html#f01e79587fade6bdd9afc994843d364c" title="This function reads and checks the next line.">pl_main_readline</a>(<a class="code" href="a00039.html#96aa34c741e50dd5fb675ccdbac9e8f034ea6e58645123ef355dd4177002e268">PL_MAIN_READLINE_OPT_GOTOPATH</a>, nav_id_save, sz_path, u16_size_line))
<a name="l00550"></a>00550         <span class="keywordflow">break</span>;
<a name="l00551"></a>00551     }
<a name="l00552"></a>00552     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="a00038.html#f01e79587fade6bdd9afc994843d364c" title="This function reads and checks the next line.">pl_main_readline</a>(<a class="code" href="a00039.html#96aa34c741e50dd5fb675ccdbac9e8f02472a994994b0c26b1fcebc9e2b06032">PL_MAIN_READLINE_OPT_CHECKLINE</a>, 0, NULL, NULL))
<a name="l00553"></a>00553       u16_current_pos++; <span class="comment">// Add a file</span>
<a name="l00554"></a>00554   }
<a name="l00555"></a>00555 
<a name="l00556"></a>00556   <span class="comment">// Restore file position</span>
<a name="l00557"></a>00557   <a class="code" href="a00022.html#2599f935c7e1b69f2650e0943091ddca" title="This function changes the position in the file.">file_seek</a>(u32_file_pos, <a class="code" href="a00023.html#5b33d405a458db1db212d345b21454f8" title="start at the beginning">FS_SEEK_SET</a>);
<a name="l00558"></a>00558   <span class="comment">// Reselect the previous navigator</span>
<a name="l00559"></a>00559   <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>(nav_id_save);
<a name="l00560"></a>00560 
<a name="l00561"></a>00561   <span class="keywordflow">return</span> TRUE;
<a name="l00562"></a>00562 }
<a name="l00563"></a>00563 
<a name="l00577"></a><a class="code" href="a00039.html#f01e79587fade6bdd9afc994843d364c">00577</a> Bool  <a class="code" href="a00038.html#f01e79587fade6bdd9afc994843d364c" title="This function reads and checks the next line.">pl_main_readline</a>( <a class="code" href="a00039.html#96aa34c741e50dd5fb675ccdbac9e8f0" title="This function reads and checks the next line.">readline_opt_t</a> opt, U8 id_nav, <a class="code" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> *sz_path, U16 *u16_size_line )
<a name="l00578"></a>00578 {
<a name="l00579"></a>00579    U16 line_beg[8];           <span class="comment">// Contains first characters of the line</span>
<a name="l00580"></a>00580    U32 u32_file_pos;
<a name="l00581"></a>00581    U16 u16_alt_length = 0;
<a name="l00582"></a>00582    U8  u8_pos_path_in_line = 0;
<a name="l00583"></a>00583 
<a name="l00584"></a>00584    <span class="comment">// Set output to NULL to specify if there is an error</span>
<a name="l00585"></a>00585    *sz_path = NULL;
<a name="l00586"></a>00586 
<a name="l00587"></a>00587    <span class="comment">// Read the 3 first char in the line</span>
<a name="l00588"></a>00588    u32_file_pos = <a class="code" href="a00022.html#2a08b2cfeeb2b4064f3b2fcd6829c8da" title="This function returns the position in the file.">file_getpos</a>();
<a name="l00589"></a>00589    <span class="keywordflow">if</span>( <a class="code" href="a00038.html#0c3455f08337dedcd64aa31097ef191882c25c5ebd4edbe7e072ab5ac19be681">E_PL_M3U</a> == <a class="code" href="a00038.html#56182ff5f21080cdc39eb8270b329ea4" title="Type of the play list.">pl_g_list_type</a> )
<a name="l00590"></a>00590    {
<a name="l00591"></a>00591       <span class="comment">// M3U path lines = "path\file"</span>
<a name="l00592"></a>00592       <span class="comment">// M3U comment lines = "#..."</span>
<a name="l00593"></a>00593       u16_alt_length = <a class="code" href="a00040.html#29030022836887d64ee7b516b93f2d4e" title="This function fills an ASCII buffer with the current text line of opened file.">reader_txt_get_line</a>( TRUE, (<a class="code" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a>)line_beg, 2 );
<a name="l00594"></a>00594       <span class="keywordflow">if</span>( (2 &gt; u16_alt_length)   <span class="comment">// The line size is not correct</span>
<a name="l00595"></a>00595       ||  (<span class="charliteral">'#'</span> == line_beg[0]) ) <span class="comment">// It is a comment line</span>
<a name="l00596"></a>00596       {
<a name="l00597"></a>00597          <span class="keywordflow">return</span> FALSE;
<a name="l00598"></a>00598       }
<a name="l00599"></a>00599       u8_pos_path_in_line=0;
<a name="l00600"></a>00600    }
<a name="l00601"></a>00601    <span class="keywordflow">if</span>( (<a class="code" href="a00038.html#0c3455f08337dedcd64aa31097ef19189ff6e70f8e629623469089e5807a6751">E_PL_PLS</a> == <a class="code" href="a00038.html#56182ff5f21080cdc39eb8270b329ea4" title="Type of the play list.">pl_g_list_type</a>) || (<a class="code" href="a00038.html#0c3455f08337dedcd64aa31097ef1918ca681f93854b4e08980ee12b7ef1abcd">E_PL_SMP</a> == <a class="code" href="a00038.html#56182ff5f21080cdc39eb8270b329ea4" title="Type of the play list.">pl_g_list_type</a>) )
<a name="l00602"></a>00602    {
<a name="l00603"></a>00603       <span class="comment">// PLS path lines = "Filexxx=path\file"</span>
<a name="l00604"></a>00604       <span class="comment">// SMP path lines = "File=path\file"</span>
<a name="l00605"></a>00605       u16_alt_length = <a class="code" href="a00040.html#29030022836887d64ee7b516b93f2d4e" title="This function fills an ASCII buffer with the current text line of opened file.">reader_txt_get_line</a>( TRUE, (<a class="code" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a>)line_beg, 8 );
<a name="l00606"></a>00606       <span class="keywordflow">if</span>(6 &gt; u16_alt_length)     <span class="comment">// The line size can't containt a path line</span>
<a name="l00607"></a>00607          <span class="keywordflow">return</span> FALSE;
<a name="l00608"></a>00608       <span class="comment">// Check if it is a path line</span>
<a name="l00609"></a>00609       <span class="keywordflow">if</span>( (<span class="charliteral">'F'</span> != line_beg[0])
<a name="l00610"></a>00610       ||  (<span class="charliteral">'i'</span> != line_beg[1])
<a name="l00611"></a>00611       ||  (<span class="charliteral">'l'</span> != line_beg[2])
<a name="l00612"></a>00612       ||  (<span class="charliteral">'e'</span> != line_beg[3]) )
<a name="l00613"></a>00613       {
<a name="l00614"></a>00614          <span class="keywordflow">return</span> FALSE;
<a name="l00615"></a>00615       }
<a name="l00616"></a>00616       u8_pos_path_in_line=5;
<a name="l00617"></a>00617       <span class="keywordflow">if</span>(<span class="charliteral">'='</span> != line_beg[4])
<a name="l00618"></a>00618       {
<a name="l00619"></a>00619          u8_pos_path_in_line++;
<a name="l00620"></a>00620          <span class="keywordflow">if</span>(<span class="charliteral">'='</span> != line_beg[5])
<a name="l00621"></a>00621          {
<a name="l00622"></a>00622             u8_pos_path_in_line++;
<a name="l00623"></a>00623             <span class="keywordflow">if</span>(<span class="charliteral">'='</span> != line_beg[6])
<a name="l00624"></a>00624             {
<a name="l00625"></a>00625                u8_pos_path_in_line++;
<a name="l00626"></a>00626                <span class="keywordflow">if</span>(<span class="charliteral">'='</span> != line_beg[7])
<a name="l00627"></a>00627                   <span class="keywordflow">return</span> FALSE;
<a name="l00628"></a>00628             }
<a name="l00629"></a>00629          }
<a name="l00630"></a>00630       }
<a name="l00631"></a>00631    }
<a name="l00632"></a>00632    <span class="comment">// Here, the line contains a path</span>
<a name="l00633"></a>00633 
<a name="l00634"></a>00634    <span class="comment">// Store the length of the line if a buffer is set</span>
<a name="l00635"></a>00635    <span class="keywordflow">if</span> (u16_size_line)
<a name="l00636"></a>00636      *u16_size_line = u16_alt_length - u8_pos_path_in_line;
<a name="l00637"></a>00637    <span class="keywordflow">if</span> (opt == <a class="code" href="a00039.html#96aa34c741e50dd5fb675ccdbac9e8f02472a994994b0c26b1fcebc9e2b06032">PL_MAIN_READLINE_OPT_CHECKLINE</a>)
<a name="l00638"></a>00638       <span class="keywordflow">return</span> TRUE;
<a name="l00639"></a>00639    <span class="comment">// else go to path</span>
<a name="l00640"></a>00640 
<a name="l00641"></a>00641    <span class="comment">// Read all characters in line</span>
<a name="l00642"></a>00642    <a class="code" href="a00022.html#2599f935c7e1b69f2650e0943091ddca" title="This function changes the position in the file.">file_seek</a>( u32_file_pos, <a class="code" href="a00023.html#5b33d405a458db1db212d345b21454f8" title="start at the beginning">FS_SEEK_SET</a> );
<a name="l00643"></a>00643    *sz_path = PLAYLIST_BUF_ALLOC( u16_alt_length * (<a class="code" href="a00020.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>? 2 : 1 ) );
<a name="l00644"></a>00644    <span class="keywordflow">if</span>( NULL == *sz_path )
<a name="l00645"></a>00645       <span class="keywordflow">return</span> FALSE;   <span class="comment">// no enought memory, impossible to store the path but path present in line</span>
<a name="l00646"></a>00646    <span class="keywordflow">if</span>( 0 == <a class="code" href="a00040.html#29030022836887d64ee7b516b93f2d4e" title="This function fills an ASCII buffer with the current text line of opened file.">reader_txt_get_line</a>( (<a class="code" href="a00016.html#f09bf00c466c5beea4340e55484677cc">FS_UNICODE</a>==ENABLED), *sz_path, u16_alt_length ) )
<a name="l00647"></a>00647       <span class="keywordflow">return</span> FALSE;  <span class="comment">// Error during the read</span>
<a name="l00648"></a>00648    <span class="keywordflow">if</span>( 0 != u8_pos_path_in_line )
<a name="l00649"></a>00649    {
<a name="l00650"></a>00650       <span class="comment">// Shift the path to the beginning of the buffer</span>
<a name="l00651"></a>00651       memmove(*sz_path, *sz_path + u8_pos_path_in_line * ((<a class="code" href="a00016.html#f09bf00c466c5beea4340e55484677cc">FS_UNICODE</a>==ENABLED) ? 2 : 1),
<a name="l00652"></a>00652               (u16_alt_length - u8_pos_path_in_line) * ((<a class="code" href="a00016.html#f09bf00c466c5beea4340e55484677cc">FS_UNICODE</a>==ENABLED) ? 2 : 1));
<a name="l00653"></a>00653    }
<a name="l00654"></a>00654    <span class="keywordflow">if</span> (opt == <a class="code" href="a00039.html#96aa34c741e50dd5fb675ccdbac9e8f05842e47ee668bd9649d03f32a046c6f1">PL_MAIN_READLINE_OPT_READSTRING</a>)
<a name="l00655"></a>00655      <span class="keywordflow">return</span> TRUE;
<a name="l00656"></a>00656 
<a name="l00657"></a>00657    <span class="comment">// Update the navigator with the path of play list file, because the path is relatif at this one</span>
<a name="l00658"></a>00658    <a class="code" href="a00036.html#3b58f8c4afeb6714cd2c7eb61058da0d" title="This function copys the navigator information to another navigator.">nav_copy</a>( id_nav );
<a name="l00659"></a>00659    <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( id_nav );
<a name="l00660"></a>00660    <span class="comment">// Go to the path included in the line</span>
<a name="l00661"></a>00661    <span class="keywordflow">if</span>( !<a class="code" href="a00036.html#3d3f2ed17daf26a7aedc2a561cee2558" title="This function selects a disk position via a path.">nav_setcwd</a>( (<a class="code" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a>) *sz_path , FALSE, FALSE ) )
<a name="l00662"></a>00662    {
<a name="l00663"></a>00663       <span class="comment">// path no found then path is dead -&gt; reset list to deselect a file</span>
<a name="l00664"></a>00664       <a class="code" href="a00036.html#7ad0aa092d133a156651abe5d871b8eb" title="This function resets the selection pointer, so &amp;quot;no file selected&amp;quot; in file...">nav_filelist_reset</a>();
<a name="l00665"></a>00665    }
<a name="l00666"></a>00666    <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( FS_NAV_ID_PLAYLIST );
<a name="l00667"></a>00667 
<a name="l00668"></a>00668    <span class="keywordflow">return</span> TRUE;
<a name="l00669"></a>00669 }
<a name="l00670"></a>00670 
<a name="l00671"></a>00671 
<a name="l00672"></a>00672 <span class="comment">//********************* Play list control position *********************</span>
<a name="l00673"></a>00673 
<a name="l00674"></a>00674 
<a name="l00679"></a><a class="code" href="a00039.html#bc2272f9c3366519ca4944ea505c0eef">00679</a> Bool  <a class="code" href="a00038.html#bc2272f9c3366519ca4944ea505c0eef" title="This function tests the valid path in list.">pl_sel_isvalid</a>( <span class="keywordtype">void</span> )
<a name="l00680"></a>00680 {
<a name="l00681"></a>00681    <span class="keywordflow">if</span>(!<a class="code" href="a00038.html#9dfed43a52815cf4c80eaaeee7b3f06b" title="This function checks if a play list file is already opened.">pl_main_isopen</a>())
<a name="l00682"></a>00682       <span class="keywordflow">return</span> FALSE;
<a name="l00683"></a>00683    <span class="keywordflow">if</span>(0 == <a class="code" href="a00038.html#43c5d67b8ebe2758b7362f58b755351c" title="Current file selected in play list (0= no file selected, 1= first file).">pl_g_u16_list_sel</a>)
<a name="l00684"></a>00684       <span class="keywordflow">return</span> FALSE;
<a name="l00685"></a>00685    <span class="keywordflow">return</span> <a class="code" href="a00036.html#dd6435ba1a2f0a8ddc072883c05a1a64" title="This function checks if a file is selected.">nav_filelist_validpos</a>();
<a name="l00686"></a>00686 }
<a name="l00687"></a>00687 
<a name="l00688"></a>00688 
<a name="l00689"></a>00689 <span class="comment">//********************* Play list additional functions *********************</span>
<a name="l00690"></a>00690 
<a name="l00691"></a>00691 
<a name="l00692"></a>00692 <span class="preprocessor">#if( PL_READONLY == DISABLED )</span>
<a name="l00705"></a><a class="code" href="a00039.html#eeb0d95a543d3f02445441fb48f31e94">00705</a> <span class="preprocessor">Bool   pl_add( const FS_STRING sz_filterext , U8 u8_mode )</span>
<a name="l00706"></a>00706 <span class="preprocessor"></span>{
<a name="l00707"></a>00707    U8 nav_id_save;
<a name="l00708"></a>00708    U8 u8_folder_level;
<a name="l00709"></a>00709 
<a name="l00710"></a>00710    <span class="keywordflow">if</span>( !<a class="code" href="a00038.html#91909ac1c0efb364b14637df0dc516fa" title="This function creates a copy of the play list in case of a restore action.">pl_main_modify</a>() )
<a name="l00711"></a>00711       <span class="keywordflow">return</span> FALSE;
<a name="l00712"></a>00712    nav_id_save = <a class="code" href="a00036.html#4a9efd8a5ff4c599be7994c009f0fb5f" title="This function returns the navigation identifier used.">nav_get</a>();
<a name="l00713"></a>00713 
<a name="l00714"></a>00714    <span class="comment">// Check last character of file</span>
<a name="l00715"></a>00715    <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( FS_NAV_ID_PLAYLIST );
<a name="l00716"></a>00716    <span class="keywordflow">if</span>( 0!=<a class="code" href="a00036.html#c3989dc4a26fbbdf0726fafae6fe4648" title="This function returns the size of selected file (unit byte).">nav_file_lgt</a>() )
<a name="l00717"></a>00717    {
<a name="l00718"></a>00718 <span class="preprocessor">#if( PL_UNICODE == ENABLED)</span>
<a name="l00719"></a>00719 <span class="preprocessor"></span>      file_string_unicode();
<a name="l00720"></a>00720       <a class="code" href="a00022.html#2599f935c7e1b69f2650e0943091ddca" title="This function changes the position in the file.">file_seek</a>( 2, <a class="code" href="a00023.html#ea9734cc236a73aefd3b35444d08d39d" title="start at the end of file and rewind">FS_SEEK_END</a>);
<a name="l00721"></a>00721       <span class="keywordflow">if</span>( <span class="charliteral">'\n'</span> != <a class="code" href="a00022.html#952fd54b2e49943d138e44d3bdf569bf" title="This function returns the next byte of file.">file_getc</a>())
<a name="l00722"></a>00722       {
<a name="l00723"></a>00723          <a class="code" href="a00022.html#2599f935c7e1b69f2650e0943091ddca" title="This function changes the position in the file.">file_seek</a>( 2, <a class="code" href="a00023.html#ea9734cc236a73aefd3b35444d08d39d" title="start at the end of file and rewind">FS_SEEK_END</a>);
<a name="l00724"></a>00724          <a class="code" href="a00022.html#44de4bc08663fbddbd11946bbb06e2ce" title="This function writes a byte in the file.">file_putc</a>(<span class="charliteral">'\n'</span>);
<a name="l00725"></a>00725       }
<a name="l00726"></a>00726       file_string_ascii();
<a name="l00727"></a>00727 <span class="preprocessor">#else</span>
<a name="l00728"></a>00728 <span class="preprocessor"></span>      <a class="code" href="a00022.html#2599f935c7e1b69f2650e0943091ddca" title="This function changes the position in the file.">file_seek</a>( 1, <a class="code" href="a00023.html#ea9734cc236a73aefd3b35444d08d39d" title="start at the end of file and rewind">FS_SEEK_END</a>);
<a name="l00729"></a>00729       <span class="keywordflow">if</span>( <span class="charliteral">'\n'</span> != <a class="code" href="a00022.html#952fd54b2e49943d138e44d3bdf569bf" title="This function returns the next byte of file.">file_getc</a>())
<a name="l00730"></a>00730       {
<a name="l00731"></a>00731          <a class="code" href="a00022.html#2599f935c7e1b69f2650e0943091ddca" title="This function changes the position in the file.">file_seek</a>( 1, <a class="code" href="a00023.html#ea9734cc236a73aefd3b35444d08d39d" title="start at the end of file and rewind">FS_SEEK_END</a>);
<a name="l00732"></a>00732          <a class="code" href="a00022.html#44de4bc08663fbddbd11946bbb06e2ce" title="This function writes a byte in the file.">file_putc</a>(<span class="charliteral">'\n'</span>);
<a name="l00733"></a>00733       }
<a name="l00734"></a>00734 <span class="preprocessor">#endif</span>
<a name="l00735"></a>00735 <span class="preprocessor"></span>   }
<a name="l00736"></a>00736    <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( nav_id_save );
<a name="l00737"></a>00737 
<a name="l00738"></a>00738    <span class="comment">// Get path of play list file and check with curent to create a relative path</span>
<a name="l00739"></a>00739 
<a name="l00740"></a>00740    <span class="keywordflow">if</span>( <a class="code" href="a00039.html#2496848c16cf7bd5ce45f402f89a7deb">PL_ADD_FILE</a> == u8_mode )
<a name="l00741"></a>00741       <span class="keywordflow">goto</span> pl_add_file;
<a name="l00742"></a>00742 
<a name="l00743"></a>00743    <span class="comment">// Add all files valid in current dir</span>
<a name="l00744"></a>00744    u8_folder_level = 0;
<a name="l00745"></a>00745    <a class="code" href="a00036.html#7ad0aa092d133a156651abe5d871b8eb" title="This function resets the selection pointer, so &amp;quot;no file selected&amp;quot; in file...">nav_filelist_reset</a>();
<a name="l00746"></a>00746    <span class="keywordflow">while</span>(1)
<a name="l00747"></a>00747    {
<a name="l00748"></a>00748       <span class="keywordflow">while</span>(1)
<a name="l00749"></a>00749       {
<a name="l00750"></a>00750          <span class="keywordflow">if</span>( <a class="code" href="a00036.html#066eaff61613f07dc5fb1f3313747aef" title="This function moves the selection pointer in file list.">nav_filelist_set</a>( 0 , <a class="code" href="a00037.html#793c4ce9436637d68ab25dc859abc35a" title="move in list to next file">FS_FIND_NEXT</a> ) )
<a name="l00751"></a>00751             <span class="keywordflow">break</span>;   <span class="comment">// a next file and directory is found</span>
<a name="l00752"></a>00752          <span class="comment">// No other dir or file in current dir then go to parent dir</span>
<a name="l00753"></a>00753          <span class="keywordflow">if</span>( 0 == u8_folder_level )
<a name="l00754"></a>00754             <span class="keywordflow">goto</span> pl_add_end;  <span class="comment">// end of ADD</span>
<a name="l00755"></a>00755          <span class="comment">// Remark, nav_dir_gotoparent() routine go to in parent dir and select the children dir in list</span>
<a name="l00756"></a>00756          u8_folder_level--;
<a name="l00757"></a>00757          <span class="keywordflow">if</span>( !<a class="code" href="a00036.html#b37aa8fc84aca800a020da78724d729e" title="This function goes to the parent directory.">nav_dir_gotoparent</a>() )
<a name="l00758"></a>00758             <span class="keywordflow">return</span> FALSE;
<a name="l00759"></a>00759       }
<a name="l00760"></a>00760 
<a name="l00761"></a>00761       <span class="keywordflow">if</span>( <a class="code" href="a00036.html#0e9d8d4d0a438b0803c57c775e6c3b9c" title="This function returns the type of selected file.">nav_file_isdir</a>())
<a name="l00762"></a>00762       {
<a name="l00763"></a>00763          <span class="keywordflow">if</span>( <a class="code" href="a00039.html#9c22455714b8b706db12b43f492df53c">PL_ADD_SUBDIR</a> == u8_mode )
<a name="l00764"></a>00764          {  <span class="comment">// Enter in sub dir</span>
<a name="l00765"></a>00765             <span class="keywordflow">if</span>( !<a class="code" href="a00036.html#dca006b356e65cb05459f7bd7917a1ed" title="This function enters in the selected directory in file list.">nav_dir_cd</a>())
<a name="l00766"></a>00766                <span class="keywordflow">return</span> FALSE;
<a name="l00767"></a>00767             u8_folder_level++;
<a name="l00768"></a>00768          }
<a name="l00769"></a>00769       }
<a name="l00770"></a>00770       <span class="keywordflow">else</span>
<a name="l00771"></a>00771       {
<a name="l00772"></a>00772 pl_add_file:
<a name="l00773"></a>00773          <span class="keywordflow">if</span>( <a class="code" href="a00036.html#4a3e65b107c26de2f7ff4fb1d2a854e3" title="This function checks the extension of selected file.">nav_file_checkext</a>( sz_filterext ) )
<a name="l00774"></a>00774          {
<a name="l00775"></a>00775             <span class="comment">// It is a valid file</span>
<a name="l00776"></a>00776             <span class="comment">// Get name of current file</span>
<a name="l00777"></a>00777 <span class="preprocessor">#if( (FS_ASCII == ENABLED) &amp;&amp; (FS_UNICODE == ENABLED) &amp;&amp; (PL_UNICODE == DISABLED) )</span>
<a name="l00778"></a>00778 <span class="preprocessor"></span>            <a class="code" href="a00036.html#7489cf6b312750301cb7df5b915b436a" title="This function selects the ASCII mode for all routines with FS_STRING parameter.">nav_string_ascii</a>();
<a name="l00779"></a>00779 <span class="preprocessor">#endif</span>
<a name="l00780"></a>00780 <span class="preprocessor"></span>            <a class="code" href="a00036.html#661d4a0464a9da163de1e07aa9196f0d" title="This function returns the full path of the selection.">nav_getcwd</a>( (<a class="code" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a>)<a class="code" href="a00016.html#08e2b05f904fab3d8f09f4f24ef214c5" title="Cache to store the path of a file (here, mapped onto a global buffer).">pl_cache_path</a>, <a class="code" href="a00016.html#a16bb33f4d06580450e9141815d35f5f" title="Size of cache to store the path of a file.">PL_CACHE_PATH_MAX_SIZE</a>, TRUE );
<a name="l00781"></a>00781 <span class="preprocessor">#if( (FS_ASCII == ENABLED) &amp;&amp; (FS_UNICODE == ENABLED) &amp;&amp; (PL_UNICODE == DISABLED) )</span>
<a name="l00782"></a>00782 <span class="preprocessor"></span>            <a class="code" href="a00036.html#69ee3def8525352e53819df1f975dd86" title="This function selects the UNICODE mode for all routines with FS_STRING parameter...">nav_string_unicode</a>();
<a name="l00783"></a>00783 <span class="preprocessor">#endif</span>
<a name="l00784"></a>00784 <span class="preprocessor"></span>            <span class="comment">// Write path in file list</span>
<a name="l00785"></a>00785             <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( FS_NAV_ID_PLAYLIST );
<a name="l00786"></a>00786 <span class="preprocessor">#if( PL_UNICODE == ENABLED)</span>
<a name="l00787"></a>00787 <span class="preprocessor"></span>            file_string_unicode();
<a name="l00788"></a>00788 <span class="preprocessor">#endif</span>
<a name="l00789"></a>00789 <span class="preprocessor"></span>            <span class="keywordflow">if</span>( file_puts(pl_cache_path))
<a name="l00790"></a>00790                <a class="code" href="a00022.html#44de4bc08663fbddbd11946bbb06e2ce" title="This function writes a byte in the file.">file_putc</a>(<span class="charliteral">'\n'</span>);
<a name="l00791"></a>00791 <span class="preprocessor">#if( PL_UNICODE == ENABLED)</span>
<a name="l00792"></a>00792 <span class="preprocessor"></span>            file_string_ascii();
<a name="l00793"></a>00793 <span class="preprocessor">#endif</span>
<a name="l00794"></a>00794 <span class="preprocessor"></span>            <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( nav_id_save );
<a name="l00795"></a>00795             <a class="code" href="a00038.html#a18a22be8e8c964836b6d3abe35fe2d0" title="Number of file included in play list.">pl_g_u16_list_size</a>++;
<a name="l00796"></a>00796          }
<a name="l00797"></a>00797          <span class="keywordflow">if</span>( <a class="code" href="a00039.html#2496848c16cf7bd5ce45f402f89a7deb">PL_ADD_FILE</a> == u8_mode )
<a name="l00798"></a>00798             <span class="keywordflow">goto</span> pl_add_end;
<a name="l00799"></a>00799       } <span class="comment">// if dir OR file</span>
<a name="l00800"></a>00800    } <span class="comment">// end of first while(1)</span>
<a name="l00801"></a>00801 
<a name="l00802"></a>00802 pl_add_end:
<a name="l00803"></a>00803    <span class="comment">// Go to beginning of file AND no file selected</span>
<a name="l00804"></a>00804    <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( FS_NAV_ID_PLAYLIST );
<a name="l00805"></a>00805    <a class="code" href="a00022.html#2599f935c7e1b69f2650e0943091ddca" title="This function changes the position in the file.">file_seek</a>( 0 , <a class="code" href="a00023.html#5b33d405a458db1db212d345b21454f8" title="start at the beginning">FS_SEEK_SET</a> );
<a name="l00806"></a>00806    <a class="code" href="a00038.html#43c5d67b8ebe2758b7362f58b755351c" title="Current file selected in play list (0= no file selected, 1= first file).">pl_g_u16_list_sel</a> = 0;
<a name="l00807"></a>00807    <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( nav_id_save );
<a name="l00808"></a>00808    <span class="keywordflow">return</span> TRUE;
<a name="l00809"></a>00809 }
<a name="l00810"></a>00810 <span class="preprocessor">#endif</span>
<a name="l00811"></a>00811 <span class="preprocessor"></span>
<a name="l00812"></a>00812 
<a name="l00813"></a>00813 <span class="comment">//********************* Play list remove functions *********************</span>
<a name="l00814"></a>00814 
<a name="l00815"></a>00815 <span class="preprocessor">#if( PL_READONLY == DISABLED )</span>
<a name="l00816"></a>00816 <span class="preprocessor"></span>
<a name="l00822"></a><a class="code" href="a00039.html#740b78bbbd6b515f6aea668466e4b279">00822</a> Bool   <a class="code" href="a00038.html#740b78bbbd6b515f6aea668466e4b279" title="This function removes all files in the list.">pl_rem_sel_all</a>( <span class="keywordtype">void</span> )
<a name="l00823"></a>00823 {
<a name="l00824"></a>00824    U8 nav_id_save;
<a name="l00825"></a>00825    Bool b_status;
<a name="l00826"></a>00826 
<a name="l00827"></a>00827    <span class="keywordflow">if</span>( !<a class="code" href="a00038.html#91909ac1c0efb364b14637df0dc516fa" title="This function creates a copy of the play list in case of a restore action.">pl_main_modify</a>() )
<a name="l00828"></a>00828       <span class="keywordflow">return</span> FALSE;
<a name="l00829"></a>00829 
<a name="l00830"></a>00830    nav_id_save = <a class="code" href="a00036.html#4a9efd8a5ff4c599be7994c009f0fb5f" title="This function returns the navigation identifier used.">nav_get</a>();
<a name="l00831"></a>00831    <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( FS_NAV_ID_PLAYLIST );
<a name="l00832"></a>00832    <span class="comment">// Go to beginning of file AND set eof to have a size = 0</span>
<a name="l00833"></a>00833    <a class="code" href="a00022.html#2599f935c7e1b69f2650e0943091ddca" title="This function changes the position in the file.">file_seek</a>( 0 , <a class="code" href="a00023.html#5b33d405a458db1db212d345b21454f8" title="start at the beginning">FS_SEEK_SET</a> );
<a name="l00834"></a>00834    b_status = <a class="code" href="a00022.html#07a8faa41a278961fccc5c0793b01ab1" title="This function sets the end of file at the current position.">file_set_eof</a>();
<a name="l00835"></a>00835    <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( nav_id_save );
<a name="l00836"></a>00836    <span class="keywordflow">return</span> b_status;
<a name="l00837"></a>00837 }
<a name="l00838"></a>00838 
<a name="l00839"></a>00839 
<a name="l00845"></a><a class="code" href="a00039.html#8be06ed22f78ede3e41cc52b7ab6b085">00845</a> Bool   <a class="code" href="a00038.html#8be06ed22f78ede3e41cc52b7ab6b085" title="This function removes the selected file in the list.">pl_rem_sel</a>( <span class="keywordtype">void</span> )
<a name="l00846"></a>00846 {
<a name="l00847"></a>00847    U8 nav_id_save;
<a name="l00848"></a>00848    Bool b_status = FALSE;
<a name="l00849"></a>00849 
<a name="l00850"></a>00850    <span class="keywordflow">if</span>( !<a class="code" href="a00038.html#91909ac1c0efb364b14637df0dc516fa" title="This function creates a copy of the play list in case of a restore action.">pl_main_modify</a>() )
<a name="l00851"></a>00851       <span class="keywordflow">return</span> FALSE;
<a name="l00852"></a>00852    <span class="keywordflow">if</span>( 0 == <a class="code" href="a00038.html#43c5d67b8ebe2758b7362f58b755351c" title="Current file selected in play list (0= no file selected, 1= first file).">pl_g_u16_list_sel</a> )
<a name="l00853"></a>00853    {
<a name="l00854"></a>00854       <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#4dc7fa3cedd22ae7885138f8f9a65973" title="You are outside of the play list.">FS_ERR_PL_OUT_LST</a>;
<a name="l00855"></a>00855       <span class="keywordflow">return</span> FALSE;
<a name="l00856"></a>00856    }
<a name="l00857"></a>00857    nav_id_save = <a class="code" href="a00036.html#4a9efd8a5ff4c599be7994c009f0fb5f" title="This function returns the navigation identifier used.">nav_get</a>();
<a name="l00858"></a>00858    <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( FS_NAV_ID_PLAYLIST );
<a name="l00859"></a>00859 
<a name="l00860"></a>00860    <span class="comment">// Jump at the beginning of the current path</span>
<a name="l00861"></a>00861 <span class="preprocessor">#if( PL_UNICODE == ENABLED)</span>
<a name="l00862"></a>00862 <span class="preprocessor"></span>   file_string_unicode();
<a name="l00863"></a>00863    <span class="keywordflow">if</span>( !<a class="code" href="a00022.html#2599f935c7e1b69f2650e0943091ddca" title="This function changes the position in the file.">file_seek</a>( pl_g_u16_path_size*2 , <a class="code" href="a00023.html#f546c33414158e18f0a25b795f402ccf" title="start at the current position and rewind">FS_SEEK_CUR_RE</a> ))
<a name="l00864"></a>00864       <span class="keywordflow">goto</span> pl_rem_sys_err;
<a name="l00865"></a>00865 <span class="preprocessor">#else</span>
<a name="l00866"></a>00866 <span class="preprocessor"></span>   <span class="keywordflow">if</span>( !<a class="code" href="a00022.html#2599f935c7e1b69f2650e0943091ddca" title="This function changes the position in the file.">file_seek</a>( pl_g_u16_path_size , <a class="code" href="a00023.html#f546c33414158e18f0a25b795f402ccf" title="start at the current position and rewind">FS_SEEK_CUR_RE</a> ))
<a name="l00867"></a>00867       <span class="keywordflow">goto</span> pl_rem_sys_err;
<a name="l00868"></a>00868 <span class="preprocessor">#endif</span>
<a name="l00869"></a>00869 <span class="preprocessor"></span>
<a name="l00870"></a>00870    <span class="comment">// Comment the line</span>
<a name="l00871"></a>00871    <span class="keywordflow">if</span>( !<a class="code" href="a00022.html#44de4bc08663fbddbd11946bbb06e2ce" title="This function writes a byte in the file.">file_putc</a>(<span class="charliteral">'#'</span>))
<a name="l00872"></a>00872       <span class="keywordflow">goto</span> pl_rem_sys_err;
<a name="l00873"></a>00873    b_status = TRUE;
<a name="l00874"></a>00874    <a class="code" href="a00038.html#a18a22be8e8c964836b6d3abe35fe2d0" title="Number of file included in play list.">pl_g_u16_list_size</a>--;
<a name="l00875"></a>00875 
<a name="l00876"></a>00876 pl_rem_sys_err:
<a name="l00877"></a>00877 <span class="preprocessor">#if( PL_UNICODE == ENABLED)</span>
<a name="l00878"></a>00878 <span class="preprocessor"></span>    file_string_ascii();
<a name="l00879"></a>00879 <span class="preprocessor">#endif</span>
<a name="l00880"></a>00880 <span class="preprocessor"></span>   <span class="comment">// Go to beginning of file AND no file selected</span>
<a name="l00881"></a>00881    <a class="code" href="a00022.html#2599f935c7e1b69f2650e0943091ddca" title="This function changes the position in the file.">file_seek</a>( 0 , <a class="code" href="a00023.html#5b33d405a458db1db212d345b21454f8" title="start at the beginning">FS_SEEK_SET</a> );
<a name="l00882"></a>00882    <a class="code" href="a00038.html#43c5d67b8ebe2758b7362f58b755351c" title="Current file selected in play list (0= no file selected, 1= first file).">pl_g_u16_list_sel</a> = 0;
<a name="l00883"></a>00883    <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( nav_id_save );
<a name="l00884"></a>00884    <span class="keywordflow">return</span> b_status;
<a name="l00885"></a>00885 }
<a name="l00886"></a>00886 
<a name="l00887"></a>00887 
<a name="l00893"></a><a class="code" href="a00039.html#abfd8b5e7bb120c39ff07e87e84474f6">00893</a> Bool <a class="code" href="a00038.html#abfd8b5e7bb120c39ff07e87e84474f6" title="This function remove the dead file in the list.">pl_rem_dead</a>( <span class="keywordtype">void</span> )
<a name="l00894"></a>00894 {
<a name="l00895"></a>00895    U8 nav_id_save;
<a name="l00896"></a>00896 
<a name="l00897"></a>00897    <a class="code" href="a00038.html#43c5d67b8ebe2758b7362f58b755351c" title="Current file selected in play list (0= no file selected, 1= first file).">pl_g_u16_list_sel</a> = 0;
<a name="l00898"></a>00898 
<a name="l00899"></a>00899    nav_id_save = <a class="code" href="a00036.html#4a9efd8a5ff4c599be7994c009f0fb5f" title="This function returns the navigation identifier used.">nav_get</a>();
<a name="l00900"></a>00900    <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( FS_NAV_ID_PLAYLIST );
<a name="l00901"></a>00901 
<a name="l00902"></a>00902    <span class="keywordflow">while</span>( <a class="code" href="a00038.html#43c5d67b8ebe2758b7362f58b755351c" title="Current file selected in play list (0= no file selected, 1= first file).">pl_g_u16_list_sel</a> &lt; <a class="code" href="a00038.html#a18a22be8e8c964836b6d3abe35fe2d0" title="Number of file included in play list.">pl_g_u16_list_size</a> )
<a name="l00903"></a>00903    {
<a name="l00904"></a>00904       <span class="keywordflow">if</span>( <a class="code" href="a00036.html#503f8d42be2b70cb554589ac7974ed78" title="This function selects a file in the navigator via a file index.">nav_gotoindex</a>( &amp;pl_g_list[ <a class="code" href="a00038.html#43c5d67b8ebe2758b7362f58b755351c" title="Current file selected in play list (0= no file selected, 1= first file).">pl_g_u16_list_sel</a> ] ))
<a name="l00905"></a>00905       {
<a name="l00906"></a>00906          <span class="comment">// the file is good -&gt; go to next file in list</span>
<a name="l00907"></a>00907          pl_g_u16_list_sel++;
<a name="l00908"></a>00908          <span class="keywordflow">continue</span>;
<a name="l00909"></a>00909       }
<a name="l00910"></a>00910 
<a name="l00911"></a>00911       <span class="comment">// The file is dead -&gt; remove this one</span>
<a name="l00912"></a>00912       <a class="code" href="a00038.html#8be06ed22f78ede3e41cc52b7ab6b085" title="This function removes the selected file in the list.">pl_rem_sel</a>();
<a name="l00913"></a>00913    }
<a name="l00914"></a>00914    <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( nav_id_save );
<a name="l00915"></a>00915    <a class="code" href="a00038.html#6762440ecae73bb09b47f5c6eadf41bf" title="This function goes to a position in the play list.">pl_nav_setpos</a>(0);
<a name="l00916"></a>00916 }
<a name="l00917"></a>00917 
<a name="l00918"></a>00918 <span class="preprocessor">#endif  // ( PL_READONLY == DISABLED )</span>
<a name="l00919"></a>00919 <span class="preprocessor"></span>
<a name="l00920"></a>00920 <span class="preprocessor">#if defined(PLAYLIST_USE_NON_BLOCKING_FUNCTION_SET) &amp;&amp; \</span>
<a name="l00921"></a>00921 <span class="preprocessor">    PLAYLIST_USE_NON_BLOCKING_FUNCTION_SET == ENABLED</span>
<a name="l00922"></a>00922 <span class="preprocessor"></span>
<a name="l00923"></a>00923 <span class="comment">//********************* Play list non-blocking function set ********************</span>
<a name="l00924"></a>00924 
<a name="l00935"></a>00935 Bool pl_main_open_non_blocking(U16 u16_n)
<a name="l00936"></a>00936 {
<a name="l00937"></a>00937   ai_async_context_t ctx;
<a name="l00938"></a>00938   U16 u16_current_count = 0;
<a name="l00939"></a>00939   <span class="keyword">static</span> U8 nav_id_save;
<a name="l00940"></a>00940   <span class="keyword">typedef</span> <span class="keyword">enum</span>
<a name="l00941"></a>00941   {
<a name="l00942"></a>00942     STATE_INITIALIZATION = 0,
<a name="l00943"></a>00943     STATE_GET_LINK_COUNT,
<a name="l00944"></a>00944     STATE_INIT_PLAYLIST_CONTEXT,
<a name="l00945"></a>00945     STATE_END
<a name="l00946"></a>00946   } state_t;
<a name="l00947"></a>00947 
<a name="l00948"></a>00948   <span class="comment">// If FALSE, means it is the first call</span>
<a name="l00949"></a>00949   <span class="keywordflow">if</span> (!ai_async_context_pop(&amp;ctx))
<a name="l00950"></a>00950     ctx.state = (state_t) STATE_INITIALIZATION;
<a name="l00951"></a>00951   <span class="comment">// By default set the status to DONE</span>
<a name="l00952"></a>00952   ctx.status = CMD_DONE;
<a name="l00953"></a>00953 
<a name="l00954"></a>00954   <span class="keywordflow">switch</span>((state_t) ctx.state)
<a name="l00955"></a>00955   {
<a name="l00956"></a>00956   <span class="comment">// Intialization</span>
<a name="l00957"></a>00957   <span class="keywordflow">case</span> STATE_INITIALIZATION:
<a name="l00958"></a>00958     <span class="keywordflow">if</span> (<a class="code" href="a00038.html#9dfed43a52815cf4c80eaaeee7b3f06b" title="This function checks if a play list file is already opened.">pl_main_isopen</a>())
<a name="l00959"></a>00959       <span class="keywordflow">return</span> FALSE;
<a name="l00960"></a>00960     <span class="comment">// Select the play list file in "play list" navigator</span>
<a name="l00961"></a>00961     <span class="comment">// Save current navigator</span>
<a name="l00962"></a>00962     nav_id_save = <a class="code" href="a00036.html#4a9efd8a5ff4c599be7994c009f0fb5f" title="This function returns the navigation identifier used.">nav_get</a>();
<a name="l00963"></a>00963     <a class="code" href="a00036.html#3b58f8c4afeb6714cd2c7eb61058da0d" title="This function copys the navigator information to another navigator.">nav_copy</a>(FS_NAV_ID_PLAYLIST);
<a name="l00964"></a>00964     <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>(FS_NAV_ID_PLAYLIST);
<a name="l00965"></a>00965     <span class="comment">// Make sure the selected file is a playlist</span>
<a name="l00966"></a>00966     <span class="keywordflow">if</span> (<a class="code" href="a00036.html#4a3e65b107c26de2f7ff4fb1d2a854e3" title="This function checks the extension of selected file.">nav_file_checkext</a>(<span class="stringliteral">"m3u"</span>))
<a name="l00967"></a>00967       <a class="code" href="a00038.html#56182ff5f21080cdc39eb8270b329ea4" title="Type of the play list.">pl_g_list_type</a> = <a class="code" href="a00038.html#0c3455f08337dedcd64aa31097ef191882c25c5ebd4edbe7e072ab5ac19be681">E_PL_M3U</a>;
<a name="l00968"></a>00968     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="a00036.html#4a3e65b107c26de2f7ff4fb1d2a854e3" title="This function checks the extension of selected file.">nav_file_checkext</a>(<span class="stringliteral">"pls"</span>))
<a name="l00969"></a>00969       <a class="code" href="a00038.html#56182ff5f21080cdc39eb8270b329ea4" title="Type of the play list.">pl_g_list_type</a> = <a class="code" href="a00038.html#0c3455f08337dedcd64aa31097ef19189ff6e70f8e629623469089e5807a6751">E_PL_PLS</a>;
<a name="l00970"></a>00970     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="a00036.html#4a3e65b107c26de2f7ff4fb1d2a854e3" title="This function checks the extension of selected file.">nav_file_checkext</a>(<span class="stringliteral">"smp"</span>))
<a name="l00971"></a>00971       <a class="code" href="a00038.html#56182ff5f21080cdc39eb8270b329ea4" title="Type of the play list.">pl_g_list_type</a> = <a class="code" href="a00038.html#0c3455f08337dedcd64aa31097ef1918ca681f93854b4e08980ee12b7ef1abcd">E_PL_SMP</a>;
<a name="l00972"></a>00972     <span class="keywordflow">else</span>
<a name="l00973"></a>00973     {
<a name="l00974"></a>00974       ctx.status = CMD_EXECUTING;
<a name="l00975"></a>00975       ctx.state = (state_t) STATE_END;
<a name="l00976"></a>00976       <span class="keywordflow">break</span>;
<a name="l00977"></a>00977     }
<a name="l00978"></a>00978     <span class="comment">// Open list</span>
<a name="l00979"></a>00979     <span class="keywordflow">if</span> (!<a class="code" href="a00040.html#ee4bf4e140c9a4893547bf41459e57f3" title="Open a selected text file in the current navigator.">reader_txt_open</a>(TRUE))
<a name="l00980"></a>00980     {
<a name="l00981"></a>00981       ctx.status = CMD_EXECUTING;
<a name="l00982"></a>00982       ctx.state = (state_t) STATE_END;
<a name="l00983"></a>00983       <span class="keywordflow">break</span>;
<a name="l00984"></a>00984     }
<a name="l00985"></a>00985     <a class="code" href="a00038.html#a18a22be8e8c964836b6d3abe35fe2d0" title="Number of file included in play list.">pl_g_u16_list_size</a> = 0;
<a name="l00986"></a>00986     ctx.status = CMD_EXECUTING;
<a name="l00987"></a>00987     <span class="keywordflow">if</span> (u16_n)
<a name="l00988"></a>00988       ctx.state = (state_t) STATE_GET_LINK_COUNT;
<a name="l00989"></a>00989     <span class="keywordflow">else</span>
<a name="l00990"></a>00990       ctx.state = (state_t) STATE_INIT_PLAYLIST_CONTEXT;
<a name="l00991"></a>00991     <span class="keywordflow">break</span>;
<a name="l00992"></a>00992 
<a name="l00993"></a>00993   <span class="keywordflow">case</span> STATE_GET_LINK_COUNT:
<a name="l00994"></a>00994     u16_current_count = 0;
<a name="l00995"></a>00995     <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>(FS_NAV_ID_PLAYLIST);
<a name="l00996"></a>00996     <span class="keywordflow">while</span> (!<a class="code" href="a00022.html#bed52ba7230c6eecf100a3709b9ed74e" title="This function checks the end of file.">file_eof</a>() &amp;&amp; u16_current_count &lt; u16_n)
<a name="l00997"></a>00997     {
<a name="l00998"></a>00998       <span class="keywordflow">if</span> (<a class="code" href="a00038.html#f01e79587fade6bdd9afc994843d364c" title="This function reads and checks the next line.">pl_main_readline</a>(<a class="code" href="a00039.html#96aa34c741e50dd5fb675ccdbac9e8f02472a994994b0c26b1fcebc9e2b06032">PL_MAIN_READLINE_OPT_CHECKLINE</a>, 0, NULL, NULL))
<a name="l00999"></a>00999         <a class="code" href="a00038.html#a18a22be8e8c964836b6d3abe35fe2d0" title="Number of file included in play list.">pl_g_u16_list_size</a>++;
<a name="l01000"></a>01000       <span class="comment">// Check if an error occured during the reading</span>
<a name="l01001"></a>01001       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> == <a class="code" href="a00024.html#89613ba21711697c707a3199bf93b9cf" title="File system error.">FS_ERR_FS</a>)
<a name="l01002"></a>01002       {
<a name="l01003"></a>01003         <span class="comment">// Error file system</span>
<a name="l01004"></a>01004         ctx.status = CMD_EXECUTING;
<a name="l01005"></a>01005         ctx.state = (state_t) STATE_END;
<a name="l01006"></a>01006         <span class="keywordflow">break</span>;
<a name="l01007"></a>01007       }        
<a name="l01008"></a>01008       u16_current_count++;
<a name="l01009"></a>01009     }
<a name="l01010"></a>01010     ctx.status = CMD_EXECUTING;
<a name="l01011"></a>01011     <span class="keywordflow">if</span> (<a class="code" href="a00022.html#bed52ba7230c6eecf100a3709b9ed74e" title="This function checks the end of file.">file_eof</a>())
<a name="l01012"></a>01012       ctx.state = (state_t) STATE_INIT_PLAYLIST_CONTEXT;
<a name="l01013"></a>01013     <span class="keywordflow">break</span>;
<a name="l01014"></a>01014 
<a name="l01015"></a>01015   <span class="keywordflow">case</span> STATE_INIT_PLAYLIST_CONTEXT:
<a name="l01016"></a>01016     <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>(FS_NAV_ID_PLAYLIST);
<a name="l01017"></a>01017     <span class="comment">// Go to at the beginning of text file</span>
<a name="l01018"></a>01018     <a class="code" href="a00040.html#4f6bbd93a0b11365b77518a22b1ae098" title="This function goes at the beginning of file and read the text header.">reader_txt_beg</a>();
<a name="l01019"></a>01019     <span class="comment">// Don't select a file</span>
<a name="l01020"></a>01020     <a class="code" href="a00038.html#43c5d67b8ebe2758b7362f58b755351c" title="Current file selected in play list (0= no file selected, 1= first file).">pl_g_u16_list_sel</a> = 0;
<a name="l01021"></a>01021     <span class="comment">// Play list file is opened</span>
<a name="l01022"></a>01022     <a class="code" href="a00038.html#ddc3fb7e481bcf02c8c6057b43c0a8d7" title="play list file is opened">pl_g_list_is_open</a> = TRUE;
<a name="l01023"></a>01023     <span class="comment">// Re select the previous navigator</span>
<a name="l01024"></a>01024     <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>(nav_id_save);
<a name="l01025"></a>01025     <a class="code" href="a00036.html#7ad0aa092d133a156651abe5d871b8eb" title="This function resets the selection pointer, so &amp;quot;no file selected&amp;quot; in file...">nav_filelist_reset</a>();
<a name="l01026"></a>01026     <span class="keywordflow">break</span>;
<a name="l01027"></a>01027 
<a name="l01028"></a>01028   <span class="keywordflow">case</span> STATE_END:
<a name="l01029"></a>01029     <span class="comment">// Re select the previous navigator</span>
<a name="l01030"></a>01030     <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>(nav_id_save);
<a name="l01031"></a>01031     <span class="keywordflow">break</span>;
<a name="l01032"></a>01032   }
<a name="l01033"></a>01033 
<a name="l01034"></a>01034   <span class="keywordflow">if</span> (ctx.status == CMD_EXECUTING)
<a name="l01035"></a>01035   {
<a name="l01036"></a>01036     <span class="keywordflow">if</span> (!ai_async_context_push(&amp;ctx))
<a name="l01037"></a>01037       <span class="keywordflow">return</span> FALSE;
<a name="l01038"></a>01038   }
<a name="l01039"></a>01039 
<a name="l01040"></a>01040   <span class="keywordflow">return</span> <a class="code" href="a00038.html#ddc3fb7e481bcf02c8c6057b43c0a8d7" title="play list file is opened">pl_g_list_is_open</a>;
<a name="l01041"></a>01041 }
<a name="l01042"></a>01042 
<a name="l01053"></a>01053 Bool pl_nav_readentry_non_blocking(pl_nav_readentry_context_t *data, U16 u16_position, <a class="code" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> *sz_path, U16 *u16_size_line, U16 u16_n)
<a name="l01054"></a>01054 {
<a name="l01055"></a>01055   ai_async_context_t ctx;
<a name="l01056"></a>01056   U16 u16_current_n;
<a name="l01057"></a>01057   <span class="keyword">typedef</span> <span class="keyword">enum</span>
<a name="l01058"></a>01058   {
<a name="l01059"></a>01059     STATE_INITIALIZATION = 0,
<a name="l01060"></a>01060     STATE_SET_POS,
<a name="l01061"></a>01061     STATE_READ_ENTRY
<a name="l01062"></a>01062   } state_t;
<a name="l01063"></a>01063   Bool b_update;
<a name="l01064"></a>01064 
<a name="l01065"></a>01065   <span class="comment">// If FALSE, means it is the first call</span>
<a name="l01066"></a>01066   <span class="keywordflow">if</span> (!ai_async_context_pop(&amp;ctx))
<a name="l01067"></a>01067     ctx.state = (state_t) STATE_INITIALIZATION;
<a name="l01068"></a>01068   <span class="comment">// By default set the status to DONE</span>
<a name="l01069"></a>01069   ctx.status = CMD_DONE;
<a name="l01070"></a>01070 
<a name="l01071"></a>01071   <span class="keywordflow">switch</span>((state_t) ctx.state)
<a name="l01072"></a>01072   {
<a name="l01073"></a>01073   <span class="comment">// Intialization</span>
<a name="l01074"></a>01074   <span class="keywordflow">case</span> STATE_INITIALIZATION:
<a name="l01075"></a>01075     <span class="comment">// Set output to NULL to specify if there is an error</span>
<a name="l01076"></a>01076     *sz_path = NULL;
<a name="l01077"></a>01077     <span class="comment">// Position out of range</span>
<a name="l01078"></a>01078     <span class="keywordflow">if</span> (u16_position == 0)
<a name="l01079"></a>01079     {
<a name="l01080"></a>01080       <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#4dc7fa3cedd22ae7885138f8f9a65973" title="You are outside of the play list.">FS_ERR_PL_OUT_LST</a>;
<a name="l01081"></a>01081       <span class="keywordflow">return</span> FALSE;
<a name="l01082"></a>01082     }
<a name="l01083"></a>01083     <span class="comment">// Go to play list file navigator</span>
<a name="l01084"></a>01084     data-&gt;nav_id_saved = <a class="code" href="a00036.html#4a9efd8a5ff4c599be7994c009f0fb5f" title="This function returns the navigation identifier used.">nav_get</a>();
<a name="l01085"></a>01085     <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>(FS_NAV_ID_PLAYLIST);
<a name="l01086"></a>01086     <span class="comment">// Save current file position</span>
<a name="l01087"></a>01087     data-&gt;u32_file_pos_saved = <a class="code" href="a00022.html#2a08b2cfeeb2b4064f3b2fcd6829c8da" title="This function returns the position in the file.">file_getpos</a>();
<a name="l01088"></a>01088 
<a name="l01089"></a>01089     <span class="comment">// In this case it means the context data is already filled with entry</span>
<a name="l01090"></a>01090     <span class="comment">// information for this specific playlist. That is the reason why it is</span>
<a name="l01091"></a>01091     <span class="comment">// important to fill this structure with zeros if non-caching options are</span>
<a name="l01092"></a>01092     <span class="comment">// used.</span>
<a name="l01093"></a>01093     b_update = TRUE;
<a name="l01094"></a>01094     <span class="keywordflow">if</span> (data-&gt;fs_entry.u8_open_mode)
<a name="l01095"></a>01095     {
<a name="l01096"></a>01096       <span class="keywordflow">if</span> (data-&gt;u16_current_pos + 1 &lt;= u16_position)
<a name="l01097"></a>01097         b_update = FALSE;
<a name="l01098"></a>01098     }
<a name="l01099"></a>01099     <span class="keywordflow">if</span> (b_update)
<a name="l01100"></a>01100     {
<a name="l01101"></a>01101       <span class="comment">// Go to the beginning of the text file</span>
<a name="l01102"></a>01102       <a class="code" href="a00040.html#4f6bbd93a0b11365b77518a22b1ae098" title="This function goes at the beginning of file and read the text header.">reader_txt_beg</a>();
<a name="l01103"></a>01103       data-&gt;u16_current_pos = 0;
<a name="l01104"></a>01104       <span class="comment">// Store the info of the entry</span>
<a name="l01105"></a>01105       memcpy(&amp;(data-&gt;fs_entry), &amp;<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>, <span class="keyword">sizeof</span>(data-&gt;fs_entry));
<a name="l01106"></a>01106     }
<a name="l01107"></a>01107     ctx.status = CMD_EXECUTING;
<a name="l01108"></a>01108     ctx.state = (state_t) STATE_SET_POS;
<a name="l01109"></a>01109     <span class="keywordflow">break</span>;
<a name="l01110"></a>01110 
<a name="l01111"></a>01111   <span class="keywordflow">case</span> STATE_SET_POS:
<a name="l01112"></a>01112     <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>(FS_NAV_ID_PLAYLIST);
<a name="l01113"></a>01113     <span class="comment">// Restore the info of the entry</span>
<a name="l01114"></a>01114     memcpy(&amp;<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>, &amp;(data-&gt;fs_entry), <span class="keyword">sizeof</span>(<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>));
<a name="l01115"></a>01115     <span class="comment">// Look for the "u16_n"th next lines on the file</span>
<a name="l01116"></a>01116     u16_current_n = 0;
<a name="l01117"></a>01117     <span class="keywordflow">while</span> ((data-&gt;u16_current_pos + 1 != u16_position) &amp;&amp;
<a name="l01118"></a>01118            !<a class="code" href="a00022.html#bed52ba7230c6eecf100a3709b9ed74e" title="This function checks the end of file.">file_eof</a>() &amp;&amp;
<a name="l01119"></a>01119            u16_current_n &lt; u16_n)
<a name="l01120"></a>01120     {
<a name="l01121"></a>01121       <span class="keywordflow">if</span> (<a class="code" href="a00038.html#f01e79587fade6bdd9afc994843d364c" title="This function reads and checks the next line.">pl_main_readline</a>(<a class="code" href="a00039.html#96aa34c741e50dd5fb675ccdbac9e8f02472a994994b0c26b1fcebc9e2b06032">PL_MAIN_READLINE_OPT_CHECKLINE</a>, 0, NULL, NULL))
<a name="l01122"></a>01122         data-&gt;u16_current_pos++;
<a name="l01123"></a>01123       u16_current_n++;
<a name="l01124"></a>01124     }
<a name="l01125"></a>01125     <span class="comment">// If end of file</span>
<a name="l01126"></a>01126     <span class="keywordflow">if</span> (<a class="code" href="a00022.html#bed52ba7230c6eecf100a3709b9ed74e" title="This function checks the end of file.">file_eof</a>())
<a name="l01127"></a>01127     {
<a name="l01128"></a>01128       <span class="comment">// Restore file position</span>
<a name="l01129"></a>01129       <a class="code" href="a00022.html#2599f935c7e1b69f2650e0943091ddca" title="This function changes the position in the file.">file_seek</a>(data-&gt;u32_file_pos_saved, <a class="code" href="a00023.html#5b33d405a458db1db212d345b21454f8" title="start at the beginning">FS_SEEK_SET</a>);
<a name="l01130"></a>01130       <span class="comment">// Reselect the previous navigator</span>
<a name="l01131"></a>01131       <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>(data-&gt;nav_id_saved);
<a name="l01132"></a>01132       <span class="keywordflow">return</span> FALSE;
<a name="l01133"></a>01133     }
<a name="l01134"></a>01134     <span class="comment">// If the file has been found</span>
<a name="l01135"></a>01135     ctx.status = CMD_EXECUTING;
<a name="l01136"></a>01136     <span class="keywordflow">if</span> (data-&gt;u16_current_pos + 1 == u16_position)
<a name="l01137"></a>01137       ctx.state = (state_t) STATE_READ_ENTRY;
<a name="l01138"></a>01138     <span class="comment">// Else continue seeking...</span>
<a name="l01139"></a>01139     <span class="comment">// Store the info of the entry</span>
<a name="l01140"></a>01140     memcpy(&amp;(data-&gt;fs_entry), &amp;<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>, <span class="keyword">sizeof</span>(data-&gt;fs_entry));
<a name="l01141"></a>01141     <span class="keywordflow">break</span>;
<a name="l01142"></a>01142 
<a name="l01143"></a>01143   <span class="keywordflow">case</span> STATE_READ_ENTRY:
<a name="l01144"></a>01144     <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>(FS_NAV_ID_PLAYLIST);
<a name="l01145"></a>01145     u16_current_n = 0;
<a name="l01146"></a>01146     b_update = FALSE;
<a name="l01147"></a>01147     <span class="keywordflow">while</span> (!<a class="code" href="a00022.html#bed52ba7230c6eecf100a3709b9ed74e" title="This function checks the end of file.">file_eof</a>() &amp;&amp; u16_current_n &lt; u16_n)
<a name="l01148"></a>01148     {
<a name="l01149"></a>01149       <span class="keywordflow">if</span> ((b_update = <a class="code" href="a00038.html#f01e79587fade6bdd9afc994843d364c" title="This function reads and checks the next line.">pl_main_readline</a>(<a class="code" href="a00039.html#96aa34c741e50dd5fb675ccdbac9e8f034ea6e58645123ef355dd4177002e268">PL_MAIN_READLINE_OPT_GOTOPATH</a>, data-&gt;nav_id_saved, sz_path, u16_size_line)))
<a name="l01150"></a>01150         <span class="keywordflow">break</span>;
<a name="l01151"></a>01151       u16_current_n++;
<a name="l01152"></a>01152     }
<a name="l01153"></a>01153     <span class="comment">// Need to retry</span>
<a name="l01154"></a>01154     <span class="keywordflow">if</span> (u16_current_n &gt;= u16_n)
<a name="l01155"></a>01155     {
<a name="l01156"></a>01156       ctx.status = CMD_EXECUTING;
<a name="l01157"></a>01157       <span class="keywordflow">break</span>;
<a name="l01158"></a>01158     }
<a name="l01159"></a>01159     <span class="comment">// If it is the end of the file</span>
<a name="l01160"></a>01160     <span class="keywordflow">if</span> (<a class="code" href="a00022.html#bed52ba7230c6eecf100a3709b9ed74e" title="This function checks the end of file.">file_eof</a>() &amp;&amp; !b_update)
<a name="l01161"></a>01161     {
<a name="l01162"></a>01162       <span class="comment">// Restore file position</span>
<a name="l01163"></a>01163       <a class="code" href="a00022.html#2599f935c7e1b69f2650e0943091ddca" title="This function changes the position in the file.">file_seek</a>(data-&gt;u32_file_pos_saved, <a class="code" href="a00023.html#5b33d405a458db1db212d345b21454f8" title="start at the beginning">FS_SEEK_SET</a>);
<a name="l01164"></a>01164       <span class="comment">// Reselect the previous navigator</span>
<a name="l01165"></a>01165       <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>(data-&gt;nav_id_saved);
<a name="l01166"></a>01166       <span class="keywordflow">return</span> FALSE;
<a name="l01167"></a>01167     }
<a name="l01168"></a>01168 
<a name="l01169"></a>01169     <span class="comment">// Store positions</span>
<a name="l01170"></a>01170     data-&gt;u16_current_pos = u16_position;
<a name="l01171"></a>01171     <span class="comment">// Store the info of the entry</span>
<a name="l01172"></a>01172     memcpy(&amp;(data-&gt;fs_entry), &amp;<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>, <span class="keyword">sizeof</span>(data-&gt;fs_entry));
<a name="l01173"></a>01173 
<a name="l01174"></a>01174     <span class="comment">// Restore file position</span>
<a name="l01175"></a>01175     <a class="code" href="a00022.html#2599f935c7e1b69f2650e0943091ddca" title="This function changes the position in the file.">file_seek</a>(data-&gt;u32_file_pos_saved, <a class="code" href="a00023.html#5b33d405a458db1db212d345b21454f8" title="start at the beginning">FS_SEEK_SET</a>);
<a name="l01176"></a>01176     <span class="comment">// Reselect the previous navigator</span>
<a name="l01177"></a>01177     <a class="code" href="a00036.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>(data-&gt;nav_id_saved);
<a name="l01178"></a>01178     <span class="keywordflow">break</span>;
<a name="l01179"></a>01179   }
<a name="l01180"></a>01180 
<a name="l01181"></a>01181   <span class="keywordflow">if</span> (ctx.status == CMD_EXECUTING)
<a name="l01182"></a>01182   {
<a name="l01183"></a>01183     <span class="keywordflow">if</span> (!ai_async_context_push(&amp;ctx))
<a name="l01184"></a>01184       <span class="keywordflow">return</span> FALSE;
<a name="l01185"></a>01185   }
<a name="l01186"></a>01186 
<a name="l01187"></a>01187   <span class="keywordflow">return</span> TRUE;
<a name="l01188"></a>01188 }
<a name="l01189"></a>01189 
<a name="l01190"></a>01190 <span class="preprocessor">#endif</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Dec 21 18:30:55 2009 for AVR32 UC3 - FSACCESS Services by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
