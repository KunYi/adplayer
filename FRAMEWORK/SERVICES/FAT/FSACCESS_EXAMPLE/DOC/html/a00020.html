<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>AVR32 UC3 - FSACCESS Services: fat.h File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>fat.h File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
FAT services. 
<p>
This file is the header for FAT services<p>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Atmel Corporation: <a href="http://www.atmel.com">http://www.atmel.com</a> <br>
 Support and FAQ: <a href="http://support.atmel.no/">http://support.atmel.no/</a> </dd></dl>

<p>Definition in file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>
<code>#include &quot;<a class="el" href="a00055.html">fs_com.h</a>&quot;</code><br>

<p>
<a href="a00051.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00001.html">Fs_clusterlist_cache</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Struture to store the cluster list cache.  <a href="a00001.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00004.html">Fs_management</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Struture to save the variables frequently used by file system mounted.  <a href="a00004.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00005.html">Fs_management_entry</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Struture to save the frequently variables of file system mounted.  <a href="a00005.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00006.html">Fs_management_fast</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Struture to save the variables very frequently used by file system mounted.  <a href="a00006.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">union &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00007.html">Fs_rootdir</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Union to define a root directory.  <a href="a00007.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00008.html">Fs_sector_cache</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Struture to store the information about sector cache (=last sector read or write on disk).  <a href="a00008.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00009.html">Fs_segment</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Struture to define a segment.  <a href="a00009.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00012.html">st_fs_cluster</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Struture to store cluster information.  <a href="a00012.html#_details">More...</a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables used to manage the sector cache</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef U8 _MEM_TYPE_SLOW_ *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#119f57abfa3b1f77fd0514b26da6afb4">PTR_CACHE</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">_GLOBEXT_ _MEM_TYPE_SLOW_ U8&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1">fs_g_sector</a> [FS_CACHE_SIZE]</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Use "FAT sector cache" to store a sector from a file (see <a class="el" href="a00022.html#44de4bc08663fbddbd11946bbb06e2ce" title="This function writes a byte in the file.">file_putc()</a>, <a class="el" href="a00022.html#952fd54b2e49943d138e44d3bdf569bf" title="This function returns the next byte of file.">file_getc()</a>, <a class="el" href="a00022.html#7b7c08bde8cb93a792dd578cf4310d0a" title="This function copys in a buffer the file data corresponding at the current position...">file_read_buf()</a>, <a class="el" href="a00022.html#415ad1a43ac79c02c294a4e32246c519" title="This function transfer a buffer to a file at the current file position.">file_write_buf()</a>).  <a href="#a84f1da7d8ef3aa46b236f6a7a3b0fa1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">_GLOBEXT_ _MEM_TYPE_SLOW_ <br>
<a class="el" href="a00008.html">Fs_sector_cache</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">_GLOBEXT_ _MEM_TYPE_SLOW_ U32&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#8e617688fc42b47e56cce053123fd05f">fs_gu32_addrsector</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Store the address of futur cache (unit 512B).  <a href="#8e617688fc42b47e56cce053123fd05f"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#d4d03be3b8f3d15ed804170a1311ec98">_GLOBEXT_</a>&nbsp;&nbsp;&nbsp;extern</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#0b62220f198f7eb96b15aa863c49ce54">FS_BUF_SECTOR_EMPTY</a>&nbsp;&nbsp;&nbsp;0xFF</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Signal that sector cache is not valid.  <a href="#0b62220f198f7eb96b15aa863c49ce54"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#70b90ba913c43a878e9b478de5d1b61c">FS_MBR_OFFSET_PART_ENTRY</a>(num)&nbsp;&nbsp;&nbsp;((U16)((U16)(0x1BE)+(0x10 * num)))</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Position (unit byte) in the MBR of a partition entry.  <a href="#70b90ba913c43a878e9b478de5d1b61c"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#c2ce5473766316396fb472c1bdd685e9">Is_fat12</a>&nbsp;&nbsp;&nbsp;(FS_TYPE_FAT_12 == fs_g_nav_fast.u8_type_fat)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#2dcd74d640da1e20ad510413c9ef4c85">Is_fat16</a>&nbsp;&nbsp;&nbsp;(FS_TYPE_FAT_16 == fs_g_nav_fast.u8_type_fat)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#57a82f24a45a33a159e0362b7e82e3fa">Is_fat32</a>&nbsp;&nbsp;&nbsp;(FS_TYPE_FAT_32 == fs_g_nav_fast.u8_type_fat)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>&nbsp;&nbsp;&nbsp;(<a class="el" href="a00020.html#fdc963fda511dd9e790c81b6a6b33d34">g_b_unicode</a>)</td></tr>

<tr><td colspan="2"><div class="groupHeader">Macro to check the file open mode</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#55c673ca91c5301834a588e1d5a6515f">Fat_file_close</a>()&nbsp;&nbsp;&nbsp;(fs_g_nav_entry.u8_open_mode  =0 )</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#9bce5b4def8042e051c97409568e0138">Fat_file_is_open</a>()&nbsp;&nbsp;&nbsp;(fs_g_nav_entry.u8_open_mode !=0 )</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#683f625ba66d2777d10aa6cc7c7435d9">Fat_file_isnot_open</a>()&nbsp;&nbsp;&nbsp;(fs_g_nav_entry.u8_open_mode ==0 )</td></tr>

<tr><td colspan="2"><div class="groupHeader">The unit sector of 512B is many used in file System stack</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#e6e52ba6ed3159395fab025719b91bd0">FS_512B</a>&nbsp;&nbsp;&nbsp;512</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#88ac363f9c597edc80e1185f99434056">FS_512B_MASK</a>&nbsp;&nbsp;&nbsp;(512-1)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#aee8167d49f58301e72fa2c546cd5b55">FS_512B_SHIFT_BIT</a>&nbsp;&nbsp;&nbsp;9</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#1f24fc24a15f2e52ecae58ae2d5dfbfc">FS_CACHE_SIZE</a>&nbsp;&nbsp;&nbsp;512</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#7090b63e1693b160aaebf802dfd8e05a">FS_MASK_SIZE_OF_SECTOR</a>&nbsp;&nbsp;&nbsp;FS_512B_MASK</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#90491f94e13d340a9d3f98e57a66e9d3">FS_SHIFT_B_TO_SECTOR</a>&nbsp;&nbsp;&nbsp;FS_512B_SHIFT_BIT</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#3d8dbd6dd4c5150d859e8926f69e88b9">FS_SIZE_OF_SECTOR</a>&nbsp;&nbsp;&nbsp;FS_512B</td></tr>

<tr><td colspan="2"><div class="groupHeader">Constants used in MBR sector</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#8b3d7dc9ad174dc5273cc5cb052598f1">FS_BOOT_SIGN</a>&nbsp;&nbsp;&nbsp;0x29</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#b01eb16ba36dc7c0412a886c1678232f">FS_PART_BOOTABLE</a>&nbsp;&nbsp;&nbsp;0x80</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#3eecd129a66f4de0d5cd023f2f925e1e">FS_PART_HARD_DISK</a>&nbsp;&nbsp;&nbsp;0x81</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#e9933a03e28f302f391f377b8efc001d">FS_PART_NO_BOOTABLE</a>&nbsp;&nbsp;&nbsp;0x00</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#3222ba68ea2f6dc67aa88a0caeb7e6e4">FS_PART_NO_REMOVE_MEDIA</a>&nbsp;&nbsp;&nbsp;0xF8</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#1e9f640fda1f242a6a45dbffbffa4f56">FS_PART_REMOVE_MEDIA</a>&nbsp;&nbsp;&nbsp;0xF0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#d8702ceb3912c09278602d3ea33224ff">FS_PART_TYPE_FAT12</a>&nbsp;&nbsp;&nbsp;0x01</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#b9f13193999f7bb7ea0e4be6cf5ee57b">FS_PART_TYPE_FAT16_INF32M</a>&nbsp;&nbsp;&nbsp;0x04</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#29856400974fc942f9cf900a44ea7389">FS_PART_TYPE_FAT16_SUP32M</a>&nbsp;&nbsp;&nbsp;0x06</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#c7c65caf9513f8cddd4319b334813d85">FS_PART_TYPE_FAT16_SUP32M_BIS</a>&nbsp;&nbsp;&nbsp;0x0E</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#93881dd293ba41286e413bef3212786a">FS_PART_TYPE_FAT32</a>&nbsp;&nbsp;&nbsp;0x0B</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#3e13e837536764161f0aa9768e76b2e1">FS_PART_TYPE_FAT32_BIS</a>&nbsp;&nbsp;&nbsp;0x0C</td></tr>

<tr><td colspan="2"><div class="groupHeader">Constante used to sign a MBR or PBR sectors</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#b4cd4bfc6a5baebc1d25bbc5d5db2c15">FS_BR_SIGNATURE_HIGH</a>&nbsp;&nbsp;&nbsp;0xAA</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#36f09355f7020d410cb43695cab680fa">FS_BR_SIGNATURE_LOW</a>&nbsp;&nbsp;&nbsp;0x55</td></tr>

<tr><td colspan="2"><div class="groupHeader">Status of the fat_checkcluster() function</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#296001b537ea1cf21069172943e73e60">FS_CLUS_BAD</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#186703da0d708086e4ceaae4a470467d">FS_CLUS_END</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#e9f7cc865270a55859b36205dc45b284">FS_CLUS_OK</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td colspan="2"><div class="groupHeader">Options of the fat_cluster_list() function</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#b314d14ba33772e9bcbae993a8d17e9f">FS_CLUST_ACT_CLR</a>&nbsp;&nbsp;&nbsp;0x03</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#b24c1ca2a8bc9c3e264eb923d3b90666">FS_CLUST_ACT_ONE</a>&nbsp;&nbsp;&nbsp;0x02</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#67f38f48a73531bf4bcd7bf87c7b1db5">FS_CLUST_ACT_SEG</a>&nbsp;&nbsp;&nbsp;0x01</td></tr>

<tr><td colspan="2"><div class="groupHeader">Options of the fat_cluster_val() function</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#6a0f491ab351899993a4171f5ff526f3">FS_CLUST_VAL_EOL</a>&nbsp;&nbsp;&nbsp;0x0FFFFFFF</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#087734ece5cae84508fd1fbe9414ad02">FS_CLUST_VAL_READ</a>&nbsp;&nbsp;&nbsp;FALSE</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#c11d0331723bc237aac4d6c7a4fe7496">FS_CLUST_VAL_WRITE</a>&nbsp;&nbsp;&nbsp;TRUE</td></tr>

<tr><td colspan="2"><div class="groupHeader">Value used in "Fs_management_fast.u16_entry_pos_sel_file"</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#fe6257cc919ba9fad5fad6c1e499f6d6">FS_END_FIND</a>&nbsp;&nbsp;&nbsp;0xFFFE</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Signal that a file entry is the last file entry accessibled by system.  <a href="#fe6257cc919ba9fad5fad6c1e499f6d6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#2e16c6cfcb3174f7ad19ad3996a69ae7">FS_NO_SEL</a>&nbsp;&nbsp;&nbsp;0xFFFF</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Signal that a file entry isn't selected.  <a href="#2e16c6cfcb3174f7ad19ad3996a69ae7"></a><br></td></tr>
<tr><td colspan="2"><div class="groupHeader">Constants used in the first byte of file entry</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#303c1237fa5a61ddc015c0365eedd008">FS_ENTRY_DEL</a>&nbsp;&nbsp;&nbsp;0xE5</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#453bf57f059970b3ce13033b7959cb0c">FS_ENTRY_END</a>&nbsp;&nbsp;&nbsp;0x00</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#bf0fa999d28907c3742656b6407aca78">FS_ENTRY_LFN_LAST</a>&nbsp;&nbsp;&nbsp;0x40</td></tr>

<tr><td colspan="2"><div class="groupHeader">Maximum of FAT cluster</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#2f2a41f51db7209b1e068193cd10a9d8">FS_FAT12_MAX_CLUSTERS</a>&nbsp;&nbsp;&nbsp;4085</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#c1bec4fdf32e8ff9a9afc44b80607336">FS_FAT16_MAX_CLUSTERS</a>&nbsp;&nbsp;&nbsp;65525</td></tr>

<tr><td colspan="2"><div class="groupHeader">LIMITATIONS OF FILE SYSTEM</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#4d46dee315ad22b94de647e7c883edc0">FS_NB_FAT</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td colspan="2"><div class="groupHeader">Constantes used to manage the file entry</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#f5a730740b41e20c1a467dcd1d52699f">FS_SHIFT_B_TO_FILE_ENTRY</a>&nbsp;&nbsp;&nbsp;5</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#0ff67916e073882d162d5fbac91d7e50">FS_SIZE_FILE_ENTRY</a>&nbsp;&nbsp;&nbsp;32</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#bbdca2b90701f373bf6c865c88c99697">FS_SIZE_LFN_ENTRY</a>&nbsp;&nbsp;&nbsp;13</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#69da5456f1f42a68c03ac860e33ac75b">FS_SIZE_SFNAME</a>&nbsp;&nbsp;&nbsp;11</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#f26286ed549d8b9fe8beb60c7744b5cc">FS_SIZE_SFNAME_EXT_ONLY</a>&nbsp;&nbsp;&nbsp;3</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#18e4c969985c697213c58a67e7c20795">FS_SIZE_SFNAME_WITHOUT_EXT</a>&nbsp;&nbsp;&nbsp;8</td></tr>

<tr><td colspan="2"><div class="groupHeader">FAT type ID, used in "Fs_management_fast.u8_type_fat"</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#cbc6a789e2144cbc0893187e2d665d8c">FS_TYPE_FAT_12</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#3433de4e69ce8d55317158ee2624e8af">FS_TYPE_FAT_16</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#bed7b1e094b19dac8efa753f59f84fc6">FS_TYPE_FAT_32</a>&nbsp;&nbsp;&nbsp;3</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#429fbd0498704c3d5864877548040069">FS_TYPE_FAT_UNM</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Partition not mounted.  <a href="#429fbd0498704c3d5864877548040069"></a><br></td></tr>
<tr><td colspan="2"><div class="groupHeader">Macro to access at fields in BPB sector (only used in fat_mount() function)</div></td></tr>
<tr><td colspan="2"><div class="groupText">The name prefixed by "BPB_" are defined in "Hardware White Paper FAT" <br><br></div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#1bf0f3b3cb79deb5b7c459b5d10449d5">HIGH_16_BPB_BytsPerSec</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[12]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#c7277af1ce6ee4efe860da2d1f3b1b38">HIGH_16_BPB_FATSz16</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[23]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#067a2e63be3c41412dca91da1ac0f1b7">HIGH_16_BPB_FSInfo</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[49]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#72679a68a6d92475a790f11861a92316">HIGH_16_BPB_ResvSecCnt</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[15]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#8f6e516573fdbd3ea8eadd402cc6e134">HIGH_16_BPB_RootEntCnt</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[18]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#3f384bfdb0b306957dbc5f9c9b087dbe">HIGH_16_BPB_TotSec16</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[20]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#c1ba95f06dfaaf3c71a5eb12dd56009c">LOW0_32_BPB_FATSz32</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[36]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#0a4a06552fb3a44093ef87a09fc2840f">LOW0_32_BPB_RootClus</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[44]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#874e06185fcba59848db370a65ffb162">LOW0_32_BPB_TotSec32</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[32]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#dff814b0d106b4c3b3f730fbef8338ce">LOW1_32_BPB_FATSz32</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[37]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#dd80ee1ba4292b33a35bb9794e46b91d">LOW1_32_BPB_RootClus</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[45]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#36c744b34bb704e3777d34a3b4c365a7">LOW1_32_BPB_TotSec32</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[33]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#8ef0e71139f216c7aaa15dc92f04ad74">LOW2_32_BPB_FATSz32</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[38]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#47260296ce546b21bd10d3ddc963a2c7">LOW2_32_BPB_RootClus</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[46]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#b1bff622ef1d89f52b64b80e0f04bb4c">LOW2_32_BPB_TotSec32</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[34]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#ae445a7061c79d078f70001aa7d5ca16">LOW3_32_BPB_FATSz32</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[39]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#68f0eada6fa2bbfffcdc98fcd463d225">LOW3_32_BPB_RootClus</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[47]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#f6bd554441216cd3475dd35a23d2a282">LOW3_32_BPB_TotSec32</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[35]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#931fb8aaa3236e5d2ee2d03424c07dc5">LOW_16_BPB_BytsPerSec</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[11]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#fe57e984b2baf3970ac7feda02355ac9">LOW_16_BPB_FATSz16</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[22]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#690460cf97d7336c73da86955724b060">LOW_16_BPB_FSInfo</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[48]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#054eca177d5b03154cb95ead9e3cca0b">LOW_16_BPB_ResvSecCnt</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[14]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#b1eab4cea0637f0fa8c7e521968803a2">LOW_16_BPB_RootEntCnt</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[17]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#b63400ba470fe3bf6c110a0af483ccc0">LOW_16_BPB_TotSec16</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[19]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#58a994fdcf3ee750422c9088d66033c1">U8_BPB_NumFATs</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[16]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#14c055fd6f5b4bda4470668bab3694ee">U8_BPB_SecPerClus</a>&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[13]</td></tr>

<tr><td colspan="2"><br><h2>Typedefs</h2></td></tr>
<tr><td colspan="2"><div class="groupHeader">Main sructures</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef struct <a class="el" href="a00012.html">st_fs_cluster</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#af4e4784230dad737c18ed1f15d671fb">Fs_cluster</a></td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#6099b0e8fafcc01b8c1769c94c827325">fat_format</a> (U8 u8_fat_type)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function formats the drive.  <a href="#6099b0e8fafcc01b8c1769c94c827325"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">U8&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#920798e6366e8c3c408601c58fed4bb3">fat_get_nbpartition</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function returns the number of partition present on selected drive.  <a href="#920798e6366e8c3c408601c58fed4bb3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#c0108ea608b547e8d3a405c70644c1e9">fat_mount</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function mounts a partition.  <a href="#c0108ea608b547e8d3a405c70644c1e9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#2ff43f97db7a5d76f46f4fb1b683d192">fat_serialnumber</a> (Bool b_action, U8 _MEM_TYPE_SLOW_ *a_u8_sn)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function reads or writes a serial number.  <a href="#2ff43f97db7a5d76f46f4fb1b683d192"></a><br></td></tr>
<tr><td colspan="2"><div class="groupHeader">Functions to manage the cluster list</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#1fa62b2728e71cff2e95556db7ed1b9c">fat_allocfreespace</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function allocs a cluster list.  <a href="#1fa62b2728e71cff2e95556db7ed1b9c"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#ecb0d4c200bed41b8bdcf671aa931a2a">fat_cache_clusterlist_reset</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function resets the cluster list caches.  <a href="#ecb0d4c200bed41b8bdcf671aa931a2a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">U8&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#4010dc2ad42864603bb81a41b485d346">fat_checkcluster</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function checks the cluster value.  <a href="#4010dc2ad42864603bb81a41b485d346"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#6cc9ee9a14553be84990df27709f51a6">fat_clear_cluster</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function clears one cluster.  <a href="#6cc9ee9a14553be84990df27709f51a6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#9503329592cf7484faf77ca95a6a21aa">fat_clear_info_fat_mod</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function clears the cache information about FAT modifications.  <a href="#9503329592cf7484faf77ca95a6a21aa"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#b08a718173c6b1a1966e6395801a32e7">fat_cluster_list</a> (U8 opt_action, Bool b_for_file)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function gets or clears a cluster list.  <a href="#b08a718173c6b1a1966e6395801a32e7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#e28958d1a5e3ed006edf937e6b7dacc7">fat_cluster_readnext</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function is optimized to read a continue cluster list on FAT16 and FAT32.  <a href="#e28958d1a5e3ed006edf937e6b7dacc7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#1be84552293d174f534b2fb8d0a4e737">fat_cluster_val</a> (Bool b_mode)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function returns or modifys a cluster value in FAT.  <a href="#1be84552293d174f534b2fb8d0a4e737"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#8145cff91620fc1b70aa0eef5750db72">fat_update_fat2</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function copys the modifications of the first FAT to the second FAT.  <a href="#8145cff91620fc1b70aa0eef5750db72"></a><br></td></tr>
<tr><td colspan="2"><div class="groupHeader">Functions to manage the cache</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#5948c1de515852418670d3fb8ae1e832">fat_cache_clear</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function clears the sector cache.  <a href="#5948c1de515852418670d3fb8ae1e832"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#578ab4800128cde17c0820a5027c1c06">fat_cache_flush</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function flushs the sector cache on the memory if necessary.  <a href="#578ab4800128cde17c0820a5027c1c06"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#45c0f16885c9e414ddb4b5afaa1cde34">fat_cache_mark_sector_as_dirty</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function sets a flag to signal that sector cache is modified.  <a href="#45c0f16885c9e414ddb4b5afaa1cde34"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#a67dc439478853cefdd226f9c99c9539">fat_cache_read_sector</a> (Bool b_load)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function loads a memory sector in internal cache sector.  <a href="#a67dc439478853cefdd226f9c99c9539"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#961692919a93b6cb714ec2a3d57c0141">fat_cache_reset</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function resets the sector cache.  <a href="#961692919a93b6cb714ec2a3d57c0141"></a><br></td></tr>
<tr><td colspan="2"><div class="groupHeader">Functions to verify navigator state</div></td></tr>
<tr><td colspan="2"><div class="groupText">}@ <br><br></div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#eeec0bd6755a6be4c4dda2b4669eb0ae">fat_check_device</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function checks device state.  <a href="#eeec0bd6755a6be4c4dda2b4669eb0ae"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#2fb226027c5ea59f40c582737e5a44b9">fat_check_is_file</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function checks if the selected file entry is a file and not a directory.  <a href="#2fb226027c5ea59f40c582737e5a44b9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#8ee865aa4c51519c0d141f1f4559c72a">fat_check_mount</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function checks if the partition is mounted.  <a href="#8ee865aa4c51519c0d141f1f4559c72a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#e9d0f61d0e7b29a4e8e9e95347194f21">fat_check_mount_noopen</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function checks if the partition is mounted and no file is opened.  <a href="#e9d0f61d0e7b29a4e8e9e95347194f21"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#47e29fedbed4084c9f8ec6f27b51015d">fat_check_mount_select</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function checks if the partition is mounted and if a file is selected.  <a href="#47e29fedbed4084c9f8ec6f27b51015d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#003f1c81dcb2c7a95f191c30b8a4f258">fat_check_mount_select_noopen</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function checks if the partition is mounted and if no file is opened and a file is selected.  <a href="#003f1c81dcb2c7a95f191c30b8a4f258"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#0096f66037f89595dfccbca38ab795f8">fat_check_mount_select_open</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function checks if the partition is mounted and if a file is opened.  <a href="#0096f66037f89595dfccbca38ab795f8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#f6f4a9e2d8e7b6dd557871b6bc2c2ee0">fat_check_noopen</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function checks if a file is not opened on current navigator.  <a href="#f6f4a9e2d8e7b6dd557871b6bc2c2ee0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#4efc7734a340e899bb54506b277bb8c1">fat_check_open</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function checks if a file is opened on current navigator.  <a href="#4efc7734a340e899bb54506b277bb8c1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#909da9e84afbebf8ed5838cbe5002f60">fat_check_select</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function checks if a file is selected on current navigator.  <a href="#909da9e84afbebf8ed5838cbe5002f60"></a><br></td></tr>
<tr><td colspan="2"><div class="groupHeader">Functions to manage the entry field (fat.c)</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#452e159ed5e2a4d8ea88f0515a3a6e10">fat_check_eof_name</a> (U16 character)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check end of name.  <a href="#452e159ed5e2a4d8ea88f0515a3a6e10"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#56d9a210bc2d4b0b5c46cb24a2e9f690">fat_clear_entry_info_and_ptr</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function resets the selection pointers.  <a href="#56d9a210bc2d4b0b5c46cb24a2e9f690"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#ef13c743905d7e0381b3a461da2ebd7a">fat_entry_check</a> (Bool b_type)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function checks the entry.  <a href="#ef13c743905d7e0381b3a461da2ebd7a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#d690d22df98e6c1fa927c38b1d1a0fae">fat_entry_checkext</a> (<a class="el" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> sz_filter)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function checks the file extension.  <a href="#d690d22df98e6c1fa927c38b1d1a0fae"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#e0caae1c6e4a737af4ad0aa5d4171e79">fat_entry_is_dir</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function checks if the entry file is a directory.  <a href="#e0caae1c6e4a737af4ad0aa5d4171e79"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#c0bdbd911ecf04b3fcebbc2e4ae33166">fat_entry_longname</a> (<a class="el" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> sz_name, U8 u8_size_max, Bool b_mode, Bool b_match_case)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function returns or compares the long name entry.  <a href="#c0bdbd911ecf04b3fcebbc2e4ae33166"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#6bc798e9f4eac3457cc61e9cd9ba70b9">fat_entry_shortname</a> (<a class="el" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> sz_name, U8 u8_size_max, Bool b_mode)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function returns or compares the short name entry.  <a href="#6bc798e9f4eac3457cc61e9cd9ba70b9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#56b68ed36f194500ce88c22252e3c317">fat_get_entry_info</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function reads information about selected file.  <a href="#56b68ed36f194500ce88c22252e3c317"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="a00020.html#119f57abfa3b1f77fd0514b26da6afb4">PTR_CACHE</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#0c24a717d004b7194e2c566522348fd5">fat_get_ptr_entry</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function returns a cache pointer on the current entry.  <a href="#0c24a717d004b7194e2c566522348fd5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#40035dc41d435ed3281155cdf800cf02">fat_write_entry_file</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function writes the information about selected file.  <a href="#40035dc41d435ed3281155cdf800cf02"></a><br></td></tr>
<tr><td colspan="2"><div class="groupHeader">Functions to control access disk</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#3ebe58d94472a1818a38afaf09c19c35">fat_check_nav_access_disk</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function checks write access.  <a href="#3ebe58d94472a1818a38afaf09c19c35"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#07f36d38eda0af16ef7ef899129d7e7b">fat_check_nav_access_file</a> (Bool mode)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function checks all access at current file.  <a href="#07f36d38eda0af16ef7ef899129d7e7b"></a><br></td></tr>
<tr><td colspan="2"><div class="groupHeader">Functions to manage navigator switch</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#1d133b71ef98fe5945a358bf46680504">fat_copy_nav</a> (U8 u8_idnav)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function copys the main navigator to another navigator.  <a href="#1d133b71ef98fe5945a358bf46680504"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#65cfc6e07b1a1bc3a12d564148daca37">fat_invert_nav</a> (U8 u8_idnav)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function inverts the current navigation with another.  <a href="#65cfc6e07b1a1bc3a12d564148daca37"></a><br></td></tr>
<tr><td colspan="2"><div class="groupHeader">Functions to manage the entry field (fat_unusual.c)</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#da2110d711208b46e93eb269da40bdf1">fat_create_entry_file_name</a> (<a class="el" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> sz_name)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function creates the short and the long name of a new entry.  <a href="#da2110d711208b46e93eb269da40bdf1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#797fc629a4a513e6a5f2951720da5d47">fat_delete_file</a> (Bool b_cluster_list)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function deletes the file entries and cluster list.  <a href="#797fc629a4a513e6a5f2951720da5d47"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#a03d2728f28964e1eb4d78c2bb831718">fat_entry_label</a> (Bool b_action, <a class="el" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> sz_label)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function reads or writes a label in the partition.  <a href="#a03d2728f28964e1eb4d78c2bb831718"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#51041500c2e36ab39aad19b54e93d504">fat_get_date</a> (<a class="el" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> sz_date, Bool type_date)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function reads the information about a date.  <a href="#51041500c2e36ab39aad19b54e93d504"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#838253d384d03898e6fcb2b3a7687e43">fat_set_date</a> (const <a class="el" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> sz_date, Bool type_date)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function changes the date information.  <a href="#838253d384d03898e6fcb2b3a7687e43"></a><br></td></tr>
<tr><td colspan="2"><div class="groupHeader">Functions to compute free space on a partition</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">U32&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#e23270781477be5e6c89b90531c01651">fat_getfreespace</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function returns the space free in the partition.  <a href="#e23270781477be5e6c89b90531c01651"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">U8&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#14426d5552b72b88ea0d61828c57d6c6">fat_getfreespace_percent</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function returns the space free in percent.  <a href="#14426d5552b72b88ea0d61828c57d6c6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">U32&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#0a8beb16a074b07828fc725e0c0ae500">fat_read_fat32_FSInfo</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function returns the space free in the selected FAT32 partition.  <a href="#0a8beb16a074b07828fc725e0c0ae500"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#9cf154ffe36bc2c00b1d589e523b449c">fat_write_fat32_FSInfo</a> (U32 u32_nb_free_cluster)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function writes the space free number in selected FAT32 partition.  <a href="#9cf154ffe36bc2c00b1d589e523b449c"></a><br></td></tr>
<tr><td colspan="2"><div class="groupHeader">Functions to read or to write a file or a directory</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#9510bd193c1e70f2307c5b9b07078511">fat_initialize_dir</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function writes the directory information.  <a href="#9510bd193c1e70f2307c5b9b07078511"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#1a35321a99150ba643f87cb6c79ec3e5">fat_read_dir</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function fill the internal cache with a sector from current directory.  <a href="#1a35321a99150ba643f87cb6c79ec3e5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#d8c9c9a63c821e8cea06c340c029668d">fat_read_file</a> (U8 mode)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function gets or clears a cluster list at the current position in the selected file.  <a href="#d8c9c9a63c821e8cea06c340c029668d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#8723a199c01163d9f9839bd42ac60693">fat_write_file</a> (U8 mode, U32 u32_nb_sector_write)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function gets and eventually allocs a cluster list at the current position in the selected file.  <a href="#8723a199c01163d9f9839bd42ac60693"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">_GLOBEXT_ _MEM_TYPE_FAST_ <br>
<a class="el" href="a00012.html">Fs_cluster</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d">fs_g_cluster</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster.  <a href="#f1ca07cf6181c8e6af3fa988a0b0539d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">_GLOBEXT_ _MEM_TYPE_FAST_ <br>
<a class="el" href="a00009.html">Fs_segment</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5">fs_g_seg</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Variable frequently used by many function (optimization, no parameter in function).  <a href="#6d934f26f97b442c30712e57ee8b21e5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">_GLOBEXT_ Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#6e59f1ec12b7954a956be7185df3ec05">g_b_no_check_disk</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Variables to enable/disable the disk check before each action on disk.  <a href="#6e59f1ec12b7954a956be7185df3ec05"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">_GLOBEXT_ Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#6d450fc3016f0d8a7f5674d9e3a05c83">g_b_string_length</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Variables to select LENGTH string mode (initialised in <a class="el" href="a00036.html#605dfecfa334f8ced2cebfa5162a931b" title="This function resets ALL navigations to init file system core.">nav_reset()</a>).  <a href="#6d450fc3016f0d8a7f5674d9e3a05c83"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">_GLOBEXT_ Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#fdc963fda511dd9e790c81b6a6b33d34">g_b_unicode</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Variables to select string format (initialised in <a class="el" href="a00036.html#605dfecfa334f8ced2cebfa5162a931b" title="This function resets ALL navigations to init file system core.">nav_reset()</a>).  <a href="#fdc963fda511dd9e790c81b6a6b33d34"></a><br></td></tr>
<tr><td colspan="2"><div class="groupHeader">Variables initialised in drive_mount()</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">_GLOBEXT_ _MEM_TYPE_SLOW_ <br>
<a class="el" href="a00004.html">Fs_management</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">_GLOBEXT_ _MEM_TYPE_SLOW_ <br>
<a class="el" href="a00005.html">Fs_management_entry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">_GLOBEXT_ _MEM_TYPE_FAST_ <br>
<a class="el" href="a00006.html">Fs_management_fast</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a></td></tr>

<tr><td colspan="2"><div class="groupHeader">Variables used to update the second FAT zone</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">_GLOBEXT_ _MEM_TYPE_SLOW_ U16&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#b55b94c50b63cf8b83e2afcf2e0c2981">fs_g_u16_first_mod_fat</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Offset (unit 512B) in fat of the first sector (unit 512B).  <a href="#b55b94c50b63cf8b83e2afcf2e0c2981"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">_GLOBEXT_ _MEM_TYPE_SLOW_ U16&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00020.html#e8c6fce6d75eb9ddbf1e63e46659e9cc">fs_g_u16_last_mod_fat</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Offset (unit 512B) in fat of the last sector (unit 512B).  <a href="#e8c6fce6d75eb9ddbf1e63e46659e9cc"></a><br></td></tr>
</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="d4d03be3b8f3d15ed804170a1311ec98"></a><!-- doxytag: member="fat.h::_GLOBEXT_" ref="d4d03be3b8f3d15ed804170a1311ec98" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _GLOBEXT_&nbsp;&nbsp;&nbsp;extern          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<div class="fragment"><pre class="fragment">
    - File system vocabulary :
    MBR : Master Boot Record (constains four PE)
    PE  : Partition Entry (constains a location informations about PBR)
    PBR : Partition Boot Record
    BPB : BIOS Parameter Block (see Hardware White Paper FAT)
    PBR = BPB
    FAT : File Allocation Table
    </pre></div> 
<p>Definition at line <a class="el" href="a00051.html#l00064">64</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="55c673ca91c5301834a588e1d5a6515f"></a><!-- doxytag: member="fat.h::Fat_file_close" ref="55c673ca91c5301834a588e1d5a6515f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Fat_file_close          </td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%">&nbsp;&nbsp;&nbsp;(fs_g_nav_entry.u8_open_mode  =0 )</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00376">376</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00091">fat_check_device()</a>, <a class="el" href="a00050.html#l01394">fat_clear_entry_info_and_ptr()</a>, <a class="el" href="a00053.html#l00747">file_close()</a>, and <a class="el" href="a00067.html#l00165">nav_reset()</a>.</p>

</div>
</div><p>
<a class="anchor" name="9bce5b4def8042e051c97409568e0138"></a><!-- doxytag: member="fat.h::Fat_file_is_open" ref="9bce5b4def8042e051c97409568e0138" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Fat_file_is_open          </td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%">&nbsp;&nbsp;&nbsp;(fs_g_nav_entry.u8_open_mode !=0 )</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00374">374</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00175">fat_check_noopen()</a>.</p>

</div>
</div><p>
<a class="anchor" name="683f625ba66d2777d10aa6cc7c7435d9"></a><!-- doxytag: member="fat.h::Fat_file_isnot_open" ref="683f625ba66d2777d10aa6cc7c7435d9" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Fat_file_isnot_open          </td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%">&nbsp;&nbsp;&nbsp;(fs_g_nav_entry.u8_open_mode ==0 )</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00375">375</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00195">fat_check_open()</a>.</p>

</div>
</div><p>
<a class="anchor" name="e6e52ba6ed3159395fab025719b91bd0"></a><!-- doxytag: member="fat.h::FS_512B" ref="e6e52ba6ed3159395fab025719b91bd0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_512B&nbsp;&nbsp;&nbsp;512          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00216">216</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>, <a class="el" href="a00052.html#l00484">fat_select_filesystem()</a>, <a class="el" href="a00052.html#l00623">fat_write_MBR()</a>, <a class="el" href="a00053.html#l00172">file_read()</a>, <a class="el" href="a00053.html#l00249">file_read_buf()</a>, <a class="el" href="a00053.html#l00415">file_write()</a>, <a class="el" href="a00053.html#l00489">file_write_buf()</a>, <a class="el" href="a00067.html#l02263">nav_file_paste_state()</a>, and <a class="el" href="a00048.html#l00533">stream_mem_to_mem()</a>.</p>

</div>
</div><p>
<a class="anchor" name="88ac363f9c597edc80e1185f99434056"></a><!-- doxytag: member="fat.h::FS_512B_MASK" ref="88ac363f9c597edc80e1185f99434056" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_512B_MASK&nbsp;&nbsp;&nbsp;(512-1)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00217">217</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l01773">fat_get_ptr_entry()</a>, <a class="el" href="a00050.html#l01035">fat_read_file()</a>, <a class="el" href="a00053.html#l00363">file_getc()</a>, <a class="el" href="a00053.html#l00599">file_putc()</a>, and <a class="el" href="a00053.html#l00172">file_read()</a>.</p>

</div>
</div><p>
<a class="anchor" name="aee8167d49f58301e72fa2c546cd5b55"></a><!-- doxytag: member="fat.h::FS_512B_SHIFT_BIT" ref="aee8167d49f58301e72fa2c546cd5b55" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_512B_SHIFT_BIT&nbsp;&nbsp;&nbsp;9          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00218">218</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l01195">fat_read_dir()</a>, <a class="el" href="a00050.html#l01035">fat_read_file()</a>, <a class="el" href="a00053.html#l00172">file_read()</a>, and <a class="el" href="a00067.html#l01866">nav_file_lgtsector()</a>.</p>

</div>
</div><p>
<a class="anchor" name="8b3d7dc9ad174dc5273cc5cb052598f1"></a><!-- doxytag: member="fat.h::FS_BOOT_SIGN" ref="8b3d7dc9ad174dc5273cc5cb052598f1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_BOOT_SIGN&nbsp;&nbsp;&nbsp;0x29          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00176">176</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="b4cd4bfc6a5baebc1d25bbc5d5db2c15"></a><!-- doxytag: member="fat.h::FS_BR_SIGNATURE_HIGH" ref="b4cd4bfc6a5baebc1d25bbc5d5db2c15" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_BR_SIGNATURE_HIGH&nbsp;&nbsp;&nbsp;0xAA          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00146">146</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00299">fat_get_nbpartition()</a>, <a class="el" href="a00052.html#l00105">fat_mount()</a>, <a class="el" href="a00052.html#l00888">fat_read_fat32_FSInfo()</a>, <a class="el" href="a00052.html#l00853">fat_write_fat32_FSInfo()</a>, <a class="el" href="a00052.html#l00623">fat_write_MBR()</a>, and <a class="el" href="a00052.html#l00730">fat_write_PBR()</a>.</p>

</div>
</div><p>
<a class="anchor" name="36f09355f7020d410cb43695cab680fa"></a><!-- doxytag: member="fat.h::FS_BR_SIGNATURE_LOW" ref="36f09355f7020d410cb43695cab680fa" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_BR_SIGNATURE_LOW&nbsp;&nbsp;&nbsp;0x55          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00145">145</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00299">fat_get_nbpartition()</a>, <a class="el" href="a00052.html#l00105">fat_mount()</a>, <a class="el" href="a00052.html#l00888">fat_read_fat32_FSInfo()</a>, <a class="el" href="a00052.html#l00853">fat_write_fat32_FSInfo()</a>, <a class="el" href="a00052.html#l00623">fat_write_MBR()</a>, and <a class="el" href="a00052.html#l00730">fat_write_PBR()</a>.</p>

</div>
</div><p>
<a class="anchor" name="0b62220f198f7eb96b15aa863c49ce54"></a><!-- doxytag: member="fat.h::FS_BUF_SECTOR_EMPTY" ref="0b62220f198f7eb96b15aa863c49ce54" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_BUF_SECTOR_EMPTY&nbsp;&nbsp;&nbsp;0xFF          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Signal that sector cache is not valid. 
<p>

<p>Definition at line <a class="el" href="a00051.html#l00226">226</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l01829">fat_cache_reset()</a>.</p>

</div>
</div><p>
<a class="anchor" name="1f24fc24a15f2e52ecae58ae2d5dfbfc"></a><!-- doxytag: member="fat.h::FS_CACHE_SIZE" ref="1f24fc24a15f2e52ecae58ae2d5dfbfc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_CACHE_SIZE&nbsp;&nbsp;&nbsp;512          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00222">222</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l01840">fat_cache_clear()</a>, <a class="el" href="a00052.html#l00929">fat_clean_zone()</a>, <a class="el" href="a00050.html#l00798">fat_cluster_readnext()</a>, and <a class="el" href="a00050.html#l00603">fat_cluster_val()</a>.</p>

</div>
</div><p>
<a class="anchor" name="296001b537ea1cf21069172943e73e60"></a><!-- doxytag: member="fat.h::FS_CLUS_BAD" ref="296001b537ea1cf21069172943e73e60" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_CLUS_BAD&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00232">232</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00845">fat_checkcluster()</a>, and <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>.</p>

</div>
</div><p>
<a class="anchor" name="186703da0d708086e4ceaae4a470467d"></a><!-- doxytag: member="fat.h::FS_CLUS_END" ref="186703da0d708086e4ceaae4a470467d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_CLUS_END&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00233">233</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00845">fat_checkcluster()</a>, and <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>.</p>

</div>
</div><p>
<a class="anchor" name="e9f7cc865270a55859b36205dc45b284"></a><!-- doxytag: member="fat.h::FS_CLUS_OK" ref="e9f7cc865270a55859b36205dc45b284" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_CLUS_OK&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00231">231</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00845">fat_checkcluster()</a>.</p>

</div>
</div><p>
<a class="anchor" name="b314d14ba33772e9bcbae993a8d17e9f"></a><!-- doxytag: member="fat.h::FS_CLUST_ACT_CLR" ref="b314d14ba33772e9bcbae993a8d17e9f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_CLUST_ACT_CLR&nbsp;&nbsp;&nbsp;0x03          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00241">241</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>, <a class="el" href="a00052.html#l02074">fat_delete_file()</a>, <a class="el" href="a00050.html#l01035">fat_read_file()</a>, and <a class="el" href="a00053.html#l00460">file_set_eof()</a>.</p>

</div>
</div><p>
<a class="anchor" name="b24c1ca2a8bc9c3e264eb923d3b90666"></a><!-- doxytag: member="fat.h::FS_CLUST_ACT_ONE" ref="b24c1ca2a8bc9c3e264eb923d3b90666" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_CLUST_ACT_ONE&nbsp;&nbsp;&nbsp;0x02          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00240">240</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l02474">fat_clear_cluster()</a>, <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>, <a class="el" href="a00050.html#l01195">fat_read_dir()</a>, <a class="el" href="a00050.html#l01035">fat_read_file()</a>, <a class="el" href="a00053.html#l00363">file_getc()</a>, <a class="el" href="a00053.html#l00599">file_putc()</a>, <a class="el" href="a00053.html#l00249">file_read_buf()</a>, and <a class="el" href="a00053.html#l00489">file_write_buf()</a>.</p>

</div>
</div><p>
<a class="anchor" name="67f38f48a73531bf4bcd7bf87c7b1db5"></a><!-- doxytag: member="fat.h::FS_CLUST_ACT_SEG" ref="67f38f48a73531bf4bcd7bf87c7b1db5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_CLUST_ACT_SEG&nbsp;&nbsp;&nbsp;0x01          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00239">239</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>, <a class="el" href="a00050.html#l01035">fat_read_file()</a>, <a class="el" href="a00050.html#l01117">fat_write_file()</a>, <a class="el" href="a00053.html#l00172">file_read()</a>, <a class="el" href="a00053.html#l00249">file_read_buf()</a>, <a class="el" href="a00053.html#l00415">file_write()</a>, and <a class="el" href="a00053.html#l00489">file_write_buf()</a>.</p>

</div>
</div><p>
<a class="anchor" name="6a0f491ab351899993a4171f5ff526f3"></a><!-- doxytag: member="fat.h::FS_CLUST_VAL_EOL" ref="6a0f491ab351899993a4171f5ff526f3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_CLUST_VAL_EOL&nbsp;&nbsp;&nbsp;0x0FFFFFFF          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00248">248</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l02294">fat_allocfreespace()</a>, and <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>.</p>

</div>
</div><p>
<a class="anchor" name="087734ece5cae84508fd1fbe9414ad02"></a><!-- doxytag: member="fat.h::FS_CLUST_VAL_READ" ref="087734ece5cae84508fd1fbe9414ad02" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_CLUST_VAL_READ&nbsp;&nbsp;&nbsp;FALSE          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00246">246</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l02294">fat_allocfreespace()</a>, <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>, <a class="el" href="a00052.html#l02133">fat_getfreespace()</a>, and <a class="el" href="a00052.html#l02198">fat_getfreespace_percent()</a>.</p>

</div>
</div><p>
<a class="anchor" name="c11d0331723bc237aac4d6c7a4fe7496"></a><!-- doxytag: member="fat.h::FS_CLUST_VAL_WRITE" ref="c11d0331723bc237aac4d6c7a4fe7496" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_CLUST_VAL_WRITE&nbsp;&nbsp;&nbsp;TRUE          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00247">247</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l02294">fat_allocfreespace()</a>, and <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>.</p>

</div>
</div><p>
<a class="anchor" name="fe6257cc919ba9fad5fad6c1e499f6d6"></a><!-- doxytag: member="fat.h::FS_END_FIND" ref="fe6257cc919ba9fad5fad6c1e499f6d6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_END_FIND&nbsp;&nbsp;&nbsp;0xFFFE          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Signal that a file entry is the last file entry accessibled by system. 
<p>

<p>Definition at line <a class="el" href="a00051.html#l00368">368</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00067.html#l00726">nav_filelist_set()</a>.</p>

</div>
</div><p>
<a class="anchor" name="303c1237fa5a61ddc015c0365eedd008"></a><!-- doxytag: member="fat.h::FS_ENTRY_DEL" ref="303c1237fa5a61ddc015c0365eedd008" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_ENTRY_DEL&nbsp;&nbsp;&nbsp;0xE5          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00190">190</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l02074">fat_delete_file()</a>, <a class="el" href="a00050.html#l01243">fat_entry_check()</a>, <a class="el" href="a00050.html#l01607">fat_entry_longname()</a>, <a class="el" href="a00052.html#l01808">fat_entry_shortname_compare()</a>, and <a class="el" href="a00052.html#l02004">fat_garbage_collector_entry()</a>.</p>

</div>
</div><p>
<a class="anchor" name="453bf57f059970b3ce13033b7959cb0c"></a><!-- doxytag: member="fat.h::FS_ENTRY_END" ref="453bf57f059970b3ce13033b7959cb0c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_ENTRY_END&nbsp;&nbsp;&nbsp;0x00          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00189">189</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l01921">fat_alloc_entry_free()</a>, <a class="el" href="a00050.html#l01243">fat_entry_check()</a>, <a class="el" href="a00052.html#l01088">fat_entry_label()</a>, <a class="el" href="a00050.html#l01607">fat_entry_longname()</a>, <a class="el" href="a00052.html#l01808">fat_entry_shortname_compare()</a>, and <a class="el" href="a00052.html#l02004">fat_garbage_collector_entry()</a>.</p>

</div>
</div><p>
<a class="anchor" name="bf0fa999d28907c3742656b6407aca78"></a><!-- doxytag: member="fat.h::FS_ENTRY_LFN_LAST" ref="bf0fa999d28907c3742656b6407aca78" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_ENTRY_LFN_LAST&nbsp;&nbsp;&nbsp;0x40          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00191">191</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l01500">fat_create_entry_file_name()</a>, <a class="el" href="a00052.html#l02074">fat_delete_file()</a>, and <a class="el" href="a00050.html#l01607">fat_entry_longname()</a>.</p>

</div>
</div><p>
<a class="anchor" name="2f2a41f51db7209b1e068193cd10a9d8"></a><!-- doxytag: member="fat.h::FS_FAT12_MAX_CLUSTERS" ref="2f2a41f51db7209b1e068193cd10a9d8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_FAT12_MAX_CLUSTERS&nbsp;&nbsp;&nbsp;4085          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00182">182</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="c1bec4fdf32e8ff9a9afc44b80607336"></a><!-- doxytag: member="fat.h::FS_FAT16_MAX_CLUSTERS" ref="c1bec4fdf32e8ff9a9afc44b80607336" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_FAT16_MAX_CLUSTERS&nbsp;&nbsp;&nbsp;65525          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00183">183</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="7090b63e1693b160aaebf802dfd8e05a"></a><!-- doxytag: member="fat.h::FS_MASK_SIZE_OF_SECTOR" ref="7090b63e1693b160aaebf802dfd8e05a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_MASK_SIZE_OF_SECTOR&nbsp;&nbsp;&nbsp;FS_512B_MASK          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00220">220</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="70b90ba913c43a878e9b478de5d1b61c"></a><!-- doxytag: member="fat.h::FS_MBR_OFFSET_PART_ENTRY" ref="70b90ba913c43a878e9b478de5d1b61c" args="(num)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_MBR_OFFSET_PART_ENTRY          </td>
          <td>(</td>
          <td class="paramtype">num&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%">&nbsp;&nbsp;&nbsp;((U16)((U16)(0x1BE)+(0x10 * num)))</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Position (unit byte) in the MBR of a partition entry. 
<p>

<p>Definition at line <a class="el" href="a00051.html#l00108">108</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00299">fat_get_nbpartition()</a>, <a class="el" href="a00052.html#l00105">fat_mount()</a>, and <a class="el" href="a00052.html#l00623">fat_write_MBR()</a>.</p>

</div>
</div><p>
<a class="anchor" name="4d46dee315ad22b94de647e7c883edc0"></a><!-- doxytag: member="fat.h::FS_NB_FAT" ref="4d46dee315ad22b94de647e7c883edc0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_NB_FAT&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00208">208</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="2e16c6cfcb3174f7ad19ad3996a69ae7"></a><!-- doxytag: member="fat.h::FS_NO_SEL" ref="2e16c6cfcb3174f7ad19ad3996a69ae7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_NO_SEL&nbsp;&nbsp;&nbsp;0xFFFF          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Signal that a file entry isn't selected. 
<p>

<p>Definition at line <a class="el" href="a00051.html#l00367">367</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00211">fat_check_select()</a>, <a class="el" href="a00050.html#l01394">fat_clear_entry_info_and_ptr()</a>, <a class="el" href="a00067.html#l00923">nav_filelist_eol()</a>, <a class="el" href="a00067.html#l00965">nav_filelist_exist()</a>, <a class="el" href="a00067.html#l00859">nav_filelist_goto()</a>, <a class="el" href="a00067.html#l00991">nav_filelist_nb()</a>, <a class="el" href="a00067.html#l00726">nav_filelist_set()</a>, <a class="el" href="a00061.html#l00214">nav_filterflat_goto()</a>, <a class="el" href="a00063.html#l00366">nav_filterlist_cd()</a>, <a class="el" href="a00063.html#l00152">nav_filterlist_goto()</a>, <a class="el" href="a00063.html#l00337">nav_filterlist_mount()</a>, <a class="el" href="a00063.html#l00257">nav_filterlist_nb_ex()</a>, <a class="el" href="a00063.html#l00088">nav_filterlist_next()</a>, <a class="el" href="a00063.html#l00076">nav_filterlist_reset()</a>, and <a class="el" href="a00063.html#l00349">nav_filterlist_root()</a>.</p>

</div>
</div><p>
<a class="anchor" name="b01eb16ba36dc7c0412a886c1678232f"></a><!-- doxytag: member="fat.h::FS_PART_BOOTABLE" ref="b01eb16ba36dc7c0412a886c1678232f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_PART_BOOTABLE&nbsp;&nbsp;&nbsp;0x80          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00152">152</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="3eecd129a66f4de0d5cd023f2f925e1e"></a><!-- doxytag: member="fat.h::FS_PART_HARD_DISK" ref="3eecd129a66f4de0d5cd023f2f925e1e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_PART_HARD_DISK&nbsp;&nbsp;&nbsp;0x81          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00175">175</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="e9933a03e28f302f391f377b8efc001d"></a><!-- doxytag: member="fat.h::FS_PART_NO_BOOTABLE" ref="e9933a03e28f302f391f377b8efc001d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_PART_NO_BOOTABLE&nbsp;&nbsp;&nbsp;0x00          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00153">153</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>, and <a class="el" href="a00052.html#l00623">fat_write_MBR()</a>.</p>

</div>
</div><p>
<a class="anchor" name="3222ba68ea2f6dc67aa88a0caeb7e6e4"></a><!-- doxytag: member="fat.h::FS_PART_NO_REMOVE_MEDIA" ref="3222ba68ea2f6dc67aa88a0caeb7e6e4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_PART_NO_REMOVE_MEDIA&nbsp;&nbsp;&nbsp;0xF8          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00174">174</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="1e9f640fda1f242a6a45dbffbffa4f56"></a><!-- doxytag: member="fat.h::FS_PART_REMOVE_MEDIA" ref="1e9f640fda1f242a6a45dbffbffa4f56" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_PART_REMOVE_MEDIA&nbsp;&nbsp;&nbsp;0xF0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00173">173</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="d8702ceb3912c09278602d3ea33224ff"></a><!-- doxytag: member="fat.h::FS_PART_TYPE_FAT12" ref="d8702ceb3912c09278602d3ea33224ff" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_PART_TYPE_FAT12&nbsp;&nbsp;&nbsp;0x01          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00167">167</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>, and <a class="el" href="a00052.html#l00623">fat_write_MBR()</a>.</p>

</div>
</div><p>
<a class="anchor" name="b9f13193999f7bb7ea0e4be6cf5ee57b"></a><!-- doxytag: member="fat.h::FS_PART_TYPE_FAT16_INF32M" ref="b9f13193999f7bb7ea0e4be6cf5ee57b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_PART_TYPE_FAT16_INF32M&nbsp;&nbsp;&nbsp;0x04          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00168">168</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>, and <a class="el" href="a00052.html#l00623">fat_write_MBR()</a>.</p>

</div>
</div><p>
<a class="anchor" name="29856400974fc942f9cf900a44ea7389"></a><!-- doxytag: member="fat.h::FS_PART_TYPE_FAT16_SUP32M" ref="29856400974fc942f9cf900a44ea7389" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_PART_TYPE_FAT16_SUP32M&nbsp;&nbsp;&nbsp;0x06          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00169">169</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>, and <a class="el" href="a00052.html#l00623">fat_write_MBR()</a>.</p>

</div>
</div><p>
<a class="anchor" name="c7c65caf9513f8cddd4319b334813d85"></a><!-- doxytag: member="fat.h::FS_PART_TYPE_FAT16_SUP32M_BIS" ref="c7c65caf9513f8cddd4319b334813d85" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_PART_TYPE_FAT16_SUP32M_BIS&nbsp;&nbsp;&nbsp;0x0E          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00170">170</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="93881dd293ba41286e413bef3212786a"></a><!-- doxytag: member="fat.h::FS_PART_TYPE_FAT32" ref="93881dd293ba41286e413bef3212786a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_PART_TYPE_FAT32&nbsp;&nbsp;&nbsp;0x0B          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00171">171</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>, and <a class="el" href="a00052.html#l00623">fat_write_MBR()</a>.</p>

</div>
</div><p>
<a class="anchor" name="3e13e837536764161f0aa9768e76b2e1"></a><!-- doxytag: member="fat.h::FS_PART_TYPE_FAT32_BIS" ref="3e13e837536764161f0aa9768e76b2e1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_PART_TYPE_FAT32_BIS&nbsp;&nbsp;&nbsp;0x0C          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00172">172</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="f5a730740b41e20c1a467dcd1d52699f"></a><!-- doxytag: member="fat.h::FS_SHIFT_B_TO_FILE_ENTRY" ref="f5a730740b41e20c1a467dcd1d52699f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_SHIFT_B_TO_FILE_ENTRY&nbsp;&nbsp;&nbsp;5          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00198">198</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l01195">fat_read_dir()</a>.</p>

</div>
</div><p>
<a class="anchor" name="90491f94e13d340a9d3f98e57a66e9d3"></a><!-- doxytag: member="fat.h::FS_SHIFT_B_TO_SECTOR" ref="90491f94e13d340a9d3f98e57a66e9d3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_SHIFT_B_TO_SECTOR&nbsp;&nbsp;&nbsp;FS_512B_SHIFT_BIT          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00221">221</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="0ff67916e073882d162d5fbac91d7e50"></a><!-- doxytag: member="fat.h::FS_SIZE_FILE_ENTRY" ref="0ff67916e073882d162d5fbac91d7e50" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_SIZE_FILE_ENTRY&nbsp;&nbsp;&nbsp;32          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00197">197</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l01558">fat_create_long_name_entry()</a>, <a class="el" href="a00050.html#l01607">fat_entry_longname()</a>, <a class="el" href="a00052.html#l02004">fat_garbage_collector_entry()</a>, <a class="el" href="a00050.html#l01773">fat_get_ptr_entry()</a>, <a class="el" href="a00052.html#l01181">fat_initialize_dir()</a>, and <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="bbdca2b90701f373bf6c865c88c99697"></a><!-- doxytag: member="fat.h::FS_SIZE_LFN_ENTRY" ref="bbdca2b90701f373bf6c865c88c99697" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_SIZE_LFN_ENTRY&nbsp;&nbsp;&nbsp;13          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00199">199</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l01838">fat_check_name()</a>, <a class="el" href="a00052.html#l01500">fat_create_entry_file_name()</a>, and <a class="el" href="a00067.html#l01769">nav_file_name()</a>.</p>

</div>
</div><p>
<a class="anchor" name="3d8dbd6dd4c5150d859e8926f69e88b9"></a><!-- doxytag: member="fat.h::FS_SIZE_OF_SECTOR" ref="3d8dbd6dd4c5150d859e8926f69e88b9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_SIZE_OF_SECTOR&nbsp;&nbsp;&nbsp;FS_512B          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00219">219</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00058.html#l00365">fsaccess_example_read()</a>, and <a class="el" href="a00058.html#l00470">fsaccess_example_write()</a>.</p>

</div>
</div><p>
<a class="anchor" name="69da5456f1f42a68c03ac860e33ac75b"></a><!-- doxytag: member="fat.h::FS_SIZE_SFNAME" ref="69da5456f1f42a68c03ac860e33ac75b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_SIZE_SFNAME&nbsp;&nbsp;&nbsp;11          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00200">200</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l01633">fat_create_short_entry_name()</a>, and <a class="el" href="a00050.html#l01476">fat_entry_shortname()</a>.</p>

</div>
</div><p>
<a class="anchor" name="f26286ed549d8b9fe8beb60c7744b5cc"></a><!-- doxytag: member="fat.h::FS_SIZE_SFNAME_EXT_ONLY" ref="f26286ed549d8b9fe8beb60c7744b5cc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_SIZE_SFNAME_EXT_ONLY&nbsp;&nbsp;&nbsp;3          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00202">202</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="18e4c969985c697213c58a67e7c20795"></a><!-- doxytag: member="fat.h::FS_SIZE_SFNAME_WITHOUT_EXT" ref="18e4c969985c697213c58a67e7c20795" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_SIZE_SFNAME_WITHOUT_EXT&nbsp;&nbsp;&nbsp;8          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00201">201</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l01633">fat_create_short_entry_name()</a>, and <a class="el" href="a00050.html#l01476">fat_entry_shortname()</a>.</p>

</div>
</div><p>
<a class="anchor" name="cbc6a789e2144cbc0893187e2d665d8c"></a><!-- doxytag: member="fat.h::FS_TYPE_FAT_12" ref="cbc6a789e2144cbc0893187e2d665d8c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_TYPE_FAT_12&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00359">359</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>, and <a class="el" href="a00052.html#l00484">fat_select_filesystem()</a>.</p>

</div>
</div><p>
<a class="anchor" name="3433de4e69ce8d55317158ee2624e8af"></a><!-- doxytag: member="fat.h::FS_TYPE_FAT_16" ref="3433de4e69ce8d55317158ee2624e8af" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_TYPE_FAT_16&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00360">360</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>, and <a class="el" href="a00052.html#l00484">fat_select_filesystem()</a>.</p>

</div>
</div><p>
<a class="anchor" name="bed7b1e094b19dac8efa753f59f84fc6"></a><!-- doxytag: member="fat.h::FS_TYPE_FAT_32" ref="bed7b1e094b19dac8efa753f59f84fc6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_TYPE_FAT_32&nbsp;&nbsp;&nbsp;3          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00361">361</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l02294">fat_allocfreespace()</a>, <a class="el" href="a00052.html#l00105">fat_mount()</a>, and <a class="el" href="a00052.html#l00484">fat_select_filesystem()</a>.</p>

</div>
</div><p>
<a class="anchor" name="429fbd0498704c3d5864877548040069"></a><!-- doxytag: member="fat.h::FS_TYPE_FAT_UNM" ref="429fbd0498704c3d5864877548040069" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FS_TYPE_FAT_UNM&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Partition not mounted. 
<p>

<p>Definition at line <a class="el" href="a00051.html#l00358">358</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00091">fat_check_device()</a>, <a class="el" href="a00050.html#l00154">fat_check_mount()</a>, <a class="el" href="a00050.html#l01888">fat_check_nav_access_disk()</a>, <a class="el" href="a00050.html#l01920">fat_check_nav_access_file()</a>, <a class="el" href="a00050.html#l00175">fat_check_noopen()</a>, <a class="el" href="a00052.html#l00105">fat_mount()</a>, <a class="el" href="a00067.html#l00324">nav_drive_set()</a>, <a class="el" href="a00067.html#l00609">nav_partition_freespace()</a>, <a class="el" href="a00067.html#l00627">nav_partition_freespace_percent()</a>, <a class="el" href="a00067.html#l00461">nav_partition_mount()</a>, <a class="el" href="a00067.html#l00434">nav_partition_set()</a>, <a class="el" href="a00067.html#l00582">nav_partition_space()</a>, <a class="el" href="a00067.html#l00485">nav_partition_type()</a>, and <a class="el" href="a00067.html#l00165">nav_reset()</a>.</p>

</div>
</div><p>
<a class="anchor" name="1bf0f3b3cb79deb5b7c459b5d10449d5"></a><!-- doxytag: member="fat.h::HIGH_16_BPB_BytsPerSec" ref="1bf0f3b3cb79deb5b7c459b5d10449d5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HIGH_16_BPB_BytsPerSec&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[12]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00115">115</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="c7277af1ce6ee4efe860da2d1f3b1b38"></a><!-- doxytag: member="fat.h::HIGH_16_BPB_FATSz16" ref="c7277af1ce6ee4efe860da2d1f3b1b38" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HIGH_16_BPB_FATSz16&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[23]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00120">120</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>, and <a class="el" href="a00052.html#l00730">fat_write_PBR()</a>.</p>

</div>
</div><p>
<a class="anchor" name="067a2e63be3c41412dca91da1ac0f1b7"></a><!-- doxytag: member="fat.h::HIGH_16_BPB_FSInfo" ref="067a2e63be3c41412dca91da1ac0f1b7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HIGH_16_BPB_FSInfo&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[49]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00139">139</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="72679a68a6d92475a790f11861a92316"></a><!-- doxytag: member="fat.h::HIGH_16_BPB_ResvSecCnt" ref="72679a68a6d92475a790f11861a92316" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HIGH_16_BPB_ResvSecCnt&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[15]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00132">132</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="8f6e516573fdbd3ea8eadd402cc6e134"></a><!-- doxytag: member="fat.h::HIGH_16_BPB_RootEntCnt" ref="8f6e516573fdbd3ea8eadd402cc6e134" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HIGH_16_BPB_RootEntCnt&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[18]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00118">118</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="3f384bfdb0b306957dbc5f9c9b087dbe"></a><!-- doxytag: member="fat.h::HIGH_16_BPB_TotSec16" ref="3f384bfdb0b306957dbc5f9c9b087dbe" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HIGH_16_BPB_TotSec16&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[20]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00126">126</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="c2ce5473766316396fb472c1bdd685e9"></a><!-- doxytag: member="fat.h::Is_fat12" ref="c2ce5473766316396fb472c1bdd685e9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Is_fat12&nbsp;&nbsp;&nbsp;(FS_TYPE_FAT_12 == fs_g_nav_fast.u8_type_fat)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00075">75</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00845">fat_checkcluster()</a>, <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>, <a class="el" href="a00050.html#l00603">fat_cluster_val()</a>, <a class="el" href="a00052.html#l02133">fat_getfreespace()</a>, <a class="el" href="a00052.html#l02198">fat_getfreespace_percent()</a>, <a class="el" href="a00052.html#l01006">fat_initialize_fat()</a>, <a class="el" href="a00052.html#l00484">fat_select_filesystem()</a>, <a class="el" href="a00052.html#l01044">fat_serialnumber()</a>, <a class="el" href="a00052.html#l00623">fat_write_MBR()</a>, and <a class="el" href="a00052.html#l00730">fat_write_PBR()</a>.</p>

</div>
</div><p>
<a class="anchor" name="2dcd74d640da1e20ad510413c9ef4c85"></a><!-- doxytag: member="fat.h::Is_fat16" ref="2dcd74d640da1e20ad510413c9ef4c85" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Is_fat16&nbsp;&nbsp;&nbsp;(FS_TYPE_FAT_16 == fs_g_nav_fast.u8_type_fat)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00080">80</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00845">fat_checkcluster()</a>, <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>, <a class="el" href="a00050.html#l00603">fat_cluster_val()</a>, <a class="el" href="a00052.html#l02198">fat_getfreespace_percent()</a>, <a class="el" href="a00052.html#l01006">fat_initialize_fat()</a>, <a class="el" href="a00052.html#l00484">fat_select_filesystem()</a>, <a class="el" href="a00052.html#l01044">fat_serialnumber()</a>, and <a class="el" href="a00052.html#l00623">fat_write_MBR()</a>.</p>

</div>
</div><p>
<a class="anchor" name="57a82f24a45a33a159e0362b7e82e3fa"></a><!-- doxytag: member="fat.h::Is_fat32" ref="57a82f24a45a33a159e0362b7e82e3fa" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Is_fat32&nbsp;&nbsp;&nbsp;(FS_TYPE_FAT_32 == fs_g_nav_fast.u8_type_fat)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00085">85</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l02294">fat_allocfreespace()</a>, <a class="el" href="a00050.html#l00845">fat_checkcluster()</a>, <a class="el" href="a00052.html#l00929">fat_clean_zone()</a>, <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>, <a class="el" href="a00050.html#l00798">fat_cluster_readnext()</a>, <a class="el" href="a00050.html#l00603">fat_cluster_val()</a>, <a class="el" href="a00052.html#l02133">fat_getfreespace()</a>, <a class="el" href="a00052.html#l02198">fat_getfreespace_percent()</a>, <a class="el" href="a00052.html#l01006">fat_initialize_fat()</a>, <a class="el" href="a00052.html#l00484">fat_select_filesystem()</a>, <a class="el" href="a00052.html#l00623">fat_write_MBR()</a>, and <a class="el" href="a00052.html#l00730">fat_write_PBR()</a>.</p>

</div>
</div><p>
<a class="anchor" name="4ad00946d48b5c25c6734344ecf974c1"></a><!-- doxytag: member="fat.h::Is_unicode" ref="4ad00946d48b5c25c6734344ecf974c1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Is_unicode&nbsp;&nbsp;&nbsp;(<a class="el" href="a00020.html#fdc963fda511dd9e790c81b6a6b33d34">g_b_unicode</a>)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00092">92</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l01838">fat_check_name()</a>, <a class="el" href="a00052.html#l01500">fat_create_entry_file_name()</a>, <a class="el" href="a00052.html#l01558">fat_create_long_name_entry()</a>, <a class="el" href="a00052.html#l01633">fat_create_short_entry_name()</a>, <a class="el" href="a00050.html#l01607">fat_entry_longname()</a>, <a class="el" href="a00050.html#l01476">fat_entry_shortname()</a>, <a class="el" href="a00067.html#l01267">nav_dir_name()</a>, <a class="el" href="a00067.html#l01769">nav_file_name()</a>, <a class="el" href="a00067.html#l01411">nav_getcwd()</a>, <a class="el" href="a00067.html#l01578">nav_setcwd()</a>, <a class="el" href="a00069.html#l00277">pl_main_close()</a>, and <a class="el" href="a00069.html#l00577">pl_main_readline()</a>.</p>

</div>
</div><p>
<a class="anchor" name="c1ba95f06dfaaf3c71a5eb12dd56009c"></a><!-- doxytag: member="fat.h::LOW0_32_BPB_FATSz32" ref="c1ba95f06dfaaf3c71a5eb12dd56009c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOW0_32_BPB_FATSz32&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[36]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00121">121</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>, and <a class="el" href="a00052.html#l00730">fat_write_PBR()</a>.</p>

</div>
</div><p>
<a class="anchor" name="0a4a06552fb3a44093ef87a09fc2840f"></a><!-- doxytag: member="fat.h::LOW0_32_BPB_RootClus" ref="0a4a06552fb3a44093ef87a09fc2840f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOW0_32_BPB_RootClus&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[44]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00134">134</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="874e06185fcba59848db370a65ffb162"></a><!-- doxytag: member="fat.h::LOW0_32_BPB_TotSec32" ref="874e06185fcba59848db370a65ffb162" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOW0_32_BPB_TotSec32&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[32]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00127">127</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="dff814b0d106b4c3b3f730fbef8338ce"></a><!-- doxytag: member="fat.h::LOW1_32_BPB_FATSz32" ref="dff814b0d106b4c3b3f730fbef8338ce" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOW1_32_BPB_FATSz32&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[37]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00122">122</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>, and <a class="el" href="a00052.html#l00730">fat_write_PBR()</a>.</p>

</div>
</div><p>
<a class="anchor" name="dd80ee1ba4292b33a35bb9794e46b91d"></a><!-- doxytag: member="fat.h::LOW1_32_BPB_RootClus" ref="dd80ee1ba4292b33a35bb9794e46b91d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOW1_32_BPB_RootClus&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[45]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00135">135</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="36c744b34bb704e3777d34a3b4c365a7"></a><!-- doxytag: member="fat.h::LOW1_32_BPB_TotSec32" ref="36c744b34bb704e3777d34a3b4c365a7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOW1_32_BPB_TotSec32&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[33]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00128">128</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="8ef0e71139f216c7aaa15dc92f04ad74"></a><!-- doxytag: member="fat.h::LOW2_32_BPB_FATSz32" ref="8ef0e71139f216c7aaa15dc92f04ad74" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOW2_32_BPB_FATSz32&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[38]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00123">123</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="47260296ce546b21bd10d3ddc963a2c7"></a><!-- doxytag: member="fat.h::LOW2_32_BPB_RootClus" ref="47260296ce546b21bd10d3ddc963a2c7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOW2_32_BPB_RootClus&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[46]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00136">136</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="b1bff622ef1d89f52b64b80e0f04bb4c"></a><!-- doxytag: member="fat.h::LOW2_32_BPB_TotSec32" ref="b1bff622ef1d89f52b64b80e0f04bb4c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOW2_32_BPB_TotSec32&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[34]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00129">129</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="ae445a7061c79d078f70001aa7d5ca16"></a><!-- doxytag: member="fat.h::LOW3_32_BPB_FATSz32" ref="ae445a7061c79d078f70001aa7d5ca16" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOW3_32_BPB_FATSz32&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[39]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00124">124</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="68f0eada6fa2bbfffcdc98fcd463d225"></a><!-- doxytag: member="fat.h::LOW3_32_BPB_RootClus" ref="68f0eada6fa2bbfffcdc98fcd463d225" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOW3_32_BPB_RootClus&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[47]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00137">137</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="f6bd554441216cd3475dd35a23d2a282"></a><!-- doxytag: member="fat.h::LOW3_32_BPB_TotSec32" ref="f6bd554441216cd3475dd35a23d2a282" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOW3_32_BPB_TotSec32&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[35]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00130">130</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="931fb8aaa3236e5d2ee2d03424c07dc5"></a><!-- doxytag: member="fat.h::LOW_16_BPB_BytsPerSec" ref="931fb8aaa3236e5d2ee2d03424c07dc5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOW_16_BPB_BytsPerSec&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[11]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00114">114</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="fe57e984b2baf3970ac7feda02355ac9"></a><!-- doxytag: member="fat.h::LOW_16_BPB_FATSz16" ref="fe57e984b2baf3970ac7feda02355ac9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOW_16_BPB_FATSz16&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[22]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00119">119</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>, and <a class="el" href="a00052.html#l00730">fat_write_PBR()</a>.</p>

</div>
</div><p>
<a class="anchor" name="690460cf97d7336c73da86955724b060"></a><!-- doxytag: member="fat.h::LOW_16_BPB_FSInfo" ref="690460cf97d7336c73da86955724b060" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOW_16_BPB_FSInfo&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[48]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00138">138</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="054eca177d5b03154cb95ead9e3cca0b"></a><!-- doxytag: member="fat.h::LOW_16_BPB_ResvSecCnt" ref="054eca177d5b03154cb95ead9e3cca0b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOW_16_BPB_ResvSecCnt&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[14]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00131">131</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="b1eab4cea0637f0fa8c7e521968803a2"></a><!-- doxytag: member="fat.h::LOW_16_BPB_RootEntCnt" ref="b1eab4cea0637f0fa8c7e521968803a2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOW_16_BPB_RootEntCnt&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[17]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00117">117</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="b63400ba470fe3bf6c110a0af483ccc0"></a><!-- doxytag: member="fat.h::LOW_16_BPB_TotSec16" ref="b63400ba470fe3bf6c110a0af483ccc0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOW_16_BPB_TotSec16&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[19]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00125">125</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<a class="anchor" name="58a994fdcf3ee750422c9088d66033c1"></a><!-- doxytag: member="fat.h::U8_BPB_NumFATs" ref="58a994fdcf3ee750422c9088d66033c1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define U8_BPB_NumFATs&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[16]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00133">133</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="14c055fd6f5b4bda4470668bab3694ee"></a><!-- doxytag: member="fat.h::U8_BPB_SecPerClus" ref="14c055fd6f5b4bda4470668bab3694ee" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define U8_BPB_SecPerClus&nbsp;&nbsp;&nbsp;<a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[13]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00116">116</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>.</p>

</div>
</div><p>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="af4e4784230dad737c18ed1f15d671fb"></a><!-- doxytag: member="fat.h::Fs_cluster" ref="af4e4784230dad737c18ed1f15d671fb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="a00012.html">st_fs_cluster</a>  <a class="el" href="a00012.html">Fs_cluster</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="119f57abfa3b1f77fd0514b26da6afb4"></a><!-- doxytag: member="fat.h::PTR_CACHE" ref="119f57abfa3b1f77fd0514b26da6afb4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef U8 _MEM_TYPE_SLOW_* <a class="el" href="a00020.html#119f57abfa3b1f77fd0514b26da6afb4">PTR_CACHE</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00418">418</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="1fa62b2728e71cff2e95556db7ed1b9c"></a><!-- doxytag: member="fat.h::fat_allocfreespace" ref="1fa62b2728e71cff2e95556db7ed1b9c" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_allocfreespace           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function allocs a cluster list. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE in case of error, see global value "fs_g_status" for more detail <p>
TRUE otherwise</dd></dl>
<div class="fragment"><pre class="fragment">
//! Global variables used
//! IN :
//!   fs_g_seg.u32_addr          Last cluster value of a cluster list to link with the new cluster list
//!                              If no cluster list to link then set MSB0(fs_g_seg.u32_addr) to 0xFF
//!   fs_g_seg.u32_size_or_pos   Maximum size of cluster list to alloc (unit sector)
//! OUT:
//!   fs_g_seg.u32_addr          Return the first cluster value of the new cluster list
//!   fs_g_seg.u32_size_or_pos   The number of sector remainning (no allocated sectors, because disk fragmented or disk full)
//! </pre></div> 
<p>Definition at line <a class="el" href="a00052.html#l02294">2294</a> of file <a class="el" href="a00052.html">fat_unusual.c</a>.</p>

<p>References <a class="el" href="a00052.html#l02425">fat_clear_info_fat_mod()</a>, <a class="el" href="a00050.html#l00603">fat_cluster_val()</a>, <a class="el" href="a00052.html#l02439">fat_update_fat2()</a>, <a class="el" href="a00052.html#l00853">fat_write_fat32_FSInfo()</a>, <a class="el" href="a00051.html#l00248">FS_CLUST_VAL_EOL</a>, <a class="el" href="a00051.html#l00246">FS_CLUST_VAL_READ</a>, <a class="el" href="a00051.html#l00247">FS_CLUST_VAL_WRITE</a>, <a class="el" href="a00055.html#l00216">FS_ERR_NO_FREE_SPACE</a>, <a class="el" href="a00051.html#l00403">fs_g_cluster</a>, <a class="el" href="a00051.html#l00394">fs_g_nav</a>, <a class="el" href="a00051.html#l00395">fs_g_nav_fast</a>, <a class="el" href="a00051.html#l00400">fs_g_seg</a>, <a class="el" href="a00055.html#l00256">fs_g_status</a>, <a class="el" href="a00051.html#l00361">FS_TYPE_FAT_32</a>, <a class="el" href="a00051.html#l00085">Is_fat32</a>, <a class="el" href="a00051.html#l00280">Fs_management::rootdir</a>, <a class="el" href="a00051.html#l00317">Fs_segment::u32_addr</a>, <a class="el" href="a00051.html#l00258">Fs_rootdir::u32_cluster</a>, <a class="el" href="a00051.html#l00277">Fs_management::u32_CountofCluster</a>, <a class="el" href="a00051.html#l00324">st_fs_cluster::u32_pos</a>, <a class="el" href="a00051.html#l00318">Fs_segment::u32_size_or_pos</a>, <a class="el" href="a00051.html#l00325">st_fs_cluster::u32_val</a>, <a class="el" href="a00051.html#l00273">Fs_management::u8_BPB_SecPerClus</a>, and <a class="el" href="a00051.html#l00295">Fs_management_fast::u8_type_fat</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l01921">fat_alloc_entry_free()</a>, <a class="el" href="a00050.html#l01117">fat_write_file()</a>, and <a class="el" href="a00067.html#l01361">nav_dir_make()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l02294"></a>02294 {
<a name="l02295"></a>02295    <span class="comment">// Flag to signal the first step which search the first free cluster of the new list</span>
<a name="l02296"></a>02296    Bool first_cluster_free_is_found = FALSE;
<a name="l02297"></a>02297    <span class="comment">// If TRUE then use a quick procedure but don't scan all FAT else use a slow proceudre but scan all FAT</span>
<a name="l02298"></a>02298    Bool b_quick_find = TRUE;
<a name="l02299"></a>02299 
<a name="l02300"></a>02300    <span class="keywordflow">if</span>( <a class="code" href="a00020.html#57a82f24a45a33a159e0362b7e82e3fa">Is_fat32</a> )
<a name="l02301"></a>02301    {
<a name="l02302"></a>02302       <span class="comment">// Clear info about free space</span>
<a name="l02303"></a>02303       <span class="keywordflow">if</span>( !<a class="code" href="a00020.html#9cf154ffe36bc2c00b1d589e523b449c" title="This function writes the space free number in selected FAT32 partition.">fat_write_fat32_FSInfo</a>( 0xFFFFFFFF ))
<a name="l02304"></a>02304          <span class="keywordflow">return</span> FALSE;
<a name="l02305"></a>02305    }
<a name="l02306"></a>02306 
<a name="l02307"></a>02307    <span class="keywordflow">if</span>( 0xFF == MSB0(<a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a>) )
<a name="l02308"></a>02308    {
<a name="l02309"></a>02309 fat_allocfreespace_start:
<a name="l02310"></a>02310       <span class="comment">// New cluster list, then research at the beginning of FAT</span>
<a name="l02311"></a>02311       <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a> = 2;
<a name="l02312"></a>02312    }<span class="keywordflow">else</span>{
<a name="l02313"></a>02313       <span class="comment">// Continue the cluster list then start after the end of the cluster list</span>
<a name="l02314"></a>02314       <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a> = <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a>+1;
<a name="l02315"></a>02315    }
<a name="l02316"></a>02316 
<a name="l02317"></a>02317    <a class="code" href="a00020.html#9503329592cf7484faf77ca95a6a21aa" title="This function clears the cache information about FAT modifications.">fat_clear_info_fat_mod</a>();
<a name="l02318"></a>02318 
<a name="l02319"></a>02319    <span class="comment">// Read ALL FAT1</span>
<a name="l02320"></a>02320    <span class="keywordflow">for</span>(
<a name="l02321"></a>02321    ;     <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a> &lt; <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#2f9e0c9af661ea927729c08280e1105e" title="Number of cluster (include the two reserved cluster).">u32_CountofCluster</a>
<a name="l02322"></a>02322    ;     <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a>++ )
<a name="l02323"></a>02323    {
<a name="l02324"></a>02324       <span class="comment">// Get the value of the cluster</span>
<a name="l02325"></a>02325       <span class="keywordflow">if</span> ( !<a class="code" href="a00019.html#1be84552293d174f534b2fb8d0a4e737" title="This function returns or modifys a cluster value in FAT.">fat_cluster_val</a>( <a class="code" href="a00020.html#087734ece5cae84508fd1fbe9414ad02">FS_CLUST_VAL_READ</a> ) )
<a name="l02326"></a>02326          <span class="keywordflow">return</span> FALSE;
<a name="l02327"></a>02327 
<a name="l02328"></a>02328       <span class="keywordflow">if</span> ( 0 == <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> )
<a name="l02329"></a>02329       {
<a name="l02330"></a>02330          <span class="comment">// A free cluster is found</span>
<a name="l02331"></a>02331          <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> = <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a>;    <span class="comment">// value of the cluster is the new free cluster</span>
<a name="l02332"></a>02332          <span class="keywordflow">if</span>( TRUE == first_cluster_free_is_found )
<a name="l02333"></a>02333          {
<a name="l02334"></a>02334             <span class="comment">// Link the new cluster with previous cluster</span>
<a name="l02335"></a>02335             <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a>--;                      <span class="comment">// select the previous cluster</span>
<a name="l02336"></a>02336             <span class="keywordflow">if</span> ( !<a class="code" href="a00019.html#1be84552293d174f534b2fb8d0a4e737" title="This function returns or modifys a cluster value in FAT.">fat_cluster_val</a>( <a class="code" href="a00020.html#c11d0331723bc237aac4d6c7a4fe7496">FS_CLUST_VAL_WRITE</a> ) )
<a name="l02337"></a>02337                <span class="keywordflow">return</span> FALSE;
<a name="l02338"></a>02338          }
<a name="l02339"></a>02339          <span class="keywordflow">else</span>
<a name="l02340"></a>02340          {
<a name="l02341"></a>02341             <span class="comment">// It is the first cluster of the new list</span>
<a name="l02342"></a>02342             first_cluster_free_is_found = TRUE;
<a name="l02343"></a>02343 
<a name="l02344"></a>02344             <span class="keywordflow">if</span>( 0xFF != MSB0(<a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a>) )
<a name="l02345"></a>02345             {
<a name="l02346"></a>02346                <span class="comment">// Link this new cluster with the current cluster list</span>
<a name="l02347"></a>02347                <span class="comment">// Select the last cluster of the current list</span>
<a name="l02348"></a>02348                <span class="keywordflow">if</span>( 0 == <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a> )
<a name="l02349"></a>02349                {  <span class="comment">// The current cluster list is the cluster list of root directory</span>
<a name="l02350"></a>02350                   <span class="keywordflow">if</span>( <a class="code" href="a00020.html#bed7b1e094b19dac8efa753f59f84fc6">FS_TYPE_FAT_32</a> != <a class="code" href="a00020.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00006.html#74121fb3c8d3a1d018c911650e2ec920" title="FAT type (default = no mounted = FS_TYPE_FAT_UNM).">u8_type_fat</a> )
<a name="l02351"></a>02351                   {
<a name="l02352"></a>02352                      <span class="comment">// Impossible to increment ROOT DIR size of FAT12 or FAT16</span>
<a name="l02353"></a>02353                      <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#660c831b30ffc47ef997a2e8ddc66c0d" title="No free cluster found in FAT.">FS_ERR_NO_FREE_SPACE</a>;
<a name="l02354"></a>02354                      <span class="keywordflow">return</span> FALSE;
<a name="l02355"></a>02355                   }
<a name="l02356"></a>02356                   <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a> = <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#b26050633d0597af6c2c6abe9684481b" title="Root directory informations.">rootdir</a>.<a class="code" href="a00007.html#54d1e701d0705a2b2adb2b2cdc2e604b" title="For FAT32, the root directory is a cluster list.">u32_cluster</a>;
<a name="l02357"></a>02357                }
<a name="l02358"></a>02358                <span class="keywordflow">else</span>
<a name="l02359"></a>02359                {
<a name="l02360"></a>02360                   <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a> = <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a>;
<a name="l02361"></a>02361                }
<a name="l02362"></a>02362                <span class="keywordflow">if</span> ( !<a class="code" href="a00019.html#1be84552293d174f534b2fb8d0a4e737" title="This function returns or modifys a cluster value in FAT.">fat_cluster_val</a>( <a class="code" href="a00020.html#c11d0331723bc237aac4d6c7a4fe7496">FS_CLUST_VAL_WRITE</a> ) )
<a name="l02363"></a>02363                   <span class="keywordflow">return</span> FALSE;
<a name="l02364"></a>02364             }  <span class="comment">// else no writing the first cluster value in FAT because no current cluster list</span>
<a name="l02365"></a>02365             <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a> = <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a>;    <span class="comment">// save the first cluster value</span>
<a name="l02366"></a>02366          }
<a name="l02367"></a>02367 
<a name="l02368"></a>02368          <span class="comment">// At the new cluster position, set the flag end of list</span>
<a name="l02369"></a>02369          <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a> = <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a>;    <span class="comment">// Select the new cluster</span>
<a name="l02370"></a>02370          <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> = <a class="code" href="a00020.html#6a0f491ab351899993a4171f5ff526f3">FS_CLUST_VAL_EOL</a>;        <span class="comment">// Cluster value is the flag end of list</span>
<a name="l02371"></a>02371          <span class="keywordflow">if</span> ( !<a class="code" href="a00019.html#1be84552293d174f534b2fb8d0a4e737" title="This function returns or modifys a cluster value in FAT.">fat_cluster_val</a>( <a class="code" href="a00020.html#c11d0331723bc237aac4d6c7a4fe7496">FS_CLUST_VAL_WRITE</a> ) )
<a name="l02372"></a>02372             <span class="keywordflow">return</span> FALSE;
<a name="l02373"></a>02373 
<a name="l02374"></a>02374          <span class="comment">// Compute the remaining sectors</span>
<a name="l02375"></a>02375          <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> &lt;= <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#cddebea9972567fdcb5b87327b48125e" title="Cluster size (unit 512B).">u8_BPB_SecPerClus</a> )
<a name="l02376"></a>02376          {
<a name="l02377"></a>02377             <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> = 0; <span class="comment">// All space found</span>
<a name="l02378"></a>02378             <span class="keywordflow">break</span>;                        <span class="comment">// Stop loop</span>
<a name="l02379"></a>02379          }
<a name="l02380"></a>02380          <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> -= <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#cddebea9972567fdcb5b87327b48125e" title="Cluster size (unit 512B).">u8_BPB_SecPerClus</a>;
<a name="l02381"></a>02381       }
<a name="l02382"></a>02382       <span class="keywordflow">else</span>
<a name="l02383"></a>02383       {
<a name="l02384"></a>02384          <span class="comment">// The next cluster is not free</span>
<a name="l02385"></a>02385          <span class="keywordflow">if</span>( TRUE == first_cluster_free_is_found )
<a name="l02386"></a>02386          {
<a name="l02387"></a>02387             <span class="comment">// To have a segment memory continue, the cluster list must be continue</span>
<a name="l02388"></a>02388             <span class="comment">// then stop allocation</span>
<a name="l02389"></a>02389             <span class="keywordflow">break</span>;
<a name="l02390"></a>02390          }
<a name="l02391"></a>02391          <span class="keywordflow">else</span>
<a name="l02392"></a>02392          {
<a name="l02393"></a>02393             <span class="comment">// It is the first step to search the first free cluster</span>
<a name="l02394"></a>02394             <span class="comment">// then ignore this cluster no free and continue search</span>
<a name="l02395"></a>02395             <span class="keywordflow">if</span>( b_quick_find )
<a name="l02396"></a>02396             {
<a name="l02397"></a>02397                <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a> += 500;
<a name="l02398"></a>02398             }
<a name="l02399"></a>02399          }
<a name="l02400"></a>02400       }
<a name="l02401"></a>02401    }
<a name="l02402"></a>02402 
<a name="l02403"></a>02403    <span class="comment">// End of alloc</span>
<a name="l02404"></a>02404    <span class="keywordflow">if</span>( FALSE == first_cluster_free_is_found )
<a name="l02405"></a>02405    {
<a name="l02406"></a>02406       <span class="keywordflow">if</span>( b_quick_find )
<a name="l02407"></a>02407       {
<a name="l02408"></a>02408          <span class="comment">// Retry in normal mode to scann all FAT (= no quick mode)</span>
<a name="l02409"></a>02409          b_quick_find = FALSE;
<a name="l02410"></a>02410          <span class="keywordflow">goto</span> fat_allocfreespace_start;
<a name="l02411"></a>02411       }
<a name="l02412"></a>02412       <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#660c831b30ffc47ef997a2e8ddc66c0d" title="No free cluster found in FAT.">FS_ERR_NO_FREE_SPACE</a>; <span class="comment">// NO FREE CLUSTER FIND</span>
<a name="l02413"></a>02413       <span class="keywordflow">return</span> FALSE;
<a name="l02414"></a>02414    }
<a name="l02415"></a>02415 
<a name="l02416"></a>02416    <span class="keywordflow">return</span> <a class="code" href="a00020.html#8145cff91620fc1b70aa0eef5750db72" title="This function copys the modifications of the first FAT to the second FAT.">fat_update_fat2</a>();
<a name="l02417"></a>02417 }
<a name="l02418"></a>02418 <span class="preprocessor">#endif  // FS_LEVEL_FEATURES</span>
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="5948c1de515852418670d3fb8ae1e832"></a><!-- doxytag: member="fat.h::fat_cache_clear" ref="5948c1de515852418670d3fb8ae1e832" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fat_cache_clear           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function clears the sector cache. 
<p>

<p>Definition at line <a class="el" href="a00050.html#l01840">1840</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00051.html#l00222">FS_CACHE_SIZE</a>, and <a class="el" href="a00051.html#l00415">fs_g_sector</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00929">fat_clean_zone()</a>, <a class="el" href="a00052.html#l02474">fat_clear_cluster()</a>, <a class="el" href="a00052.html#l00853">fat_write_fat32_FSInfo()</a>, <a class="el" href="a00052.html#l00623">fat_write_MBR()</a>, and <a class="el" href="a00052.html#l00730">fat_write_PBR()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01841"></a>01841 {
<a name="l01842"></a>01842    memset( <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a> , 0 , <a class="code" href="a00020.html#1f24fc24a15f2e52ecae58ae2d5dfbfc">FS_CACHE_SIZE</a> );
<a name="l01843"></a>01843 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="ecb0d4c200bed41b8bdcf671aa931a2a"></a><!-- doxytag: member="fat.h::fat_cache_clusterlist_reset" ref="ecb0d4c200bed41b8bdcf671aa931a2a" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fat_cache_clusterlist_reset           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function resets the cluster list caches. 
<p>

<p>Definition at line <a class="el" href="a00050.html#l00882">882</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00051.html#l00333">Fs_clusterlist_cache::b_cache_file</a>, <a class="el" href="a00050.html#l00068">fs_g_cache_clusterlist</a>, <a class="el" href="a00050.html#l00069">fs_g_u8_current_cache</a>, <a class="el" href="a00047.html#l00089">FS_NB_CACHE_CLUSLIST</a>, <a class="el" href="a00051.html#l00334">Fs_clusterlist_cache::u8_level_use</a>, and <a class="el" href="a00051.html#l00335">Fs_clusterlist_cache::u8_lun</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00091">fat_check_device()</a>, <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>, and <a class="el" href="a00067.html#l00165">nav_reset()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00883"></a>00883 {
<a name="l00884"></a>00884    U8 u8_i;
<a name="l00885"></a>00885    <a class="code" href="a00019.html#07bae2654ebf3c7d64078af69ccebd3b">fs_g_u8_current_cache</a>=0;
<a name="l00886"></a>00886    <span class="keywordflow">for</span>( u8_i=0; u8_i&lt;(<a class="code" href="a00016.html#ee9842c6b2f49d1bca72d0ad56e97502" title="Number of caches used to store a cluster list of files (interesting in case of many...">FS_NB_CACHE_CLUSLIST</a>*2); u8_i++ )
<a name="l00887"></a>00887    {
<a name="l00888"></a>00888       <span class="comment">// The cache list is splited in two cache (file cluster list and directory cluster list)</span>
<a name="l00889"></a>00889       <a class="code" href="a00019.html#2c119a8b66b97a6c14624fb941889a24">fs_g_cache_clusterlist</a>[u8_i].<a class="code" href="a00001.html#1826ec47ceec3f316fb4af191b919998" title="Signal a cluster cache from file cluster list or directory cluster list.">b_cache_file</a> = (u8_i&lt;<a class="code" href="a00016.html#ee9842c6b2f49d1bca72d0ad56e97502" title="Number of caches used to store a cluster list of files (interesting in case of many...">FS_NB_CACHE_CLUSLIST</a>)?TRUE:FALSE;
<a name="l00890"></a>00890       <a class="code" href="a00019.html#2c119a8b66b97a6c14624fb941889a24">fs_g_cache_clusterlist</a>[u8_i].<a class="code" href="a00001.html#9fbad8d6dc29d31a77b92c759ecfeba8" title="LUN of cluster list.">u8_lun</a> = 0xFF;
<a name="l00891"></a>00891       <a class="code" href="a00019.html#2c119a8b66b97a6c14624fb941889a24">fs_g_cache_clusterlist</a>[u8_i].<a class="code" href="a00001.html#a91792be887473384687bac546fae6bb" title="Cache level, 0 for the last used and up to FS_NB_CACHE_CLUSLIST-1 for the old access...">u8_level_use</a> = 0xFF;
<a name="l00892"></a>00892    }
<a name="l00893"></a>00893 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="578ab4800128cde17c0820a5027c1c06"></a><!-- doxytag: member="fat.h::fat_cache_flush" ref="578ab4800128cde17c0820a5027c1c06" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_cache_flush           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function flushs the sector cache on the memory if necessary. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE in case of error, see global value "fs_g_status" for more detail <p>
TRUE otherwise </dd></dl>

<p>Definition at line <a class="el" href="a00050.html#l01860">1860</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00049.html#l00067">CTRL_GOOD</a>, <a class="el" href="a00055.html#l00190">FS_ERR_HW</a>, <a class="el" href="a00051.html#l00415">fs_g_sector</a>, <a class="el" href="a00051.html#l00416">fs_g_sectorcache</a>, <a class="el" href="a00055.html#l00256">fs_g_status</a>, <a class="el" href="a00055.html#l00209">FS_LUN_WP</a>, <a class="el" href="a00048.html#l00349">mem_wr_protect()</a>, <a class="el" href="a00048.html#l00493">ram_2_memory()</a>, <a class="el" href="a00051.html#l00346">Fs_sector_cache::u32_addr</a>, <a class="el" href="a00051.html#l00347">Fs_sector_cache::u8_dirty</a>, and <a class="el" href="a00051.html#l00345">Fs_sector_cache::u8_lun</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l01794">fat_cache_read_sector()</a>, <a class="el" href="a00052.html#l00929">fat_clean_zone()</a>, <a class="el" href="a00052.html#l01088">fat_entry_label()</a>, <a class="el" href="a00052.html#l00341">fat_format()</a>, <a class="el" href="a00052.html#l01044">fat_serialnumber()</a>, <a class="el" href="a00053.html#l00747">file_close()</a>, <a class="el" href="a00053.html#l00460">file_set_eof()</a>, <a class="el" href="a00067.html#l01361">nav_dir_make()</a>, <a class="el" href="a00067.html#l00211">nav_exit()</a>, <a class="el" href="a00067.html#l01988">nav_file_attributset()</a>, <a class="el" href="a00067.html#l02156">nav_file_create()</a>, <a class="el" href="a00067.html#l01966">nav_file_dateset()</a>, <a class="el" href="a00067.html#l02016">nav_file_del()</a>, and <a class="el" href="a00067.html#l02096">nav_file_rename()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01861"></a>01861 {
<a name="l01862"></a>01862    <span class="comment">// If the cache is modified, then write the sector cache on the device</span>
<a name="l01863"></a>01863    <span class="keywordflow">if</span> ( TRUE == <a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#b7c05aed70b9dd29519e3b3f9b06a709" title="Cache status if the sector is a sector from a cluster list THEN.">u8_dirty</a> )
<a name="l01864"></a>01864    {
<a name="l01865"></a>01865       <a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#b7c05aed70b9dd29519e3b3f9b06a709" title="Cache status if the sector is a sector from a cluster list THEN.">u8_dirty</a> = FALSE; <span class="comment">// Always clear, although an error occur</span>
<a name="l01866"></a>01866       <span class="keywordflow">if</span>( <a class="code" href="a00017.html#f4b64acad5f46d01e082d7a7301078df" title="Returns the write-protection state of the memory.">mem_wr_protect</a>( <a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#983c3e8973f75815f64897cfdcacd10e" title="LUN of sector.">u8_lun</a>  ))
<a name="l01867"></a>01867       {
<a name="l01868"></a>01868          <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#3e74c914900316653d8cfdef780447c8" title="Drive is in read only mode.">FS_LUN_WP</a>;
<a name="l01869"></a>01869          <span class="keywordflow">return</span> FALSE;
<a name="l01870"></a>01870       }
<a name="l01871"></a>01871       <span class="keywordflow">if</span> (<a class="code" href="a00018.html#910a0fdf1e7a70b08981dce14e86e2918cc674c935507be438bb2d9b6e70d6b8" title="Success, memory ready.">CTRL_GOOD</a> != <a class="code" href="a00017.html#61739dc73f8bff39c3d291f2e47a5bce" title="Copies 1 data sector from RAM to the memory.">ram_2_memory</a>( <a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#983c3e8973f75815f64897cfdcacd10e" title="LUN of sector.">u8_lun</a> , <a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#fe852c5721ec70a1942bcebca4e370c9" title="Sector address (unit 512B).">u32_addr</a> , <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a> ))
<a name="l01872"></a>01872       {
<a name="l01873"></a>01873          <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#cf37e5255ee1dbfaab77def32a7cbbef" title="Hardware driver error.">FS_ERR_HW</a>;
<a name="l01874"></a>01874          <span class="keywordflow">return</span> FALSE;
<a name="l01875"></a>01875       }
<a name="l01876"></a>01876    }
<a name="l01877"></a>01877    <span class="keywordflow">return</span> TRUE;
<a name="l01878"></a>01878 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="45c0f16885c9e414ddb4b5afaa1cde34"></a><!-- doxytag: member="fat.h::fat_cache_mark_sector_as_dirty" ref="45c0f16885c9e414ddb4b5afaa1cde34" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fat_cache_mark_sector_as_dirty           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function sets a flag to signal that sector cache is modified. 
<p>

<p>Definition at line <a class="el" href="a00050.html#l01848">1848</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00051.html#l00416">fs_g_sectorcache</a>, and <a class="el" href="a00051.html#l00347">Fs_sector_cache::u8_dirty</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00929">fat_clean_zone()</a>, <a class="el" href="a00052.html#l02474">fat_clear_cluster()</a>, <a class="el" href="a00050.html#l00603">fat_cluster_val()</a>, <a class="el" href="a00052.html#l01558">fat_create_long_name_entry()</a>, <a class="el" href="a00052.html#l01633">fat_create_short_entry_name()</a>, <a class="el" href="a00052.html#l02074">fat_delete_file()</a>, <a class="el" href="a00052.html#l01088">fat_entry_label()</a>, <a class="el" href="a00052.html#l02004">fat_garbage_collector_entry()</a>, <a class="el" href="a00052.html#l01181">fat_initialize_dir()</a>, <a class="el" href="a00052.html#l01006">fat_initialize_fat()</a>, <a class="el" href="a00052.html#l01044">fat_serialnumber()</a>, <a class="el" href="a00052.html#l01349">fat_set_date()</a>, <a class="el" href="a00052.html#l02439">fat_update_fat2()</a>, <a class="el" href="a00050.html#l01421">fat_write_entry_file()</a>, <a class="el" href="a00052.html#l00853">fat_write_fat32_FSInfo()</a>, <a class="el" href="a00052.html#l00623">fat_write_MBR()</a>, <a class="el" href="a00052.html#l00730">fat_write_PBR()</a>, <a class="el" href="a00053.html#l00599">file_putc()</a>, and <a class="el" href="a00053.html#l00489">file_write_buf()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01849"></a>01849 {
<a name="l01850"></a>01850    <a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#b7c05aed70b9dd29519e3b3f9b06a709" title="Cache status if the sector is a sector from a cluster list THEN.">u8_dirty</a> = TRUE;
<a name="l01851"></a>01851 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="a67dc439478853cefdd226f9c99c9539"></a><!-- doxytag: member="fat.h::fat_cache_read_sector" ref="a67dc439478853cefdd226f9c99c9539" args="(Bool b_load)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_cache_read_sector           </td>
          <td>(</td>
          <td class="paramtype">Bool&nbsp;</td>
          <td class="paramname"> <em>b_load</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function loads a memory sector in internal cache sector. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>b_load</em>&nbsp;</td><td>TRUE, load the cache with the memory sector corresponding <br>
 FALSE, Don't change the sector cache but change the memory address of cache <br>
</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE in case of error, see global value "fs_g_status" for more detail <p>
TRUE otherwise</dd></dl>
<div class="fragment"><pre class="fragment">
//! Global variable used
//! IN :
//!   fs_g_nav.u8_lun      drive number to read
//!   fs_gu32_addrsector   address to read (unit sector)
//! </pre></div> 
<p>Definition at line <a class="el" href="a00050.html#l01794">1794</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00049.html#l00067">CTRL_GOOD</a>, <a class="el" href="a00050.html#l01860">fat_cache_flush()</a>, <a class="el" href="a00050.html#l01829">fat_cache_reset()</a>, <a class="el" href="a00055.html#l00190">FS_ERR_HW</a>, <a class="el" href="a00051.html#l00394">fs_g_nav</a>, <a class="el" href="a00051.html#l00415">fs_g_sector</a>, <a class="el" href="a00051.html#l00416">fs_g_sectorcache</a>, <a class="el" href="a00055.html#l00256">fs_g_status</a>, <a class="el" href="a00051.html#l00417">fs_gu32_addrsector</a>, <a class="el" href="a00048.html#l00469">memory_2_ram()</a>, <a class="el" href="a00051.html#l00346">Fs_sector_cache::u32_addr</a>, <a class="el" href="a00051.html#l00269">Fs_management::u8_lun</a>, and <a class="el" href="a00051.html#l00345">Fs_sector_cache::u8_lun</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00929">fat_clean_zone()</a>, <a class="el" href="a00052.html#l02474">fat_clear_cluster()</a>, <a class="el" href="a00050.html#l00798">fat_cluster_readnext()</a>, <a class="el" href="a00050.html#l00603">fat_cluster_val()</a>, <a class="el" href="a00050.html#l00299">fat_get_nbpartition()</a>, <a class="el" href="a00052.html#l02198">fat_getfreespace_percent()</a>, <a class="el" href="a00052.html#l01006">fat_initialize_fat()</a>, <a class="el" href="a00052.html#l00105">fat_mount()</a>, <a class="el" href="a00050.html#l01195">fat_read_dir()</a>, <a class="el" href="a00052.html#l00888">fat_read_fat32_FSInfo()</a>, <a class="el" href="a00050.html#l01035">fat_read_file()</a>, <a class="el" href="a00052.html#l01044">fat_serialnumber()</a>, <a class="el" href="a00052.html#l02439">fat_update_fat2()</a>, <a class="el" href="a00052.html#l00853">fat_write_fat32_FSInfo()</a>, <a class="el" href="a00052.html#l00623">fat_write_MBR()</a>, <a class="el" href="a00052.html#l00730">fat_write_PBR()</a>, and <a class="el" href="a00053.html#l00489">file_write_buf()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01795"></a>01795 {
<a name="l01796"></a>01796    <span class="comment">// Check if the sector asked is the same in cache</span>
<a name="l01797"></a>01797    <span class="keywordflow">if</span>( (<a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#983c3e8973f75815f64897cfdcacd10e" title="LUN of sector.">u8_lun</a>     == <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a> )
<a name="l01798"></a>01798    &amp;&amp;  (<a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#fe852c5721ec70a1942bcebca4e370c9" title="Sector address (unit 512B).">u32_addr</a>   == <a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a> ) )
<a name="l01799"></a>01799    {
<a name="l01800"></a>01800       <span class="keywordflow">return</span> TRUE;
<a name="l01801"></a>01801    }
<a name="l01802"></a>01802 
<a name="l01803"></a>01803    <span class="comment">// Write previous cache before fill cache with a new sector</span>
<a name="l01804"></a>01804    <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#578ab4800128cde17c0820a5027c1c06" title="This function flushs the sector cache on the memory if necessary.">fat_cache_flush</a>())
<a name="l01805"></a>01805       <span class="keywordflow">return</span> FALSE;
<a name="l01806"></a>01806 
<a name="l01807"></a>01807    <span class="comment">// Delete informations about the caches</span>
<a name="l01808"></a>01808    <a class="code" href="a00019.html#961692919a93b6cb714ec2a3d57c0141" title="This function resets the sector cache.">fat_cache_reset</a>();
<a name="l01809"></a>01809 
<a name="l01810"></a>01810    <span class="comment">// Init sector cache</span>
<a name="l01811"></a>01811    <a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#fe852c5721ec70a1942bcebca4e370c9" title="Sector address (unit 512B).">u32_addr</a> = <a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a>;
<a name="l01812"></a>01812    <span class="keywordflow">if</span>( b_load )
<a name="l01813"></a>01813    {
<a name="l01814"></a>01814       <span class="comment">// Load the sector from memory</span>
<a name="l01815"></a>01815       <span class="keywordflow">if</span>( <a class="code" href="a00018.html#910a0fdf1e7a70b08981dce14e86e2918cc674c935507be438bb2d9b6e70d6b8" title="Success, memory ready.">CTRL_GOOD</a> != <a class="code" href="a00017.html#dde05eb39b542eb5a7d3f78cf7006f28" title="Copies 1 data sector from the memory to RAM.">memory_2_ram</a>( <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a>  , <a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#fe852c5721ec70a1942bcebca4e370c9" title="Sector address (unit 512B).">u32_addr</a>, <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>))
<a name="l01816"></a>01816       {
<a name="l01817"></a>01817          <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#cf37e5255ee1dbfaab77def32a7cbbef" title="Hardware driver error.">FS_ERR_HW</a>;
<a name="l01818"></a>01818          <span class="keywordflow">return</span> FALSE;
<a name="l01819"></a>01819       }
<a name="l01820"></a>01820    }
<a name="l01821"></a>01821    <span class="comment">// Valid sector cache</span>
<a name="l01822"></a>01822    <a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#983c3e8973f75815f64897cfdcacd10e" title="LUN of sector.">u8_lun</a> = <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a>;
<a name="l01823"></a>01823    <span class="keywordflow">return</span> TRUE;
<a name="l01824"></a>01824 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="961692919a93b6cb714ec2a3d57c0141"></a><!-- doxytag: member="fat.h::fat_cache_reset" ref="961692919a93b6cb714ec2a3d57c0141" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fat_cache_reset           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function resets the sector cache. 
<p>

<p>Definition at line <a class="el" href="a00050.html#l01829">1829</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00051.html#l00226">FS_BUF_SECTOR_EMPTY</a>, <a class="el" href="a00051.html#l00416">fs_g_sectorcache</a>, <a class="el" href="a00051.html#l00349">Fs_sector_cache::u32_clusterlist_start</a>, <a class="el" href="a00051.html#l00347">Fs_sector_cache::u8_dirty</a>, and <a class="el" href="a00051.html#l00345">Fs_sector_cache::u8_lun</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l01794">fat_cache_read_sector()</a>, <a class="el" href="a00050.html#l00091">fat_check_device()</a>, and <a class="el" href="a00067.html#l00165">nav_reset()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01830"></a>01830 {
<a name="l01831"></a>01831    <a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#983c3e8973f75815f64897cfdcacd10e" title="LUN of sector.">u8_lun</a>                = <a class="code" href="a00020.html#0b62220f198f7eb96b15aa863c49ce54" title="Signal that sector cache is not valid.">FS_BUF_SECTOR_EMPTY</a>;
<a name="l01832"></a>01832    <a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#b7c05aed70b9dd29519e3b3f9b06a709" title="Cache status if the sector is a sector from a cluster list THEN.">u8_dirty</a>              = FALSE;
<a name="l01833"></a>01833    <a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#9aba32679527ef002f0bbf18545108cf" title="first cluster of cluster list">u32_clusterlist_start</a> = 0xFFFFFFFF;
<a name="l01834"></a>01834 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="eeec0bd6755a6be4c4dda2b4669eb0ae"></a><!-- doxytag: member="fat.h::fat_check_device" ref="eeec0bd6755a6be4c4dda2b4669eb0ae" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_check_device           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function checks device state. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>TRUE device ready <p>
FALSE otherwise</dd></dl>
<div class="fragment"><pre class="fragment">
//! This function updates all navigator datas when the device state change.
//! </pre></div> 
<p>Definition at line <a class="el" href="a00050.html#l00091">91</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00049.html#l00070">CTRL_BUSY</a>, <a class="el" href="a00049.html#l00067">CTRL_GOOD</a>, <a class="el" href="a00049.html#l00069">CTRL_NO_PRESENT</a>, <a class="el" href="a00050.html#l00882">fat_cache_clusterlist_reset()</a>, <a class="el" href="a00050.html#l01829">fat_cache_reset()</a>, <a class="el" href="a00051.html#l00376">Fat_file_close</a>, <a class="el" href="a00055.html#l00190">FS_ERR_HW</a>, <a class="el" href="a00055.html#l00213">FS_ERR_HW_NO_PRESENT</a>, <a class="el" href="a00051.html#l00394">fs_g_nav</a>, <a class="el" href="a00051.html#l00395">fs_g_nav_fast</a>, <a class="el" href="a00050.html#l00060">fs_g_navext</a>, <a class="el" href="a00050.html#l00062">fs_g_navext_entry</a>, <a class="el" href="a00050.html#l00061">fs_g_navext_fast</a>, <a class="el" href="a00051.html#l00416">fs_g_sectorcache</a>, <a class="el" href="a00055.html#l00256">fs_g_status</a>, <a class="el" href="a00047.html#l00092">FS_NB_NAVIGATOR</a>, <a class="el" href="a00051.html#l00358">FS_TYPE_FAT_UNM</a>, <a class="el" href="a00051.html#l00390">g_b_no_check_disk</a>, <a class="el" href="a00048.html#l00283">mem_test_unit_ready()</a>, <a class="el" href="a00051.html#l00345">Fs_sector_cache::u8_lun</a>, <a class="el" href="a00051.html#l00269">Fs_management::u8_lun</a>, <a class="el" href="a00051.html#l00302">Fs_management_entry::u8_open_mode</a>, and <a class="el" href="a00051.html#l00295">Fs_management_fast::u8_type_fat</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00154">fat_check_mount()</a>, <a class="el" href="a00050.html#l00175">fat_check_noopen()</a>, <a class="el" href="a00050.html#l00299">fat_get_nbpartition()</a>, <a class="el" href="a00052.html#l00105">fat_mount()</a>, <a class="el" href="a00067.html#l00609">nav_partition_freespace()</a>, <a class="el" href="a00067.html#l00627">nav_partition_freespace_percent()</a>, <a class="el" href="a00067.html#l00582">nav_partition_space()</a>, and <a class="el" href="a00067.html#l00485">nav_partition_type()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00092"></a>00092 {
<a name="l00093"></a>00093    U8 retry=0;
<a name="l00094"></a>00094 <span class="preprocessor">#if (FS_NB_NAVIGATOR &gt; 1)</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span>   U8 i;
<a name="l00096"></a>00096 <span class="preprocessor">#endif</span>
<a name="l00097"></a>00097 <span class="preprocessor"></span>   <a class="code" href="a00018.html#910a0fdf1e7a70b08981dce14e86e291" title="Status returned by CTRL_ACCESS interfaces.">Ctrl_status</a> status;
<a name="l00098"></a>00098    
<a name="l00099"></a>00099    <span class="comment">// Possibility to ignore the disk check. Used to take time during multi read/write access</span>
<a name="l00100"></a>00100    <span class="keywordflow">if</span>( <a class="code" href="a00020.html#6e59f1ec12b7954a956be7185df3ec05" title="Variables to enable/disable the disk check before each action on disk.">g_b_no_check_disk</a> )
<a name="l00101"></a>00101       <span class="keywordflow">return</span> TRUE;
<a name="l00102"></a>00102 
<a name="l00103"></a>00103    <span class="keywordflow">if</span>( 0xFF == <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a> )
<a name="l00104"></a>00104    {
<a name="l00105"></a>00105       <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#cf37e5255ee1dbfaab77def32a7cbbef" title="Hardware driver error.">FS_ERR_HW</a>;
<a name="l00106"></a>00106       <span class="keywordflow">return</span> FALSE;                                <span class="comment">// No device selected</span>
<a name="l00107"></a>00107    }
<a name="l00108"></a>00108 
<a name="l00109"></a>00109    <span class="keywordflow">for</span>( retry=0 ; retry&lt;100 ; retry++ )
<a name="l00110"></a>00110    {
<a name="l00111"></a>00111       <span class="comment">// Check device</span>
<a name="l00112"></a>00112       status = <a class="code" href="a00017.html#51555be425eeacfd88e603b9cba97049" title="Tests the memory state and initializes the memory if required.">mem_test_unit_ready</a>( <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a> );
<a name="l00113"></a>00113       <span class="keywordflow">if</span>( <a class="code" href="a00018.html#910a0fdf1e7a70b08981dce14e86e2918cc674c935507be438bb2d9b6e70d6b8" title="Success, memory ready.">CTRL_GOOD</a>       == status )
<a name="l00114"></a>00114          <span class="keywordflow">return</span> TRUE;                              <span class="comment">// drive ready</span>
<a name="l00115"></a>00115 
<a name="l00116"></a>00116       <span class="comment">//* HERE error or state change</span>
<a name="l00117"></a>00117       <span class="comment">// Clean all navigator datas which use this device</span>
<a name="l00118"></a>00118       <a class="code" href="a00020.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00006.html#74121fb3c8d3a1d018c911650e2ec920" title="FAT type (default = no mounted = FS_TYPE_FAT_UNM).">u8_type_fat</a> = <a class="code" href="a00020.html#429fbd0498704c3d5864877548040069" title="Partition not mounted.">FS_TYPE_FAT_UNM</a>; <span class="comment">// By default the fat isn't mounted</span>
<a name="l00119"></a>00119       <a class="code" href="a00020.html#55c673ca91c5301834a588e1d5a6515f">Fat_file_close</a>();                            <span class="comment">// By default the file is not open</span>
<a name="l00120"></a>00120 <span class="preprocessor">#if (FS_NB_NAVIGATOR &gt; 1)</span>
<a name="l00121"></a>00121 <span class="preprocessor"></span>      <span class="keywordflow">for</span>( i=0 ; i!=(<a class="code" href="a00016.html#8ab6bd77e49639be7dc419bcf66bd73f" title="Maximal number of simultaneous navigators.">FS_NB_NAVIGATOR</a>-1) ; i++ )
<a name="l00122"></a>00122       {
<a name="l00123"></a>00123          <span class="keywordflow">if</span>( <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a> == <a class="code" href="a00019.html#0d59a916e72039fa7f898cd233f8fe2f">fs_g_navext</a>[i].<a class="code" href="a00004.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a> )
<a name="l00124"></a>00124          {
<a name="l00125"></a>00125             <a class="code" href="a00019.html#d24195746b40d4a83dff493c118b91aa">fs_g_navext_fast</a>[i].<a class="code" href="a00006.html#74121fb3c8d3a1d018c911650e2ec920" title="FAT type (default = no mounted = FS_TYPE_FAT_UNM).">u8_type_fat</a>     = <a class="code" href="a00020.html#429fbd0498704c3d5864877548040069" title="Partition not mounted.">FS_TYPE_FAT_UNM</a>;   <span class="comment">// By default the fat isn't mounted</span>
<a name="l00126"></a>00126             <a class="code" href="a00019.html#90e0163ac7f98f08019dc0b73fd7c834">fs_g_navext_entry</a>[i].<a class="code" href="a00005.html#316b7df1bf2c7e55453f17ad00290447" title="open mode of selected file">u8_open_mode</a>   = 0;                 <span class="comment">// By default the file is not open</span>
<a name="l00127"></a>00127          }
<a name="l00128"></a>00128       }
<a name="l00129"></a>00129 <span class="preprocessor">#endif</span>
<a name="l00130"></a>00130 <span class="preprocessor"></span>      <span class="comment">// If the internal cache corresponding at device then clean it</span>
<a name="l00131"></a>00131       <span class="keywordflow">if</span>( <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a> == <a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#983c3e8973f75815f64897cfdcacd10e" title="LUN of sector.">u8_lun</a> )
<a name="l00132"></a>00132       {
<a name="l00133"></a>00133          <a class="code" href="a00019.html#961692919a93b6cb714ec2a3d57c0141" title="This function resets the sector cache.">fat_cache_reset</a>();
<a name="l00134"></a>00134       }
<a name="l00135"></a>00135       <a class="code" href="a00019.html#ecb0d4c200bed41b8bdcf671aa931a2a" title="This function resets the cluster list caches.">fat_cache_clusterlist_reset</a>();
<a name="l00136"></a>00136 
<a name="l00137"></a>00137       <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#cf37e5255ee1dbfaab77def32a7cbbef" title="Hardware driver error.">FS_ERR_HW</a>;                     <span class="comment">// By default HW error</span>
<a name="l00138"></a>00138       <span class="keywordflow">if</span>( <a class="code" href="a00018.html#910a0fdf1e7a70b08981dce14e86e291a647d0a662ac6400be3b843dfae52c65" title="Memory not initialized or changed.">CTRL_BUSY</a> == status )
<a name="l00139"></a>00139          <span class="keywordflow">continue</span>;                                 <span class="comment">// If device busy then retry</span>
<a name="l00140"></a>00140 
<a name="l00141"></a>00141       <span class="keywordflow">if</span>( <a class="code" href="a00018.html#910a0fdf1e7a70b08981dce14e86e29172ef3612d2c1df6f137934d4b89b18b7" title="Memory unplugged.">CTRL_NO_PRESENT</a> == status )
<a name="l00142"></a>00142          <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#599d11cd249edc025b1a1fb514809db6" title="Device is not present.">FS_ERR_HW_NO_PRESENT</a>;       <span class="comment">// Update error flag</span>
<a name="l00143"></a>00143       <span class="keywordflow">break</span>;                                       <span class="comment">// FAIL or NOT PRESENT = fatal error = no retry</span>
<a name="l00144"></a>00144    }
<a name="l00145"></a>00145    <span class="keywordflow">return</span> FALSE;
<a name="l00146"></a>00146 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="452e159ed5e2a4d8ea88f0515a3a6e10"></a><!-- doxytag: member="fat.h::fat_check_eof_name" ref="452e159ed5e2a4d8ea88f0515a3a6e10" args="(U16 character)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_check_eof_name           </td>
          <td>(</td>
          <td class="paramtype">U16&nbsp;</td>
          <td class="paramname"> <em>character</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Check end of name. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>character</em>&nbsp;</td><td>value of character to check</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>TRUE, it is a character to signal a end of name (0,'\','/') <p>
FALSE, otherwise </dd></dl>

<p>Definition at line <a class="el" href="a00050.html#l01763">1763</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l01838">fat_check_name()</a>, <a class="el" href="a00052.html#l01633">fat_create_short_entry_name()</a>, and <a class="el" href="a00050.html#l01607">fat_entry_longname()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01764"></a>01764 {
<a name="l01765"></a>01765    <span class="keywordflow">return</span> ((<span class="charliteral">'\0'</span>==character)||(<span class="charliteral">'\\'</span>==character)||(<span class="charliteral">'/'</span>==character));
<a name="l01766"></a>01766 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="2fb226027c5ea59f40c582737e5a44b9"></a><!-- doxytag: member="fat.h::fat_check_is_file" ref="2fb226027c5ea59f40c582737e5a44b9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_check_is_file           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function checks if the selected file entry is a file and not a directory. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>TRUE It is a file and not a directory <p>
FALSE otherwise </dd></dl>

<p>Definition at line <a class="el" href="a00050.html#l00283">283</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00055.html#l00135">Fat_is_not_a_file</a>, <a class="el" href="a00055.html#l00208">FS_ERR_NO_FILE</a>, and <a class="el" href="a00055.html#l00256">fs_g_status</a>.</p>

<p>Referenced by <a class="el" href="a00053.html#l00072">file_ispresent()</a>, and <a class="el" href="a00053.html#l00092">file_open()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00284"></a>00284 {
<a name="l00285"></a>00285    <span class="keywordflow">if</span>( <a class="code" href="a00024.html#627f80804f90f766ed2cda3a012bcf66">Fat_is_not_a_file</a> )
<a name="l00286"></a>00286    {
<a name="l00287"></a>00287       <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#d9116e06ad4be1ef2ff8e7cb649ccb90" title="The selected file entry isn&amp;#39;t a file.">FS_ERR_NO_FILE</a>;   <span class="comment">// It isn't a file, it is a directory or a volume id</span>
<a name="l00288"></a>00288       <span class="keywordflow">return</span> FALSE;
<a name="l00289"></a>00289    }
<a name="l00290"></a>00290    <span class="keywordflow">return</span> TRUE;
<a name="l00291"></a>00291 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="8ee865aa4c51519c0d141f1f4559c72a"></a><!-- doxytag: member="fat.h::fat_check_mount" ref="8ee865aa4c51519c0d141f1f4559c72a" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_check_mount           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function checks if the partition is mounted. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>TRUE partition mounted <p>
FALSE otherwise </dd></dl>

<p>Definition at line <a class="el" href="a00050.html#l00154">154</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00050.html#l00091">fat_check_device()</a>, <a class="el" href="a00052.html#l00105">fat_mount()</a>, <a class="el" href="a00055.html#l00203">FS_ERR_NO_MOUNT</a>, <a class="el" href="a00051.html#l00395">fs_g_nav_fast</a>, <a class="el" href="a00055.html#l00256">fs_g_status</a>, <a class="el" href="a00051.html#l00358">FS_TYPE_FAT_UNM</a>, and <a class="el" href="a00051.html#l00295">Fs_management_fast::u8_type_fat</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00227">fat_check_mount_noopen()</a>, <a class="el" href="a00050.html#l00270">fat_check_mount_select()</a>, <a class="el" href="a00050.html#l00240">fat_check_mount_select_noopen()</a>, <a class="el" href="a00050.html#l00255">fat_check_mount_select_open()</a>, and <a class="el" href="a00067.html#l00508">nav_partition_serialnumber()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00155"></a>00155 {
<a name="l00156"></a>00156    <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#eeec0bd6755a6be4c4dda2b4669eb0ae" title="This function checks device state.">fat_check_device</a>() )
<a name="l00157"></a>00157       <span class="keywordflow">return</span> FALSE;
<a name="l00158"></a>00158    <span class="keywordflow">if</span> (<a class="code" href="a00020.html#429fbd0498704c3d5864877548040069" title="Partition not mounted.">FS_TYPE_FAT_UNM</a> == <a class="code" href="a00020.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00006.html#74121fb3c8d3a1d018c911650e2ec920" title="FAT type (default = no mounted = FS_TYPE_FAT_UNM).">u8_type_fat</a>)
<a name="l00159"></a>00159    {
<a name="l00160"></a>00160       <span class="keywordflow">if</span>( !<a class="code" href="a00020.html#c0108ea608b547e8d3a405c70644c1e9" title="This function mounts a partition.">fat_mount</a>() )
<a name="l00161"></a>00161       {
<a name="l00162"></a>00162          <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#1aeb93f5a9728927830dd999b9b0e720" title="The partition isn&amp;#39;t mounted.">FS_ERR_NO_MOUNT</a>;
<a name="l00163"></a>00163          <span class="keywordflow">return</span> FALSE;
<a name="l00164"></a>00164       }
<a name="l00165"></a>00165    }
<a name="l00166"></a>00166    <span class="keywordflow">return</span> TRUE;
<a name="l00167"></a>00167 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="e9d0f61d0e7b29a4e8e9e95347194f21"></a><!-- doxytag: member="fat.h::fat_check_mount_noopen" ref="e9d0f61d0e7b29a4e8e9e95347194f21" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_check_mount_noopen           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function checks if the partition is mounted and no file is opened. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>TRUE partition mounted and no file is opened <p>
FALSE otherwise </dd></dl>

<p>Definition at line <a class="el" href="a00050.html#l00227">227</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00050.html#l00154">fat_check_mount()</a>, and <a class="el" href="a00050.html#l00175">fat_check_noopen()</a>.</p>

<p>Referenced by <a class="el" href="a00067.html#l01219">nav_dir_gotoparent()</a>, <a class="el" href="a00067.html#l01170">nav_dir_is_root()</a>, <a class="el" href="a00067.html#l01361">nav_dir_make()</a>, <a class="el" href="a00067.html#l01267">nav_dir_name()</a>, <a class="el" href="a00067.html#l00676">nav_filelist_reset()</a>, <a class="el" href="a00067.html#l00726">nav_filelist_set()</a>, <a class="el" href="a00063.html#l00383">nav_filterlist_gotoparent()</a>, and <a class="el" href="a00067.html#l01411">nav_getcwd()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00228"></a>00228 {
<a name="l00229"></a>00229    <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#8ee865aa4c51519c0d141f1f4559c72a" title="This function checks if the partition is mounted.">fat_check_mount</a>() )
<a name="l00230"></a>00230       <span class="keywordflow">return</span> FALSE;
<a name="l00231"></a>00231    <span class="keywordflow">return</span> <a class="code" href="a00019.html#f6f4a9e2d8e7b6dd557871b6bc2c2ee0" title="This function checks if a file is not opened on current navigator.">fat_check_noopen</a>();
<a name="l00232"></a>00232 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="47e29fedbed4084c9f8ec6f27b51015d"></a><!-- doxytag: member="fat.h::fat_check_mount_select" ref="47e29fedbed4084c9f8ec6f27b51015d" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_check_mount_select           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function checks if the partition is mounted and if a file is selected. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>TRUE partition mounted and a file is selected <p>
FALSE otherwise </dd></dl>

<p>Definition at line <a class="el" href="a00050.html#l00270">270</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00050.html#l00154">fat_check_mount()</a>, and <a class="el" href="a00050.html#l00211">fat_check_select()</a>.</p>

<p>Referenced by <a class="el" href="a00053.html#l00072">file_ispresent()</a>, <a class="el" href="a00067.html#l01988">nav_file_attributset()</a>, <a class="el" href="a00067.html#l01905">nav_file_checkext()</a>, <a class="el" href="a00067.html#l01931">nav_file_dateget()</a>, <a class="el" href="a00067.html#l01966">nav_file_dateset()</a>, <a class="el" href="a00067.html#l01877">nav_file_isreadonly()</a>, and <a class="el" href="a00067.html#l01769">nav_file_name()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00271"></a>00271 {
<a name="l00272"></a>00272    <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#8ee865aa4c51519c0d141f1f4559c72a" title="This function checks if the partition is mounted.">fat_check_mount</a>() )
<a name="l00273"></a>00273       <span class="keywordflow">return</span> FALSE;
<a name="l00274"></a>00274    <span class="keywordflow">return</span> <a class="code" href="a00019.html#909da9e84afbebf8ed5838cbe5002f60" title="This function checks if a file is selected on current navigator.">fat_check_select</a>();
<a name="l00275"></a>00275 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="003f1c81dcb2c7a95f191c30b8a4f258"></a><!-- doxytag: member="fat.h::fat_check_mount_select_noopen" ref="003f1c81dcb2c7a95f191c30b8a4f258" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_check_mount_select_noopen           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function checks if the partition is mounted and if no file is opened and a file is selected. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>TRUE partition mounted and no file is opened and a file is selected <p>
FALSE otherwise </dd></dl>

<p>Definition at line <a class="el" href="a00050.html#l00240">240</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00050.html#l00154">fat_check_mount()</a>, <a class="el" href="a00050.html#l00175">fat_check_noopen()</a>, and <a class="el" href="a00050.html#l00211">fat_check_select()</a>.</p>

<p>Referenced by <a class="el" href="a00053.html#l00092">file_open()</a>, <a class="el" href="a00067.html#l01189">nav_dir_cd()</a>, <a class="el" href="a00067.html#l02016">nav_file_del()</a>, <a class="el" href="a00067.html#l02096">nav_file_rename()</a>, and <a class="el" href="a00067.html#l00692">nav_filelist_validpos()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00241"></a>00241 {
<a name="l00242"></a>00242    <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#8ee865aa4c51519c0d141f1f4559c72a" title="This function checks if the partition is mounted.">fat_check_mount</a>() )
<a name="l00243"></a>00243       <span class="keywordflow">return</span> FALSE;
<a name="l00244"></a>00244    <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#909da9e84afbebf8ed5838cbe5002f60" title="This function checks if a file is selected on current navigator.">fat_check_select</a>() )
<a name="l00245"></a>00245       <span class="keywordflow">return</span> FALSE;
<a name="l00246"></a>00246    <span class="keywordflow">return</span> <a class="code" href="a00019.html#f6f4a9e2d8e7b6dd557871b6bc2c2ee0" title="This function checks if a file is not opened on current navigator.">fat_check_noopen</a>();
<a name="l00247"></a>00247 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="0096f66037f89595dfccbca38ab795f8"></a><!-- doxytag: member="fat.h::fat_check_mount_select_open" ref="0096f66037f89595dfccbca38ab795f8" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_check_mount_select_open           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function checks if the partition is mounted and if a file is opened. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>TRUE partition mounted and a file is opened <p>
FALSE otherwise </dd></dl>

<p>Definition at line <a class="el" href="a00050.html#l00255">255</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00050.html#l00154">fat_check_mount()</a>, <a class="el" href="a00050.html#l00195">fat_check_open()</a>, and <a class="el" href="a00050.html#l00211">fat_check_select()</a>.</p>

<p>Referenced by <a class="el" href="a00053.html#l00711">file_bof()</a>, <a class="el" href="a00053.html#l00747">file_close()</a>, <a class="el" href="a00053.html#l00726">file_eof()</a>, <a class="el" href="a00053.html#l00632">file_getpos()</a>, <a class="el" href="a00053.html#l00599">file_putc()</a>, <a class="el" href="a00053.html#l00172">file_read()</a>, <a class="el" href="a00053.html#l00249">file_read_buf()</a>, <a class="el" href="a00053.html#l00653">file_seek()</a>, <a class="el" href="a00053.html#l00460">file_set_eof()</a>, <a class="el" href="a00053.html#l00415">file_write()</a>, and <a class="el" href="a00053.html#l00489">file_write_buf()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00256"></a>00256 {
<a name="l00257"></a>00257    <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#8ee865aa4c51519c0d141f1f4559c72a" title="This function checks if the partition is mounted.">fat_check_mount</a>() )
<a name="l00258"></a>00258       <span class="keywordflow">return</span> FALSE;
<a name="l00259"></a>00259    <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#909da9e84afbebf8ed5838cbe5002f60" title="This function checks if a file is selected on current navigator.">fat_check_select</a>() )
<a name="l00260"></a>00260       <span class="keywordflow">return</span> FALSE;
<a name="l00261"></a>00261    <span class="keywordflow">return</span> <a class="code" href="a00019.html#4efc7734a340e899bb54506b277bb8c1" title="This function checks if a file is opened on current navigator.">fat_check_open</a>();
<a name="l00262"></a>00262 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="3ebe58d94472a1818a38afaf09c19c35"></a><!-- doxytag: member="fat.h::fat_check_nav_access_disk" ref="3ebe58d94472a1818a38afaf09c19c35" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_check_nav_access_disk           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function checks write access. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>TRUE, write access on disk possibled <p>
FALSE, File open then write access not possibled </dd></dl>

<p>Definition at line <a class="el" href="a00050.html#l01888">1888</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00055.html#l00229">FS_ERR_FILE_OPEN</a>, <a class="el" href="a00051.html#l00394">fs_g_nav</a>, <a class="el" href="a00050.html#l00060">fs_g_navext</a>, <a class="el" href="a00050.html#l00062">fs_g_navext_entry</a>, <a class="el" href="a00050.html#l00061">fs_g_navext_fast</a>, <a class="el" href="a00055.html#l00256">fs_g_status</a>, <a class="el" href="a00047.html#l00092">FS_NB_NAVIGATOR</a>, <a class="el" href="a00051.html#l00358">FS_TYPE_FAT_UNM</a>, and <a class="el" href="a00051.html#l00269">Fs_management::u8_lun</a>.</p>

<p>Referenced by <a class="el" href="a00067.html#l00399">nav_drive_format()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01889"></a>01889 {
<a name="l01890"></a>01890    U8 i;
<a name="l01891"></a>01891 
<a name="l01892"></a>01892    <span class="comment">// For each navigators</span>
<a name="l01893"></a>01893    <span class="keywordflow">for</span>( i=0 ; i!=(<a class="code" href="a00016.html#8ab6bd77e49639be7dc419bcf66bd73f" title="Maximal number of simultaneous navigators.">FS_NB_NAVIGATOR</a>-1) ; i++ )
<a name="l01894"></a>01894    {
<a name="l01895"></a>01895       <span class="comment">// Disk mounted ?</span>
<a name="l01896"></a>01896       <span class="keywordflow">if</span>( <a class="code" href="a00020.html#429fbd0498704c3d5864877548040069" title="Partition not mounted.">FS_TYPE_FAT_UNM</a> != <a class="code" href="a00019.html#d24195746b40d4a83dff493c118b91aa">fs_g_navext_fast</a>[i].u8_type_fat )
<a name="l01897"></a>01897       <span class="comment">// Is it the same disk ?</span>
<a name="l01898"></a>01898       <span class="keywordflow">if</span>( <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a> == <a class="code" href="a00019.html#0d59a916e72039fa7f898cd233f8fe2f">fs_g_navext</a>[i].<a class="code" href="a00004.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a> )
<a name="l01899"></a>01899       <span class="comment">// Is it access file ?</span>
<a name="l01900"></a>01900       <span class="keywordflow">if</span>( <a class="code" href="a00019.html#90e0163ac7f98f08019dc0b73fd7c834">fs_g_navext_entry</a>[i].u8_open_mode!=0 )
<a name="l01901"></a>01901       {
<a name="l01902"></a>01902          <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#65f54d5e9ae9fb0958d6be4d1fb919c7" title="The file is already opened.">FS_ERR_FILE_OPEN</a>;
<a name="l01903"></a>01903          <span class="keywordflow">return</span> FALSE;  <span class="comment">// File opened then write access not possibled</span>
<a name="l01904"></a>01904       }
<a name="l01905"></a>01905    }
<a name="l01906"></a>01906    <span class="keywordflow">return</span> TRUE;
<a name="l01907"></a>01907 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="07f36d38eda0af16ef7ef899129d7e7b"></a><!-- doxytag: member="fat.h::fat_check_nav_access_file" ref="07f36d38eda0af16ef7ef899129d7e7b" args="(Bool mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_check_nav_access_file           </td>
          <td>(</td>
          <td class="paramtype">Bool&nbsp;</td>
          <td class="paramname"> <em>mode</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function checks all access at current file. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mode</em>&nbsp;</td><td>TRUE, check to write access <br>
 FALSE, check to read access <br>
</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE in case of error, see global value "fs_g_status" for more detail : <br>
 mode TRUE, File opened then write access not possibles <br>
 mode FALSE, File opened in write mode then read access not possibles <br>
 <p>
TRUE, access file possibles </dd></dl>

<p>Definition at line <a class="el" href="a00050.html#l01920">1920</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00055.html#l00141">FOPEN_WRITE_ACCESS</a>, <a class="el" href="a00055.html#l00229">FS_ERR_FILE_OPEN</a>, <a class="el" href="a00055.html#l00230">FS_ERR_FILE_OPEN_WR</a>, <a class="el" href="a00051.html#l00394">fs_g_nav</a>, <a class="el" href="a00051.html#l00395">fs_g_nav_fast</a>, <a class="el" href="a00050.html#l00060">fs_g_navext</a>, <a class="el" href="a00050.html#l00062">fs_g_navext_entry</a>, <a class="el" href="a00050.html#l00061">fs_g_navext_fast</a>, <a class="el" href="a00055.html#l00256">fs_g_status</a>, <a class="el" href="a00047.html#l00092">FS_NB_NAVIGATOR</a>, <a class="el" href="a00051.html#l00358">FS_TYPE_FAT_UNM</a>, <a class="el" href="a00051.html#l00296">Fs_management_fast::u16_entry_pos_sel_file</a>, <a class="el" href="a00051.html#l00282">Fs_management::u32_cluster_sel_dir</a>, <a class="el" href="a00051.html#l00269">Fs_management::u8_lun</a>, and <a class="el" href="a00051.html#l00271">Fs_management::u8_partition</a>.</p>

<p>Referenced by <a class="el" href="a00053.html#l00092">file_open()</a>, <a class="el" href="a00067.html#l02016">nav_file_del()</a>, and <a class="el" href="a00067.html#l02096">nav_file_rename()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01921"></a>01921 {
<a name="l01922"></a>01922    U8 i;
<a name="l01923"></a>01923 
<a name="l01924"></a>01924    <span class="comment">// For each navigators</span>
<a name="l01925"></a>01925    <span class="keywordflow">for</span>( i=0 ; i!=(<a class="code" href="a00016.html#8ab6bd77e49639be7dc419bcf66bd73f" title="Maximal number of simultaneous navigators.">FS_NB_NAVIGATOR</a>-1) ; i++ )
<a name="l01926"></a>01926    {
<a name="l01927"></a>01927       <span class="comment">// Disk mounted ?</span>
<a name="l01928"></a>01928       <span class="keywordflow">if</span>( <a class="code" href="a00020.html#429fbd0498704c3d5864877548040069" title="Partition not mounted.">FS_TYPE_FAT_UNM</a> != <a class="code" href="a00019.html#d24195746b40d4a83dff493c118b91aa">fs_g_navext_fast</a>[i].u8_type_fat )
<a name="l01929"></a>01929       <span class="comment">// Is it the same disk ?</span>
<a name="l01930"></a>01930       <span class="keywordflow">if</span>( <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a> == <a class="code" href="a00019.html#0d59a916e72039fa7f898cd233f8fe2f">fs_g_navext</a>[i].<a class="code" href="a00004.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a> )
<a name="l01931"></a>01931 <span class="preprocessor">#if (FS_MULTI_PARTITION == ENABLED)</span>
<a name="l01932"></a>01932 <span class="preprocessor"></span>      <span class="comment">// Is it the same partition ?</span>
<a name="l01933"></a>01933       <span class="keywordflow">if</span>( <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#af482bc02a186c363c37c93e169fbbd4" title="Number of partition - 1 (0 or 1).">u8_partition</a> == <a class="code" href="a00019.html#0d59a916e72039fa7f898cd233f8fe2f">fs_g_navext</a>[i].<a class="code" href="a00004.html#af482bc02a186c363c37c93e169fbbd4" title="Number of partition - 1 (0 or 1).">u8_partition</a> )
<a name="l01934"></a>01934 <span class="preprocessor">#endif</span>
<a name="l01935"></a>01935 <span class="preprocessor"></span>      <span class="comment">// Is it the same directory ?</span>
<a name="l01936"></a>01936       <span class="keywordflow">if</span>( <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#ed8faad36e96ff2f422ddadd3740713f" title="First cluster number of selected directory (0 for the root directory).">u32_cluster_sel_dir</a> == <a class="code" href="a00019.html#0d59a916e72039fa7f898cd233f8fe2f">fs_g_navext</a>[i].<a class="code" href="a00004.html#ed8faad36e96ff2f422ddadd3740713f" title="First cluster number of selected directory (0 for the root directory).">u32_cluster_sel_dir</a> )
<a name="l01937"></a>01937       <span class="comment">// Is it the same file ?</span>
<a name="l01938"></a>01938       <span class="keywordflow">if</span>( <a class="code" href="a00020.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00006.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a> == <a class="code" href="a00019.html#d24195746b40d4a83dff493c118b91aa">fs_g_navext_fast</a>[i].<a class="code" href="a00006.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a> )
<a name="l01939"></a>01939       {
<a name="l01940"></a>01940          <span class="keywordflow">if</span>( mode )
<a name="l01941"></a>01941          {
<a name="l01942"></a>01942             <span class="comment">// Is it open ?</span>
<a name="l01943"></a>01943             <span class="keywordflow">if</span>( <a class="code" href="a00019.html#90e0163ac7f98f08019dc0b73fd7c834">fs_g_navext_entry</a>[i].u8_open_mode!=0 )
<a name="l01944"></a>01944             {
<a name="l01945"></a>01945                <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#65f54d5e9ae9fb0958d6be4d1fb919c7" title="The file is already opened.">FS_ERR_FILE_OPEN</a>;
<a name="l01946"></a>01946                <span class="keywordflow">return</span> FALSE;  <span class="comment">// File opened then write access not possibled</span>
<a name="l01947"></a>01947             }
<a name="l01948"></a>01948          }
<a name="l01949"></a>01949          <span class="keywordflow">else</span>
<a name="l01950"></a>01950          {
<a name="l01951"></a>01951             <span class="comment">// Is it open in write mode ?</span>
<a name="l01952"></a>01952             <span class="keywordflow">if</span>( <a class="code" href="a00019.html#90e0163ac7f98f08019dc0b73fd7c834">fs_g_navext_entry</a>[i].u8_open_mode &amp; <a class="code" href="a00024.html#2315e5a3aea8aa74d67e855a926d3921">FOPEN_WRITE_ACCESS</a> )
<a name="l01953"></a>01953             {
<a name="l01954"></a>01954                <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#5b438435c3686cdce1a51be28a732565" title="The file is already opened in write mode.">FS_ERR_FILE_OPEN_WR</a>;
<a name="l01955"></a>01955                <span class="keywordflow">return</span> FALSE;  <span class="comment">// File opened in write mode then read access not possibled</span>
<a name="l01956"></a>01956             }
<a name="l01957"></a>01957          }
<a name="l01958"></a>01958       }
<a name="l01959"></a>01959    }
<a name="l01960"></a>01960    <span class="keywordflow">return</span> TRUE;
<a name="l01961"></a>01961 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="f6f4a9e2d8e7b6dd557871b6bc2c2ee0"></a><!-- doxytag: member="fat.h::fat_check_noopen" ref="f6f4a9e2d8e7b6dd557871b6bc2c2ee0" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_check_noopen           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function checks if a file is not opened on current navigator. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>TRUE no file opened <p>
FALSE otherwise </dd></dl>

<p>Definition at line <a class="el" href="a00050.html#l00175">175</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00050.html#l00091">fat_check_device()</a>, <a class="el" href="a00051.html#l00374">Fat_file_is_open</a>, <a class="el" href="a00055.html#l00194">FS_ERR_TOO_FILE_OPEN</a>, <a class="el" href="a00051.html#l00395">fs_g_nav_fast</a>, <a class="el" href="a00055.html#l00256">fs_g_status</a>, <a class="el" href="a00051.html#l00358">FS_TYPE_FAT_UNM</a>, and <a class="el" href="a00051.html#l00295">Fs_management_fast::u8_type_fat</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00227">fat_check_mount_noopen()</a>, <a class="el" href="a00050.html#l00240">fat_check_mount_select_noopen()</a>, <a class="el" href="a00067.html#l00399">nav_drive_format()</a>, <a class="el" href="a00067.html#l00324">nav_drive_set()</a>, <a class="el" href="a00067.html#l00703">nav_filelist_fileisnotopen()</a>, <a class="el" href="a00067.html#l00461">nav_partition_mount()</a>, <a class="el" href="a00067.html#l00434">nav_partition_set()</a>, and <a class="el" href="a00067.html#l01578">nav_setcwd()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00176"></a>00176 {
<a name="l00177"></a>00177    <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#eeec0bd6755a6be4c4dda2b4669eb0ae" title="This function checks device state.">fat_check_device</a>() )
<a name="l00178"></a>00178       <span class="keywordflow">return</span> TRUE;
<a name="l00179"></a>00179    <span class="keywordflow">if</span> (<a class="code" href="a00020.html#429fbd0498704c3d5864877548040069" title="Partition not mounted.">FS_TYPE_FAT_UNM</a> == <a class="code" href="a00020.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00006.html#74121fb3c8d3a1d018c911650e2ec920" title="FAT type (default = no mounted = FS_TYPE_FAT_UNM).">u8_type_fat</a>)
<a name="l00180"></a>00180       <span class="keywordflow">return</span> TRUE;
<a name="l00181"></a>00181    <span class="keywordflow">if</span>( <a class="code" href="a00020.html#9bce5b4def8042e051c97409568e0138">Fat_file_is_open</a>() )
<a name="l00182"></a>00182    {
<a name="l00183"></a>00183       <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#498b273aa1304bf952cff68f0904e869" title="The navigation have already opened a file.">FS_ERR_TOO_FILE_OPEN</a>;  <span class="comment">// The navigation have already open a file</span>
<a name="l00184"></a>00184       <span class="keywordflow">return</span> FALSE;
<a name="l00185"></a>00185    }
<a name="l00186"></a>00186    <span class="keywordflow">return</span> TRUE;
<a name="l00187"></a>00187 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="4efc7734a340e899bb54506b277bb8c1"></a><!-- doxytag: member="fat.h::fat_check_open" ref="4efc7734a340e899bb54506b277bb8c1" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_check_open           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function checks if a file is opened on current navigator. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>TRUE a file is opened <p>
FALSE otherwise </dd></dl>

<p>Definition at line <a class="el" href="a00050.html#l00195">195</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00051.html#l00375">Fat_file_isnot_open</a>, <a class="el" href="a00055.html#l00212">FS_ERR_FILE_NO_OPEN</a>, and <a class="el" href="a00055.html#l00256">fs_g_status</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00255">fat_check_mount_select_open()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00196"></a>00196 {
<a name="l00197"></a>00197    <span class="keywordflow">if</span>( <a class="code" href="a00020.html#683f625ba66d2777d10aa6cc7c7435d9">Fat_file_isnot_open</a>() )
<a name="l00198"></a>00198    {
<a name="l00199"></a>00199       <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#ac3120e8423320b534f9ec08112ee8b9" title="No file is opened.">FS_ERR_FILE_NO_OPEN</a>;
<a name="l00200"></a>00200       <span class="keywordflow">return</span> FALSE;
<a name="l00201"></a>00201    }
<a name="l00202"></a>00202    <span class="keywordflow">return</span> TRUE;
<a name="l00203"></a>00203 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="909da9e84afbebf8ed5838cbe5002f60"></a><!-- doxytag: member="fat.h::fat_check_select" ref="909da9e84afbebf8ed5838cbe5002f60" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_check_select           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function checks if a file is selected on current navigator. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>TRUE a file is selected <p>
FALSE otherwise </dd></dl>

<p>Definition at line <a class="el" href="a00050.html#l00211">211</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00055.html#l00204">FS_ERR_NO_FILE_SEL</a>, <a class="el" href="a00051.html#l00395">fs_g_nav_fast</a>, <a class="el" href="a00055.html#l00256">fs_g_status</a>, <a class="el" href="a00051.html#l00367">FS_NO_SEL</a>, and <a class="el" href="a00051.html#l00296">Fs_management_fast::u16_entry_pos_sel_file</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00270">fat_check_mount_select()</a>, <a class="el" href="a00050.html#l00240">fat_check_mount_select_noopen()</a>, <a class="el" href="a00050.html#l00255">fat_check_mount_select_open()</a>, and <a class="el" href="a00067.html#l01411">nav_getcwd()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00212"></a>00212 {
<a name="l00213"></a>00213    <span class="keywordflow">if</span> (<a class="code" href="a00020.html#2e16c6cfcb3174f7ad19ad3996a69ae7" title="Signal that a file entry isn&amp;#39;t selected.">FS_NO_SEL</a> == <a class="code" href="a00020.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00006.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a>)
<a name="l00214"></a>00214    {
<a name="l00215"></a>00215       <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#231c28be4072acdd82517f3a24e2b245" title="There are no selected file.">FS_ERR_NO_FILE_SEL</a>;
<a name="l00216"></a>00216       <span class="keywordflow">return</span> FALSE;
<a name="l00217"></a>00217    }
<a name="l00218"></a>00218    <span class="keywordflow">return</span> TRUE;
<a name="l00219"></a>00219 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="4010dc2ad42864603bb81a41b485d346"></a><!-- doxytag: member="fat.h::fat_checkcluster" ref="4010dc2ad42864603bb81a41b485d346" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">U8 fat_checkcluster           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function checks the cluster value. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>value status <br>
 FS_CLUS_OK Value correct <br>
 FS_CLUS_BAD Value bad <br>
 FS_CLUS_END It is a end of list <br>
</dd></dl>
<div class="fragment"><pre class="fragment">
//! Global variable used
//! IN :
//!   fs_g_cluster.u32_val       value to check
//! </pre></div> 
<p>Definition at line <a class="el" href="a00050.html#l00845">845</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00051.html#l00232">FS_CLUS_BAD</a>, <a class="el" href="a00051.html#l00233">FS_CLUS_END</a>, <a class="el" href="a00051.html#l00231">FS_CLUS_OK</a>, <a class="el" href="a00051.html#l00403">fs_g_cluster</a>, <a class="el" href="a00051.html#l00075">Is_fat12</a>, <a class="el" href="a00051.html#l00080">Is_fat16</a>, <a class="el" href="a00051.html#l00085">Is_fat32</a>, and <a class="el" href="a00051.html#l00325">st_fs_cluster::u32_val</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00846"></a>00846 {
<a name="l00847"></a>00847   <span class="keywordflow">if</span> ( !<a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> )
<a name="l00848"></a>00848     <span class="keywordflow">return</span> <a class="code" href="a00020.html#296001b537ea1cf21069172943e73e60">FS_CLUS_BAD</a>;
<a name="l00849"></a>00849 
<a name="l00850"></a>00850   <span class="comment">// Cluster bad if (FAT12 == 0x0FF7) (FAT16 == 0xFFF7) (FAT32 == 0x0FFFFFF7)</span>
<a name="l00851"></a>00851   <span class="comment">// Last cluster if (FAT12 &gt; 0x0FF7) (FAT16 &gt; 0xFFF7) (FAT32 &gt; 0x0FFFFFF7)</span>
<a name="l00852"></a>00852   <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#57a82f24a45a33a159e0362b7e82e3fa">Is_fat32</a> )
<a name="l00853"></a>00853   {
<a name="l00854"></a>00854     <span class="keywordflow">if</span> (<a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> &gt;= 0x0FFFFFF8)
<a name="l00855"></a>00855       <span class="keywordflow">return</span> <a class="code" href="a00020.html#186703da0d708086e4ceaae4a470467d">FS_CLUS_END</a>;
<a name="l00856"></a>00856     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> == 0x0FFFFFF7)
<a name="l00857"></a>00857       <span class="keywordflow">return</span> <a class="code" href="a00020.html#296001b537ea1cf21069172943e73e60">FS_CLUS_BAD</a>;
<a name="l00858"></a>00858   }
<a name="l00859"></a>00859   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#2dcd74d640da1e20ad510413c9ef4c85">Is_fat16</a> )
<a name="l00860"></a>00860   {
<a name="l00861"></a>00861     <span class="keywordflow">if</span> (<a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> &gt;= 0xFFF8)
<a name="l00862"></a>00862       <span class="keywordflow">return</span> <a class="code" href="a00020.html#186703da0d708086e4ceaae4a470467d">FS_CLUS_END</a>;
<a name="l00863"></a>00863     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> == 0xFFF7)
<a name="l00864"></a>00864       <span class="keywordflow">return</span> <a class="code" href="a00020.html#296001b537ea1cf21069172943e73e60">FS_CLUS_BAD</a>;
<a name="l00865"></a>00865   }
<a name="l00866"></a>00866   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#c2ce5473766316396fb472c1bdd685e9">Is_fat12</a> )
<a name="l00867"></a>00867   {
<a name="l00868"></a>00868     <span class="keywordflow">if</span> (<a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> &gt;= 0xFF8)
<a name="l00869"></a>00869       <span class="keywordflow">return</span> <a class="code" href="a00020.html#186703da0d708086e4ceaae4a470467d">FS_CLUS_END</a>;
<a name="l00870"></a>00870     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> == 0xFF7)
<a name="l00871"></a>00871       <span class="keywordflow">return</span> <a class="code" href="a00020.html#296001b537ea1cf21069172943e73e60">FS_CLUS_BAD</a>;
<a name="l00872"></a>00872   }
<a name="l00873"></a>00873 
<a name="l00874"></a>00874   <span class="keywordflow">return</span> <a class="code" href="a00020.html#e9f7cc865270a55859b36205dc45b284">FS_CLUS_OK</a>;
<a name="l00875"></a>00875 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="6cc9ee9a14553be84990df27709f51a6"></a><!-- doxytag: member="fat.h::fat_clear_cluster" ref="6cc9ee9a14553be84990df27709f51a6" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_clear_cluster           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function clears one cluster. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE in case of error, see global value "fs_g_status" for more detail <p>
TRUE otherwise</dd></dl>
<div class="fragment"><pre class="fragment">
//! Global variables used
//! IN :
//!   fs_g_seg.u32_addr          Cluster value to clear
//! </pre></div> 
<p>Definition at line <a class="el" href="a00052.html#l02474">2474</a> of file <a class="el" href="a00052.html">fat_unusual.c</a>.</p>

<p>References <a class="el" href="a00050.html#l01840">fat_cache_clear()</a>, <a class="el" href="a00050.html#l01848">fat_cache_mark_sector_as_dirty()</a>, <a class="el" href="a00050.html#l01794">fat_cache_read_sector()</a>, <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>, <a class="el" href="a00051.html#l00240">FS_CLUST_ACT_ONE</a>, <a class="el" href="a00051.html#l00394">fs_g_nav</a>, <a class="el" href="a00051.html#l00400">fs_g_seg</a>, <a class="el" href="a00051.html#l00417">fs_gu32_addrsector</a>, <a class="el" href="a00051.html#l00317">Fs_segment::u32_addr</a>, <a class="el" href="a00051.html#l00318">Fs_segment::u32_size_or_pos</a>, and <a class="el" href="a00051.html#l00273">Fs_management::u8_BPB_SecPerClus</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l01921">fat_alloc_entry_free()</a>, and <a class="el" href="a00052.html#l01181">fat_initialize_dir()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l02474"></a>02474 {
<a name="l02475"></a>02475    U8 u8_loop;
<a name="l02476"></a>02476 
<a name="l02477"></a>02477    <span class="comment">// Compute the cluster sector address</span>
<a name="l02478"></a>02478    <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a>  = 0;   <span class="comment">// Select the beginning of cluster</span>
<a name="l02479"></a>02479    <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#b08a718173c6b1a1966e6395801a32e7" title="This function gets or clears a cluster list.">fat_cluster_list</a>( <a class="code" href="a00020.html#b24c1ca2a8bc9c3e264eb923d3b90666">FS_CLUST_ACT_ONE</a>, FALSE ))
<a name="l02480"></a>02480       <span class="keywordflow">return</span> FALSE;
<a name="l02481"></a>02481 
<a name="l02482"></a>02482    <span class="comment">// Loop in the cluster (start at the end of cluster)</span>
<a name="l02483"></a>02483    <a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a> = <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a> + (<a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#cddebea9972567fdcb5b87327b48125e" title="Cluster size (unit 512B).">u8_BPB_SecPerClus</a> -1);
<a name="l02484"></a>02484    <span class="keywordflow">for</span>(  u8_loop = 0
<a name="l02485"></a>02485    ;     <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#cddebea9972567fdcb5b87327b48125e" title="Cluster size (unit 512B).">u8_BPB_SecPerClus</a> != u8_loop
<a name="l02486"></a>02486    ;     u8_loop++ )
<a name="l02487"></a>02487    {
<a name="l02488"></a>02488       <span class="comment">// Update internal cache with cluster sector inforamtion but don't read data from memory</span>
<a name="l02489"></a>02489       <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#a67dc439478853cefdd226f9c99c9539" title="This function loads a memory sector in internal cache sector.">fat_cache_read_sector</a>( FALSE ))
<a name="l02490"></a>02490          <span class="keywordflow">return</span> FALSE;
<a name="l02491"></a>02491 
<a name="l02492"></a>02492       <span class="keywordflow">if</span>(0 == u8_loop)
<a name="l02493"></a>02493       {  <span class="comment">// Clean internal cache (just for the sector)</span>
<a name="l02494"></a>02494          <a class="code" href="a00019.html#5948c1de515852418670d3fb8ae1e832" title="This function clears the sector cache.">fat_cache_clear</a>();
<a name="l02495"></a>02495       }
<a name="l02496"></a>02496       <a class="code" href="a00019.html#45c0f16885c9e414ddb4b5afaa1cde34" title="This function sets a flag to signal that sector cache is modified.">fat_cache_mark_sector_as_dirty</a>();
<a name="l02497"></a>02497       <a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a>--;         <span class="comment">// go to previous sector</span>
<a name="l02498"></a>02498    }
<a name="l02499"></a>02499    <span class="keywordflow">return</span> TRUE;
<a name="l02500"></a>02500 }
<a name="l02501"></a>02501 <span class="preprocessor">#endif  // FS_LEVEL_FEATURES</span>
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="56d9a210bc2d4b0b5c46cb24a2e9f690"></a><!-- doxytag: member="fat.h::fat_clear_entry_info_and_ptr" ref="56d9a210bc2d4b0b5c46cb24a2e9f690" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fat_clear_entry_info_and_ptr           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function resets the selection pointers. 
<p>

<p>Definition at line <a class="el" href="a00050.html#l01394">1394</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00051.html#l00286">Fs_management::b_mode_nav</a>, <a class="el" href="a00051.html#l00287">Fs_management::b_mode_nav_single</a>, <a class="el" href="a00051.html#l00376">Fat_file_close</a>, <a class="el" href="a00055.html#l00116">FS_DIR</a>, <a class="el" href="a00051.html#l00394">fs_g_nav</a>, <a class="el" href="a00051.html#l00396">fs_g_nav_entry</a>, <a class="el" href="a00051.html#l00395">fs_g_nav_fast</a>, <a class="el" href="a00051.html#l00367">FS_NO_SEL</a>, <a class="el" href="a00051.html#l00296">Fs_management_fast::u16_entry_pos_sel_file</a>, <a class="el" href="a00051.html#l00283">Fs_management::u16_pos_sel_file</a>, <a class="el" href="a00051.html#l00305">Fs_management_entry::u32_cluster</a>, <a class="el" href="a00051.html#l00306">Fs_management_entry::u32_size</a>, and <a class="el" href="a00051.html#l00304">Fs_management_entry::u8_attr</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l00105">fat_mount()</a>, <a class="el" href="a00067.html#l00676">nav_filelist_reset()</a>, and <a class="el" href="a00067.html#l00461">nav_partition_mount()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01395"></a>01395 {
<a name="l01396"></a>01396    <a class="code" href="a00020.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00006.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a>= <a class="code" href="a00020.html#2e16c6cfcb3174f7ad19ad3996a69ae7" title="Signal that a file entry isn&amp;#39;t selected.">FS_NO_SEL</a>;
<a name="l01397"></a>01397    <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#b0213ed9fc205b282b4c1d92adfa7460" title="File position in the file list (only used by navigation functions).">u16_pos_sel_file</a>           = <a class="code" href="a00020.html#2e16c6cfcb3174f7ad19ad3996a69ae7" title="Signal that a file entry isn&amp;#39;t selected.">FS_NO_SEL</a>;
<a name="l01398"></a>01398    <span class="keywordflow">if</span>( !<a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#a77329e481dd65221af40a8c26b6541b" title="Navigation File List provide only files or directories.">b_mode_nav_single</a> )
<a name="l01399"></a>01399    {
<a name="l01400"></a>01400       <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#f36b5e65540c67c04d0ca489e2f52332" title="Navigation step ( FS_FILE or FS_DIR ).">b_mode_nav</a>                 = <a class="code" href="a00024.html#d043d9359eeca08e8c5ea4d9136eb15b">FS_DIR</a>;
<a name="l01401"></a>01401    }
<a name="l01402"></a>01402    <a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#c4f33191c9fd60c7520012bbe6005267" title="Attribut of the selected file.">u8_attr</a>     = 0;
<a name="l01403"></a>01403    <a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a> = 0;
<a name="l01404"></a>01404    <a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#6ffedc3932826a337dfb3e656a09edcc" title="Size of selected file (unit Bytes).">u32_size</a>    = 0;
<a name="l01405"></a>01405    <a class="code" href="a00020.html#55c673ca91c5301834a588e1d5a6515f">Fat_file_close</a>();
<a name="l01406"></a>01406 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="9503329592cf7484faf77ca95a6a21aa"></a><!-- doxytag: member="fat.h::fat_clear_info_fat_mod" ref="9503329592cf7484faf77ca95a6a21aa" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fat_clear_info_fat_mod           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function clears the cache information about FAT modifications. 
<p>

<p>Definition at line <a class="el" href="a00052.html#l02425">2425</a> of file <a class="el" href="a00052.html">fat_unusual.c</a>.</p>

<p>References <a class="el" href="a00051.html#l00408">fs_g_u16_first_mod_fat</a>, and <a class="el" href="a00051.html#l00409">fs_g_u16_last_mod_fat</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l02294">fat_allocfreespace()</a>, and <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l02425"></a>02425 {
<a name="l02426"></a>02426    <a class="code" href="a00020.html#b55b94c50b63cf8b83e2afcf2e0c2981" title="Offset (unit 512B) in fat of the first sector (unit 512B).">fs_g_u16_first_mod_fat</a> = 0xFFFF;
<a name="l02427"></a>02427    <a class="code" href="a00020.html#e8c6fce6d75eb9ddbf1e63e46659e9cc" title="Offset (unit 512B) in fat of the last sector (unit 512B).">fs_g_u16_last_mod_fat</a> = 0;
<a name="l02428"></a>02428 }
<a name="l02429"></a>02429 <span class="preprocessor">#endif  // FS_LEVEL_FEATURES</span>
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="b08a718173c6b1a1966e6395801a32e7"></a><!-- doxytag: member="fat.h::fat_cluster_list" ref="b08a718173c6b1a1966e6395801a32e7" args="(U8 opt_action, Bool b_for_file)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_cluster_list           </td>
          <td>(</td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>opt_action</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Bool&nbsp;</td>
          <td class="paramname"> <em>b_for_file</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function gets or clears a cluster list. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>b_for_file</em>&nbsp;</td><td>If TRUE then it is a file cluster list else a directory cluster list <br>
 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>opt_action</em>&nbsp;</td><td>Choose action on the cluster list <br>
 FS_CLUST_ACT_SEG Get continue memory segment corresponding at cluster list <br>
 FS_CLUST_ACT_ONE Get only one memory sector (512B) corresponding at cluster list <br>
 FS_CLUST_ACT_CLR Clear the cluster list <br>
</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE in case of error, see global value "fs_g_status" for more detail <p>
TRUE otherwise</dd></dl>
<div class="fragment"><pre class="fragment">
//! Global variables used
//! IN :
//!   fs_g_seg.u32_addr          The first cluster of the cluster list
//!   fs_g_seg.u32_size_or_pos   Start position in the cluster list (unit 512B)
//! OUT:
//!   fs_g_seg.u32_addr          The memory segment address corresponding at the beginning of cluster list (only for action FS_CLUST_ACT_SEG &amp; FS_CLUST_ACT_ONE)
//!   fs_g_seg.u32_size_or_pos   The memory segment size corresponding at cluster list readed or cleared (unit 512B)
//! </pre></div> 
<p>Definition at line <a class="el" href="a00050.html#l00364">364</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00050.html#l00882">fat_cache_clusterlist_reset()</a>, <a class="el" href="a00050.html#l00924">fat_cache_clusterlist_update_finish()</a>, <a class="el" href="a00050.html#l00964">fat_cache_clusterlist_update_read()</a>, <a class="el" href="a00050.html#l00845">fat_checkcluster()</a>, <a class="el" href="a00052.html#l02425">fat_clear_info_fat_mod()</a>, <a class="el" href="a00050.html#l00798">fat_cluster_readnext()</a>, <a class="el" href="a00050.html#l00603">fat_cluster_val()</a>, <a class="el" href="a00052.html#l02439">fat_update_fat2()</a>, <a class="el" href="a00052.html#l00853">fat_write_fat32_FSInfo()</a>, <a class="el" href="a00051.html#l00232">FS_CLUS_BAD</a>, <a class="el" href="a00051.html#l00233">FS_CLUS_END</a>, <a class="el" href="a00051.html#l00241">FS_CLUST_ACT_CLR</a>, <a class="el" href="a00051.html#l00240">FS_CLUST_ACT_ONE</a>, <a class="el" href="a00051.html#l00239">FS_CLUST_ACT_SEG</a>, <a class="el" href="a00051.html#l00248">FS_CLUST_VAL_EOL</a>, <a class="el" href="a00051.html#l00246">FS_CLUST_VAL_READ</a>, <a class="el" href="a00051.html#l00247">FS_CLUST_VAL_WRITE</a>, <a class="el" href="a00055.html#l00197">FS_ERR_FS</a>, <a class="el" href="a00055.html#l00215">FS_ERR_OUT_LIST</a>, <a class="el" href="a00050.html#l00068">fs_g_cache_clusterlist</a>, <a class="el" href="a00051.html#l00403">fs_g_cluster</a>, <a class="el" href="a00051.html#l00394">fs_g_nav</a>, <a class="el" href="a00051.html#l00400">fs_g_seg</a>, <a class="el" href="a00055.html#l00256">fs_g_status</a>, <a class="el" href="a00050.html#l00069">fs_g_u8_current_cache</a>, <a class="el" href="a00051.html#l00075">Is_fat12</a>, <a class="el" href="a00051.html#l00080">Is_fat16</a>, <a class="el" href="a00051.html#l00085">Is_fat32</a>, <a class="el" href="a00051.html#l00280">Fs_management::rootdir</a>, <a class="el" href="a00007.html#996b5fc79b7527c2b3dc3b34ed98f428">Fs_rootdir::seg</a>, <a class="el" href="a00051.html#l00261">Fs_rootdir::u16_pos</a>, <a class="el" href="a00051.html#l00262">Fs_rootdir::u16_size</a>, <a class="el" href="a00051.html#l00317">Fs_segment::u32_addr</a>, <a class="el" href="a00051.html#l00258">Fs_rootdir::u32_cluster</a>, <a class="el" href="a00051.html#l00279">Fs_management::u32_offset_data</a>, <a class="el" href="a00051.html#l00324">st_fs_cluster::u32_pos</a>, <a class="el" href="a00051.html#l00278">Fs_management::u32_ptr_fat</a>, <a class="el" href="a00051.html#l00318">Fs_segment::u32_size_or_pos</a>, <a class="el" href="a00051.html#l00337">Fs_clusterlist_cache::u32_start</a>, <a class="el" href="a00051.html#l00325">st_fs_cluster::u32_val</a>, and <a class="el" href="a00051.html#l00273">Fs_management::u8_BPB_SecPerClus</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l02474">fat_clear_cluster()</a>, <a class="el" href="a00050.html#l01195">fat_read_dir()</a>, and <a class="el" href="a00050.html#l01035">fat_read_file()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00365"></a>00365 {
<a name="l00366"></a>00366    _MEM_TYPE_FAST_ U32 u32_tmp;
<a name="l00367"></a>00367    _MEM_TYPE_FAST_ U8 u8_cluster_status;
<a name="l00368"></a>00368 
<a name="l00369"></a>00369    <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#89613ba21711697c707a3199bf93b9cf" title="File system error.">FS_ERR_FS</a>;      <span class="comment">// By default system error</span>
<a name="l00370"></a>00370 
<a name="l00371"></a>00371    <span class="keywordflow">if</span>(  <a class="code" href="a00020.html#57a82f24a45a33a159e0362b7e82e3fa">Is_fat32</a>
<a name="l00372"></a>00372    &amp;&amp;  (<a class="code" href="a00020.html#b314d14ba33772e9bcbae993a8d17e9f">FS_CLUST_ACT_CLR</a> == opt_action) )
<a name="l00373"></a>00373    {
<a name="l00374"></a>00374 <span class="preprocessor">#if (FSFEATURE_WRITE_COMPLET == (FS_LEVEL_FEATURES &amp; FSFEATURE_WRITE_COMPLET) )</span>
<a name="l00375"></a>00375 <span class="preprocessor"></span>      <span class="comment">// Clear free space information storage in FAT32</span>
<a name="l00376"></a>00376       <span class="keywordflow">if</span>( !<a class="code" href="a00020.html#9cf154ffe36bc2c00b1d589e523b449c" title="This function writes the space free number in selected FAT32 partition.">fat_write_fat32_FSInfo</a>( 0xFFFFFFFF ))
<a name="l00377"></a>00377          <span class="keywordflow">return</span> FALSE;
<a name="l00378"></a>00378 <span class="preprocessor">#else</span>
<a name="l00379"></a>00379 <span class="preprocessor"></span>      <span class="keywordflow">return</span> FALSE;
<a name="l00380"></a>00380 <span class="preprocessor">#endif</span>
<a name="l00381"></a>00381 <span class="preprocessor"></span>   }
<a name="l00382"></a>00382 
<a name="l00383"></a>00383    <span class="keywordflow">if</span> ( 0 == <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a> )
<a name="l00384"></a>00384    {
<a name="l00385"></a>00385       <span class="comment">// Cluster list of root directory</span>
<a name="l00386"></a>00386       <span class="keywordflow">if</span>( <a class="code" href="a00020.html#b314d14ba33772e9bcbae993a8d17e9f">FS_CLUST_ACT_CLR</a> == opt_action )
<a name="l00387"></a>00387          <span class="keywordflow">return</span> FALSE;           <span class="comment">// Impossible to erase ROOT DIR</span>
<a name="l00388"></a>00388 
<a name="l00389"></a>00389       <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#c2ce5473766316396fb472c1bdd685e9">Is_fat12</a> || <a class="code" href="a00020.html#2dcd74d640da1e20ad510413c9ef4c85">Is_fat16</a> )
<a name="l00390"></a>00390       {
<a name="l00391"></a>00391          <span class="comment">// For a FAT 12 &amp; 16, the root dir isn't a cluster list</span>
<a name="l00392"></a>00392          <span class="comment">// Check the position</span>
<a name="l00393"></a>00393          <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> &lt; <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#b26050633d0597af6c2c6abe9684481b" title="Root directory informations.">rootdir</a>.<a class="code" href="a00007.html#996b5fc79b7527c2b3dc3b34ed98f428" title="For FAT 12 &amp;amp; 16, it is a segment (no cluster list).">seg</a>.<a class="code" href="a00007.html#5e384bddb7393218e17f0329d1b8527f" title="Size of root (unit 512B).">u16_size</a> )
<a name="l00394"></a>00394          {
<a name="l00395"></a>00395             <span class="comment">// Compute the start address and the size</span>
<a name="l00396"></a>00396             <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a> = <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#af1d8fda28bded48a54c7eab4d729618" title="FAT address (unit 512B).">u32_ptr_fat</a> + <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#b26050633d0597af6c2c6abe9684481b" title="Root directory informations.">rootdir</a>.<a class="code" href="a00007.html#996b5fc79b7527c2b3dc3b34ed98f428" title="For FAT 12 &amp;amp; 16, it is a segment (no cluster list).">seg</a>.<a class="code" href="a00007.html#a17ca07269fcb28d77b14e5a67d56378" title="Offset between the beginning of FAT and the beginning of root dir (unit 512B).">u16_pos</a> + <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a>;
<a name="l00397"></a>00397             <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> = <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#b26050633d0597af6c2c6abe9684481b" title="Root directory informations.">rootdir</a>.<a class="code" href="a00007.html#996b5fc79b7527c2b3dc3b34ed98f428" title="For FAT 12 &amp;amp; 16, it is a segment (no cluster list).">seg</a>.<a class="code" href="a00007.html#5e384bddb7393218e17f0329d1b8527f" title="Size of root (unit 512B).">u16_size</a> - <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a>;
<a name="l00398"></a>00398             <span class="keywordflow">return</span> TRUE;
<a name="l00399"></a>00399          } <span class="keywordflow">else</span> {
<a name="l00400"></a>00400             <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#e8798a89bfc4f49da50fc55b14a5b07f" title="The position is outside the cluster list.">FS_ERR_OUT_LIST</a>;
<a name="l00401"></a>00401             <span class="keywordflow">return</span> FALSE;        <span class="comment">// Position outside the root area</span>
<a name="l00402"></a>00402          }
<a name="l00403"></a>00403       }
<a name="l00404"></a>00404       <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#57a82f24a45a33a159e0362b7e82e3fa">Is_fat32</a> )
<a name="l00405"></a>00405       {
<a name="l00406"></a>00406          <span class="comment">// For FAT 32, the root is a cluster list and the first cluster is reading during the mount</span>
<a name="l00407"></a>00407          <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a> = <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#b26050633d0597af6c2c6abe9684481b" title="Root directory informations.">rootdir</a>.<a class="code" href="a00007.html#54d1e701d0705a2b2adb2b2cdc2e604b" title="For FAT32, the root directory is a cluster list.">u32_cluster</a>;
<a name="l00408"></a>00408       }
<a name="l00409"></a>00409    } <span class="keywordflow">else</span> {
<a name="l00410"></a>00410       <span class="comment">// It is the first cluster of a cluster list</span>
<a name="l00411"></a>00411       <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a> = <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a>;
<a name="l00412"></a>00412    }
<a name="l00413"></a>00413 
<a name="l00414"></a>00414    <span class="comment">// Management of cluster list caches</span>
<a name="l00415"></a>00415    <span class="keywordflow">if</span>( <a class="code" href="a00020.html#b314d14ba33772e9bcbae993a8d17e9f">FS_CLUST_ACT_CLR</a> != opt_action )
<a name="l00416"></a>00416    {
<a name="l00417"></a>00417       <span class="keywordflow">if</span>( <a class="code" href="a00019.html#b4f9f4f20c7e1ef6fa76ddc52cdc54f1" title="This function searchs a cluster list in cluster list caches.">fat_cache_clusterlist_update_read</a>( b_for_file ) )
<a name="l00418"></a>00418          <span class="keywordflow">return</span> TRUE;            <span class="comment">// Segment found in cache</span>
<a name="l00419"></a>00419       <span class="comment">// Segment not found &amp; cache ready to update</span>
<a name="l00420"></a>00420    }<span class="keywordflow">else</span>{
<a name="l00421"></a>00421       <a class="code" href="a00019.html#ecb0d4c200bed41b8bdcf671aa931a2a" title="This function resets the cluster list caches.">fat_cache_clusterlist_reset</a>();   <span class="comment">// It is a clear action then clear cluster list caches</span>
<a name="l00422"></a>00422 <span class="preprocessor">#if (FS_LEVEL_FEATURES &gt; FSFEATURE_READ)</span>
<a name="l00423"></a>00423 <span class="preprocessor"></span>      <a class="code" href="a00020.html#9503329592cf7484faf77ca95a6a21aa" title="This function clears the cache information about FAT modifications.">fat_clear_info_fat_mod</a>();        <span class="comment">// Init cache on fat modification range</span>
<a name="l00424"></a>00424 <span class="preprocessor">#endif  // FS_LEVEL_FEATURES</span>
<a name="l00425"></a>00425 <span class="preprocessor"></span>   }
<a name="l00426"></a>00426 
<a name="l00427"></a>00427    <span class="comment">// Init loop with a start segment no found</span>
<a name="l00428"></a>00428    MSB0( <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a> ) = 0xFF;
<a name="l00429"></a>00429 
<a name="l00430"></a>00430    <span class="comment">//**** Loop to read the cluster list</span>
<a name="l00431"></a>00431    <span class="keywordflow">while</span> ( 1 )
<a name="l00432"></a>00432    {
<a name="l00433"></a>00433       <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> &lt; <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#cddebea9972567fdcb5b87327b48125e" title="Cluster size (unit 512B).">u8_BPB_SecPerClus</a> )
<a name="l00434"></a>00434       {
<a name="l00435"></a>00435          <span class="comment">// The segment starts in this cluster</span>
<a name="l00436"></a>00436          <span class="comment">// Compute the sector address of this cluster</span>
<a name="l00437"></a>00437          <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a> = ((<a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a> - 2) * <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#cddebea9972567fdcb5b87327b48125e" title="Cluster size (unit 512B).">u8_BPB_SecPerClus</a>)
<a name="l00438"></a>00438                            + <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#af1d8fda28bded48a54c7eab4d729618" title="FAT address (unit 512B).">u32_ptr_fat</a> + <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#4666662ac4fa96c340a61e5fb786b83a" title="Offset between the beginning of FAT and the first cluster (unit 512B).">u32_offset_data</a> + <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a>;
<a name="l00439"></a>00439 
<a name="l00440"></a>00440          <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#b24c1ca2a8bc9c3e264eb923d3b90666">FS_CLUST_ACT_ONE</a> == opt_action )
<a name="l00441"></a>00441          {
<a name="l00442"></a>00442             <span class="comment">// Compute the maximum size</span>
<a name="l00443"></a>00443             <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> = <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#cddebea9972567fdcb5b87327b48125e" title="Cluster size (unit 512B).">u8_BPB_SecPerClus</a>-<a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a>;
<a name="l00444"></a>00444             <a class="code" href="a00019.html#2ae33c7eebc67cd4cf420593aa2c97d6" title="This function updates a cache of cluster list caches.">fat_cache_clusterlist_update_finish</a>();
<a name="l00445"></a>00445             <span class="comment">// Send a size of one sector</span>
<a name="l00446"></a>00446             <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> = 1;
<a name="l00447"></a>00447             <span class="keywordflow">return</span> TRUE;
<a name="l00448"></a>00448          }
<a name="l00449"></a>00449          <span class="comment">// Update the segment size</span>
<a name="l00450"></a>00450          <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> = <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#cddebea9972567fdcb5b87327b48125e" title="Cluster size (unit 512B).">u8_BPB_SecPerClus</a> - LSB0( <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> );
<a name="l00451"></a>00451 
<a name="l00452"></a>00452          <span class="comment">// Take time, during read cluster list on FAT 16 &amp; 32</span>
<a name="l00453"></a>00453          <span class="keywordflow">if</span>( (<a class="code" href="a00020.html#67f38f48a73531bf4bcd7bf87c7b1db5">FS_CLUST_ACT_SEG</a> == opt_action)
<a name="l00454"></a>00454          &amp;&amp;  (!<a class="code" href="a00020.html#c2ce5473766316396fb472c1bdd685e9">Is_fat12</a>) )
<a name="l00455"></a>00455          {
<a name="l00456"></a>00456             <span class="comment">// Init loop with the current cluster</span>
<a name="l00457"></a>00457             u32_tmp = <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a>;
<a name="l00458"></a>00458             <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#1be84552293d174f534b2fb8d0a4e737" title="This function returns or modifys a cluster value in FAT.">fat_cluster_val</a>( <a class="code" href="a00020.html#087734ece5cae84508fd1fbe9414ad02">FS_CLUST_VAL_READ</a> ))
<a name="l00459"></a>00459                <span class="keywordflow">return</span> FALSE;
<a name="l00460"></a>00460             <span class="comment">// Read cluster list, while this one is continue</span>
<a name="l00461"></a>00461             <span class="keywordflow">while</span>(1)
<a name="l00462"></a>00462             {
<a name="l00463"></a>00463                <span class="keywordflow">if</span> ( (++<a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a>) != <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> )
<a name="l00464"></a>00464                {
<a name="l00465"></a>00465                   <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a>--;                   <span class="comment">// Recompute previous value</span>
<a name="l00466"></a>00466                   u32_tmp = <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a> - u32_tmp; <span class="comment">// Compute the size of cluster list</span>
<a name="l00467"></a>00467                   <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> += u32_tmp * <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#cddebea9972567fdcb5b87327b48125e" title="Cluster size (unit 512B).">u8_BPB_SecPerClus</a>;
<a name="l00468"></a>00468                   <span class="keywordflow">break</span>;
<a name="l00469"></a>00469                }
<a name="l00470"></a>00470                <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#e28958d1a5e3ed006edf937e6b7dacc7" title="This function is optimized to read a continue cluster list on FAT16 and FAT32.">fat_cluster_readnext</a>() )
<a name="l00471"></a>00471                   <span class="keywordflow">return</span> FALSE;
<a name="l00472"></a>00472             }
<a name="l00473"></a>00473          }
<a name="l00474"></a>00474       }
<a name="l00475"></a>00475       <span class="comment">// Get the cluster value</span>
<a name="l00476"></a>00476       <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#1be84552293d174f534b2fb8d0a4e737" title="This function returns or modifys a cluster value in FAT.">fat_cluster_val</a>( <a class="code" href="a00020.html#087734ece5cae84508fd1fbe9414ad02">FS_CLUST_VAL_READ</a> ))
<a name="l00477"></a>00477          <span class="keywordflow">return</span> FALSE;
<a name="l00478"></a>00478 
<a name="l00479"></a>00479       <span class="comment">// Read and check the status of the new cluster</span>
<a name="l00480"></a>00480       u8_cluster_status = <a class="code" href="a00019.html#4010dc2ad42864603bb81a41b485d346" title="This function checks the cluster value.">fat_checkcluster</a>();
<a name="l00481"></a>00481       <span class="keywordflow">if</span> (<a class="code" href="a00020.html#296001b537ea1cf21069172943e73e60">FS_CLUS_BAD</a> == u8_cluster_status)
<a name="l00482"></a>00482          <span class="keywordflow">return</span> FALSE; <span class="comment">// error, end of cluster list</span>
<a name="l00483"></a>00483 
<a name="l00484"></a>00484       <span class="keywordflow">if</span> (0xFF == MSB0(<a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a>))
<a name="l00485"></a>00485       {
<a name="l00486"></a>00486          <span class="comment">// The beginning of the segment isn't found</span>
<a name="l00487"></a>00487          <span class="keywordflow">if</span> (<a class="code" href="a00020.html#186703da0d708086e4ceaae4a470467d">FS_CLUS_END</a> == u8_cluster_status)
<a name="l00488"></a>00488          {
<a name="l00489"></a>00489             u32_tmp = <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a>;       <span class="comment">// Save number of sector remaining</span>
<a name="l00490"></a>00490 
<a name="l00491"></a>00491             <span class="comment">// Compute the sector address of this last cluster to take time during a futur request with the same cluster list</span>
<a name="l00492"></a>00492             <a class="code" href="a00019.html#2c119a8b66b97a6c14624fb941889a24">fs_g_cache_clusterlist</a>[<a class="code" href="a00019.html#07bae2654ebf3c7d64078af69ccebd3b">fs_g_u8_current_cache</a>].<a class="code" href="a00001.html#9b3cb7c527c5e7e02cc5f4e76fdcd90c" title="Start position in the cluster list (unit 512B).">u32_start</a> -= <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a>;
<a name="l00493"></a>00493             <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a> = ((<a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a> - 2) * <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#cddebea9972567fdcb5b87327b48125e" title="Cluster size (unit 512B).">u8_BPB_SecPerClus</a>)
<a name="l00494"></a>00494                               + <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#af1d8fda28bded48a54c7eab4d729618" title="FAT address (unit 512B).">u32_ptr_fat</a> + <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#4666662ac4fa96c340a61e5fb786b83a" title="Offset between the beginning of FAT and the first cluster (unit 512B).">u32_offset_data</a>;
<a name="l00495"></a>00495             <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> = <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#cddebea9972567fdcb5b87327b48125e" title="Cluster size (unit 512B).">u8_BPB_SecPerClus</a>;
<a name="l00496"></a>00496             <span class="keywordflow">if</span> (<a class="code" href="a00020.html#b314d14ba33772e9bcbae993a8d17e9f">FS_CLUST_ACT_CLR</a> != opt_action)
<a name="l00497"></a>00497                <a class="code" href="a00019.html#2ae33c7eebc67cd4cf420593aa2c97d6" title="This function updates a cache of cluster list caches.">fat_cache_clusterlist_update_finish</a>();
<a name="l00498"></a>00498 
<a name="l00499"></a>00499             <span class="comment">// The position is outside the cluster list</span>
<a name="l00500"></a>00500             <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a> = <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a>; <span class="comment">// Send the last cluster value</span>
<a name="l00501"></a>00501             <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> = u32_tmp;       <span class="comment">// Restore number of sector remaining</span>
<a name="l00502"></a>00502             <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#e8798a89bfc4f49da50fc55b14a5b07f" title="The position is outside the cluster list.">FS_ERR_OUT_LIST</a>;
<a name="l00503"></a>00503             <span class="keywordflow">return</span> FALSE;
<a name="l00504"></a>00504          }
<a name="l00505"></a>00505          <span class="comment">// Good cluster then continue</span>
<a name="l00506"></a>00506          <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> -= <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#cddebea9972567fdcb5b87327b48125e" title="Cluster size (unit 512B).">u8_BPB_SecPerClus</a>;
<a name="l00507"></a>00507 <span class="preprocessor">#if (FS_LEVEL_FEATURES &gt; FSFEATURE_READ)</span>
<a name="l00508"></a>00508 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (<a class="code" href="a00020.html#b314d14ba33772e9bcbae993a8d17e9f">FS_CLUST_ACT_CLR</a> == opt_action)
<a name="l00509"></a>00509          {
<a name="l00510"></a>00510             <span class="keywordflow">if</span>( <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> == 0)
<a name="l00511"></a>00511             {
<a name="l00512"></a>00512                <span class="comment">// At cluster position, set the flag end of cluster list</span>
<a name="l00513"></a>00513                <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a> = <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a>; <span class="comment">// Save the next cluster</span>
<a name="l00514"></a>00514                <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> = <a class="code" href="a00020.html#6a0f491ab351899993a4171f5ff526f3">FS_CLUST_VAL_EOL</a>;
<a name="l00515"></a>00515                <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#1be84552293d174f534b2fb8d0a4e737" title="This function returns or modifys a cluster value in FAT.">fat_cluster_val</a>( <a class="code" href="a00020.html#c11d0331723bc237aac4d6c7a4fe7496">FS_CLUST_VAL_WRITE</a> ))
<a name="l00516"></a>00516                   <span class="keywordflow">return</span> FALSE;
<a name="l00517"></a>00517                <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> = <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a>; <span class="comment">// Resotre the next cluster</span>
<a name="l00518"></a>00518                <span class="comment">// !!!! It isn't necessary to reinit MSB0( fs_g_seg.u32_addr ) to 0xFF,</span>
<a name="l00519"></a>00519                <span class="comment">// !!!! fs_g_seg.u32_addr will be modified at the beginning of main loop</span>
<a name="l00520"></a>00520             }
<a name="l00521"></a>00521          }
<a name="l00522"></a>00522 <span class="preprocessor">#endif  // FS_LEVEL_FEATURES</span>
<a name="l00523"></a>00523 <span class="preprocessor"></span>      }
<a name="l00524"></a>00524       <span class="keywordflow">else</span>
<a name="l00525"></a>00525       {
<a name="l00526"></a>00526          <span class="comment">// The beginning of segment is found</span>
<a name="l00527"></a>00527          <span class="keywordflow">if</span> (<a class="code" href="a00020.html#67f38f48a73531bf4bcd7bf87c7b1db5">FS_CLUST_ACT_SEG</a> == opt_action)
<a name="l00528"></a>00528          {
<a name="l00529"></a>00529             <span class="keywordflow">if</span> ( (<a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a>+1) != <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> )
<a name="l00530"></a>00530             {
<a name="l00531"></a>00531                <span class="comment">// The cluster is not a continue cluster or a invalid cluster</span>
<a name="l00532"></a>00532                <a class="code" href="a00019.html#2ae33c7eebc67cd4cf420593aa2c97d6" title="This function updates a cache of cluster list caches.">fat_cache_clusterlist_update_finish</a>();
<a name="l00533"></a>00533                <span class="keywordflow">return</span> TRUE;                              <span class="comment">// End of segment</span>
<a name="l00534"></a>00534             }
<a name="l00535"></a>00535          }
<a name="l00536"></a>00536 <span class="preprocessor">#if (FS_LEVEL_FEATURES &gt; FSFEATURE_READ)</span>
<a name="l00537"></a>00537 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (<a class="code" href="a00020.html#b314d14ba33772e9bcbae993a8d17e9f">FS_CLUST_ACT_CLR</a> == opt_action)
<a name="l00538"></a>00538          {
<a name="l00539"></a>00539             <span class="comment">//** Clear cluster position</span>
<a name="l00540"></a>00540             <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a> = <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a>;    <span class="comment">// Save the next cluster</span>
<a name="l00541"></a>00541             <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> = 0;                    <span class="comment">// by default free cluster</span>
<a name="l00542"></a>00542             <span class="comment">// If it is the first cluster (fs_g_seg.u32_size_or_pos &lt;= fs_g_nav.u8_BPB_SecPerClus)</span>
<a name="l00543"></a>00543             <span class="comment">// and doesn't start at the beginning of cluster (fs_g_seg.u32_size_or_pos != fs_g_nav.u8_BPB_SecPerClus)</span>
<a name="l00544"></a>00544             <span class="keywordflow">if</span> (<a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> &lt; <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#cddebea9972567fdcb5b87327b48125e" title="Cluster size (unit 512B).">u8_BPB_SecPerClus</a>)
<a name="l00545"></a>00545             {
<a name="l00546"></a>00546                <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> = <a class="code" href="a00020.html#6a0f491ab351899993a4171f5ff526f3">FS_CLUST_VAL_EOL</a>;  <span class="comment">// End of cluster list allocated</span>
<a name="l00547"></a>00547             }
<a name="l00548"></a>00548             <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#1be84552293d174f534b2fb8d0a4e737" title="This function returns or modifys a cluster value in FAT.">fat_cluster_val</a>( <a class="code" href="a00020.html#c11d0331723bc237aac4d6c7a4fe7496">FS_CLUST_VAL_WRITE</a> ))
<a name="l00549"></a>00549                <span class="keywordflow">return</span> FALSE;
<a name="l00550"></a>00550             <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> = <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a>;    <span class="comment">// Resotre the next cluster</span>
<a name="l00551"></a>00551             <span class="comment">// !!!! It isn't necessary to reinit MSB0( fs_g_seg.u32_addr ) at 0xFF,</span>
<a name="l00552"></a>00552             <span class="comment">// !!!! because it isn't possible that MSB0( fs_g_cluster.val ) = 0xFF.</span>
<a name="l00553"></a>00553          }
<a name="l00554"></a>00554 <span class="preprocessor">#endif  // FS_LEVEL_FEATURES</span>
<a name="l00555"></a>00555 <span class="preprocessor"></span>
<a name="l00556"></a>00556          <span class="comment">// Check the end of cluster list</span>
<a name="l00557"></a>00557          <span class="keywordflow">if</span> (<a class="code" href="a00020.html#186703da0d708086e4ceaae4a470467d">FS_CLUS_END</a> == u8_cluster_status)
<a name="l00558"></a>00558          {
<a name="l00559"></a>00559 <span class="preprocessor">#if (FS_LEVEL_FEATURES &gt; FSFEATURE_READ)</span>
<a name="l00560"></a>00560 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (<a class="code" href="a00020.html#b314d14ba33772e9bcbae993a8d17e9f">FS_CLUST_ACT_CLR</a> == opt_action)
<a name="l00561"></a>00561             {
<a name="l00562"></a>00562                <span class="keywordflow">return</span> <a class="code" href="a00020.html#8145cff91620fc1b70aa0eef5750db72" title="This function copys the modifications of the first FAT to the second FAT.">fat_update_fat2</a>();
<a name="l00563"></a>00563             }
<a name="l00564"></a>00564 <span class="preprocessor">#endif  // FS_LEVEL_FEATURES</span>
<a name="l00565"></a>00565 <span class="preprocessor"></span>            <a class="code" href="a00019.html#2ae33c7eebc67cd4cf420593aa2c97d6" title="This function updates a cache of cluster list caches.">fat_cache_clusterlist_update_finish</a>();
<a name="l00566"></a>00566             <span class="keywordflow">return</span> TRUE; <span class="comment">// End of segment</span>
<a name="l00567"></a>00567          }
<a name="l00568"></a>00568 
<a name="l00569"></a>00569          <span class="comment">// Update the segment size</span>
<a name="l00570"></a>00570          <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> += <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#cddebea9972567fdcb5b87327b48125e" title="Cluster size (unit 512B).">u8_BPB_SecPerClus</a>;
<a name="l00571"></a>00571       }
<a name="l00572"></a>00572       <span class="comment">// HERE, Continue to read the cluster list</span>
<a name="l00573"></a>00573       <span class="comment">// The next cluster is the value of previous cluster</span>
<a name="l00574"></a>00574       <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a> = <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a>;
<a name="l00575"></a>00575    }  <span class="comment">// End of main loop</span>
<a name="l00576"></a>00576 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="e28958d1a5e3ed006edf937e6b7dacc7"></a><!-- doxytag: member="fat.h::fat_cluster_readnext" ref="e28958d1a5e3ed006edf937e6b7dacc7" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_cluster_readnext           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function is optimized to read a continue cluster list on FAT16 and FAT32. 
<p>
Read global value "fs_g_status" in case of error : FS_ERR_HW Hardware driver error FS_LUN_WP Drive is read only<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE in case of error, see global value "fs_g_status" for more detail <p>
TRUE otherwise</dd></dl>
<div class="fragment"><pre class="fragment">
//! Global variables used
//! IN :
//!   fs_g_u16_pos_fat        previous cluster position in FAT
//! OUT:
//!   fs_g_u16_pos_fat        readed cluster position in FAT
//!   fs_g_cluster.u32_val    value of cluster readed
//! </pre></div> 
<p>Definition at line <a class="el" href="a00050.html#l00798">798</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00050.html#l01794">fat_cache_read_sector()</a>, <a class="el" href="a00051.html#l00222">FS_CACHE_SIZE</a>, <a class="el" href="a00051.html#l00403">fs_g_cluster</a>, <a class="el" href="a00051.html#l00415">fs_g_sector</a>, <a class="el" href="a00050.html#l00581">fs_g_u16_pos_fat</a>, <a class="el" href="a00051.html#l00417">fs_gu32_addrsector</a>, <a class="el" href="a00051.html#l00085">Is_fat32</a>, and <a class="el" href="a00051.html#l00325">st_fs_cluster::u32_val</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>, and <a class="el" href="a00052.html#l02133">fat_getfreespace()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00799"></a>00799 {
<a name="l00800"></a>00800    <span class="comment">// Compute the next cluster position in FAT</span>
<a name="l00801"></a>00801    <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#57a82f24a45a33a159e0362b7e82e3fa">Is_fat32</a> )
<a name="l00802"></a>00802    {
<a name="l00803"></a>00803       <a class="code" href="a00019.html#87e7f1f24baa43d2924a1c55a0b3f76c">fs_g_u16_pos_fat</a> += 4;
<a name="l00804"></a>00804    }<span class="keywordflow">else</span>{
<a name="l00805"></a>00805       <span class="comment">// Is_fat16</span>
<a name="l00806"></a>00806       <a class="code" href="a00019.html#87e7f1f24baa43d2924a1c55a0b3f76c">fs_g_u16_pos_fat</a> += 2;
<a name="l00807"></a>00807    }
<a name="l00808"></a>00808 
<a name="l00809"></a>00809    <span class="comment">// Check if next cluster is in internal cache</span>
<a name="l00810"></a>00810    <span class="keywordflow">if</span>( <a class="code" href="a00020.html#1f24fc24a15f2e52ecae58ae2d5dfbfc">FS_CACHE_SIZE</a> == <a class="code" href="a00019.html#87e7f1f24baa43d2924a1c55a0b3f76c">fs_g_u16_pos_fat</a> )
<a name="l00811"></a>00811    {
<a name="l00812"></a>00812       <span class="comment">// Update cache</span>
<a name="l00813"></a>00813       <a class="code" href="a00019.html#87e7f1f24baa43d2924a1c55a0b3f76c">fs_g_u16_pos_fat</a> = 0;
<a name="l00814"></a>00814       <a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a>++;
<a name="l00815"></a>00815       <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#a67dc439478853cefdd226f9c99c9539" title="This function loads a memory sector in internal cache sector.">fat_cache_read_sector</a>( TRUE ))
<a name="l00816"></a>00816          <span class="keywordflow">return</span> FALSE;
<a name="l00817"></a>00817    }
<a name="l00818"></a>00818 
<a name="l00819"></a>00819    <span class="comment">//**** Read the cluster value</span>
<a name="l00820"></a>00820    LSB0( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> ) = <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00019.html#87e7f1f24baa43d2924a1c55a0b3f76c">fs_g_u16_pos_fat</a>+0];  <span class="comment">// FAT 16,32</span>
<a name="l00821"></a>00821    LSB1( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> ) = <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00019.html#87e7f1f24baa43d2924a1c55a0b3f76c">fs_g_u16_pos_fat</a>+1];  <span class="comment">// FAT 16,32</span>
<a name="l00822"></a>00822 
<a name="l00823"></a>00823    <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#57a82f24a45a33a159e0362b7e82e3fa">Is_fat32</a> )
<a name="l00824"></a>00824    {  <span class="comment">// FAT 32</span>
<a name="l00825"></a>00825       LSB2( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> ) = <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00019.html#87e7f1f24baa43d2924a1c55a0b3f76c">fs_g_u16_pos_fat</a>+2];
<a name="l00826"></a>00826       LSB3( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> ) = <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00019.html#87e7f1f24baa43d2924a1c55a0b3f76c">fs_g_u16_pos_fat</a>+3];
<a name="l00827"></a>00827    }
<a name="l00828"></a>00828    <span class="keywordflow">return</span> TRUE;
<a name="l00829"></a>00829 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="1be84552293d174f534b2fb8d0a4e737"></a><!-- doxytag: member="fat.h::fat_cluster_val" ref="1be84552293d174f534b2fb8d0a4e737" args="(Bool b_mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_cluster_val           </td>
          <td>(</td>
          <td class="paramtype">Bool&nbsp;</td>
          <td class="paramname"> <em>b_mode</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function returns or modifys a cluster value in FAT. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>b_mode</em>&nbsp;</td><td>FALSE, to read a cluster value <br>
 TRUE, to write a cluster value</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE in case of error, see global value "fs_g_status" for more detail <p>
TRUE otherwise</dd></dl>
<div class="fragment"><pre class="fragment">
//! Global variables used
//! IN :
//!   fs_g_cluster.u32_pos    cluster number to read or write
//!   fs_g_cluster.u32_val    value to write
//! OUT:
//!   fs_g_cluster.u32_val    value readed
//!   fs_g_u16_pos_fat        position in FAT of the cluster to read or write
//!                           value init in case of the fat_cluster_readnext() routine is used after
//! </pre></div> 
<p>Definition at line <a class="el" href="a00050.html#l00603">603</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00050.html#l01848">fat_cache_mark_sector_as_dirty()</a>, <a class="el" href="a00050.html#l01794">fat_cache_read_sector()</a>, <a class="el" href="a00051.html#l00222">FS_CACHE_SIZE</a>, <a class="el" href="a00055.html#l00223">FS_ERR_COMMAND</a>, <a class="el" href="a00051.html#l00403">fs_g_cluster</a>, <a class="el" href="a00051.html#l00394">fs_g_nav</a>, <a class="el" href="a00051.html#l00415">fs_g_sector</a>, <a class="el" href="a00055.html#l00256">fs_g_status</a>, <a class="el" href="a00051.html#l00408">fs_g_u16_first_mod_fat</a>, <a class="el" href="a00051.html#l00409">fs_g_u16_last_mod_fat</a>, <a class="el" href="a00050.html#l00581">fs_g_u16_pos_fat</a>, <a class="el" href="a00051.html#l00417">fs_gu32_addrsector</a>, <a class="el" href="a00051.html#l00075">Is_fat12</a>, <a class="el" href="a00051.html#l00080">Is_fat16</a>, <a class="el" href="a00051.html#l00085">Is_fat32</a>, <a class="el" href="a00051.html#l00324">st_fs_cluster::u32_pos</a>, <a class="el" href="a00051.html#l00278">Fs_management::u32_ptr_fat</a>, <a class="el" href="a00051.html#l00325">st_fs_cluster::u32_val</a>, <a class="el" href="a00019.html#6b0f192ee05f7d19f1372a8a1fb514bc">u8_data3</a>, and <a class="el" href="a00019.html#4d26b9400e3057b9cfde8d083a0049e6">u8_data4</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l02294">fat_allocfreespace()</a>, <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>, <a class="el" href="a00052.html#l02133">fat_getfreespace()</a>, and <a class="el" href="a00052.html#l02198">fat_getfreespace_percent()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00604"></a>00604 {
<a name="l00605"></a>00605    _MEM_TYPE_FAST_ U16   u16_offset_fat;
<a name="l00606"></a>00606    _MEM_TYPE_FAST_ U8    u8_data1, u8_data2;
<a name="l00607"></a>00607 <span class="preprocessor">#define  u8_data3    (LSB(u16_offset_fat)) // Manual overlay</span>
<a name="l00608"></a>00608 <span class="preprocessor"></span><span class="preprocessor">#define  u8_data4    (MSB(u16_offset_fat)) // Manual overlay</span>
<a name="l00609"></a>00609 <span class="preprocessor"></span>   _MEM_TYPE_FAST_ <a class="code" href="a00020.html#119f57abfa3b1f77fd0514b26da6afb4">PTR_CACHE</a> u8_ptr_cluster;
<a name="l00610"></a>00610 
<a name="l00611"></a>00611    <span class="comment">//**** Compute the cluster position in FAT (sector address &amp; position in sector)</span>
<a name="l00612"></a>00612    <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#57a82f24a45a33a159e0362b7e82e3fa">Is_fat32</a> )
<a name="l00613"></a>00613    {
<a name="l00614"></a>00614       <span class="comment">// FAT 32</span>
<a name="l00615"></a>00615       <span class="comment">// Optimization of -&gt; u16_offset_fat = fs_g_cluster.pos * 4 / FS_CACHE_SIZE;</span>
<a name="l00616"></a>00616       <span class="comment">// Optimization of -&gt; u16_offset_fat = fs_g_cluster.pos / 128</span>
<a name="l00617"></a>00617       u16_offset_fat = <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a> &gt;&gt; (8-1);
<a name="l00618"></a>00618 
<a name="l00619"></a>00619       <span class="comment">// Optimization of -&gt; fs_g_u16_pos_fat = (fs_g_cluster.u32_pos * 4) % FS_CACHE_SIZE;</span>
<a name="l00620"></a>00620       <span class="comment">// Optimization of -&gt; fs_g_u16_pos_fat = (fs_g_cluster.u32_pos % 128) * 4</span>
<a name="l00621"></a>00621       <a class="code" href="a00019.html#87e7f1f24baa43d2924a1c55a0b3f76c">fs_g_u16_pos_fat</a> = ((U16)(LSB0(<a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a>) &amp; 0x7F))&lt;&lt; 2;
<a name="l00622"></a>00622    }
<a name="l00623"></a>00623    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#2dcd74d640da1e20ad510413c9ef4c85">Is_fat16</a> )
<a name="l00624"></a>00624    {
<a name="l00625"></a>00625       <span class="comment">// FAT 16</span>
<a name="l00626"></a>00626       <span class="comment">// Optimization of -&gt; u16_offset_fat = fs_g_cluster.u32_pos * 2 / FS_CACHE_SIZE = fs_g_cluster.u32_pos / 256;</span>
<a name="l00627"></a>00627       u16_offset_fat = LSB1(<a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a>);
<a name="l00628"></a>00628       <span class="comment">// Optimization of -&gt; fs_g_u16_pos_fat = (fs_g_cluster.u32_pos * 2) % FS_CACHE_SIZE;</span>
<a name="l00629"></a>00629       <span class="comment">// Optimization of -&gt; fs_g_u16_pos_fat = (fs_g_cluster.u32_pos % 256) * 2</span>
<a name="l00630"></a>00630       <a class="code" href="a00019.html#87e7f1f24baa43d2924a1c55a0b3f76c">fs_g_u16_pos_fat</a> = ((U16)LSB0(<a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a>)) &lt;&lt;1;
<a name="l00631"></a>00631    }
<a name="l00632"></a>00632    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#c2ce5473766316396fb472c1bdd685e9">Is_fat12</a> )
<a name="l00633"></a>00633    {
<a name="l00634"></a>00634       <span class="comment">// FAT 12</span>
<a name="l00635"></a>00635       <span class="comment">// Optimization of -&gt; fs_g_u16_pos_fat = fs_g_cluster.u32_pos + (fs_g_cluster.u32_pos/ 2)</span>
<a name="l00636"></a>00636       <a class="code" href="a00019.html#87e7f1f24baa43d2924a1c55a0b3f76c">fs_g_u16_pos_fat</a> = (U16)<a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a> + ((U16)<a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a> &gt;&gt;1);
<a name="l00637"></a>00637       <span class="comment">// Optimization of -&gt; u16_offset_fat = fs_g_cluster.u32_pos / FS_CACHE_SIZE</span>
<a name="l00638"></a>00638       u16_offset_fat = MSB(<a class="code" href="a00019.html#87e7f1f24baa43d2924a1c55a0b3f76c">fs_g_u16_pos_fat</a>) &gt;&gt; 1;
<a name="l00639"></a>00639       <span class="comment">// Optimization of -&gt; fs_g_u16_pos_fat = fs_g_u16_pos_fat % FS_CACHE_SIZE</span>
<a name="l00640"></a>00640       MSB( <a class="code" href="a00019.html#87e7f1f24baa43d2924a1c55a0b3f76c">fs_g_u16_pos_fat</a> ) &amp;= 0x01;
<a name="l00641"></a>00641    }
<a name="l00642"></a>00642 
<a name="l00643"></a>00643 <span class="preprocessor">#if (FS_LEVEL_FEATURES &gt; FSFEATURE_READ)</span>
<a name="l00644"></a>00644 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (b_mode)
<a name="l00645"></a>00645    {
<a name="l00646"></a>00646       <span class="comment">// Update information about FAT modification</span>
<a name="l00647"></a>00647       <span class="keywordflow">if</span>( <a class="code" href="a00020.html#b55b94c50b63cf8b83e2afcf2e0c2981" title="Offset (unit 512B) in fat of the first sector (unit 512B).">fs_g_u16_first_mod_fat</a> &gt; u16_offset_fat )
<a name="l00648"></a>00648       {
<a name="l00649"></a>00649          <a class="code" href="a00020.html#b55b94c50b63cf8b83e2afcf2e0c2981" title="Offset (unit 512B) in fat of the first sector (unit 512B).">fs_g_u16_first_mod_fat</a> = u16_offset_fat;
<a name="l00650"></a>00650       }
<a name="l00651"></a>00651       <span class="keywordflow">if</span>( <a class="code" href="a00020.html#e8c6fce6d75eb9ddbf1e63e46659e9cc" title="Offset (unit 512B) in fat of the last sector (unit 512B).">fs_g_u16_last_mod_fat</a> &lt; u16_offset_fat )
<a name="l00652"></a>00652       {
<a name="l00653"></a>00653          <a class="code" href="a00020.html#e8c6fce6d75eb9ddbf1e63e46659e9cc" title="Offset (unit 512B) in fat of the last sector (unit 512B).">fs_g_u16_last_mod_fat</a> = u16_offset_fat;
<a name="l00654"></a>00654       }
<a name="l00655"></a>00655       <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#c2ce5473766316396fb472c1bdd685e9">Is_fat12</a> )
<a name="l00656"></a>00656       {  <span class="comment">// A cluster may be stored on two sectors</span>
<a name="l00657"></a>00657          <span class="keywordflow">if</span>( <a class="code" href="a00019.html#87e7f1f24baa43d2924a1c55a0b3f76c">fs_g_u16_pos_fat</a> == (<a class="code" href="a00020.html#1f24fc24a15f2e52ecae58ae2d5dfbfc">FS_CACHE_SIZE</a>-1) )
<a name="l00658"></a>00658          {  <span class="comment">// Count the next FAT sector</span>
<a name="l00659"></a>00659             <span class="keywordflow">if</span>( <a class="code" href="a00020.html#e8c6fce6d75eb9ddbf1e63e46659e9cc" title="Offset (unit 512B) in fat of the last sector (unit 512B).">fs_g_u16_last_mod_fat</a> &lt; (u16_offset_fat+1) )
<a name="l00660"></a>00660             {
<a name="l00661"></a>00661                <a class="code" href="a00020.html#e8c6fce6d75eb9ddbf1e63e46659e9cc" title="Offset (unit 512B) in fat of the last sector (unit 512B).">fs_g_u16_last_mod_fat</a> = (u16_offset_fat+1);
<a name="l00662"></a>00662             }
<a name="l00663"></a>00663          }
<a name="l00664"></a>00664       }
<a name="l00665"></a>00665    }
<a name="l00666"></a>00666 <span class="preprocessor">#endif  // FS_LEVEL_FEATURES</span>
<a name="l00667"></a>00667 <span class="preprocessor"></span>
<a name="l00668"></a>00668    <span class="comment">//**** Read cluster sector in FAT</span>
<a name="l00669"></a>00669    <a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a> = <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#af1d8fda28bded48a54c7eab4d729618" title="FAT address (unit 512B).">u32_ptr_fat</a> + u16_offset_fat;   <span class="comment">// Computed logical sector address</span>
<a name="l00670"></a>00670    <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#a67dc439478853cefdd226f9c99c9539" title="This function loads a memory sector in internal cache sector.">fat_cache_read_sector</a>( TRUE ))
<a name="l00671"></a>00671       <span class="keywordflow">return</span> FALSE;
<a name="l00672"></a>00672 
<a name="l00673"></a>00673    <span class="comment">// Read cluster information</span>
<a name="l00674"></a>00674    u8_ptr_cluster = &amp;<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00019.html#87e7f1f24baa43d2924a1c55a0b3f76c">fs_g_u16_pos_fat</a>];
<a name="l00675"></a>00675    u8_data1 = u8_ptr_cluster[0];
<a name="l00676"></a>00676    <span class="comment">// Remark: if (fs_g_u16_pos_fat+1)=512 then it isn't a mistake, because this value will be erase in next lines</span>
<a name="l00677"></a>00677    u8_data2 = u8_ptr_cluster[1];
<a name="l00678"></a>00678    <a class="code" href="a00019.html#6b0f192ee05f7d19f1372a8a1fb514bc">u8_data3</a> = u8_ptr_cluster[2];
<a name="l00679"></a>00679    <a class="code" href="a00019.html#4d26b9400e3057b9cfde8d083a0049e6">u8_data4</a> = u8_ptr_cluster[3];
<a name="l00680"></a>00680 
<a name="l00681"></a>00681    <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#c2ce5473766316396fb472c1bdd685e9">Is_fat12</a> )
<a name="l00682"></a>00682    {   <span class="comment">// A cluster may be stored on two sectors</span>
<a name="l00683"></a>00683       <span class="keywordflow">if</span>(  <a class="code" href="a00019.html#87e7f1f24baa43d2924a1c55a0b3f76c">fs_g_u16_pos_fat</a> == (<a class="code" href="a00020.html#1f24fc24a15f2e52ecae58ae2d5dfbfc">FS_CACHE_SIZE</a>-1) )
<a name="l00684"></a>00684       {  <span class="comment">// Go to next sector</span>
<a name="l00685"></a>00685          <a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a>++;
<a name="l00686"></a>00686          <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#a67dc439478853cefdd226f9c99c9539" title="This function loads a memory sector in internal cache sector.">fat_cache_read_sector</a>( TRUE ))
<a name="l00687"></a>00687            <span class="keywordflow">return</span> FALSE;
<a name="l00688"></a>00688          u8_data2 = <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[0];
<a name="l00689"></a>00689       }
<a name="l00690"></a>00690    }
<a name="l00691"></a>00691 
<a name="l00692"></a>00692    <span class="keywordflow">if</span> (FALSE == b_mode)
<a name="l00693"></a>00693    {
<a name="l00694"></a>00694       <span class="comment">//**** Read the cluster value</span>
<a name="l00695"></a>00695       LSB0( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> ) = u8_data1;  <span class="comment">// FAT 12,16,32</span>
<a name="l00696"></a>00696       LSB1( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> ) = u8_data2;  <span class="comment">// FAT 12,16,32</span>
<a name="l00697"></a>00697 
<a name="l00698"></a>00698       <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#57a82f24a45a33a159e0362b7e82e3fa">Is_fat32</a> )
<a name="l00699"></a>00699       {  <span class="comment">// FAT 32</span>
<a name="l00700"></a>00700          LSB2( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> ) = <a class="code" href="a00019.html#6b0f192ee05f7d19f1372a8a1fb514bc">u8_data3</a>;
<a name="l00701"></a>00701          LSB3( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> ) = <a class="code" href="a00019.html#4d26b9400e3057b9cfde8d083a0049e6">u8_data4</a> &amp; 0x0F; <span class="comment">// The high 4 bits are reserved</span>
<a name="l00702"></a>00702       }
<a name="l00703"></a>00703       <span class="keywordflow">else</span>
<a name="l00704"></a>00704       {  <span class="comment">// FAT 12 &amp; 16 don't use the high bytes</span>
<a name="l00705"></a>00705          LSB2( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> ) = 0;
<a name="l00706"></a>00706          LSB3( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> ) = 0;
<a name="l00707"></a>00707 
<a name="l00708"></a>00708          <span class="comment">// FAT 12 translate 16bits value to 12bits</span>
<a name="l00709"></a>00709          <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#c2ce5473766316396fb472c1bdd685e9">Is_fat12</a> )
<a name="l00710"></a>00710          {
<a name="l00711"></a>00711             <span class="keywordflow">if</span> ( 0x01 &amp; LSB0(<a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a>) )
<a name="l00712"></a>00712             {  <span class="comment">// Readed cluster is ODD</span>
<a name="l00713"></a>00713                LSB0( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> ) = (LSB1( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> ) &lt;&lt;4 ) + (LSB0( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> ) &gt;&gt;4 );
<a name="l00714"></a>00714                LSB1( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> ) =  LSB1( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> ) &gt;&gt;4 ;
<a name="l00715"></a>00715             }
<a name="l00716"></a>00716             <span class="keywordflow">else</span>
<a name="l00717"></a>00717             {  <span class="comment">// Readed cluster is EVEN</span>
<a name="l00718"></a>00718                LSB1( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> ) &amp;= 0x0F;
<a name="l00719"></a>00719             }
<a name="l00720"></a>00720          }
<a name="l00721"></a>00721       }
<a name="l00722"></a>00722    } <span class="keywordflow">else</span> {
<a name="l00723"></a>00723 <span class="preprocessor">#if (FS_LEVEL_FEATURES &gt; FSFEATURE_READ)</span>
<a name="l00724"></a>00724 <span class="preprocessor"></span>      <span class="comment">//**** Write the cluster value</span>
<a name="l00725"></a>00725       <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#c2ce5473766316396fb472c1bdd685e9">Is_fat12</a> )
<a name="l00726"></a>00726       {
<a name="l00727"></a>00727          <span class="comment">// FAT 12, translate cluster value</span>
<a name="l00728"></a>00728          <span class="keywordflow">if</span> ( 0x01 &amp; LSB0(<a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a>) )
<a name="l00729"></a>00729          {  <span class="comment">// Cluster writing is ODD</span>
<a name="l00730"></a>00730             u8_data1 = (u8_data1 &amp; 0x0F) + (LSB0( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> )&lt;&lt;4);
<a name="l00731"></a>00731             u8_data2 = (LSB1( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> )&lt;&lt;4) + (LSB0( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> )&gt;&gt;4) ;
<a name="l00732"></a>00732          } <span class="keywordflow">else</span> {
<a name="l00733"></a>00733             <span class="comment">// Cluster writing is EVEN</span>
<a name="l00734"></a>00734             u8_data1 = LSB0( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> );
<a name="l00735"></a>00735             u8_data2 = (u8_data2 &amp; 0xF0) + (LSB1( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> ) &amp; 0x0F) ;
<a name="l00736"></a>00736          }
<a name="l00737"></a>00737 
<a name="l00738"></a>00738          <span class="comment">// A cluster may be stored on two sectors</span>
<a name="l00739"></a>00739          <span class="keywordflow">if</span>( <a class="code" href="a00019.html#87e7f1f24baa43d2924a1c55a0b3f76c">fs_g_u16_pos_fat</a> == (<a class="code" href="a00020.html#1f24fc24a15f2e52ecae58ae2d5dfbfc">FS_CACHE_SIZE</a>-1) )
<a name="l00740"></a>00740          {
<a name="l00741"></a>00741             <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[0] = u8_data2;
<a name="l00742"></a>00742             <a class="code" href="a00019.html#45c0f16885c9e414ddb4b5afaa1cde34" title="This function sets a flag to signal that sector cache is modified.">fat_cache_mark_sector_as_dirty</a>();
<a name="l00743"></a>00743             <span class="comment">// Go to previous sector</span>
<a name="l00744"></a>00744             <a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a>--;
<a name="l00745"></a>00745             <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#a67dc439478853cefdd226f9c99c9539" title="This function loads a memory sector in internal cache sector.">fat_cache_read_sector</a>( TRUE ))
<a name="l00746"></a>00746               <span class="keywordflow">return</span> FALSE;
<a name="l00747"></a>00747             <span class="comment">// Modify the previous sector</span>
<a name="l00748"></a>00748             <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[ <a class="code" href="a00020.html#1f24fc24a15f2e52ecae58ae2d5dfbfc">FS_CACHE_SIZE</a>-1 ] = u8_data1;
<a name="l00749"></a>00749             <a class="code" href="a00019.html#45c0f16885c9e414ddb4b5afaa1cde34" title="This function sets a flag to signal that sector cache is modified.">fat_cache_mark_sector_as_dirty</a>();
<a name="l00750"></a>00750             <span class="keywordflow">return</span> TRUE;
<a name="l00751"></a>00751          }
<a name="l00752"></a>00752       }
<a name="l00753"></a>00753       <span class="keywordflow">else</span>
<a name="l00754"></a>00754       {
<a name="l00755"></a>00755          <span class="comment">// FAT 16 &amp; 32</span>
<a name="l00756"></a>00756          u8_data1 = LSB0( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> );
<a name="l00757"></a>00757          u8_data2 = LSB1( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> );
<a name="l00758"></a>00758          <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#57a82f24a45a33a159e0362b7e82e3fa">Is_fat32</a> )
<a name="l00759"></a>00759          {  <span class="comment">// FAT 32</span>
<a name="l00760"></a>00760             u8_ptr_cluster[2] = LSB2( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> );
<a name="l00761"></a>00761             u8_ptr_cluster[3] = LSB3( <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> ) + (<a class="code" href="a00019.html#4d26b9400e3057b9cfde8d083a0049e6">u8_data4</a> &amp; 0xF0); <span class="comment">// The high 4 bits are reserved</span>
<a name="l00762"></a>00762          }
<a name="l00763"></a>00763       }
<a name="l00764"></a>00764       <span class="comment">// Here for FAT 32, 16 &amp; 12 (only if the cluster values are in the same sector)</span>
<a name="l00765"></a>00765       u8_ptr_cluster[0] = u8_data1;
<a name="l00766"></a>00766       u8_ptr_cluster[1] = u8_data2;
<a name="l00767"></a>00767       <a class="code" href="a00019.html#45c0f16885c9e414ddb4b5afaa1cde34" title="This function sets a flag to signal that sector cache is modified.">fat_cache_mark_sector_as_dirty</a>();
<a name="l00768"></a>00768 <span class="preprocessor">#else</span>
<a name="l00769"></a>00769 <span class="preprocessor"></span>      <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#d85516645a3ffadb77b948fd6d5bcb08" title="This command is not supported.">FS_ERR_COMMAND</a>;
<a name="l00770"></a>00770       <span class="keywordflow">return</span> FALSE;
<a name="l00771"></a>00771 <span class="preprocessor">#endif  // FS_LEVEL_FEATURES</span>
<a name="l00772"></a>00772 <span class="preprocessor"></span>   }
<a name="l00773"></a>00773 
<a name="l00774"></a>00774    <span class="keywordflow">return</span> TRUE;
<a name="l00775"></a>00775 <span class="preprocessor">#undef  u8_data3    // end of Manual overlay</span>
<a name="l00776"></a>00776 <span class="preprocessor"></span><span class="preprocessor">#undef  u8_data4    // end of Manual overlay</span>
<a name="l00777"></a>00777 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="1d133b71ef98fe5945a358bf46680504"></a><!-- doxytag: member="fat.h::fat_copy_nav" ref="1d133b71ef98fe5945a358bf46680504" args="(U8 u8_idnav)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fat_copy_nav           </td>
          <td>(</td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>u8_idnav</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function copys the main navigator to another navigator. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>u8_idnav</em>&nbsp;</td><td>Id navigator to fill </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="a00050.html#l01994">1994</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00051.html#l00394">fs_g_nav</a>, <a class="el" href="a00051.html#l00396">fs_g_nav_entry</a>, <a class="el" href="a00051.html#l00395">fs_g_nav_fast</a>, <a class="el" href="a00050.html#l00060">fs_g_navext</a>, <a class="el" href="a00050.html#l00062">fs_g_navext_entry</a>, <a class="el" href="a00050.html#l00061">fs_g_navext_fast</a>, and <a class="el" href="a00051.html#l00302">Fs_management_entry::u8_open_mode</a>.</p>

<p>Referenced by <a class="el" href="a00067.html#l00281">nav_copy()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01995"></a>01995 {
<a name="l01996"></a>01996    <span class="keywordflow">if</span>( 0 != u8_idnav)
<a name="l01997"></a>01997    {
<a name="l01998"></a>01998       u8_idnav--;
<a name="l01999"></a>01999       memcpy_ram2ram((U8*)&amp;<a class="code" href="a00019.html#0d59a916e72039fa7f898cd233f8fe2f">fs_g_navext</a>[u8_idnav],       (U8*)&amp;<a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>       , <span class="keyword">sizeof</span>(<a class="code" href="a00004.html" title="Struture to save the variables frequently used by file system mounted.">Fs_management</a>) );
<a name="l02000"></a>02000       memcpy_ram2ram((U8*)&amp;<a class="code" href="a00019.html#90e0163ac7f98f08019dc0b73fd7c834">fs_g_navext_entry</a>[u8_idnav], (U8*)&amp;<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a> , <span class="keyword">sizeof</span>(<a class="code" href="a00005.html" title="Struture to save the frequently variables of file system mounted.">Fs_management_entry</a>) );
<a name="l02001"></a>02001       memcpy_ram2ram((U8*)&amp;<a class="code" href="a00019.html#d24195746b40d4a83dff493c118b91aa">fs_g_navext_fast</a>[u8_idnav],  (U8*)&amp;<a class="code" href="a00020.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>  , <span class="keyword">sizeof</span>(<a class="code" href="a00006.html" title="Struture to save the variables very frequently used by file system mounted.">Fs_management_fast</a>) );
<a name="l02002"></a>02002       <a class="code" href="a00019.html#90e0163ac7f98f08019dc0b73fd7c834">fs_g_navext_entry</a>[u8_idnav].<a class="code" href="a00005.html#316b7df1bf2c7e55453f17ad00290447" title="open mode of selected file">u8_open_mode</a>=0;   <span class="comment">// Clear open file flag</span>
<a name="l02003"></a>02003    }
<a name="l02004"></a>02004 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="da2110d711208b46e93eb269da40bdf1"></a><!-- doxytag: member="fat.h::fat_create_entry_file_name" ref="da2110d711208b46e93eb269da40bdf1" args="(FS_STRING sz_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_create_entry_file_name           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a>&nbsp;</td>
          <td class="paramname"> <em>sz_name</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function creates the short and the long name of a new entry. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sz_name</em>&nbsp;</td><td>name to create (ASCII or UNICODE)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE in case of error, see global value "fs_g_status" for more detail <p>
TRUE otherwise</dd></dl>
<div class="fragment"><pre class="fragment">
//! IN:
//! b_unicode is a global flag to select UNICODE or ASCII
//! The name must be terminated by NULL and it can't have two dot characters.
//! </pre></div> 
<p>Definition at line <a class="el" href="a00052.html#l01500">1500</a> of file <a class="el" href="a00052.html">fat_unusual.c</a>.</p>

<p>References <a class="el" href="a00052.html#l01921">fat_alloc_entry_free()</a>, <a class="el" href="a00052.html#l01838">fat_check_name()</a>, <a class="el" href="a00052.html#l01558">fat_create_long_name_entry()</a>, <a class="el" href="a00052.html#l01633">fat_create_short_entry_name()</a>, <a class="el" href="a00052.html#l01768">fat_find_short_entry_name()</a>, <a class="el" href="a00050.html#l01195">fat_read_dir()</a>, <a class="el" href="a00051.html#l00191">FS_ENTRY_LFN_LAST</a>, <a class="el" href="a00055.html#l00231">FS_ERR_FILE_EXIST</a>, <a class="el" href="a00051.html#l00395">fs_g_nav_fast</a>, <a class="el" href="a00055.html#l00256">fs_g_status</a>, <a class="el" href="a00051.html#l00199">FS_SIZE_LFN_ENTRY</a>, <a class="el" href="a00051.html#l00092">Is_unicode</a>, and <a class="el" href="a00051.html#l00296">Fs_management_fast::u16_entry_pos_sel_file</a>.</p>

<p>Referenced by <a class="el" href="a00067.html#l02156">nav_file_create()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01500"></a>01500 {
<a name="l01501"></a>01501    U8 u8_i, u8_nb;
<a name="l01502"></a>01502    U8 u8_crc, u8_nb_entry;
<a name="l01503"></a>01503 
<a name="l01504"></a>01504    <span class="comment">// Compute the number of entry for this name</span>
<a name="l01505"></a>01505    u8_nb_entry = <a class="code" href="a00021.html#8849a8388de3f116fd53fd9ec07747b2" title="This function checks the character in name AND computes the number of entry file...">fat_check_name</a>( sz_name  );
<a name="l01506"></a>01506    <span class="keywordflow">if</span>( 0 == u8_nb_entry )
<a name="l01507"></a>01507       <span class="keywordflow">return</span> FALSE;
<a name="l01508"></a>01508 
<a name="l01509"></a>01509    <span class="comment">// Search a unik short entry</span>
<a name="l01510"></a>01510    u8_nb = <a class="code" href="a00021.html#24d01b29254a31c7b331935fd8288037" title="This function searchs an unique short name.">fat_find_short_entry_name</a>( sz_name  );
<a name="l01511"></a>01511    <span class="keywordflow">if</span>( 0 == u8_nb )
<a name="l01512"></a>01512    {
<a name="l01513"></a>01513       <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#620feae4af460b0f591356b6408e7b45" title="The file is already existed.">FS_ERR_FILE_EXIST</a>;
<a name="l01514"></a>01514       <span class="keywordflow">return</span> FALSE;  <span class="comment">// All short name exist</span>
<a name="l01515"></a>01515    }
<a name="l01516"></a>01516    
<a name="l01517"></a>01517    <span class="comment">// Alloc a space for entrys</span>
<a name="l01518"></a>01518    <span class="keywordflow">if</span>( !<a class="code" href="a00021.html#a2b4dadfd961b4547fd67f7ebe8a5c5d" title="This function allocs a number of entry in a current directory.">fat_alloc_entry_free</a>( u8_nb_entry ))
<a name="l01519"></a>01519       <span class="keywordflow">return</span> FALSE;
<a name="l01520"></a>01520    <span class="comment">// Remark: here the pointer of entry is on the last free entry of new space allocated</span>
<a name="l01521"></a>01521 
<a name="l01522"></a>01522    <span class="comment">// Add short name entry</span>
<a name="l01523"></a>01523    u8_crc = <a class="code" href="a00021.html#49163f06665633236c432aa1a1163f01" title="This function creates a short name in the internal cache sector OR in a string.">fat_create_short_entry_name</a>( sz_name , 0 , u8_nb, FALSE  );
<a name="l01524"></a>01524    u8_nb_entry--;
<a name="l01525"></a>01525 
<a name="l01526"></a>01526    <span class="comment">// For each long name entry</span>
<a name="l01527"></a>01527    <span class="keywordflow">for</span>( u8_i=1 ; u8_i&lt;=u8_nb_entry ; u8_i++ )
<a name="l01528"></a>01528    {
<a name="l01529"></a>01529       <span class="comment">// Go to previous entry</span>
<a name="l01530"></a>01530       <a class="code" href="a00020.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00006.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a>--;
<a name="l01531"></a>01531       <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#1a35321a99150ba643f87cb6c79ec3e5" title="This function fill the internal cache with a sector from current directory.">fat_read_dir</a>())
<a name="l01532"></a>01532          <span class="keywordflow">return</span> FALSE;
<a name="l01533"></a>01533       <span class="comment">// Write a long name entry</span>
<a name="l01534"></a>01534       <span class="keywordflow">if</span>( u8_i == u8_nb_entry )
<a name="l01535"></a>01535       {
<a name="l01536"></a>01536          u8_i += <a class="code" href="a00020.html#bf0fa999d28907c3742656b6407aca78">FS_ENTRY_LFN_LAST</a>;
<a name="l01537"></a>01537       }
<a name="l01538"></a>01538       <a class="code" href="a00021.html#70a6be69645d22685e0ec6b52b93d9b2" title="This function creates a long name entry.">fat_create_long_name_entry</a>( sz_name , u8_crc , u8_i );
<a name="l01539"></a>01539       sz_name += <a class="code" href="a00020.html#bbdca2b90701f373bf6c865c88c99697">FS_SIZE_LFN_ENTRY</a>*(<a class="code" href="a00020.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>? 2 : 1 );
<a name="l01540"></a>01540   }
<a name="l01541"></a>01541   <span class="comment">// Go back to the short name entry</span>
<a name="l01542"></a>01542   <a class="code" href="a00020.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00006.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a> += u8_nb_entry;
<a name="l01543"></a>01543   <span class="keywordflow">return</span> TRUE;
<a name="l01544"></a>01544 }
<a name="l01545"></a>01545 
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="797fc629a4a513e6a5f2951720da5d47"></a><!-- doxytag: member="fat.h::fat_delete_file" ref="797fc629a4a513e6a5f2951720da5d47" args="(Bool b_cluster_list)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_delete_file           </td>
          <td>(</td>
          <td class="paramtype">Bool&nbsp;</td>
          <td class="paramname"> <em>b_cluster_list</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function deletes the file entries and cluster list. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>b_cluster_list</em>&nbsp;</td><td>TRUE, delete file entries and cluster list FALSE, delete only file entries</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE in case of error, see global value "fs_g_status" for more detail <p>
TRUE otherwise </dd></dl>

<p>Definition at line <a class="el" href="a00052.html#l02074">2074</a> of file <a class="el" href="a00052.html">fat_unusual.c</a>.</p>

<p>References <a class="el" href="a00050.html#l01848">fat_cache_mark_sector_as_dirty()</a>, <a class="el" href="a00050.html#l01773">fat_get_ptr_entry()</a>, <a class="el" href="a00050.html#l01195">fat_read_dir()</a>, <a class="el" href="a00050.html#l01035">fat_read_file()</a>, <a class="el" href="a00055.html#l00134">FS_ATTR_LFN_ENTRY</a>, <a class="el" href="a00051.html#l00241">FS_CLUST_ACT_CLR</a>, <a class="el" href="a00051.html#l00190">FS_ENTRY_DEL</a>, <a class="el" href="a00051.html#l00191">FS_ENTRY_LFN_LAST</a>, <a class="el" href="a00051.html#l00396">fs_g_nav_entry</a>, <a class="el" href="a00051.html#l00395">fs_g_nav_fast</a>, <a class="el" href="a00051.html#l00296">Fs_management_fast::u16_entry_pos_sel_file</a>, and <a class="el" href="a00051.html#l00307">Fs_management_entry::u32_pos_in_file</a>.</p>

<p>Referenced by <a class="el" href="a00067.html#l01361">nav_dir_make()</a>, <a class="el" href="a00067.html#l02016">nav_file_del()</a>, and <a class="el" href="a00067.html#l02096">nav_file_rename()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l02074"></a>02074 {
<a name="l02075"></a>02075    <a class="code" href="a00020.html#119f57abfa3b1f77fd0514b26da6afb4">PTR_CACHE</a> ptr_entry;
<a name="l02076"></a>02076    U8 u8_tmp;
<a name="l02077"></a>02077    Bool b_short_del = FALSE;
<a name="l02078"></a>02078 
<a name="l02079"></a>02079    <span class="comment">// loop in directory</span>
<a name="l02080"></a>02080    <span class="keywordflow">while</span>( 1 )
<a name="l02081"></a>02081    {
<a name="l02082"></a>02082       <span class="comment">// Fill internal cache with a sector from directory</span>
<a name="l02083"></a>02083       <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#1a35321a99150ba643f87cb6c79ec3e5" title="This function fill the internal cache with a sector from current directory.">fat_read_dir</a>() )
<a name="l02084"></a>02084          <span class="keywordflow">return</span> FALSE;
<a name="l02085"></a>02085 
<a name="l02086"></a>02086       <span class="comment">// Get pointer on the current entry</span>
<a name="l02087"></a>02087       ptr_entry = <a class="code" href="a00019.html#0c24a717d004b7194e2c566522348fd5" title="This function returns a cache pointer on the current entry.">fat_get_ptr_entry</a>();
<a name="l02088"></a>02088       u8_tmp = ptr_entry[0];
<a name="l02089"></a>02089 
<a name="l02090"></a>02090       <span class="keywordflow">if</span>( (<a class="code" href="a00024.html#1aa64d79e89a455b62036d2230fd718d">FS_ATTR_LFN_ENTRY</a> != ptr_entry[11])
<a name="l02091"></a>02091       &amp;&amp;  (b_short_del) )
<a name="l02092"></a>02092       {
<a name="l02093"></a>02093          <span class="comment">// no long entry exist, then only a short entry to delete</span>
<a name="l02094"></a>02094          <span class="keywordflow">break</span>;   <span class="comment">// Go to delete cluster list</span>
<a name="l02095"></a>02095       }
<a name="l02096"></a>02096 
<a name="l02097"></a>02097       <span class="comment">// Delete entry</span>
<a name="l02098"></a>02098       b_short_del = TRUE;
<a name="l02099"></a>02099       ptr_entry[0] = <a class="code" href="a00020.html#303c1237fa5a61ddc015c0365eedd008">FS_ENTRY_DEL</a>;
<a name="l02100"></a>02100       <a class="code" href="a00019.html#45c0f16885c9e414ddb4b5afaa1cde34" title="This function sets a flag to signal that sector cache is modified.">fat_cache_mark_sector_as_dirty</a>();
<a name="l02101"></a>02101 
<a name="l02102"></a>02102       <span class="keywordflow">if</span>( (<a class="code" href="a00024.html#1aa64d79e89a455b62036d2230fd718d">FS_ATTR_LFN_ENTRY</a> == ptr_entry[11])
<a name="l02103"></a>02103       &amp;&amp;  ( 0 != (<a class="code" href="a00020.html#bf0fa999d28907c3742656b6407aca78">FS_ENTRY_LFN_LAST</a> &amp; u8_tmp)) )
<a name="l02104"></a>02104       {
<a name="l02105"></a>02105          <span class="comment">// It is the last entry of long name</span>
<a name="l02106"></a>02106          <span class="keywordflow">break</span>;   <span class="comment">// Go to delete cluster list</span>
<a name="l02107"></a>02107       }
<a name="l02108"></a>02108 
<a name="l02109"></a>02109       <span class="comment">// Go to previous entry</span>
<a name="l02110"></a>02110       <a class="code" href="a00020.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00006.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a>--;
<a name="l02111"></a>02111    }  <span class="comment">// end of while(1)</span>
<a name="l02112"></a>02112 
<a name="l02113"></a>02113    <span class="keywordflow">if</span>( b_cluster_list )
<a name="l02114"></a>02114    {
<a name="l02115"></a>02115       <span class="comment">// Delete cluster list</span>
<a name="l02116"></a>02116       <a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#1e1dae249ae6839c1b8cce0fecbbf7af" title="Current position in file (unit Bytes).">u32_pos_in_file</a>=0;      <span class="comment">// Delete ALL list (start at begining)</span>
<a name="l02117"></a>02117       <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#d8c9c9a63c821e8cea06c340c029668d" title="This function gets or clears a cluster list at the current position in the selected...">fat_read_file</a>( <a class="code" href="a00020.html#b314d14ba33772e9bcbae993a8d17e9f">FS_CLUST_ACT_CLR</a> ))
<a name="l02118"></a>02118          <span class="keywordflow">return</span> FALSE;
<a name="l02119"></a>02119    }
<a name="l02120"></a>02120 
<a name="l02121"></a>02121    <span class="keywordflow">return</span> TRUE;
<a name="l02122"></a>02122 }
<a name="l02123"></a>02123 <span class="preprocessor">#endif  // FS_LEVEL_FEATURES</span>
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="ef13c743905d7e0381b3a461da2ebd7a"></a><!-- doxytag: member="fat.h::fat_entry_check" ref="ef13c743905d7e0381b3a461da2ebd7a" args="(Bool b_type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_entry_check           </td>
          <td>(</td>
          <td class="paramtype">Bool&nbsp;</td>
          <td class="paramname"> <em>b_type</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function checks the entry. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>b_type</em>&nbsp;</td><td>entry type to compare (FS_FILE or FS_DIR)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>TRUE, the entry is a short entry and correspond to b_type <p>
FALSE, otherwise</dd></dl>
<div class="fragment"><pre class="fragment">
//! Global variable used
//! IN :
//!   fs_g_sector       The directory sector corresponding at the current position
//!   fs_g_nav_fast.u16_entry_pos_sel_file    Position in directory of the entry file (unit entry)
//! </pre></div> 
<p>Definition at line <a class="el" href="a00050.html#l01243">1243</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00050.html#l01773">fat_get_ptr_entry()</a>, <a class="el" href="a00055.html#l00132">FS_ATTR_DIRECTORY</a>, <a class="el" href="a00055.html#l00131">FS_ATTR_VOLUME_ID</a>, <a class="el" href="a00055.html#l00116">FS_DIR</a>, <a class="el" href="a00051.html#l00190">FS_ENTRY_DEL</a>, <a class="el" href="a00051.html#l00189">FS_ENTRY_END</a>, <a class="el" href="a00055.html#l00200">FS_ERR_ENTRY_BAD</a>, <a class="el" href="a00055.html#l00199">FS_ERR_ENTRY_EMPTY</a>, <a class="el" href="a00055.html#l00115">FS_FILE</a>, and <a class="el" href="a00055.html#l00256">fs_g_status</a>.</p>

<p>Referenced by <a class="el" href="a00067.html#l00726">nav_filelist_set()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01244"></a>01244 {
<a name="l01245"></a>01245    <a class="code" href="a00020.html#119f57abfa3b1f77fd0514b26da6afb4">PTR_CACHE</a> u8_ptr_entry;
<a name="l01246"></a>01246    U8 u8_first_byte, u8_seconde_byte;
<a name="l01247"></a>01247    U8 u8_attribut;
<a name="l01248"></a>01248 
<a name="l01249"></a>01249    u8_ptr_entry = <a class="code" href="a00019.html#0c24a717d004b7194e2c566522348fd5" title="This function returns a cache pointer on the current entry.">fat_get_ptr_entry</a>();
<a name="l01250"></a>01250 
<a name="l01251"></a>01251    u8_first_byte = u8_ptr_entry[0];
<a name="l01252"></a>01252    <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#453bf57f059970b3ce13033b7959cb0c">FS_ENTRY_END</a> == u8_first_byte )
<a name="l01253"></a>01253    {
<a name="l01254"></a>01254       <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#33817136df196a5f0146574b4e1775b6" title="File entry empty.">FS_ERR_ENTRY_EMPTY</a>;   <span class="comment">// end of directory</span>
<a name="l01255"></a>01255       <span class="keywordflow">return</span> FALSE;
<a name="l01256"></a>01256    }
<a name="l01257"></a>01257    <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#934f48a8e1cb558d75ec00bbd242030d" title="File entry bad.">FS_ERR_ENTRY_BAD</a>;        <span class="comment">// by default BAD ENTRY</span>
<a name="l01258"></a>01258    <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#303c1237fa5a61ddc015c0365eedd008">FS_ENTRY_DEL</a> == u8_first_byte )      { <span class="keywordflow">return</span> FALSE;   } <span class="comment">// entry deleted</span>
<a name="l01259"></a>01259    <span class="keywordflow">if</span> (   <span class="charliteral">'.'</span>  == u8_first_byte )            { <span class="keywordflow">return</span> FALSE;   } <span class="comment">// current dir "."</span>
<a name="l01260"></a>01260    u8_seconde_byte = u8_ptr_entry[1];
<a name="l01261"></a>01261    <span class="keywordflow">if</span> ( (<span class="charliteral">'.'</span>  == u8_first_byte)
<a name="l01262"></a>01262    &amp;&amp;   (<span class="charliteral">'.'</span>  == u8_seconde_byte) )          { <span class="keywordflow">return</span> FALSE;   } <span class="comment">// current dir ".."</span>
<a name="l01263"></a>01263 
<a name="l01264"></a>01264    <span class="comment">// Check attribut</span>
<a name="l01265"></a>01265    u8_attribut = u8_ptr_entry[11];
<a name="l01266"></a>01266    <span class="keywordflow">if</span> ( <a class="code" href="a00024.html#4ed995c53b13fcf1694ae3ba6da61eba">FS_ATTR_VOLUME_ID</a> &amp; u8_attribut )    { <span class="keywordflow">return</span> FALSE;   } <span class="comment">// volume id</span>
<a name="l01267"></a>01267    <span class="comment">// Optimization, this line isn't necessary because the next test control this case</span>
<a name="l01268"></a>01268    <span class="comment">// if ( FS_ATTR_LFN_ENTRY == *u8_ptr_entry) { return FALSE;   } // long file name</span>
<a name="l01269"></a>01269 
<a name="l01270"></a>01270    <span class="comment">// Check entry type</span>
<a name="l01271"></a>01271    <span class="keywordflow">if</span>( <a class="code" href="a00024.html#99004e3e756391a7ac1c4dde4db6864c">FS_ATTR_DIRECTORY</a> &amp; u8_attribut )
<a name="l01272"></a>01272    {
<a name="l01273"></a>01273       <span class="keywordflow">return</span> (<a class="code" href="a00024.html#d043d9359eeca08e8c5ea4d9136eb15b">FS_DIR</a> == b_type);
<a name="l01274"></a>01274    }<span class="keywordflow">else</span>{
<a name="l01275"></a>01275       <span class="keywordflow">return</span> (<a class="code" href="a00024.html#20f0a7ade1270e3923abafeb33864c55">FS_FILE</a> == b_type);
<a name="l01276"></a>01276    }
<a name="l01277"></a>01277 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="d690d22df98e6c1fa927c38b1d1a0fae"></a><!-- doxytag: member="fat.h::fat_entry_checkext" ref="d690d22df98e6c1fa927c38b1d1a0fae" args="(FS_STRING sz_filter)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_entry_checkext           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a>&nbsp;</td>
          <td class="paramname"> <em>sz_filter</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function checks the file extension. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sz_filter</em>&nbsp;</td><td>extension filter is a ASCII string (ex: "mp3,w*" )</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>TRUE, the file name have a good extension <p>
FALSE, otherwise</dd></dl>
<div class="fragment"><pre class="fragment">
//! Global variable used
//! IN :
//!   fs_g_sector       The directory sector corresponding at the current position
//!   fs_g_nav_fast.u16_entry_pos_sel_file    Position in directory of the entry file (unit entry)
//! </pre></div> 
<p>Definition at line <a class="el" href="a00050.html#l01294">1294</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00050.html#l01773">fat_get_ptr_entry()</a>.</p>

<p>Referenced by <a class="el" href="a00067.html#l01905">nav_file_checkext()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01295"></a>01295 {
<a name="l01296"></a>01296    <a class="code" href="a00020.html#119f57abfa3b1f77fd0514b26da6afb4">PTR_CACHE</a> u8_ptr_entry;
<a name="l01297"></a>01297    U8 u8_i, u8_filter_char, u8_entry_char;
<a name="l01298"></a>01298 
<a name="l01299"></a>01299    u8_ptr_entry = <a class="code" href="a00019.html#0c24a717d004b7194e2c566522348fd5" title="This function returns a cache pointer on the current entry.">fat_get_ptr_entry</a>();
<a name="l01300"></a>01300 
<a name="l01301"></a>01301    <span class="comment">// Compare the extension with filter</span>
<a name="l01302"></a>01302    <span class="keywordflow">for</span>( u8_i=0 ; u8_i&lt;3 ; u8_i++)
<a name="l01303"></a>01303    {
<a name="l01304"></a>01304       u8_filter_char = *sz_filter;
<a name="l01305"></a>01305       <span class="keywordflow">if</span> (<span class="charliteral">'*'</span> == u8_filter_char)
<a name="l01306"></a>01306          <span class="keywordflow">break</span>; <span class="comment">// All extension is good</span>
<a name="l01307"></a>01307 
<a name="l01308"></a>01308       u8_entry_char = u8_ptr_entry[8+u8_i];
<a name="l01309"></a>01309 
<a name="l01310"></a>01310       <span class="comment">// Compare the extension filter to extension file (this one ignore the case)</span>
<a name="l01311"></a>01311       <span class="keywordflow">if</span>( (u8_filter_char!=  u8_entry_char     )
<a name="l01312"></a>01312       &amp;&amp;  (u8_filter_char!= (u8_entry_char+(<span class="charliteral">'a'</span>-<span class="charliteral">'A'</span>))) )
<a name="l01313"></a>01313       {
<a name="l01314"></a>01314          <span class="keywordflow">if</span> ( (<span class="charliteral">','</span> == u8_filter_char)
<a name="l01315"></a>01315          ||   ( 0  == u8_filter_char) )
<a name="l01316"></a>01316          {
<a name="l01317"></a>01317            <span class="comment">// It is the end of filter</span>
<a name="l01318"></a>01318            <span class="keywordflow">if</span> (<span class="charliteral">' '</span> == u8_entry_char)
<a name="l01319"></a>01319               <span class="keywordflow">break</span>; <span class="comment">// it is the end of extension file -&gt; extension good</span>
<a name="l01320"></a>01320          }
<a name="l01321"></a>01321          <span class="comment">// here, bad extension</span>
<a name="l01322"></a>01322 
<a name="l01323"></a>01323          <span class="comment">// Search the next filter</span>
<a name="l01324"></a>01324          <span class="keywordflow">while</span>( <span class="charliteral">','</span> != u8_filter_char )
<a name="l01325"></a>01325          {
<a name="l01326"></a>01326             <span class="keywordflow">if</span> (0  == u8_filter_char)
<a name="l01327"></a>01327             {
<a name="l01328"></a>01328                <span class="keywordflow">return</span> FALSE;   <span class="comment">// it is the last filter</span>
<a name="l01329"></a>01329             }
<a name="l01330"></a>01330             sz_filter++;
<a name="l01331"></a>01331             u8_filter_char = *sz_filter;
<a name="l01332"></a>01332          }
<a name="l01333"></a>01333          u8_i = 0xFF;          <span class="comment">// restart loop compare</span>
<a name="l01334"></a>01334       }
<a name="l01335"></a>01335       sz_filter++; <span class="comment">// go to next char of filter</span>
<a name="l01336"></a>01336    }
<a name="l01337"></a>01337 
<a name="l01338"></a>01338    <span class="keywordflow">return</span> TRUE; <span class="comment">// It is a good extension</span>
<a name="l01339"></a>01339 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="e0caae1c6e4a737af4ad0aa5d4171e79"></a><!-- doxytag: member="fat.h::fat_entry_is_dir" ref="e0caae1c6e4a737af4ad0aa5d4171e79" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_entry_is_dir           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function checks if the entry file is a directory. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>TRUE, this entry is a directory <p>
FALSE, otherwise </dd></dl>

<p>Definition at line <a class="el" href="a00050.html#l01385">1385</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00055.html#l00132">FS_ATTR_DIRECTORY</a>, <a class="el" href="a00055.html#l00202">FS_ERR_NO_DIR</a>, <a class="el" href="a00051.html#l00396">fs_g_nav_entry</a>, <a class="el" href="a00055.html#l00256">fs_g_status</a>, and <a class="el" href="a00051.html#l00304">Fs_management_entry::u8_attr</a>.</p>

<p>Referenced by <a class="el" href="a00067.html#l01189">nav_dir_cd()</a>, <a class="el" href="a00067.html#l01892">nav_file_isdir()</a>, and <a class="el" href="a00067.html#l01578">nav_setcwd()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01386"></a>01386 {
<a name="l01387"></a>01387    <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#4374de2d1b7c653404d71d049b963e10" title="The selected file isn&amp;#39;t a directory.">FS_ERR_NO_DIR</a>;
<a name="l01388"></a>01388    <span class="keywordflow">return</span> (<a class="code" href="a00024.html#99004e3e756391a7ac1c4dde4db6864c">FS_ATTR_DIRECTORY</a> &amp; <a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#c4f33191c9fd60c7520012bbe6005267" title="Attribut of the selected file.">u8_attr</a>);
<a name="l01389"></a>01389 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="a03d2728f28964e1eb4d78c2bb831718"></a><!-- doxytag: member="fat.h::fat_entry_label" ref="a03d2728f28964e1eb4d78c2bb831718" args="(Bool b_action, FS_STRING sz_label)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_entry_label           </td>
          <td>(</td>
          <td class="paramtype">Bool&nbsp;</td>
          <td class="paramname"> <em>b_action</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a>&nbsp;</td>
          <td class="paramname"> <em>sz_label</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function reads or writes a label in the partition. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>b_action</em>&nbsp;</td><td>choose action (FS_LABEL_READ or FS_LABEL_WRITE) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sz_label</em>&nbsp;</td><td>string ASCII to store label (11B min) or to get new label (11B max)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE in case of error, see global value "fs_g_status" for more detail <p>
TRUE otherwise </dd></dl>

<p>Definition at line <a class="el" href="a00052.html#l01088">1088</a> of file <a class="el" href="a00052.html">fat_unusual.c</a>.</p>

<p>References <a class="el" href="a00050.html#l01860">fat_cache_flush()</a>, <a class="el" href="a00050.html#l01848">fat_cache_mark_sector_as_dirty()</a>, <a class="el" href="a00050.html#l01773">fat_get_ptr_entry()</a>, <a class="el" href="a00055.html#l00131">FS_ATTR_VOLUME_ID</a>, <a class="el" href="a00051.html#l00189">FS_ENTRY_END</a>, <a class="el" href="a00055.html#l00200">FS_ERR_ENTRY_BAD</a>, <a class="el" href="a00055.html#l00199">FS_ERR_ENTRY_EMPTY</a>, <a class="el" href="a00055.html#l00211">FS_ERR_NAME_INCORRECT</a>, <a class="el" href="a00055.html#l00256">fs_g_status</a>, <a class="el" href="a00055.html#l00096">FS_LABEL_READ</a>, and <a class="el" href="a00055.html#l00097">FS_LABEL_WRITE</a>.</p>

<p>Referenced by <a class="el" href="a00067.html#l00529">nav_partition_label()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01088"></a>01088 {
<a name="l01089"></a>01089    <a class="code" href="a00020.html#119f57abfa3b1f77fd0514b26da6afb4">PTR_CACHE</a> ptr_entry;
<a name="l01090"></a>01090    U8 u8_pos_name;
<a name="l01091"></a>01091    U8 u8_char;
<a name="l01092"></a>01092 
<a name="l01093"></a>01093    ptr_entry = <a class="code" href="a00019.html#0c24a717d004b7194e2c566522348fd5" title="This function returns a cache pointer on the current entry.">fat_get_ptr_entry</a>();
<a name="l01094"></a>01094 
<a name="l01095"></a>01095    <span class="keywordflow">if</span>( <a class="code" href="a00024.html#c1570dd392605e8ff8f7d4cb16487830">FS_LABEL_READ</a> == b_action)
<a name="l01096"></a>01096    {
<a name="l01097"></a>01097       <span class="keywordflow">if</span>( <a class="code" href="a00020.html#453bf57f059970b3ce13033b7959cb0c">FS_ENTRY_END</a> == ptr_entry[0] )           <span class="comment">// end of directory</span>
<a name="l01098"></a>01098       {
<a name="l01099"></a>01099          <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#33817136df196a5f0146574b4e1775b6" title="File entry empty.">FS_ERR_ENTRY_EMPTY</a>;
<a name="l01100"></a>01100          <span class="keywordflow">return</span> FALSE;
<a name="l01101"></a>01101       }
<a name="l01102"></a>01102       <span class="keywordflow">if</span>( <a class="code" href="a00024.html#4ed995c53b13fcf1694ae3ba6da61eba">FS_ATTR_VOLUME_ID</a> != ptr_entry[11])      <span class="comment">// no system label</span>
<a name="l01103"></a>01103       {
<a name="l01104"></a>01104          <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#934f48a8e1cb558d75ec00bbd242030d" title="File entry bad.">FS_ERR_ENTRY_BAD</a>;
<a name="l01105"></a>01105          <span class="keywordflow">return</span> FALSE;
<a name="l01106"></a>01106       }
<a name="l01107"></a>01107       <span class="keywordflow">if</span>( NULL == sz_label )
<a name="l01108"></a>01108          <span class="keywordflow">return</span> TRUE;
<a name="l01109"></a>01109       <span class="keywordflow">for</span>( u8_pos_name=0; u8_pos_name&lt;11; u8_pos_name++ )
<a name="l01110"></a>01110       {
<a name="l01111"></a>01111          u8_char = *ptr_entry;
<a name="l01112"></a>01112          <span class="keywordflow">if</span>( 0x20 == u8_char )
<a name="l01113"></a>01113             u8_char = 0;
<a name="l01114"></a>01114          *sz_label = u8_char;
<a name="l01115"></a>01115          <span class="keywordflow">if</span>( 0 == u8_char )
<a name="l01116"></a>01116             <span class="keywordflow">return</span> TRUE;                           <span class="comment">// Label readed</span>
<a name="l01117"></a>01117          ptr_entry++;
<a name="l01118"></a>01118          sz_label++;
<a name="l01119"></a>01119       }
<a name="l01120"></a>01120       *sz_label = 0;
<a name="l01121"></a>01121       <span class="keywordflow">return</span> TRUE;
<a name="l01122"></a>01122    }
<a name="l01123"></a>01123 
<a name="l01124"></a>01124    <span class="keywordflow">if</span>( <a class="code" href="a00024.html#c5e191f04380ef238255929695f8efcb">FS_LABEL_WRITE</a> == b_action)
<a name="l01125"></a>01125    {
<a name="l01126"></a>01126       <span class="comment">// Autorize to write the label only on an empty entry or the system label entry</span>
<a name="l01127"></a>01127       <span class="keywordflow">if</span>( <a class="code" href="a00020.html#453bf57f059970b3ce13033b7959cb0c">FS_ENTRY_END</a> != ptr_entry[0] )           <span class="comment">// end of directory</span>
<a name="l01128"></a>01128       {
<a name="l01129"></a>01129          <span class="keywordflow">if</span>( <a class="code" href="a00024.html#4ed995c53b13fcf1694ae3ba6da61eba">FS_ATTR_VOLUME_ID</a> != ptr_entry[11])   <span class="comment">// no system label</span>
<a name="l01130"></a>01130          {
<a name="l01131"></a>01131             <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#934f48a8e1cb558d75ec00bbd242030d" title="File entry bad.">FS_ERR_ENTRY_BAD</a>;
<a name="l01132"></a>01132             <span class="keywordflow">return</span> FALSE;
<a name="l01133"></a>01133          }
<a name="l01134"></a>01134       }
<a name="l01135"></a>01135       <span class="keywordflow">if</span>( 0 == *sz_label )
<a name="l01136"></a>01136       {
<a name="l01137"></a>01137          <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#5ea145bbe1eb7413020b5e6b6f12a1ba" title="The name don&amp;#39;t corresponding at the filter name.">FS_ERR_NAME_INCORRECT</a>;
<a name="l01138"></a>01138          <span class="keywordflow">return</span> FALSE;
<a name="l01139"></a>01139       }
<a name="l01140"></a>01140       ptr_entry[11] = <a class="code" href="a00024.html#4ed995c53b13fcf1694ae3ba6da61eba">FS_ATTR_VOLUME_ID</a>;
<a name="l01141"></a>01141       <span class="keywordflow">for</span>( u8_pos_name=0; u8_pos_name&lt;11; u8_pos_name++ )
<a name="l01142"></a>01142       {
<a name="l01143"></a>01143          u8_char = *sz_label;
<a name="l01144"></a>01144          <span class="keywordflow">if</span>( (<span class="charliteral">'a'</span>&lt;=u8_char) &amp;&amp; (u8_char&lt;=<span class="charliteral">'z'</span>) )
<a name="l01145"></a>01145          {
<a name="l01146"></a>01146             u8_char -= (<span class="charliteral">'a'</span>-<span class="charliteral">'A'</span>);                  <span class="comment">// Change to upper case</span>
<a name="l01147"></a>01147          }
<a name="l01148"></a>01148          <span class="keywordflow">if</span>( 0 == u8_char )
<a name="l01149"></a>01149          {
<a name="l01150"></a>01150             u8_char = 0x20;
<a name="l01151"></a>01151          }
<a name="l01152"></a>01152          *ptr_entry = u8_char;
<a name="l01153"></a>01153          ptr_entry++;
<a name="l01154"></a>01154          <span class="keywordflow">if</span>( 0x20 == u8_char )
<a name="l01155"></a>01155             <span class="keywordflow">continue</span>;
<a name="l01156"></a>01156          sz_label++;
<a name="l01157"></a>01157       }
<a name="l01158"></a>01158       <a class="code" href="a00019.html#45c0f16885c9e414ddb4b5afaa1cde34" title="This function sets a flag to signal that sector cache is modified.">fat_cache_mark_sector_as_dirty</a>();
<a name="l01159"></a>01159       <span class="keywordflow">return</span> <a class="code" href="a00019.html#578ab4800128cde17c0820a5027c1c06" title="This function flushs the sector cache on the memory if necessary.">fat_cache_flush</a>();
<a name="l01160"></a>01160    }
<a name="l01161"></a>01161    <span class="keywordflow">return</span> FALSE;                                   <span class="comment">// To delete the compilation warning</span>
<a name="l01162"></a>01162 }
<a name="l01163"></a>01163 <span class="preprocessor">#endif  // FS_LEVEL_FEATURES</span>
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="c0bdbd911ecf04b3fcebbc2e4ae33166"></a><!-- doxytag: member="fat.h::fat_entry_longname" ref="c0bdbd911ecf04b3fcebbc2e4ae33166" args="(FS_STRING sz_name, U8 u8_size_max, Bool b_mode, Bool b_match_case)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_entry_longname           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a>&nbsp;</td>
          <td class="paramname"> <em>sz_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>u8_size_max</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Bool&nbsp;</td>
          <td class="paramname"> <em>b_mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Bool&nbsp;</td>
          <td class="paramname"> <em>b_match_case</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function returns or compares the long name entry. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>b_mode</em>&nbsp;</td><td>action mode: <br>
 FS_NAME_GET to get the long name of selected file <br>
 FS_NAME_CHECK to compare the long name of selected file <br>
 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sz_name</em>&nbsp;</td><td>if FS_NAME_GET then buffer to store the long name file (ASCII or UNICODE ) <br>
 if FS_NAME_CHECK then name to compare with long name (ASCII or UNICODE), it must be terminate by NULL or '*' value <br>
</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>b_match_case</em>&nbsp;</td><td>FALSE, ignore the case (only used in "FS_NAME_CHECK" action mode) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>u8_size_max</em>&nbsp;</td><td>buffer size (unit ASCII or UNICODE ) (ignored in "FS_NAME_CHECK" mode)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE is not the end of long name, or in case of error, see global value "fs_g_status" for more detail <p>
TRUE, the name is correct or read is finish</dd></dl>
<div class="fragment"><pre class="fragment">
//! Global variable used
//! IN :
//!   fs_g_sector       The directory sector corresponding at the current position
//!   fs_g_nav_fast.u16_entry_pos_sel_file    Position in directory of the entry file (unit entry)
//! </pre></div> 
<p>Definition at line <a class="el" href="a00050.html#l01607">1607</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00050.html#l01763">fat_check_eof_name()</a>, <a class="el" href="a00050.html#l01773">fat_get_ptr_entry()</a>, <a class="el" href="a00055.html#l00134">FS_ATTR_LFN_ENTRY</a>, <a class="el" href="a00051.html#l00190">FS_ENTRY_DEL</a>, <a class="el" href="a00051.html#l00189">FS_ENTRY_END</a>, <a class="el" href="a00051.html#l00191">FS_ENTRY_LFN_LAST</a>, <a class="el" href="a00055.html#l00200">FS_ERR_ENTRY_BAD</a>, <a class="el" href="a00055.html#l00211">FS_ERR_NAME_INCORRECT</a>, <a class="el" href="a00055.html#l00256">fs_g_status</a>, <a class="el" href="a00055.html#l00084">FS_NAME_GET</a>, <a class="el" href="a00055.html#l00205">FS_NO_LAST_LFN_ENTRY</a>, <a class="el" href="a00051.html#l00197">FS_SIZE_FILE_ENTRY</a>, <a class="el" href="a00051.html#l00387">g_b_string_length</a>, and <a class="el" href="a00051.html#l00092">Is_unicode</a>.</p>

<p>Referenced by <a class="el" href="a00067.html#l01769">nav_file_name()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01608"></a>01608 {
<a name="l01609"></a>01609    U8 u8_pos_name;
<a name="l01610"></a>01610    <a class="code" href="a00020.html#119f57abfa3b1f77fd0514b26da6afb4">PTR_CACHE</a> ptr_entry;
<a name="l01611"></a>01611    U16 u16_unicode_entry;
<a name="l01612"></a>01612    U16 u16_unicode_szname;
<a name="l01613"></a>01613 
<a name="l01614"></a>01614    ptr_entry = <a class="code" href="a00019.html#0c24a717d004b7194e2c566522348fd5" title="This function returns a cache pointer on the current entry.">fat_get_ptr_entry</a>();
<a name="l01615"></a>01615 
<a name="l01616"></a>01616    <span class="keywordflow">if</span>( (<a class="code" href="a00020.html#453bf57f059970b3ce13033b7959cb0c">FS_ENTRY_END</a> == *ptr_entry )            <span class="comment">// end of directory</span>
<a name="l01617"></a>01617    ||  (<a class="code" href="a00020.html#303c1237fa5a61ddc015c0365eedd008">FS_ENTRY_DEL</a> == *ptr_entry )            <span class="comment">// entry deleted</span>
<a name="l01618"></a>01618    ||  (<a class="code" href="a00024.html#1aa64d79e89a455b62036d2230fd718d">FS_ATTR_LFN_ENTRY</a> != ptr_entry[11]) )   <span class="comment">// no long name</span>
<a name="l01619"></a>01619    {
<a name="l01620"></a>01620       <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#934f48a8e1cb558d75ec00bbd242030d" title="File entry bad.">FS_ERR_ENTRY_BAD</a>;
<a name="l01621"></a>01621       <span class="keywordflow">return</span> FALSE;
<a name="l01622"></a>01622    }
<a name="l01623"></a>01623 
<a name="l01624"></a>01624    <span class="keywordflow">if</span>( <a class="code" href="a00020.html#6d450fc3016f0d8a7f5674d9e3a05c83" title="Variables to select LENGTH string mode (initialised in nav_reset()).">g_b_string_length</a> )
<a name="l01625"></a>01625    {
<a name="l01626"></a>01626       <span class="keywordflow">if</span> ( 0 == (<a class="code" href="a00020.html#bf0fa999d28907c3742656b6407aca78">FS_ENTRY_LFN_LAST</a> &amp; *ptr_entry))
<a name="l01627"></a>01627       {
<a name="l01628"></a>01628          <span class="comment">// no necessary -&gt; ((FS_STR_UNICODE)sz_name)[0] = FS_SIZE_LFN_ENTRY;</span>
<a name="l01629"></a>01629          <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#2dad540bd4ed9c78eff34ba269371d8d" title="The file entry isn&amp;#39;t the last long file entry.">FS_NO_LAST_LFN_ENTRY</a>;
<a name="l01630"></a>01630          <span class="keywordflow">return</span> FALSE;                          <span class="comment">// Other entry long name</span>
<a name="l01631"></a>01631       }
<a name="l01632"></a>01632    }
<a name="l01633"></a>01633 
<a name="l01634"></a>01634    ptr_entry++;                                 <span class="comment">// The long name start at offset 1 of the entry file</span>
<a name="l01635"></a>01635 
<a name="l01636"></a>01636    u8_pos_name=0;
<a name="l01637"></a>01637    <span class="keywordflow">while</span>( 1 )
<a name="l01638"></a>01638    {
<a name="l01639"></a>01639       LSB(u16_unicode_entry) = ptr_entry[0];
<a name="l01640"></a>01640       MSB(u16_unicode_entry) = ptr_entry[1];
<a name="l01641"></a>01641       <span class="keywordflow">if</span>( <a class="code" href="a00024.html#a07ca9c4f511c7e1f326c27aeecb7178">FS_NAME_GET</a> == b_mode )
<a name="l01642"></a>01642       {
<a name="l01643"></a>01643          <span class="keywordflow">if</span>( !<a class="code" href="a00020.html#6d450fc3016f0d8a7f5674d9e3a05c83" title="Variables to select LENGTH string mode (initialised in nav_reset()).">g_b_string_length</a> )
<a name="l01644"></a>01644          {
<a name="l01645"></a>01645             <span class="comment">// Check the end of buffer</span>
<a name="l01646"></a>01646             <span class="keywordflow">if</span>( u8_pos_name&gt;=(u8_size_max-1) )
<a name="l01647"></a>01647             {
<a name="l01648"></a>01648                <span class="comment">// Write end of string</span>
<a name="l01649"></a>01649                <span class="keywordflow">if</span>( <a class="code" href="a00020.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a> )
<a name="l01650"></a>01650                {
<a name="l01651"></a>01651                   ((<a class="code" href="a00024.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_name)[0] = 0;
<a name="l01652"></a>01652                }<span class="keywordflow">else</span>{
<a name="l01653"></a>01653                   sz_name[0] = 0;
<a name="l01654"></a>01654                }
<a name="l01655"></a>01655                <span class="keywordflow">return</span> TRUE;                     <span class="comment">// the buffer is full</span>
<a name="l01656"></a>01656             }
<a name="l01657"></a>01657             <span class="comment">// Read and store the long name</span>
<a name="l01658"></a>01658             <span class="keywordflow">if</span>( <a class="code" href="a00020.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a> )
<a name="l01659"></a>01659             {
<a name="l01660"></a>01660                ((<a class="code" href="a00024.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_name)[0] = u16_unicode_entry;
<a name="l01661"></a>01661             }<span class="keywordflow">else</span>{
<a name="l01662"></a>01662                sz_name[0] = (U8)u16_unicode_entry;
<a name="l01663"></a>01663             }
<a name="l01664"></a>01664          }
<a name="l01665"></a>01665       }
<a name="l01666"></a>01666       <span class="keywordflow">else</span>
<a name="l01667"></a>01667       {
<a name="l01668"></a>01668          <span class="keywordflow">if</span>( <a class="code" href="a00020.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a> )
<a name="l01669"></a>01669          {
<a name="l01670"></a>01670             u16_unicode_szname = ((<a class="code" href="a00024.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_name)[0];
<a name="l01671"></a>01671          }<span class="keywordflow">else</span>{
<a name="l01672"></a>01672             u16_unicode_szname = sz_name[0];
<a name="l01673"></a>01673          }
<a name="l01674"></a>01674          <span class="comment">// Check the name</span>
<a name="l01675"></a>01675          <span class="keywordflow">if</span>( <span class="charliteral">'*'</span> == u16_unicode_szname )
<a name="l01676"></a>01676          {  <span class="comment">// end of filter name which autorise all next character</span>
<a name="l01677"></a>01677             <span class="keywordflow">return</span> TRUE;   <span class="comment">//*** The name is correct ***</span>
<a name="l01678"></a>01678          }
<a name="l01679"></a>01679 
<a name="l01680"></a>01680          <span class="keywordflow">if</span>( ((0 != u16_unicode_entry ) || (( <span class="charliteral">'\\'</span> != u16_unicode_szname) &amp;&amp; ( <span class="charliteral">'/'</span> != u16_unicode_szname)) )
<a name="l01681"></a>01681          &amp;&amp;  ((u16_unicode_szname != (u16_unicode_entry+(<span class="charliteral">'a'</span>-<span class="charliteral">'A'</span>))) || b_match_case)
<a name="l01682"></a>01682          &amp;&amp;  ((u16_unicode_szname != (u16_unicode_entry-(<span class="charliteral">'a'</span>-<span class="charliteral">'A'</span>))) || b_match_case)
<a name="l01683"></a>01683          &amp;&amp;  (u16_unicode_szname != u16_unicode_entry) )
<a name="l01684"></a>01684          {
<a name="l01685"></a>01685            <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#5ea145bbe1eb7413020b5e6b6f12a1ba" title="The name don&amp;#39;t corresponding at the filter name.">FS_ERR_NAME_INCORRECT</a>; <span class="comment">//  The name don't corresponding at filter name</span>
<a name="l01686"></a>01686            <span class="keywordflow">return</span> FALSE;
<a name="l01687"></a>01687          }
<a name="l01688"></a>01688       }
<a name="l01689"></a>01689 
<a name="l01690"></a>01690       <span class="keywordflow">if</span>( 0 == u16_unicode_entry)
<a name="l01691"></a>01691       {
<a name="l01692"></a>01692          <span class="keywordflow">if</span>( <a class="code" href="a00020.html#6d450fc3016f0d8a7f5674d9e3a05c83" title="Variables to select LENGTH string mode (initialised in nav_reset()).">g_b_string_length</a> )
<a name="l01693"></a>01693          {
<a name="l01694"></a>01694             ((<a class="code" href="a00024.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_name)[0] = u8_pos_name+1;
<a name="l01695"></a>01695          }
<a name="l01696"></a>01696          <span class="keywordflow">return</span> TRUE;                           <span class="comment">// Last long name entry</span>
<a name="l01697"></a>01697       }
<a name="l01698"></a>01698       <span class="keywordflow">if</span>( 4 == u8_pos_name )
<a name="l01699"></a>01699          ptr_entry += 3;                        <span class="comment">// Go to second character</span>
<a name="l01700"></a>01700 
<a name="l01701"></a>01701       <span class="keywordflow">if</span>( 10 == u8_pos_name )
<a name="l01702"></a>01702          ptr_entry += 2;                        <span class="comment">// Go to third character</span>
<a name="l01703"></a>01703 
<a name="l01704"></a>01704       <span class="keywordflow">if</span>( 12 == u8_pos_name )
<a name="l01705"></a>01705       {  <span class="comment">// End of entry long name</span>
<a name="l01706"></a>01706          ptr_entry -= (<a class="code" href="a00020.html#0ff67916e073882d162d5fbac91d7e50">FS_SIZE_FILE_ENTRY</a>-2);   <span class="comment">// Go to the first byte of the file entry</span>
<a name="l01707"></a>01707          <span class="keywordflow">if</span> ( 0 == (<a class="code" href="a00020.html#bf0fa999d28907c3742656b6407aca78">FS_ENTRY_LFN_LAST</a> &amp; ptr_entry[0]))
<a name="l01708"></a>01708          {
<a name="l01709"></a>01709             <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#2dad540bd4ed9c78eff34ba269371d8d" title="The file entry isn&amp;#39;t the last long file entry.">FS_NO_LAST_LFN_ENTRY</a>;
<a name="l01710"></a>01710             <span class="keywordflow">return</span> FALSE;                       <span class="comment">// Other long name entry is present</span>
<a name="l01711"></a>01711          }
<a name="l01712"></a>01712          <span class="keywordflow">else</span>
<a name="l01713"></a>01713          {  <span class="comment">// It is the last long name entry</span>
<a name="l01714"></a>01714             <span class="comment">// then it is the end of name</span>
<a name="l01715"></a>01715             <span class="keywordflow">if</span>( (<a class="code" href="a00024.html#a07ca9c4f511c7e1f326c27aeecb7178">FS_NAME_GET</a> == b_mode) &amp;&amp; <a class="code" href="a00020.html#6d450fc3016f0d8a7f5674d9e3a05c83" title="Variables to select LENGTH string mode (initialised in nav_reset()).">g_b_string_length</a> )
<a name="l01716"></a>01716             {
<a name="l01717"></a>01717                ((<a class="code" href="a00024.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_name)[0] = 14;
<a name="l01718"></a>01718                <span class="keywordflow">return</span> TRUE;
<a name="l01719"></a>01719             }
<a name="l01720"></a>01720             sz_name += (<a class="code" href="a00020.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>? 2 : 1 );
<a name="l01721"></a>01721             <span class="keywordflow">if</span>( <a class="code" href="a00024.html#a07ca9c4f511c7e1f326c27aeecb7178">FS_NAME_GET</a> == b_mode )
<a name="l01722"></a>01722             {
<a name="l01723"></a>01723                <span class="comment">// Write end of string UNICODE</span>
<a name="l01724"></a>01724                <span class="keywordflow">if</span>( <a class="code" href="a00020.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a> )
<a name="l01725"></a>01725                {
<a name="l01726"></a>01726                   ((<a class="code" href="a00024.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_name)[0] = 0;
<a name="l01727"></a>01727                }<span class="keywordflow">else</span>{
<a name="l01728"></a>01728                   sz_name[0] = 0;
<a name="l01729"></a>01729                }
<a name="l01730"></a>01730                <span class="keywordflow">return</span> TRUE;
<a name="l01731"></a>01731             }
<a name="l01732"></a>01732             <span class="keywordflow">else</span>
<a name="l01733"></a>01733             {
<a name="l01734"></a>01734                <span class="comment">// if it is the end of filter</span>
<a name="l01735"></a>01735                <span class="keywordflow">if</span>( <a class="code" href="a00020.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a> )
<a name="l01736"></a>01736                {
<a name="l01737"></a>01737                   u16_unicode_szname = ((<a class="code" href="a00024.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_name)[0];
<a name="l01738"></a>01738                }<span class="keywordflow">else</span>{
<a name="l01739"></a>01739                   u16_unicode_szname = sz_name[0];
<a name="l01740"></a>01740                }
<a name="l01741"></a>01741                <span class="keywordflow">return</span> <a class="code" href="a00019.html#452e159ed5e2a4d8ea88f0515a3a6e10" title="Check end of name.">fat_check_eof_name</a>(u16_unicode_szname);
<a name="l01742"></a>01742             }
<a name="l01743"></a>01743          }
<a name="l01744"></a>01744       }
<a name="l01745"></a>01745 
<a name="l01746"></a>01746       <span class="keywordflow">if</span>( !<a class="code" href="a00020.html#6d450fc3016f0d8a7f5674d9e3a05c83" title="Variables to select LENGTH string mode (initialised in nav_reset()).">g_b_string_length</a> )
<a name="l01747"></a>01747       {
<a name="l01748"></a>01748          sz_name += (<a class="code" href="a00020.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>? 2 : 1 );
<a name="l01749"></a>01749       }
<a name="l01750"></a>01750       u8_pos_name++;
<a name="l01751"></a>01751       ptr_entry+=2;
<a name="l01752"></a>01752    }
<a name="l01753"></a>01753 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="6bc798e9f4eac3457cc61e9cd9ba70b9"></a><!-- doxytag: member="fat.h::fat_entry_shortname" ref="6bc798e9f4eac3457cc61e9cd9ba70b9" args="(FS_STRING sz_name, U8 u8_size_max, Bool b_mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_entry_shortname           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a>&nbsp;</td>
          <td class="paramname"> <em>sz_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>u8_size_max</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Bool&nbsp;</td>
          <td class="paramname"> <em>b_mode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function returns or compares the short name entry. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>b_mode</em>&nbsp;</td><td>action mode: <br>
 FS_NAME_GET to get the short name of selected file <br>
 FS_NAME_CHECK to compare the short name of selected file <br>
 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sz_name</em>&nbsp;</td><td>if FS_NAME_GET then buffer to store the short name file (ASCII or UNICODE ) <br>
 if FS_NAME_CHECK then name to compare with short name (ASCII or UNICODE), it must be terminate by NULL or '*' value <br>
 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>u8_size_max</em>&nbsp;</td><td>buffer size (unit ASCII or UNICODE ) (ignored in "FS_NAME_CHECK" mode)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE, in case of error, see global value "fs_g_status" for more detail <p>
TRUE, the name is correct or read OK</dd></dl>
<div class="fragment"><pre class="fragment">
//! Global variable used
//! IN :
//!   fs_g_sector       The directory sector corresponding at the current position
//!   fs_g_nav_fast.u16_entry_pos_sel_file    Position in directory of the entry file (unit entry)
//! </pre></div> 
<p>Definition at line <a class="el" href="a00050.html#l01476">1476</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00050.html#l01773">fat_get_ptr_entry()</a>, <a class="el" href="a00055.html#l00211">FS_ERR_NAME_INCORRECT</a>, <a class="el" href="a00055.html#l00256">fs_g_status</a>, <a class="el" href="a00055.html#l00084">FS_NAME_GET</a>, <a class="el" href="a00051.html#l00200">FS_SIZE_SFNAME</a>, <a class="el" href="a00051.html#l00201">FS_SIZE_SFNAME_WITHOUT_EXT</a>, <a class="el" href="a00051.html#l00387">g_b_string_length</a>, and <a class="el" href="a00051.html#l00092">Is_unicode</a>.</p>

<p>Referenced by <a class="el" href="a00067.html#l01769">nav_file_name()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01477"></a>01477 {
<a name="l01478"></a>01478    Bool b_extension_nostart = TRUE;
<a name="l01479"></a>01479    U8 u8_pos_name;
<a name="l01480"></a>01480    U8 u8_entry_char, u8_szname_char;
<a name="l01481"></a>01481    <a class="code" href="a00020.html#119f57abfa3b1f77fd0514b26da6afb4">PTR_CACHE</a> ptr_entry;
<a name="l01482"></a>01482    U8 u8_pos_entry;
<a name="l01483"></a>01483 
<a name="l01484"></a>01484    <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#5ea145bbe1eb7413020b5e6b6f12a1ba" title="The name don&amp;#39;t corresponding at the filter name.">FS_ERR_NAME_INCORRECT</a>;  <span class="comment">// by default the name don't corresponding at filter name</span>
<a name="l01485"></a>01485 
<a name="l01486"></a>01486    u8_pos_name = 0;
<a name="l01487"></a>01487    u8_pos_entry = 0;
<a name="l01488"></a>01488    ptr_entry = <a class="code" href="a00019.html#0c24a717d004b7194e2c566522348fd5" title="This function returns a cache pointer on the current entry.">fat_get_ptr_entry</a>();
<a name="l01489"></a>01489 
<a name="l01490"></a>01490    <span class="comment">// for each characters of short name</span>
<a name="l01491"></a>01491    <span class="keywordflow">while</span>( 1 )
<a name="l01492"></a>01492    {
<a name="l01493"></a>01493       <span class="keywordflow">if</span>( <a class="code" href="a00020.html#69da5456f1f42a68c03ac860e33ac75b">FS_SIZE_SFNAME</a> == u8_pos_entry )
<a name="l01494"></a>01494       {
<a name="l01495"></a>01495          u8_entry_char = 0;   <span class="comment">// end of name</span>
<a name="l01496"></a>01496       }
<a name="l01497"></a>01497       <span class="keywordflow">else</span>
<a name="l01498"></a>01498       {
<a name="l01499"></a>01499          u8_entry_char = ptr_entry[ u8_pos_entry ];
<a name="l01500"></a>01500          <span class="keywordflow">if</span>( ((<a class="code" href="a00020.html#18e4c969985c697213c58a67e7c20795">FS_SIZE_SFNAME_WITHOUT_EXT</a> == u8_pos_entry) &amp;&amp; b_extension_nostart)  <span class="comment">// end of name and '.' character no writed</span>
<a name="l01501"></a>01501          ||  ( <span class="charliteral">' '</span> == u8_entry_char) )
<a name="l01502"></a>01502          {
<a name="l01503"></a>01503             <span class="comment">// end of name or extension</span>
<a name="l01504"></a>01504             <span class="keywordflow">if</span>( (<a class="code" href="a00020.html#18e4c969985c697213c58a67e7c20795">FS_SIZE_SFNAME_WITHOUT_EXT</a> &gt;= u8_pos_entry)         <span class="comment">// End of name without extension</span>
<a name="l01505"></a>01505             &amp;&amp;  (<span class="charliteral">' '</span> != ptr_entry[ <a class="code" href="a00020.html#18e4c969985c697213c58a67e7c20795">FS_SIZE_SFNAME_WITHOUT_EXT</a> ]) )   <span class="comment">// extension exists</span>
<a name="l01506"></a>01506             {
<a name="l01507"></a>01507                <span class="comment">// go to extension position</span>
<a name="l01508"></a>01508                b_extension_nostart = FALSE;
<a name="l01509"></a>01509                u8_pos_entry = FS_SIZE_SFNAME_WITHOUT_EXT-1;
<a name="l01510"></a>01510                u8_entry_char = <span class="charliteral">'.'</span>;
<a name="l01511"></a>01511             }
<a name="l01512"></a>01512             <span class="keywordflow">else</span>
<a name="l01513"></a>01513             {
<a name="l01514"></a>01514                u8_entry_char = 0;                                    <span class="comment">// end of name</span>
<a name="l01515"></a>01515             }
<a name="l01516"></a>01516          }
<a name="l01517"></a>01517       }
<a name="l01518"></a>01518 
<a name="l01519"></a>01519       <span class="keywordflow">if</span>( <a class="code" href="a00024.html#a07ca9c4f511c7e1f326c27aeecb7178">FS_NAME_GET</a> == b_mode )
<a name="l01520"></a>01520       {
<a name="l01521"></a>01521          <span class="keywordflow">if</span>( !<a class="code" href="a00020.html#6d450fc3016f0d8a7f5674d9e3a05c83" title="Variables to select LENGTH string mode (initialised in nav_reset()).">g_b_string_length</a> )
<a name="l01522"></a>01522          {
<a name="l01523"></a>01523             <span class="keywordflow">if</span>(u8_pos_name &gt;= (u8_size_max-1))
<a name="l01524"></a>01524                u8_entry_char = 0;                                    <span class="comment">// buffer full then force end of string</span>
<a name="l01525"></a>01525 
<a name="l01526"></a>01526             <span class="keywordflow">if</span>( (<span class="charliteral">'A'</span>&lt;=u8_entry_char) &amp;&amp; (u8_entry_char&lt;=<span class="charliteral">'Z'</span>))
<a name="l01527"></a>01527                u8_entry_char += (<span class="charliteral">'a'</span>-<span class="charliteral">'A'</span>);                           <span class="comment">// display short name in down case</span>
<a name="l01528"></a>01528 
<a name="l01529"></a>01529             <span class="keywordflow">if</span>( <a class="code" href="a00020.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a> )
<a name="l01530"></a>01530             {
<a name="l01531"></a>01531                ((<a class="code" href="a00024.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_name)[0] = u8_entry_char;
<a name="l01532"></a>01532             }<span class="keywordflow">else</span>{
<a name="l01533"></a>01533                sz_name[0] = u8_entry_char;
<a name="l01534"></a>01534             }
<a name="l01535"></a>01535          }
<a name="l01536"></a>01536       }
<a name="l01537"></a>01537       <span class="keywordflow">else</span>
<a name="l01538"></a>01538       {
<a name="l01539"></a>01539          <span class="comment">// Compare the name</span>
<a name="l01540"></a>01540          <span class="keywordflow">if</span>( <a class="code" href="a00020.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>
<a name="l01541"></a>01541          &amp;&amp; (0 != MSB(((<a class="code" href="a00024.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_name)[0])) )
<a name="l01542"></a>01542          {
<a name="l01543"></a>01543             <span class="comment">// The UNICODE is not possibled in short name</span>
<a name="l01544"></a>01544             <span class="keywordflow">return</span> FALSE;
<a name="l01545"></a>01545          }
<a name="l01546"></a>01546 
<a name="l01547"></a>01547          <span class="keywordflow">if</span>( <a class="code" href="a00020.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a> )
<a name="l01548"></a>01548          {
<a name="l01549"></a>01549             u8_szname_char = ((<a class="code" href="a00024.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_name)[0];
<a name="l01550"></a>01550          }<span class="keywordflow">else</span>{
<a name="l01551"></a>01551             u8_szname_char = sz_name[0];
<a name="l01552"></a>01552          }
<a name="l01553"></a>01553          <span class="keywordflow">if</span> (<span class="charliteral">'*'</span> == u8_szname_char)
<a name="l01554"></a>01554          {  <span class="comment">// end of filter name which autorise all next character</span>
<a name="l01555"></a>01555             <span class="keywordflow">return</span> TRUE;   <span class="comment">//*** The name is correct ***</span>
<a name="l01556"></a>01556          }
<a name="l01557"></a>01557 
<a name="l01558"></a>01558          <span class="keywordflow">if</span>( (0 != u8_entry_char) || ((<span class="charliteral">'\\'</span> != u8_szname_char) &amp;&amp; (<span class="charliteral">'/'</span> != u8_szname_char)) )
<a name="l01559"></a>01559          {
<a name="l01560"></a>01560             <span class="keywordflow">if</span>((u8_szname_char != u8_entry_char)
<a name="l01561"></a>01561             &amp;&amp; (u8_szname_char != (u8_entry_char+(<span class="charliteral">'a'</span>-<span class="charliteral">'A'</span>))) )  <span class="comment">// no case sensitive</span>
<a name="l01562"></a>01562                <span class="keywordflow">return</span> FALSE;  <span class="comment">// short name not equal</span>
<a name="l01563"></a>01563          }
<a name="l01564"></a>01564       }
<a name="l01565"></a>01565 
<a name="l01566"></a>01566       <span class="comment">// For each characters</span>
<a name="l01567"></a>01567       <span class="keywordflow">if</span> (0 == u8_entry_char)
<a name="l01568"></a>01568       {
<a name="l01569"></a>01569          <span class="keywordflow">if</span>( <a class="code" href="a00020.html#6d450fc3016f0d8a7f5674d9e3a05c83" title="Variables to select LENGTH string mode (initialised in nav_reset()).">g_b_string_length</a> )
<a name="l01570"></a>01570          {
<a name="l01571"></a>01571             ((<a class="code" href="a00024.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_name)[0] = u8_pos_name+1;      <span class="comment">// Get length name</span>
<a name="l01572"></a>01572          }
<a name="l01573"></a>01573          <span class="keywordflow">return</span> TRUE;   <span class="comment">// End of test correct or end of get name</span>
<a name="l01574"></a>01574       }
<a name="l01575"></a>01575       <span class="keywordflow">if</span>( !<a class="code" href="a00020.html#6d450fc3016f0d8a7f5674d9e3a05c83" title="Variables to select LENGTH string mode (initialised in nav_reset()).">g_b_string_length</a> )
<a name="l01576"></a>01576       {
<a name="l01577"></a>01577          sz_name += (<a class="code" href="a00020.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>? 2 : 1 );
<a name="l01578"></a>01578       }
<a name="l01579"></a>01579       u8_pos_name++;
<a name="l01580"></a>01580       u8_pos_entry++;
<a name="l01581"></a>01581    }
<a name="l01582"></a>01582 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="6099b0e8fafcc01b8c1769c94c827325"></a><!-- doxytag: member="fat.h::fat_format" ref="6099b0e8fafcc01b8c1769c94c827325" args="(U8 u8_fat_type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_format           </td>
          <td>(</td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>u8_fat_type</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function formats the drive. 
<p>
This function formats the drive.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>u8_fat_type</em>&nbsp;</td><td>Select the type of format <br>
 FS_FORMAT_DEFAULT, The file system module choose the better FAT format for the drive space <br>
 FS_FORMAT_FAT, The FAT12 or FAT16 is used to format the drive, if possible (disk space &lt;2GB) <br>
 FS_FORMAT_FAT32, The FAT32 is used to format the drive, if possible (disk space &gt;32MB) <br>
 FS_FORMAT_NOMBR_FLAG if you don't want a MRB in disk then add this flag (e.g. FAT format on a CD support)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE in case of error, see global value "fs_g_status" for more detail <p>
TRUE otherwise</dd></dl>
<div class="fragment"><pre class="fragment">
//! Global variables used
//! IN :
//! fs_g_nav.u8_lun        indicate the drive to format
//!
//! This routine can't format a multi-partiton, if the disk contains a multi-partition area
//! then the multi-partition will be erased and replaced by a single partition on all disk space.
//! </pre></div> 
<p>Definition at line <a class="el" href="a00052.html#l00341">341</a> of file <a class="el" href="a00052.html">fat_unusual.c</a>.</p>

<p>References <a class="el" href="a00050.html#l01860">fat_cache_flush()</a>, <a class="el" href="a00052.html#l00929">fat_clean_zone()</a>, <a class="el" href="a00052.html#l01006">fat_initialize_fat()</a>, <a class="el" href="a00052.html#l00484">fat_select_filesystem()</a>, <a class="el" href="a00052.html#l00623">fat_write_MBR()</a>, <a class="el" href="a00052.html#l00730">fat_write_PBR()</a>, <a class="el" href="a00055.html#l00159">FS_FORMAT_NOMBR_FLAG</a>, <a class="el" href="a00051.html#l00394">fs_g_nav</a>, <a class="el" href="a00052.html#l00319">fs_s_u32_size_partition</a>, <a class="el" href="a00048.html#l00305">mem_read_capacity()</a>, <a class="el" href="a00051.html#l00269">Fs_management::u8_lun</a>, and <a class="el" href="a00051.html#l00271">Fs_management::u8_partition</a>.</p>

<p>Referenced by <a class="el" href="a00067.html#l00399">nav_drive_format()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00341"></a>00341 {
<a name="l00342"></a>00342    Bool b_MBR;
<a name="l00343"></a>00343 <span class="preprocessor">#if (FS_MULTI_PARTITION == ENABLED)</span>
<a name="l00344"></a>00344 <span class="preprocessor"></span><span class="preprocessor">#error NOT SUPPORTED</span>
<a name="l00345"></a>00345 <span class="preprocessor"></span>   <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#af482bc02a186c363c37c93e169fbbd4" title="Number of partition - 1 (0 or 1).">u8_partition</a> = 0;
<a name="l00346"></a>00346 <span class="preprocessor">#endif</span>
<a name="l00347"></a>00347 <span class="preprocessor"></span>
<a name="l00348"></a>00348 
<a name="l00349"></a>00349    <span class="comment">// Get drive capacity (= last LBA)</span>
<a name="l00350"></a>00350    <a class="code" href="a00017.html#0bafaa7d437e08a1727e2124db423f18" title="Returns the address of the last valid sector (512 bytes) in the memory.">mem_read_capacity</a>( <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a> , &amp;<a class="code" href="a00021.html#045dd8cfc387ec4ecf5c278bd239a5cf">fs_s_u32_size_partition</a> );
<a name="l00351"></a>00351 
<a name="l00352"></a>00352    <span class="keywordflow">if</span>( u8_fat_type &amp; <a class="code" href="a00024.html#31e4d71ce14847632a35192fae12705e" title="MBR is mandatory for USB device on MacOS, and no MBR is mandatory for CD-ROM USB...">FS_FORMAT_NOMBR_FLAG</a> )
<a name="l00353"></a>00353    {
<a name="l00354"></a>00354       b_MBR = FALSE;
<a name="l00355"></a>00355       u8_fat_type &amp;= ~FS_FORMAT_NOMBR_FLAG;
<a name="l00356"></a>00356       <span class="comment">// partition size = disk size = last LBA + 1</span>
<a name="l00357"></a>00357       <a class="code" href="a00021.html#045dd8cfc387ec4ecf5c278bd239a5cf">fs_s_u32_size_partition</a>++;
<a name="l00358"></a>00358    }<span class="keywordflow">else</span>{
<a name="l00359"></a>00359       b_MBR = TRUE;
<a name="l00360"></a>00360       <span class="comment">// partition size = size disk -1 = last LBA</span>
<a name="l00361"></a>00361    }
<a name="l00362"></a>00362 
<a name="l00363"></a>00363    <span class="comment">// Compute the FAT type for the device</span>
<a name="l00364"></a>00364    <span class="keywordflow">if</span>( !<a class="code" href="a00021.html#477e90a97f3fcb8361020feb2557098d" title="This function computes the FAT type to use.">fat_select_filesystem</a>( u8_fat_type , b_MBR ))
<a name="l00365"></a>00365       <span class="keywordflow">return</span> FALSE;
<a name="l00366"></a>00366 
<a name="l00367"></a>00367    <span class="comment">// Write the MBR sector (first sector)</span>
<a name="l00368"></a>00368    <span class="keywordflow">if</span>( b_MBR )
<a name="l00369"></a>00369       <span class="keywordflow">if</span>( !<a class="code" href="a00021.html#9075855486dc53d38dd64e068b512027" title="This function writes the MBR.">fat_write_MBR</a>())
<a name="l00370"></a>00370          <span class="keywordflow">return</span> FALSE;
<a name="l00371"></a>00371 
<a name="l00372"></a>00372    <span class="comment">// Write the PBR sector</span>
<a name="l00373"></a>00373    <span class="keywordflow">if</span>( !<a class="code" href="a00021.html#89d56497bd58d7d6553b7e319f3ee863" title="This function writes the PBR.">fat_write_PBR</a>( b_MBR ))
<a name="l00374"></a>00374       <span class="keywordflow">return</span> FALSE;
<a name="l00375"></a>00375 
<a name="l00376"></a>00376    <span class="comment">// Clear reserved zone, FAT zone, and Root dir zone</span>
<a name="l00377"></a>00377    <span class="comment">// Remark: the reserved zone of FAT32 isn't initialized, because BPB_FSInfo is equal to 0</span>
<a name="l00378"></a>00378    <span class="keywordflow">if</span>( !<a class="code" href="a00021.html#ad6177926c645c867ea1d23c727d9097" title="This function cleans the reserved zone, FAT zone, and root dir zone.">fat_clean_zone</a>( b_MBR ))
<a name="l00379"></a>00379       <span class="keywordflow">return</span> FALSE;
<a name="l00380"></a>00380 
<a name="l00381"></a>00381    <span class="comment">// Initialization of the FAT 1 and 2</span>
<a name="l00382"></a>00382    <span class="keywordflow">if</span>( !<a class="code" href="a00021.html#6ab74fa9e68a4379a3ea33465d835277" title="This function initializes the fat one and two.">fat_initialize_fat</a>())
<a name="l00383"></a>00383       <span class="keywordflow">return</span> FALSE;
<a name="l00384"></a>00384 
<a name="l00385"></a>00385    <span class="keywordflow">return</span> <a class="code" href="a00019.html#578ab4800128cde17c0820a5027c1c06" title="This function flushs the sector cache on the memory if necessary.">fat_cache_flush</a>();
<a name="l00386"></a>00386 }
<a name="l00387"></a>00387 
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="51041500c2e36ab39aad19b54e93d504"></a><!-- doxytag: member="fat.h::fat_get_date" ref="51041500c2e36ab39aad19b54e93d504" args="(FS_STRING sz_date, Bool type_date)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fat_get_date           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a>&nbsp;</td>
          <td class="paramname"> <em>sz_date</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Bool&nbsp;</td>
          <td class="paramname"> <em>type_date</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function reads the information about a date. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>type_date</em>&nbsp;</td><td>choose the date type (FS_DATE_LAST_WRITE or FS_DATE_CREATION) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sz_date</em>&nbsp;</td><td>table to store the date <br>
 storage format (ASCII) = "YYYYMMDDHHMMSSMS" = year, month, day, hour, minute, seconde, miliseconde </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="a00052.html#l01222">1222</a> of file <a class="el" href="a00052.html">fat_unusual.c</a>.</p>

<p>References <a class="el" href="a00050.html#l01773">fat_get_ptr_entry()</a>, <a class="el" href="a00052.html#l01245">fat_translatedate_number_to_ascii()</a>, and <a class="el" href="a00055.html#l00110">FS_DATE_LAST_WRITE</a>.</p>

<p>Referenced by <a class="el" href="a00067.html#l01931">nav_file_dateget()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01222"></a>01222 {
<a name="l01223"></a>01223    <a class="code" href="a00020.html#119f57abfa3b1f77fd0514b26da6afb4">PTR_CACHE</a> ptr_entry;
<a name="l01224"></a>01224 
<a name="l01225"></a>01225    ptr_entry = <a class="code" href="a00019.html#0c24a717d004b7194e2c566522348fd5" title="This function returns a cache pointer on the current entry.">fat_get_ptr_entry</a>();
<a name="l01226"></a>01226    <span class="keywordflow">if</span>( <a class="code" href="a00024.html#fbbd68bf71e1e73a9162dd04f3dec8fe">FS_DATE_LAST_WRITE</a> == type_date )
<a name="l01227"></a>01227    {
<a name="l01228"></a>01228       <a class="code" href="a00021.html#015e44f70b92d8b39e00ababfdb6bc24" title="This function translates a date FAT value to ascii string.">fat_translatedate_number_to_ascii</a>( sz_date , &amp;ptr_entry[22] , FALSE );
<a name="l01229"></a>01229    }
<a name="l01230"></a>01230    <span class="keywordflow">else</span>
<a name="l01231"></a>01231    {
<a name="l01232"></a>01232       <a class="code" href="a00021.html#015e44f70b92d8b39e00ababfdb6bc24" title="This function translates a date FAT value to ascii string.">fat_translatedate_number_to_ascii</a>( sz_date , &amp;ptr_entry[13] , TRUE );
<a name="l01233"></a>01233    }
<a name="l01234"></a>01234 }
<a name="l01235"></a>01235 
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="56b68ed36f194500ce88c22252e3c317"></a><!-- doxytag: member="fat.h::fat_get_entry_info" ref="56b68ed36f194500ce88c22252e3c317" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fat_get_entry_info           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function reads information about selected file. 
<p>
<div class="fragment"><pre class="fragment">
//! Global variable used
//! IN :
//!   fs_g_sector       The directory sector corresponding at the current position
//!   fs_g_nav_fast.u16_entry_pos_sel_file    Position in directory of the entry file (unit entry)
//! OUT:
//!   fs_g_nav_entry. u32_cluster, u8_attr, u32_size
//! </pre></div> 
<p>Definition at line <a class="el" href="a00050.html#l01353">1353</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00050.html#l01773">fat_get_ptr_entry()</a>, <a class="el" href="a00051.html#l00396">fs_g_nav_entry</a>, <a class="el" href="a00051.html#l00305">Fs_management_entry::u32_cluster</a>, <a class="el" href="a00051.html#l00306">Fs_management_entry::u32_size</a>, and <a class="el" href="a00051.html#l00304">Fs_management_entry::u8_attr</a>.</p>

<p>Referenced by <a class="el" href="a00067.html#l01219">nav_dir_gotoparent()</a>, <a class="el" href="a00067.html#l00726">nav_filelist_set()</a>, and <a class="el" href="a00063.html#l00383">nav_filterlist_gotoparent()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01354"></a>01354 {
<a name="l01355"></a>01355    <a class="code" href="a00020.html#119f57abfa3b1f77fd0514b26da6afb4">PTR_CACHE</a> ptr_entry;
<a name="l01356"></a>01356 
<a name="l01357"></a>01357    ptr_entry = <a class="code" href="a00019.html#0c24a717d004b7194e2c566522348fd5" title="This function returns a cache pointer on the current entry.">fat_get_ptr_entry</a>();
<a name="l01358"></a>01358 
<a name="l01359"></a>01359    <span class="comment">// Get attribut</span>
<a name="l01360"></a>01360    ptr_entry+= 11;
<a name="l01361"></a>01361    <a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#c4f33191c9fd60c7520012bbe6005267" title="Attribut of the selected file.">u8_attr</a> = ptr_entry[0];
<a name="l01362"></a>01362 
<a name="l01363"></a>01363    <span class="comment">// Get the first cluster of the file cluster list</span>
<a name="l01364"></a>01364    ptr_entry += (20-11);
<a name="l01365"></a>01365    LSB2(<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a>) = ptr_entry[0];
<a name="l01366"></a>01366    LSB3(<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a>) = ptr_entry[1];
<a name="l01367"></a>01367    ptr_entry += (26-20);
<a name="l01368"></a>01368    LSB0(<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a>) = ptr_entry[0];
<a name="l01369"></a>01369    LSB1(<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a>) = ptr_entry[1];
<a name="l01370"></a>01370 
<a name="l01371"></a>01371    <span class="comment">// Get the size of file</span>
<a name="l01372"></a>01372    ptr_entry += (28-26);
<a name="l01373"></a>01373    LSB0(<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#6ffedc3932826a337dfb3e656a09edcc" title="Size of selected file (unit Bytes).">u32_size</a>) = ptr_entry[0];
<a name="l01374"></a>01374    LSB1(<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#6ffedc3932826a337dfb3e656a09edcc" title="Size of selected file (unit Bytes).">u32_size</a>) = ptr_entry[1];
<a name="l01375"></a>01375    LSB2(<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#6ffedc3932826a337dfb3e656a09edcc" title="Size of selected file (unit Bytes).">u32_size</a>) = ptr_entry[2];
<a name="l01376"></a>01376    LSB3(<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#6ffedc3932826a337dfb3e656a09edcc" title="Size of selected file (unit Bytes).">u32_size</a>) = ptr_entry[3];
<a name="l01377"></a>01377 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="920798e6366e8c3c408601c58fed4bb3"></a><!-- doxytag: member="fat.h::fat_get_nbpartition" ref="920798e6366e8c3c408601c58fed4bb3" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">U8 fat_get_nbpartition           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function returns the number of partition present on selected drive. 
<p>
This function returns the number of partition present on selected drive.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>u8_number number of partition </dd></dl>

<p>Definition at line <a class="el" href="a00050.html#l00299">299</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00050.html#l01794">fat_cache_read_sector()</a>, <a class="el" href="a00050.html#l00091">fat_check_device()</a>, <a class="el" href="a00051.html#l00146">FS_BR_SIGNATURE_HIGH</a>, <a class="el" href="a00051.html#l00145">FS_BR_SIGNATURE_LOW</a>, <a class="el" href="a00051.html#l00415">fs_g_sector</a>, <a class="el" href="a00051.html#l00417">fs_gu32_addrsector</a>, and <a class="el" href="a00051.html#l00108">FS_MBR_OFFSET_PART_ENTRY</a>.</p>

<p>Referenced by <a class="el" href="a00067.html#l00421">nav_partition_nb()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00300"></a>00300 {
<a name="l00301"></a>00301    <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#eeec0bd6755a6be4c4dda2b4669eb0ae" title="This function checks device state.">fat_check_device</a>() )
<a name="l00302"></a>00302       <span class="keywordflow">return</span> 0;
<a name="l00303"></a>00303 
<a name="l00304"></a>00304 <span class="preprocessor">#warning this routine contains bug, rework it</span>
<a name="l00305"></a>00305 <span class="preprocessor"></span>   <span class="comment">// Read the first sector of drive</span>
<a name="l00306"></a>00306    <a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a> = 0;
<a name="l00307"></a>00307    <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#a67dc439478853cefdd226f9c99c9539" title="This function loads a memory sector in internal cache sector.">fat_cache_read_sector</a>( TRUE ))
<a name="l00308"></a>00308       <span class="keywordflow">return</span> FALSE;
<a name="l00309"></a>00309 
<a name="l00310"></a>00310    <span class="comment">// Check PBR or MBR signature</span>
<a name="l00311"></a>00311    <span class="keywordflow">if</span> ( (<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[510] != <a class="code" href="a00020.html#36f09355f7020d410cb43695cab680fa">FS_BR_SIGNATURE_LOW</a>  )
<a name="l00312"></a>00312    &amp;&amp;   (<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[511] != <a class="code" href="a00020.html#b4cd4bfc6a5baebc1d25bbc5d5db2c15">FS_BR_SIGNATURE_HIGH</a> ) )
<a name="l00313"></a>00313    {
<a name="l00314"></a>00314       <span class="comment">// No MBR</span>
<a name="l00315"></a>00315       <span class="comment">// The sector, is it a PBR ?</span>
<a name="l00316"></a>00316       <span class="keywordflow">if</span> ( (<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[0] == 0xEB) &amp;&amp;          <span class="comment">// PBR Byte 0</span>
<a name="l00317"></a>00317            (<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[2] == 0x90) &amp;&amp;          <span class="comment">// PBR Byte 2</span>
<a name="l00318"></a>00318            ((<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[21] &amp; 0xF0) == 0xF0) ) <span class="comment">// PBR Byte 21 : Media byte</span>
<a name="l00319"></a>00319       {
<a name="l00320"></a>00320          <span class="keywordflow">return</span> 1;   <span class="comment">// No MBR but PBR exist then only one partition</span>
<a name="l00321"></a>00321       } <span class="keywordflow">else</span> {
<a name="l00322"></a>00322          <span class="keywordflow">return</span> 0;   <span class="comment">// No MBR and no PBR then no partition found</span>
<a name="l00323"></a>00323       }
<a name="l00324"></a>00324    }
<a name="l00325"></a>00325 
<a name="l00326"></a>00326    number_part = 0;
<a name="l00327"></a>00327    <span class="keywordflow">while</span>( 1 )
<a name="l00328"></a>00328    {
<a name="l00329"></a>00329       <span class="comment">// The first sector must be a MBR, then check the partition entry in the MBR</span>
<a name="l00330"></a>00330       <span class="keywordflow">if</span> ( ((<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00020.html#70b90ba913c43a878e9b478de5d1b61c" title="Position (unit byte) in the MBR of a partition entry.">FS_MBR_OFFSET_PART_ENTRY</a>(number_part)+0] != FS_PARTITION_ACTIVE) &amp;&amp;
<a name="l00331"></a>00331             (<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00020.html#70b90ba913c43a878e9b478de5d1b61c" title="Position (unit byte) in the MBR of a partition entry.">FS_MBR_OFFSET_PART_ENTRY</a>(number_part)+0] != 0x00))
<a name="l00332"></a>00332       ||    (<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00020.html#70b90ba913c43a878e9b478de5d1b61c" title="Position (unit byte) in the MBR of a partition entry.">FS_MBR_OFFSET_PART_ENTRY</a>(number_part)+4] == 0x00) )
<a name="l00333"></a>00333       {
<a name="l00334"></a>00334          <span class="keywordflow">break</span>;
<a name="l00335"></a>00335       }
<a name="l00336"></a>00336       number_part++;
<a name="l00337"></a>00337    }
<a name="l00338"></a>00338    <span class="keywordflow">return</span> number_part;
<a name="l00339"></a>00339 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="0c24a717d004b7194e2c566522348fd5"></a><!-- doxytag: member="fat.h::fat_get_ptr_entry" ref="0c24a717d004b7194e2c566522348fd5" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00020.html#119f57abfa3b1f77fd0514b26da6afb4">PTR_CACHE</a> fat_get_ptr_entry           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function returns a cache pointer on the current entry. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>a pointer on the internal cache </dd></dl>

<p>Definition at line <a class="el" href="a00050.html#l01773">1773</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00051.html#l00217">FS_512B_MASK</a>, <a class="el" href="a00051.html#l00395">fs_g_nav_fast</a>, <a class="el" href="a00051.html#l00415">fs_g_sector</a>, <a class="el" href="a00051.html#l00197">FS_SIZE_FILE_ENTRY</a>, and <a class="el" href="a00051.html#l00296">Fs_management_fast::u16_entry_pos_sel_file</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l01921">fat_alloc_entry_free()</a>, <a class="el" href="a00052.html#l01558">fat_create_long_name_entry()</a>, <a class="el" href="a00052.html#l01633">fat_create_short_entry_name()</a>, <a class="el" href="a00052.html#l02074">fat_delete_file()</a>, <a class="el" href="a00050.html#l01243">fat_entry_check()</a>, <a class="el" href="a00050.html#l01294">fat_entry_checkext()</a>, <a class="el" href="a00052.html#l01088">fat_entry_label()</a>, <a class="el" href="a00050.html#l01607">fat_entry_longname()</a>, <a class="el" href="a00050.html#l01476">fat_entry_shortname()</a>, <a class="el" href="a00052.html#l01808">fat_entry_shortname_compare()</a>, <a class="el" href="a00052.html#l02004">fat_garbage_collector_entry()</a>, <a class="el" href="a00052.html#l01222">fat_get_date()</a>, <a class="el" href="a00050.html#l01353">fat_get_entry_info()</a>, <a class="el" href="a00052.html#l01349">fat_set_date()</a>, and <a class="el" href="a00050.html#l01421">fat_write_entry_file()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01774"></a>01774 {
<a name="l01775"></a>01775    <span class="keywordflow">return</span> &amp;<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[(<a class="code" href="a00020.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00006.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a> * <a class="code" href="a00020.html#0ff67916e073882d162d5fbac91d7e50">FS_SIZE_FILE_ENTRY</a>) &amp; <a class="code" href="a00020.html#88ac363f9c597edc80e1185f99434056">FS_512B_MASK</a>];
<a name="l01776"></a>01776 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="e23270781477be5e6c89b90531c01651"></a><!-- doxytag: member="fat.h::fat_getfreespace" ref="e23270781477be5e6c89b90531c01651" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">U32 fat_getfreespace           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function returns the space free in the partition. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>the number of sector free <br>
 if 0, then error or full </dd></dl>

<p>Definition at line <a class="el" href="a00052.html#l02133">2133</a> of file <a class="el" href="a00052.html">fat_unusual.c</a>.</p>

<p>References <a class="el" href="a00050.html#l00798">fat_cluster_readnext()</a>, <a class="el" href="a00050.html#l00603">fat_cluster_val()</a>, <a class="el" href="a00052.html#l00888">fat_read_fat32_FSInfo()</a>, <a class="el" href="a00052.html#l00853">fat_write_fat32_FSInfo()</a>, <a class="el" href="a00051.html#l00246">FS_CLUST_VAL_READ</a>, <a class="el" href="a00051.html#l00403">fs_g_cluster</a>, <a class="el" href="a00051.html#l00394">fs_g_nav</a>, <a class="el" href="a00051.html#l00075">Is_fat12</a>, <a class="el" href="a00051.html#l00085">Is_fat32</a>, <a class="el" href="a00051.html#l00277">Fs_management::u32_CountofCluster</a>, <a class="el" href="a00051.html#l00324">st_fs_cluster::u32_pos</a>, <a class="el" href="a00051.html#l00325">st_fs_cluster::u32_val</a>, and <a class="el" href="a00051.html#l00273">Fs_management::u8_BPB_SecPerClus</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l02198">fat_getfreespace_percent()</a>, and <a class="el" href="a00067.html#l00609">nav_partition_freespace()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l02133"></a>02133 {
<a name="l02134"></a>02134    U32 u32_nb_free_cluster = 0;
<a name="l02135"></a>02135 
<a name="l02136"></a>02136    <span class="comment">// Read ALL FAT1</span>
<a name="l02137"></a>02137    <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a> = 2;
<a name="l02138"></a>02138 
<a name="l02139"></a>02139    <span class="keywordflow">if</span>( <a class="code" href="a00020.html#c2ce5473766316396fb472c1bdd685e9">Is_fat12</a> )
<a name="l02140"></a>02140    {  <span class="comment">// FAT12 only</span>
<a name="l02141"></a>02141       <span class="keywordflow">for</span>(
<a name="l02142"></a>02142       ;     <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a> &lt; <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#2f9e0c9af661ea927729c08280e1105e" title="Number of cluster (include the two reserved cluster).">u32_CountofCluster</a>
<a name="l02143"></a>02143       ;     <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a>++ )
<a name="l02144"></a>02144       {
<a name="l02145"></a>02145          <span class="comment">// Get the value of the cluster</span>
<a name="l02146"></a>02146          <span class="keywordflow">if</span> ( !<a class="code" href="a00019.html#1be84552293d174f534b2fb8d0a4e737" title="This function returns or modifys a cluster value in FAT.">fat_cluster_val</a>( <a class="code" href="a00020.html#087734ece5cae84508fd1fbe9414ad02">FS_CLUST_VAL_READ</a> ) )
<a name="l02147"></a>02147             <span class="keywordflow">return</span> 0;
<a name="l02148"></a>02148 
<a name="l02149"></a>02149          <span class="keywordflow">if</span> ( 0 == <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> )
<a name="l02150"></a>02150             u32_nb_free_cluster++;
<a name="l02151"></a>02151       }
<a name="l02152"></a>02152    }
<a name="l02153"></a>02153    <span class="keywordflow">else</span>
<a name="l02154"></a>02154    {
<a name="l02155"></a>02155       <span class="keywordflow">if</span>( <a class="code" href="a00020.html#57a82f24a45a33a159e0362b7e82e3fa">Is_fat32</a> )
<a name="l02156"></a>02156       {
<a name="l02157"></a>02157          u32_nb_free_cluster = <a class="code" href="a00020.html#0a8beb16a074b07828fc725e0c0ae500" title="This function returns the space free in the selected FAT32 partition.">fat_read_fat32_FSInfo</a>();
<a name="l02158"></a>02158          <span class="keywordflow">if</span>( 0xFFFFFFFF != u32_nb_free_cluster )
<a name="l02159"></a>02159             <span class="keywordflow">goto</span> endof_fat_getfreespace;
<a name="l02160"></a>02160          u32_nb_free_cluster = 0;
<a name="l02161"></a>02161       }
<a name="l02162"></a>02162       <span class="comment">// Speed optimization only for FAT16 and FAT32</span>
<a name="l02163"></a>02163       <span class="comment">// init first value used by fat_cluster_readnext()</span>
<a name="l02164"></a>02164       <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#1be84552293d174f534b2fb8d0a4e737" title="This function returns or modifys a cluster value in FAT.">fat_cluster_val</a>( <a class="code" href="a00020.html#087734ece5cae84508fd1fbe9414ad02">FS_CLUST_VAL_READ</a> ))
<a name="l02165"></a>02165          <span class="keywordflow">return</span> FALSE;
<a name="l02166"></a>02166       <span class="keywordflow">for</span>(
<a name="l02167"></a>02167       ;     <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a> &lt; <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#2f9e0c9af661ea927729c08280e1105e" title="Number of cluster (include the two reserved cluster).">u32_CountofCluster</a>
<a name="l02168"></a>02168       ;     <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a>++ )
<a name="l02169"></a>02169       {
<a name="l02170"></a>02170          <span class="keywordflow">if</span> ( 0 == <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#4f323a1ec38e3c0f1b57bf4fe07842b7" title="cluster value">u32_val</a> )
<a name="l02171"></a>02171             u32_nb_free_cluster++;
<a name="l02172"></a>02172          <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#e28958d1a5e3ed006edf937e6b7dacc7" title="This function is optimized to read a continue cluster list on FAT16 and FAT32.">fat_cluster_readnext</a>() )
<a name="l02173"></a>02173             <span class="keywordflow">return</span> FALSE;
<a name="l02174"></a>02174       }
<a name="l02175"></a>02175 <span class="preprocessor">#if (FSFEATURE_WRITE_COMPLET == (FS_LEVEL_FEATURES &amp; FSFEATURE_WRITE_COMPLET) )</span>
<a name="l02176"></a>02176 <span class="preprocessor"></span>      <span class="keywordflow">if</span>( <a class="code" href="a00020.html#57a82f24a45a33a159e0362b7e82e3fa">Is_fat32</a> )
<a name="l02177"></a>02177       {
<a name="l02178"></a>02178          <span class="comment">// Save value for the future call</span>
<a name="l02179"></a>02179          <a class="code" href="a00020.html#9cf154ffe36bc2c00b1d589e523b449c" title="This function writes the space free number in selected FAT32 partition.">fat_write_fat32_FSInfo</a>( u32_nb_free_cluster );
<a name="l02180"></a>02180       }
<a name="l02181"></a>02181 <span class="preprocessor">#endif</span>
<a name="l02182"></a>02182 <span class="preprocessor"></span>   }
<a name="l02183"></a>02183 endof_fat_getfreespace:
<a name="l02184"></a>02184    <span class="keywordflow">return</span> (u32_nb_free_cluster * <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#cddebea9972567fdcb5b87327b48125e" title="Cluster size (unit 512B).">u8_BPB_SecPerClus</a>);
<a name="l02185"></a>02185 }
<a name="l02186"></a>02186 
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="14426d5552b72b88ea0d61828c57d6c6"></a><!-- doxytag: member="fat.h::fat_getfreespace_percent" ref="14426d5552b72b88ea0d61828c57d6c6" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">U8 fat_getfreespace_percent           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function returns the space free in percent. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>percent of free space (1 to 100) if 0, then error or full</dd></dl>
<div class="fragment"><pre class="fragment">
//! More speed than fat_getfreespace() routine but error delta 1%
//! </pre></div> 
<p>Definition at line <a class="el" href="a00052.html#l02198">2198</a> of file <a class="el" href="a00052.html">fat_unusual.c</a>.</p>

<p>References <a class="el" href="a00050.html#l01794">fat_cache_read_sector()</a>, <a class="el" href="a00050.html#l00603">fat_cluster_val()</a>, <a class="el" href="a00052.html#l02133">fat_getfreespace()</a>, <a class="el" href="a00052.html#l00888">fat_read_fat32_FSInfo()</a>, <a class="el" href="a00051.html#l00246">FS_CLUST_VAL_READ</a>, <a class="el" href="a00051.html#l00403">fs_g_cluster</a>, <a class="el" href="a00051.html#l00394">fs_g_nav</a>, <a class="el" href="a00051.html#l00415">fs_g_sector</a>, <a class="el" href="a00051.html#l00417">fs_gu32_addrsector</a>, <a class="el" href="a00051.html#l00075">Is_fat12</a>, <a class="el" href="a00051.html#l00080">Is_fat16</a>, <a class="el" href="a00051.html#l00085">Is_fat32</a>, <a class="el" href="a00051.html#l00275">Fs_management::u16_fat_size</a>, <a class="el" href="a00051.html#l00277">Fs_management::u32_CountofCluster</a>, <a class="el" href="a00051.html#l00324">st_fs_cluster::u32_pos</a>, and <a class="el" href="a00051.html#l00273">Fs_management::u8_BPB_SecPerClus</a>.</p>

<p>Referenced by <a class="el" href="a00067.html#l00627">nav_partition_freespace_percent()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l02198"></a>02198 {
<a name="l02199"></a>02199    U32 u32_nb_free_cluster = 0;
<a name="l02200"></a>02200    U16 u16_tmp, u16_pos;
<a name="l02201"></a>02201 
<a name="l02202"></a>02202    <span class="keywordflow">if</span>( <a class="code" href="a00020.html#c2ce5473766316396fb472c1bdd685e9">Is_fat12</a> )
<a name="l02203"></a>02203    {  <span class="comment">// No speed optimization necessary on FAT12</span>
<a name="l02204"></a>02204       <span class="keywordflow">return</span> (((<a class="code" href="a00020.html#e23270781477be5e6c89b90531c01651" title="This function returns the space free in the partition.">fat_getfreespace</a>()/<a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#cddebea9972567fdcb5b87327b48125e" title="Cluster size (unit 512B).">u8_BPB_SecPerClus</a>)*100) / <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#2f9e0c9af661ea927729c08280e1105e" title="Number of cluster (include the two reserved cluster).">u32_CountofCluster</a>);
<a name="l02205"></a>02205    }
<a name="l02206"></a>02206 
<a name="l02207"></a>02207 
<a name="l02208"></a>02208    <a class="code" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d" title="To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster...">fs_g_cluster</a>.<a class="code" href="a00012.html#06879786792eeefd3b45527499ed1174" title="cluster position">u32_pos</a> = 2;
<a name="l02209"></a>02209    <span class="comment">// Init first value used by fat_cluster_readnext()</span>
<a name="l02210"></a>02210    <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#1be84552293d174f534b2fb8d0a4e737" title="This function returns or modifys a cluster value in FAT.">fat_cluster_val</a>( <a class="code" href="a00020.html#087734ece5cae84508fd1fbe9414ad02">FS_CLUST_VAL_READ</a> ))
<a name="l02211"></a>02211       <span class="keywordflow">return</span> FALSE;
<a name="l02212"></a>02212 
<a name="l02213"></a>02213    <span class="comment">// The optimization is to</span>
<a name="l02214"></a>02214    <span class="comment">// - read only the LSB byte of cluster</span>
<a name="l02215"></a>02215    <span class="comment">// - read only 1 cluster for 2 clusters</span>
<a name="l02216"></a>02216    <span class="keywordflow">if</span>( <a class="code" href="a00020.html#57a82f24a45a33a159e0362b7e82e3fa">Is_fat32</a> )
<a name="l02217"></a>02217    {
<a name="l02218"></a>02218       u32_nb_free_cluster = <a class="code" href="a00020.html#0a8beb16a074b07828fc725e0c0ae500" title="This function returns the space free in the selected FAT32 partition.">fat_read_fat32_FSInfo</a>();
<a name="l02219"></a>02219       <span class="keywordflow">if</span>( 0xFFFFFFFF != u32_nb_free_cluster )
<a name="l02220"></a>02220          <span class="keywordflow">goto</span> endof_fat_getfreespace_percent;
<a name="l02221"></a>02221       u32_nb_free_cluster = 0;
<a name="l02222"></a>02222 
<a name="l02223"></a>02223       u16_pos = 2*4;
<a name="l02224"></a>02224       <span class="keywordflow">for</span>(  u16_tmp = <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#68924ecf6935ab3e5a32dee9e5d61f7d" title="Size of one FAT (unit 512B).">u16_fat_size</a>
<a name="l02225"></a>02225       ;     u16_tmp!=0
<a name="l02226"></a>02226       ;     u16_tmp-- )
<a name="l02227"></a>02227       {
<a name="l02228"></a>02228          <span class="keywordflow">for</span>( ; u16_pos &lt; 512 ; u16_pos += (2*4) )
<a name="l02229"></a>02229          {
<a name="l02230"></a>02230             <span class="keywordflow">if</span>( 0 == <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[u16_pos] )
<a name="l02231"></a>02231                u32_nb_free_cluster+=2;
<a name="l02232"></a>02232          }
<a name="l02233"></a>02233          <span class="comment">// Read next sector in FAT</span>
<a name="l02234"></a>02234          u16_pos = 0;
<a name="l02235"></a>02235          <a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a>++;
<a name="l02236"></a>02236          <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#a67dc439478853cefdd226f9c99c9539" title="This function loads a memory sector in internal cache sector.">fat_cache_read_sector</a>( TRUE ))
<a name="l02237"></a>02237             <span class="keywordflow">return</span> 0;
<a name="l02238"></a>02238       }
<a name="l02239"></a>02239    }
<a name="l02240"></a>02240 
<a name="l02241"></a>02241    <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#2dcd74d640da1e20ad510413c9ef4c85">Is_fat16</a> )
<a name="l02242"></a>02242    {
<a name="l02243"></a>02243       u16_pos = 2*2;
<a name="l02244"></a>02244 
<a name="l02245"></a>02245       <span class="keywordflow">for</span>(  u16_tmp = <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#68924ecf6935ab3e5a32dee9e5d61f7d" title="Size of one FAT (unit 512B).">u16_fat_size</a>
<a name="l02246"></a>02246       ;     u16_tmp!=0
<a name="l02247"></a>02247       ;     u16_tmp-- )
<a name="l02248"></a>02248       {
<a name="l02249"></a>02249          <span class="keywordflow">for</span>( ; u16_pos &lt; 512 ; u16_pos += (2*2) )
<a name="l02250"></a>02250          {
<a name="l02251"></a>02251             <span class="keywordflow">if</span>( 0 == <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[u16_pos] )
<a name="l02252"></a>02252                u32_nb_free_cluster+=2;
<a name="l02253"></a>02253          }
<a name="l02254"></a>02254          <span class="comment">// Read next sector in FAT</span>
<a name="l02255"></a>02255          u16_pos = 0;
<a name="l02256"></a>02256          <a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a>++;
<a name="l02257"></a>02257          <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#a67dc439478853cefdd226f9c99c9539" title="This function loads a memory sector in internal cache sector.">fat_cache_read_sector</a>( TRUE ))
<a name="l02258"></a>02258             <span class="keywordflow">return</span> 0;
<a name="l02259"></a>02259       }
<a name="l02260"></a>02260    }
<a name="l02261"></a>02261 
<a name="l02262"></a>02262    <span class="comment">// Compute percent</span>
<a name="l02263"></a>02263    <span class="keywordflow">if</span>( u32_nb_free_cluster &gt; <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#2f9e0c9af661ea927729c08280e1105e" title="Number of cluster (include the two reserved cluster).">u32_CountofCluster</a> )
<a name="l02264"></a>02264       <span class="keywordflow">return</span> 100;
<a name="l02265"></a>02265    <span class="keywordflow">if</span>( u32_nb_free_cluster &gt; ((<a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#2f9e0c9af661ea927729c08280e1105e" title="Number of cluster (include the two reserved cluster).">u32_CountofCluster</a>-u32_nb_free_cluster)/256) )
<a name="l02266"></a>02266    {
<a name="l02267"></a>02267       <span class="comment">// Compute and add a delta error</span>
<a name="l02268"></a>02268       u32_nb_free_cluster -= ((<a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#2f9e0c9af661ea927729c08280e1105e" title="Number of cluster (include the two reserved cluster).">u32_CountofCluster</a>-u32_nb_free_cluster)/256);
<a name="l02269"></a>02269    }
<a name="l02270"></a>02270 endof_fat_getfreespace_percent:
<a name="l02271"></a>02271    <span class="keywordflow">return</span> ((u32_nb_free_cluster * 100) / <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#2f9e0c9af661ea927729c08280e1105e" title="Number of cluster (include the two reserved cluster).">u32_CountofCluster</a>);
<a name="l02272"></a>02272 }
<a name="l02273"></a>02273 
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="9510bd193c1e70f2307c5b9b07078511"></a><!-- doxytag: member="fat.h::fat_initialize_dir" ref="9510bd193c1e70f2307c5b9b07078511" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_initialize_dir           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function writes the directory information. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE in case of error, see global value "fs_g_status" for more detail <p>
TRUE otherwise</dd></dl>
<div class="fragment"><pre class="fragment">
//! Global variables used
//! IN :
//!   fs_g_seg.u32_addr          cluster value of a directory
//! OUT:
//!   update the sector cache with init directory datas
//! </pre></div> 
<p>Definition at line <a class="el" href="a00052.html#l01181">1181</a> of file <a class="el" href="a00052.html">fat_unusual.c</a>.</p>

<p>References <a class="el" href="a00050.html#l01848">fat_cache_mark_sector_as_dirty()</a>, <a class="el" href="a00052.html#l02474">fat_clear_cluster()</a>, <a class="el" href="a00055.html#l00132">FS_ATTR_DIRECTORY</a>, <a class="el" href="a00051.html#l00394">fs_g_nav</a>, <a class="el" href="a00051.html#l00396">fs_g_nav_entry</a>, <a class="el" href="a00051.html#l00415">fs_g_sector</a>, <a class="el" href="a00051.html#l00197">FS_SIZE_FILE_ENTRY</a>, <a class="el" href="a00051.html#l00305">Fs_management_entry::u32_cluster</a>, and <a class="el" href="a00051.html#l00282">Fs_management::u32_cluster_sel_dir</a>.</p>

<p>Referenced by <a class="el" href="a00067.html#l01361">nav_dir_make()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01181"></a>01181 {
<a name="l01182"></a>01182    U8 u8_i;
<a name="l01183"></a>01183 
<a name="l01184"></a>01184    <span class="comment">// Clear the cluster corresponding at directory</span>
<a name="l01185"></a>01185    <span class="keywordflow">if</span>( !<a class="code" href="a00020.html#6cc9ee9a14553be84990df27709f51a6" title="This function clears one cluster.">fat_clear_cluster</a>())
<a name="l01186"></a>01186       <span class="keywordflow">return</span> FALSE;
<a name="l01187"></a>01187    <a class="code" href="a00019.html#45c0f16885c9e414ddb4b5afaa1cde34" title="This function sets a flag to signal that sector cache is modified.">fat_cache_mark_sector_as_dirty</a>();
<a name="l01188"></a>01188    <span class="comment">// here, the internal cache is the first sector of the cluster</span>
<a name="l01189"></a>01189 
<a name="l01190"></a>01190    <span class="comment">// Create the dot "." entry, this one is a directory that points to itself</span>
<a name="l01191"></a>01191    <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[0]=<span class="charliteral">'.'</span>;
<a name="l01192"></a>01192    <span class="keywordflow">for</span>( u8_i=1 ; u8_i&lt;11 ; u8_i++ )
<a name="l01193"></a>01193       <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[u8_i]=<span class="charliteral">' '</span>;
<a name="l01194"></a>01194    <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[11]=<a class="code" href="a00024.html#99004e3e756391a7ac1c4dde4db6864c">FS_ATTR_DIRECTORY</a>;
<a name="l01195"></a>01195    <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[26]= LSB0( <a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a> );
<a name="l01196"></a>01196    <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[27]= LSB1( <a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a> );
<a name="l01197"></a>01197    <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[20]= LSB2( <a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a> );
<a name="l01198"></a>01198    <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[21]= LSB3( <a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a> );
<a name="l01199"></a>01199    <span class="comment">// Create the dotdot ".." entry, this one points to the starting cluster of the parent directory</span>
<a name="l01200"></a>01200    <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00020.html#0ff67916e073882d162d5fbac91d7e50">FS_SIZE_FILE_ENTRY</a>+0]=<span class="charliteral">'.'</span>;
<a name="l01201"></a>01201    <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00020.html#0ff67916e073882d162d5fbac91d7e50">FS_SIZE_FILE_ENTRY</a>+1]=<span class="charliteral">'.'</span>;
<a name="l01202"></a>01202    <span class="keywordflow">for</span>( u8_i=2 ; u8_i&lt;11 ; u8_i++ )
<a name="l01203"></a>01203       <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00020.html#0ff67916e073882d162d5fbac91d7e50">FS_SIZE_FILE_ENTRY</a>+u8_i]=<span class="charliteral">' '</span>;
<a name="l01204"></a>01204    <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00020.html#0ff67916e073882d162d5fbac91d7e50">FS_SIZE_FILE_ENTRY</a>+11]=<a class="code" href="a00024.html#99004e3e756391a7ac1c4dde4db6864c">FS_ATTR_DIRECTORY</a>;
<a name="l01205"></a>01205    <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00020.html#0ff67916e073882d162d5fbac91d7e50">FS_SIZE_FILE_ENTRY</a>+26]= LSB0( <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#ed8faad36e96ff2f422ddadd3740713f" title="First cluster number of selected directory (0 for the root directory).">u32_cluster_sel_dir</a> );
<a name="l01206"></a>01206    <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00020.html#0ff67916e073882d162d5fbac91d7e50">FS_SIZE_FILE_ENTRY</a>+27]= LSB1( <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#ed8faad36e96ff2f422ddadd3740713f" title="First cluster number of selected directory (0 for the root directory).">u32_cluster_sel_dir</a> );
<a name="l01207"></a>01207    <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00020.html#0ff67916e073882d162d5fbac91d7e50">FS_SIZE_FILE_ENTRY</a>+20]= LSB2( <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#ed8faad36e96ff2f422ddadd3740713f" title="First cluster number of selected directory (0 for the root directory).">u32_cluster_sel_dir</a> );
<a name="l01208"></a>01208    <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00020.html#0ff67916e073882d162d5fbac91d7e50">FS_SIZE_FILE_ENTRY</a>+21]= LSB3( <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#ed8faad36e96ff2f422ddadd3740713f" title="First cluster number of selected directory (0 for the root directory).">u32_cluster_sel_dir</a> );
<a name="l01209"></a>01209 
<a name="l01210"></a>01210    <span class="keywordflow">return</span> TRUE;
<a name="l01211"></a>01211 }
<a name="l01212"></a>01212 <span class="preprocessor">#endif  // FS_LEVEL_FEATURES</span>
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="65cfc6e07b1a1bc3a12d564148daca37"></a><!-- doxytag: member="fat.h::fat_invert_nav" ref="65cfc6e07b1a1bc3a12d564148daca37" args="(U8 u8_idnav)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fat_invert_nav           </td>
          <td>(</td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>u8_idnav</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function inverts the current navigation with another. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>u8_idnav</em>&nbsp;</td><td>Id navigator to invert </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="a00050.html#l01968">1968</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00051.html#l00394">fs_g_nav</a>, <a class="el" href="a00051.html#l00396">fs_g_nav_entry</a>, <a class="el" href="a00051.html#l00395">fs_g_nav_fast</a>, <a class="el" href="a00050.html#l00060">fs_g_navext</a>, <a class="el" href="a00050.html#l00062">fs_g_navext_entry</a>, and <a class="el" href="a00050.html#l00061">fs_g_navext_fast</a>.</p>

<p>Referenced by <a class="el" href="a00067.html#l00237">nav_select()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01969"></a>01969 {
<a name="l01970"></a>01970    _MEM_TYPE_SLOW_ U8 Temp[Max(Max(<span class="keyword">sizeof</span>(<a class="code" href="a00004.html" title="Struture to save the variables frequently used by file system mounted.">Fs_management</a>),<span class="keyword">sizeof</span>(<a class="code" href="a00005.html" title="Struture to save the frequently variables of file system mounted.">Fs_management_entry</a>)),<span class="keyword">sizeof</span>(<a class="code" href="a00006.html" title="Struture to save the variables very frequently used by file system mounted.">Fs_management_fast</a>))];
<a name="l01971"></a>01971 
<a name="l01972"></a>01972    <span class="keywordflow">if</span>( u8_idnav == 0 )
<a name="l01973"></a>01973       <span class="keywordflow">return</span>;
<a name="l01974"></a>01974    u8_idnav--;
<a name="l01975"></a>01975 
<a name="l01976"></a>01976    memcpy_ram2ram(Temp,                              (U8*)&amp;<a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>,                     <span class="keyword">sizeof</span>(<a class="code" href="a00004.html" title="Struture to save the variables frequently used by file system mounted.">Fs_management</a>));
<a name="l01977"></a>01977    memcpy_ram2ram((U8*)&amp;fs_g_nav,                    (U8*)&amp;<a class="code" href="a00019.html#0d59a916e72039fa7f898cd233f8fe2f">fs_g_navext</a>[u8_idnav],        <span class="keyword">sizeof</span>(<a class="code" href="a00004.html" title="Struture to save the variables frequently used by file system mounted.">Fs_management</a>));
<a name="l01978"></a>01978    memcpy_ram2ram((U8*)&amp;<a class="code" href="a00019.html#0d59a916e72039fa7f898cd233f8fe2f">fs_g_navext</a>[u8_idnav],       Temp,                               <span class="keyword">sizeof</span>(<a class="code" href="a00004.html" title="Struture to save the variables frequently used by file system mounted.">Fs_management</a>));
<a name="l01979"></a>01979 
<a name="l01980"></a>01980    memcpy_ram2ram(Temp,                              (U8*)&amp;<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>,               <span class="keyword">sizeof</span>(<a class="code" href="a00005.html" title="Struture to save the frequently variables of file system mounted.">Fs_management_entry</a>));
<a name="l01981"></a>01981    memcpy_ram2ram((U8*)&amp;fs_g_nav_entry,              (U8*)&amp;<a class="code" href="a00019.html#90e0163ac7f98f08019dc0b73fd7c834">fs_g_navext_entry</a>[u8_idnav],  <span class="keyword">sizeof</span>(<a class="code" href="a00005.html" title="Struture to save the frequently variables of file system mounted.">Fs_management_entry</a>));
<a name="l01982"></a>01982    memcpy_ram2ram((U8*)&amp;<a class="code" href="a00019.html#90e0163ac7f98f08019dc0b73fd7c834">fs_g_navext_entry</a>[u8_idnav], Temp,                               <span class="keyword">sizeof</span>(<a class="code" href="a00005.html" title="Struture to save the frequently variables of file system mounted.">Fs_management_entry</a>));
<a name="l01983"></a>01983 
<a name="l01984"></a>01984    memcpy_ram2ram(Temp,                              (U8*)&amp;<a class="code" href="a00020.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>,                <span class="keyword">sizeof</span>(<a class="code" href="a00006.html" title="Struture to save the variables very frequently used by file system mounted.">Fs_management_fast</a>));
<a name="l01985"></a>01985    memcpy_ram2ram((U8*)&amp;fs_g_nav_fast,               (U8*)&amp;<a class="code" href="a00019.html#d24195746b40d4a83dff493c118b91aa">fs_g_navext_fast</a>[u8_idnav],   <span class="keyword">sizeof</span>(<a class="code" href="a00006.html" title="Struture to save the variables very frequently used by file system mounted.">Fs_management_fast</a>));
<a name="l01986"></a>01986    memcpy_ram2ram((U8*)&amp;<a class="code" href="a00019.html#d24195746b40d4a83dff493c118b91aa">fs_g_navext_fast</a>[u8_idnav],  Temp,                               <span class="keyword">sizeof</span>(<a class="code" href="a00006.html" title="Struture to save the variables very frequently used by file system mounted.">Fs_management_fast</a>));
<a name="l01987"></a>01987 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="c0108ea608b547e8d3a405c70644c1e9"></a><!-- doxytag: member="fat.h::fat_mount" ref="c0108ea608b547e8d3a405c70644c1e9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_mount           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function mounts a partition. 
<p>
This function mounts a partition.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE in case of error, see global value "fs_g_status" for more detail <p>
TRUE otherwise</dd></dl>
<div class="fragment"><pre class="fragment">
//! Global variables used
//! IN :
//!   fs_g_nav.u8_lun            Indicate the drive to mount
//!   fs_g_nav.u8_partition      Indicate the partition to mount (if FS_MULTI_PARTITION =  ENABLED )
//! OUT:
//!   fs_g_nav                   update structure
//! If the FS_MULTI_PARTITION option is disabled
//! then the mount routine selects the first partition supported by file system. &lt;br&gt;
//! </pre></div> 
<p>Definition at line <a class="el" href="a00052.html#l00105">105</a> of file <a class="el" href="a00052.html">fat_unusual.c</a>.</p>

<p>References <a class="el" href="a00050.html#l01794">fat_cache_read_sector()</a>, <a class="el" href="a00050.html#l00091">fat_check_device()</a>, <a class="el" href="a00050.html#l01394">fat_clear_entry_info_and_ptr()</a>, <a class="el" href="a00051.html#l00216">FS_512B</a>, <a class="el" href="a00051.html#l00146">FS_BR_SIGNATURE_HIGH</a>, <a class="el" href="a00051.html#l00145">FS_BR_SIGNATURE_LOW</a>, <a class="el" href="a00055.html#l00191">FS_ERR_NO_FORMAT</a>, <a class="el" href="a00055.html#l00192">FS_ERR_NO_PART</a>, <a class="el" href="a00055.html#l00193">FS_ERR_NO_SUPPORT_PART</a>, <a class="el" href="a00051.html#l00182">FS_FAT12_MAX_CLUSTERS</a>, <a class="el" href="a00051.html#l00183">FS_FAT16_MAX_CLUSTERS</a>, <a class="el" href="a00051.html#l00394">fs_g_nav</a>, <a class="el" href="a00051.html#l00395">fs_g_nav_fast</a>, <a class="el" href="a00051.html#l00415">fs_g_sector</a>, <a class="el" href="a00055.html#l00256">fs_g_status</a>, <a class="el" href="a00051.html#l00417">fs_gu32_addrsector</a>, <a class="el" href="a00051.html#l00108">FS_MBR_OFFSET_PART_ENTRY</a>, <a class="el" href="a00051.html#l00208">FS_NB_FAT</a>, <a class="el" href="a00051.html#l00152">FS_PART_BOOTABLE</a>, <a class="el" href="a00051.html#l00153">FS_PART_NO_BOOTABLE</a>, <a class="el" href="a00051.html#l00167">FS_PART_TYPE_FAT12</a>, <a class="el" href="a00051.html#l00168">FS_PART_TYPE_FAT16_INF32M</a>, <a class="el" href="a00051.html#l00169">FS_PART_TYPE_FAT16_SUP32M</a>, <a class="el" href="a00051.html#l00170">FS_PART_TYPE_FAT16_SUP32M_BIS</a>, <a class="el" href="a00051.html#l00171">FS_PART_TYPE_FAT32</a>, <a class="el" href="a00051.html#l00172">FS_PART_TYPE_FAT32_BIS</a>, <a class="el" href="a00051.html#l00197">FS_SIZE_FILE_ENTRY</a>, <a class="el" href="a00051.html#l00359">FS_TYPE_FAT_12</a>, <a class="el" href="a00051.html#l00360">FS_TYPE_FAT_16</a>, <a class="el" href="a00051.html#l00361">FS_TYPE_FAT_32</a>, <a class="el" href="a00051.html#l00358">FS_TYPE_FAT_UNM</a>, <a class="el" href="a00051.html#l00115">HIGH_16_BPB_BytsPerSec</a>, <a class="el" href="a00051.html#l00120">HIGH_16_BPB_FATSz16</a>, <a class="el" href="a00051.html#l00132">HIGH_16_BPB_ResvSecCnt</a>, <a class="el" href="a00051.html#l00118">HIGH_16_BPB_RootEntCnt</a>, <a class="el" href="a00051.html#l00126">HIGH_16_BPB_TotSec16</a>, <a class="el" href="a00051.html#l00121">LOW0_32_BPB_FATSz32</a>, <a class="el" href="a00051.html#l00134">LOW0_32_BPB_RootClus</a>, <a class="el" href="a00051.html#l00127">LOW0_32_BPB_TotSec32</a>, <a class="el" href="a00051.html#l00122">LOW1_32_BPB_FATSz32</a>, <a class="el" href="a00051.html#l00135">LOW1_32_BPB_RootClus</a>, <a class="el" href="a00051.html#l00128">LOW1_32_BPB_TotSec32</a>, <a class="el" href="a00051.html#l00123">LOW2_32_BPB_FATSz32</a>, <a class="el" href="a00051.html#l00136">LOW2_32_BPB_RootClus</a>, <a class="el" href="a00051.html#l00129">LOW2_32_BPB_TotSec32</a>, <a class="el" href="a00051.html#l00124">LOW3_32_BPB_FATSz32</a>, <a class="el" href="a00051.html#l00137">LOW3_32_BPB_RootClus</a>, <a class="el" href="a00051.html#l00130">LOW3_32_BPB_TotSec32</a>, <a class="el" href="a00051.html#l00119">LOW_16_BPB_FATSz16</a>, <a class="el" href="a00051.html#l00138">LOW_16_BPB_FSInfo</a>, <a class="el" href="a00051.html#l00131">LOW_16_BPB_ResvSecCnt</a>, <a class="el" href="a00051.html#l00117">LOW_16_BPB_RootEntCnt</a>, <a class="el" href="a00051.html#l00125">LOW_16_BPB_TotSec16</a>, <a class="el" href="a00048.html#l00327">mem_sector_size()</a>, <a class="el" href="a00051.html#l00280">Fs_management::rootdir</a>, <a class="el" href="a00007.html#996b5fc79b7527c2b3dc3b34ed98f428">Fs_rootdir::seg</a>, <a class="el" href="a00051.html#l00275">Fs_management::u16_fat_size</a>, <a class="el" href="a00051.html#l00276">Fs_management::u16_offset_FSInfo</a>, <a class="el" href="a00051.html#l00261">Fs_rootdir::u16_pos</a>, <a class="el" href="a00051.html#l00262">Fs_rootdir::u16_size</a>, <a class="el" href="a00051.html#l00258">Fs_rootdir::u32_cluster</a>, <a class="el" href="a00051.html#l00282">Fs_management::u32_cluster_sel_dir</a>, <a class="el" href="a00051.html#l00277">Fs_management::u32_CountofCluster</a>, <a class="el" href="a00051.html#l00279">Fs_management::u32_offset_data</a>, <a class="el" href="a00051.html#l00278">Fs_management::u32_ptr_fat</a>, <a class="el" href="a00051.html#l00116">U8_BPB_SecPerClus</a>, <a class="el" href="a00051.html#l00273">Fs_management::u8_BPB_SecPerClus</a>, <a class="el" href="a00051.html#l00269">Fs_management::u8_lun</a>, <a class="el" href="a00051.html#l00271">Fs_management::u8_partition</a>, and <a class="el" href="a00051.html#l00295">Fs_management_fast::u8_type_fat</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00154">fat_check_mount()</a>, <a class="el" href="a00067.html#l00399">nav_drive_format()</a>, and <a class="el" href="a00067.html#l00461">nav_partition_mount()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00106"></a>00106 {
<a name="l00107"></a>00107    U8  u8_sector_size;
<a name="l00108"></a>00108    U8  u8_tmp;
<a name="l00109"></a>00109    U16 u16_tmp;
<a name="l00110"></a>00110    U32 u32_tmp;
<a name="l00111"></a>00111 
<a name="l00112"></a>00112    <span class="comment">// Select the root directory</span>
<a name="l00113"></a>00113    <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#ed8faad36e96ff2f422ddadd3740713f" title="First cluster number of selected directory (0 for the root directory).">u32_cluster_sel_dir</a>   = 0;
<a name="l00114"></a>00114    <span class="comment">// No selected file</span>
<a name="l00115"></a>00115    <a class="code" href="a00019.html#56d9a210bc2d4b0b5c46cb24a2e9f690" title="This function resets the selection pointers.">fat_clear_entry_info_and_ptr</a>();
<a name="l00116"></a>00116 
<a name="l00117"></a>00117    <a class="code" href="a00020.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00006.html#74121fb3c8d3a1d018c911650e2ec920" title="FAT type (default = no mounted = FS_TYPE_FAT_UNM).">u8_type_fat</a> = <a class="code" href="a00020.html#429fbd0498704c3d5864877548040069" title="Partition not mounted.">FS_TYPE_FAT_UNM</a>;
<a name="l00118"></a>00118    <a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a> = 0;    <span class="comment">// Start read at the beginning of memory</span>
<a name="l00119"></a>00119 
<a name="l00120"></a>00120    <span class="comment">// Check if the drive is availabled</span>
<a name="l00121"></a>00121    <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#eeec0bd6755a6be4c4dda2b4669eb0ae" title="This function checks device state.">fat_check_device</a>() )
<a name="l00122"></a>00122       <span class="keywordflow">return</span> FALSE;
<a name="l00123"></a>00123 
<a name="l00124"></a>00124    <span class="keywordflow">while</span>( 1 )  <span class="comment">// Search a valid partition</span>
<a name="l00125"></a>00125    {
<a name="l00126"></a>00126       <span class="comment">// Read one sector</span>
<a name="l00127"></a>00127       <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#a67dc439478853cefdd226f9c99c9539" title="This function loads a memory sector in internal cache sector.">fat_cache_read_sector</a>( TRUE ))
<a name="l00128"></a>00128          <span class="keywordflow">return</span> FALSE;
<a name="l00129"></a>00129 
<a name="l00130"></a>00130       <span class="comment">// Check PBR/MBR signature</span>
<a name="l00131"></a>00131       <span class="keywordflow">if</span> ( (<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[510] != <a class="code" href="a00020.html#36f09355f7020d410cb43695cab680fa">FS_BR_SIGNATURE_LOW</a>  )
<a name="l00132"></a>00132       &amp;&amp;   (<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[511] != <a class="code" href="a00020.html#b4cd4bfc6a5baebc1d25bbc5d5db2c15">FS_BR_SIGNATURE_HIGH</a> ) )
<a name="l00133"></a>00133       {
<a name="l00134"></a>00134          <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#34de358c4f6461ed5f3f199fd5cb679f" title="The selected drive isn&amp;#39;t formated.">FS_ERR_NO_FORMAT</a>;
<a name="l00135"></a>00135          <span class="keywordflow">return</span> FALSE;
<a name="l00136"></a>00136       }
<a name="l00137"></a>00137 
<a name="l00138"></a>00138       <span class="keywordflow">if</span> ( 0 == <a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a> )
<a name="l00139"></a>00139       {
<a name="l00140"></a>00140          <span class="comment">//** first sector then check a MBR structure</span>
<a name="l00141"></a>00141          <span class="comment">// Search the first partition supported</span>
<a name="l00142"></a>00142 <span class="preprocessor">#if (FS_MULTI_PARTITION == ENABLED)</span>
<a name="l00143"></a>00143 <span class="preprocessor"></span>         u16_tmp=0;  <span class="comment">// Init to "no valid partition found"</span>
<a name="l00144"></a>00144 <span class="preprocessor">#endif</span>
<a name="l00145"></a>00145 <span class="preprocessor"></span>         <span class="keywordflow">for</span>( u8_tmp=0 ; u8_tmp!=4 ; u8_tmp++ )
<a name="l00146"></a>00146          {
<a name="l00147"></a>00147             <span class="comment">// The first sector must be a MBR, then check the partition entry in the MBR</span>
<a name="l00148"></a>00148             <span class="keywordflow">if</span> ( ((<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00020.html#70b90ba913c43a878e9b478de5d1b61c" title="Position (unit byte) in the MBR of a partition entry.">FS_MBR_OFFSET_PART_ENTRY</a>(u8_tmp)+0] == <a class="code" href="a00020.html#b01eb16ba36dc7c0412a886c1678232f">FS_PART_BOOTABLE</a>             )||
<a name="l00149"></a>00149                   (<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00020.html#70b90ba913c43a878e9b478de5d1b61c" title="Position (unit byte) in the MBR of a partition entry.">FS_MBR_OFFSET_PART_ENTRY</a>(u8_tmp)+0] == <a class="code" href="a00020.html#e9933a03e28f302f391f377b8efc001d">FS_PART_NO_BOOTABLE</a>          )  )
<a name="l00150"></a>00150             &amp;&amp;   ((<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00020.html#70b90ba913c43a878e9b478de5d1b61c" title="Position (unit byte) in the MBR of a partition entry.">FS_MBR_OFFSET_PART_ENTRY</a>(u8_tmp)+4] == <a class="code" href="a00020.html#d8702ceb3912c09278602d3ea33224ff">FS_PART_TYPE_FAT12</a>           )||
<a name="l00151"></a>00151                   (<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00020.html#70b90ba913c43a878e9b478de5d1b61c" title="Position (unit byte) in the MBR of a partition entry.">FS_MBR_OFFSET_PART_ENTRY</a>(u8_tmp)+4] == <a class="code" href="a00020.html#b9f13193999f7bb7ea0e4be6cf5ee57b">FS_PART_TYPE_FAT16_INF32M</a>    )||
<a name="l00152"></a>00152                   (<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00020.html#70b90ba913c43a878e9b478de5d1b61c" title="Position (unit byte) in the MBR of a partition entry.">FS_MBR_OFFSET_PART_ENTRY</a>(u8_tmp)+4] == <a class="code" href="a00020.html#29856400974fc942f9cf900a44ea7389">FS_PART_TYPE_FAT16_SUP32M</a>    )||
<a name="l00153"></a>00153                   (<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00020.html#70b90ba913c43a878e9b478de5d1b61c" title="Position (unit byte) in the MBR of a partition entry.">FS_MBR_OFFSET_PART_ENTRY</a>(u8_tmp)+4] == <a class="code" href="a00020.html#c7c65caf9513f8cddd4319b334813d85">FS_PART_TYPE_FAT16_SUP32M_BIS</a>)||
<a name="l00154"></a>00154                   (<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00020.html#70b90ba913c43a878e9b478de5d1b61c" title="Position (unit byte) in the MBR of a partition entry.">FS_MBR_OFFSET_PART_ENTRY</a>(u8_tmp)+4] == <a class="code" href="a00020.html#93881dd293ba41286e413bef3212786a">FS_PART_TYPE_FAT32</a>           )||
<a name="l00155"></a>00155                   (<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00020.html#70b90ba913c43a878e9b478de5d1b61c" title="Position (unit byte) in the MBR of a partition entry.">FS_MBR_OFFSET_PART_ENTRY</a>(u8_tmp)+4] == <a class="code" href="a00020.html#3e13e837536764161f0aa9768e76b2e1">FS_PART_TYPE_FAT32_BIS</a>       )) )
<a name="l00156"></a>00156             {
<a name="l00157"></a>00157                <span class="comment">// A valid partition is found</span>
<a name="l00158"></a>00158 <span class="preprocessor">#if (FS_MULTI_PARTITION == ENABLED)</span>
<a name="l00159"></a>00159 <span class="preprocessor"></span>               <span class="keywordflow">if</span>( u16_tmp == <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#af482bc02a186c363c37c93e169fbbd4" title="Number of partition - 1 (0 or 1).">u8_partition</a> )
<a name="l00160"></a>00160                   <span class="keywordflow">break</span>;   <span class="comment">// The selected partition is valid</span>
<a name="l00161"></a>00161                u16_tmp++;
<a name="l00162"></a>00162 <span class="preprocessor">#else</span>
<a name="l00163"></a>00163 <span class="preprocessor"></span>               <span class="keywordflow">break</span>;
<a name="l00164"></a>00164 <span class="preprocessor">#endif</span>
<a name="l00165"></a>00165 <span class="preprocessor"></span>            }
<a name="l00166"></a>00166          }
<a name="l00167"></a>00167          <span class="keywordflow">if</span>( u8_tmp != 4 )
<a name="l00168"></a>00168          {
<a name="l00169"></a>00169             <span class="comment">// Partition found -&gt; Get partition position (unit sector) at offset 8</span>
<a name="l00170"></a>00170             LSB0(<a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a>) = <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00020.html#70b90ba913c43a878e9b478de5d1b61c" title="Position (unit byte) in the MBR of a partition entry.">FS_MBR_OFFSET_PART_ENTRY</a>(u8_tmp)+8];
<a name="l00171"></a>00171             LSB1(<a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a>) = <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00020.html#70b90ba913c43a878e9b478de5d1b61c" title="Position (unit byte) in the MBR of a partition entry.">FS_MBR_OFFSET_PART_ENTRY</a>(u8_tmp)+9];
<a name="l00172"></a>00172             LSB2(<a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a>) = <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00020.html#70b90ba913c43a878e9b478de5d1b61c" title="Position (unit byte) in the MBR of a partition entry.">FS_MBR_OFFSET_PART_ENTRY</a>(u8_tmp)+10];
<a name="l00173"></a>00173             LSB3(<a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a>) = <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[<a class="code" href="a00020.html#70b90ba913c43a878e9b478de5d1b61c" title="Position (unit byte) in the MBR of a partition entry.">FS_MBR_OFFSET_PART_ENTRY</a>(u8_tmp)+11];
<a name="l00174"></a>00174             <a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a> *= <a class="code" href="a00017.html#6f34e66828041ff96e8bc09efa5a4bec" title="Returns the size of the physical sector.">mem_sector_size</a>( <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a> );
<a name="l00175"></a>00175             <span class="keywordflow">continue</span>;   <span class="comment">// Go to check PBR of partition</span>
<a name="l00176"></a>00176          }
<a name="l00177"></a>00177 
<a name="l00178"></a>00178          <span class="comment">// No MBR found then check PBR</span>
<a name="l00179"></a>00179 <span class="preprocessor">#if (FS_MULTI_PARTITION == ENABLED)</span>
<a name="l00180"></a>00180 <span class="preprocessor"></span>         <span class="comment">// The device don't have mutli partition, but only one</span>
<a name="l00181"></a>00181          <span class="keywordflow">if</span> ( 0 != <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#af482bc02a186c363c37c93e169fbbd4" title="Number of partition - 1 (0 or 1).">u8_partition</a> )
<a name="l00182"></a>00182          {
<a name="l00183"></a>00183             <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#bf3770f49c4ecabdec290f9238f4a906" title="The selected partition doesn&amp;#39;t existed.">FS_ERR_NO_PART</a>;
<a name="l00184"></a>00184             <span class="keywordflow">return</span> FALSE;
<a name="l00185"></a>00185          }
<a name="l00186"></a>00186 <span class="preprocessor">#endif</span>
<a name="l00187"></a>00187 <span class="preprocessor"></span>      }
<a name="l00188"></a>00188 
<a name="l00189"></a>00189       <span class="comment">//** Check a PBR structure</span>
<a name="l00190"></a>00190       <span class="keywordflow">if</span> ( (<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[0] == 0xEB) &amp;&amp;          <span class="comment">// PBR Byte 0</span>
<a name="l00191"></a>00191            (<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[2] == 0x90) &amp;&amp;          <span class="comment">// PBR Byte 2</span>
<a name="l00192"></a>00192            ((<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[21] &amp; 0xF0) == 0xF0) ) <span class="comment">// PBR Byte 21 : Media byte</span>
<a name="l00193"></a>00193       {
<a name="l00194"></a>00194          <span class="keywordflow">break</span>;   <span class="comment">// valid PBR found</span>
<a name="l00195"></a>00195       }
<a name="l00196"></a>00196       <span class="comment">// PBR not found</span>
<a name="l00197"></a>00197       <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#bf3770f49c4ecabdec290f9238f4a906" title="The selected partition doesn&amp;#39;t existed.">FS_ERR_NO_PART</a>;
<a name="l00198"></a>00198       <span class="keywordflow">return</span> FALSE;
<a name="l00199"></a>00199    }
<a name="l00200"></a>00200 
<a name="l00201"></a>00201    <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00024.html#76bd560138ff87de29b59767546d8bf3" title="The selected partition isn&amp;#39;t supported.">FS_ERR_NO_SUPPORT_PART</a>;  <span class="comment">// by default partition no supported</span>
<a name="l00202"></a>00202 
<a name="l00203"></a>00203    <span class="comment">// Get sector size of File System (unit 512B)</span>
<a name="l00204"></a>00204    <span class="comment">// To translate from sector disk unit to sector 512B unit</span>
<a name="l00205"></a>00205    u8_sector_size = <a class="code" href="a00020.html#1bf0f3b3cb79deb5b7c459b5d10449d5">HIGH_16_BPB_BytsPerSec</a>/2;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207    <span class="comment">// Read BPB_SecPerClus (unit sector)</span>
<a name="l00208"></a>00208    <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#cddebea9972567fdcb5b87327b48125e" title="Cluster size (unit 512B).">u8_BPB_SecPerClus</a> = <a class="code" href="a00020.html#14c055fd6f5b4bda4470668bab3694ee">U8_BPB_SecPerClus</a> * u8_sector_size;
<a name="l00209"></a>00209 
<a name="l00210"></a>00210    <span class="comment">//** FAT Type determination (algorithm of "Hardware White Paper FAT")</span>
<a name="l00211"></a>00211    <span class="comment">// Get FAT size (unit sector)</span>
<a name="l00212"></a>00212    LSB( u16_tmp ) = <a class="code" href="a00020.html#fe57e984b2baf3970ac7feda02355ac9">LOW_16_BPB_FATSz16</a>;
<a name="l00213"></a>00213    MSB( u16_tmp ) = <a class="code" href="a00020.html#c7277af1ce6ee4efe860da2d1f3b1b38">HIGH_16_BPB_FATSz16</a>;
<a name="l00214"></a>00214    <span class="keywordflow">if</span> ( 0==u16_tmp )
<a name="l00215"></a>00215    {
<a name="l00216"></a>00216       LSB( u16_tmp ) = <a class="code" href="a00020.html#c1ba95f06dfaaf3c71a5eb12dd56009c">LOW0_32_BPB_FATSz32</a>;
<a name="l00217"></a>00217       MSB( u16_tmp ) = <a class="code" href="a00020.html#dff814b0d106b4c3b3f730fbef8338ce">LOW1_32_BPB_FATSz32</a>;
<a name="l00218"></a>00218       <span class="comment">// a large FAT32 isn't supported by this file system</span>
<a name="l00219"></a>00219       <span class="keywordflow">if</span>( (0 != <a class="code" href="a00020.html#8ef0e71139f216c7aaa15dc92f04ad74">LOW2_32_BPB_FATSz32</a> )
<a name="l00220"></a>00220       ||  (0 != <a class="code" href="a00020.html#ae445a7061c79d078f70001aa7d5ca16">LOW3_32_BPB_FATSz32</a> ) )
<a name="l00221"></a>00221       {
<a name="l00222"></a>00222          <span class="keywordflow">return</span> FALSE;
<a name="l00223"></a>00223       }
<a name="l00224"></a>00224    }
<a name="l00225"></a>00225    <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#68924ecf6935ab3e5a32dee9e5d61f7d" title="Size of one FAT (unit 512B).">u16_fat_size</a> = u16_tmp * u8_sector_size;
<a name="l00226"></a>00226 
<a name="l00227"></a>00227    <span class="comment">// Get total count of sectors in partition</span>
<a name="l00228"></a>00228    <span class="keywordflow">if</span> ( (0==<a class="code" href="a00020.html#b63400ba470fe3bf6c110a0af483ccc0">LOW_16_BPB_TotSec16</a>) &amp;&amp; (0==<a class="code" href="a00020.html#3f384bfdb0b306957dbc5f9c9b087dbe">HIGH_16_BPB_TotSec16</a>) )
<a name="l00229"></a>00229    {
<a name="l00230"></a>00230       LSB0( u32_tmp ) = <a class="code" href="a00020.html#874e06185fcba59848db370a65ffb162">LOW0_32_BPB_TotSec32</a>;
<a name="l00231"></a>00231       LSB1( u32_tmp ) = <a class="code" href="a00020.html#36c744b34bb704e3777d34a3b4c365a7">LOW1_32_BPB_TotSec32</a>;
<a name="l00232"></a>00232       LSB2( u32_tmp ) = <a class="code" href="a00020.html#b1bff622ef1d89f52b64b80e0f04bb4c">LOW2_32_BPB_TotSec32</a>;
<a name="l00233"></a>00233       LSB3( u32_tmp ) = <a class="code" href="a00020.html#f6bd554441216cd3475dd35a23d2a282">LOW3_32_BPB_TotSec32</a>;
<a name="l00234"></a>00234    }
<a name="l00235"></a>00235    <span class="keywordflow">else</span>
<a name="l00236"></a>00236    {
<a name="l00237"></a>00237       LSB0( u32_tmp ) = <a class="code" href="a00020.html#b63400ba470fe3bf6c110a0af483ccc0">LOW_16_BPB_TotSec16</a>;
<a name="l00238"></a>00238       LSB1( u32_tmp ) = <a class="code" href="a00020.html#3f384bfdb0b306957dbc5f9c9b087dbe">HIGH_16_BPB_TotSec16</a>;
<a name="l00239"></a>00239       LSB2( u32_tmp ) = 0;
<a name="l00240"></a>00240       LSB3( u32_tmp ) = 0;
<a name="l00241"></a>00241    }
<a name="l00242"></a>00242    u32_tmp *= u8_sector_size;   <span class="comment">// Translate from sector disk unit to sector 512B unit</span>
<a name="l00243"></a>00243 
<a name="l00244"></a>00244    <span class="comment">// Compute the offset (unit 512B) between the end of FAT (beginning of root dir in FAT1x) and the beginning of PBR</span>
<a name="l00245"></a>00245    <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#b26050633d0597af6c2c6abe9684481b" title="Root directory informations.">rootdir</a>.<a class="code" href="a00007.html#996b5fc79b7527c2b3dc3b34ed98f428" title="For FAT 12 &amp;amp; 16, it is a segment (no cluster list).">seg</a>.<a class="code" href="a00007.html#a17ca07269fcb28d77b14e5a67d56378" title="Offset between the beginning of FAT and the beginning of root dir (unit 512B).">u16_pos</a> = <a class="code" href="a00020.html#4d46dee315ad22b94de647e7c883edc0">FS_NB_FAT</a> * <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#68924ecf6935ab3e5a32dee9e5d61f7d" title="Size of one FAT (unit 512B).">u16_fat_size</a>;
<a name="l00246"></a>00246 
<a name="l00247"></a>00247    <span class="comment">// Compute the root directory size (unit sector), for FAT32 is always 0</span>
<a name="l00248"></a>00248    LSB( u16_tmp ) = <a class="code" href="a00020.html#b1eab4cea0637f0fa8c7e521968803a2">LOW_16_BPB_RootEntCnt</a>;
<a name="l00249"></a>00249    MSB( u16_tmp ) = <a class="code" href="a00020.html#8f6e516573fdbd3ea8eadd402cc6e134">HIGH_16_BPB_RootEntCnt</a>;
<a name="l00250"></a>00250    <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#b26050633d0597af6c2c6abe9684481b" title="Root directory informations.">rootdir</a>.<a class="code" href="a00007.html#996b5fc79b7527c2b3dc3b34ed98f428" title="For FAT 12 &amp;amp; 16, it is a segment (no cluster list).">seg</a>.<a class="code" href="a00007.html#5e384bddb7393218e17f0329d1b8527f" title="Size of root (unit 512B).">u16_size</a> = ((u16_tmp * <a class="code" href="a00020.html#0ff67916e073882d162d5fbac91d7e50">FS_SIZE_FILE_ENTRY</a>) + ((<a class="code" href="a00020.html#e6e52ba6ed3159395fab025719b91bd0">FS_512B</a>*u8_sector_size)-1)) / (<a class="code" href="a00020.html#e6e52ba6ed3159395fab025719b91bd0">FS_512B</a>*u8_sector_size);
<a name="l00251"></a>00251    <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#b26050633d0597af6c2c6abe9684481b" title="Root directory informations.">rootdir</a>.<a class="code" href="a00007.html#996b5fc79b7527c2b3dc3b34ed98f428" title="For FAT 12 &amp;amp; 16, it is a segment (no cluster list).">seg</a>.<a class="code" href="a00007.html#5e384bddb7393218e17f0329d1b8527f" title="Size of root (unit 512B).">u16_size</a> *= u8_sector_size;
<a name="l00252"></a>00252 
<a name="l00253"></a>00253    <span class="comment">// Get number of reserved sector</span>
<a name="l00254"></a>00254    LSB( u16_tmp ) = <a class="code" href="a00020.html#054eca177d5b03154cb95ead9e3cca0b">LOW_16_BPB_ResvSecCnt</a>;
<a name="l00255"></a>00255    MSB( u16_tmp ) = <a class="code" href="a00020.html#72679a68a6d92475a790f11861a92316">HIGH_16_BPB_ResvSecCnt</a>;
<a name="l00256"></a>00256    <span class="comment">// Get FSInfo position</span>
<a name="l00257"></a>00257    <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#d7fc62fd6868a846c0f242c6cf35fe60" title="Offset between the beginning of FAT and the FSInfo sector (only used by FAT32) (unit...">u16_offset_FSInfo</a> = (u16_tmp-<a class="code" href="a00020.html#690460cf97d7336c73da86955724b060">LOW_16_BPB_FSInfo</a>)*u8_sector_size;
<a name="l00258"></a>00258    u16_tmp *= u8_sector_size; <span class="comment">// number of reserved sector translated in unit 512B</span>
<a name="l00259"></a>00259 
<a name="l00260"></a>00260    <span class="comment">// Compute the FAT address (unit 512B)</span>
<a name="l00261"></a>00261    <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#af1d8fda28bded48a54c7eab4d729618" title="FAT address (unit 512B).">u32_ptr_fat</a> = <a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a> + u16_tmp;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263    <span class="comment">// Compute the offset (unit 512B) between the first data cluster and the FAT beginning</span>
<a name="l00264"></a>00264    <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#4666662ac4fa96c340a61e5fb786b83a" title="Offset between the beginning of FAT and the first cluster (unit 512B).">u32_offset_data</a> = (<a class="code" href="a00020.html#4d46dee315ad22b94de647e7c883edc0">FS_NB_FAT</a> * (U32)<a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#68924ecf6935ab3e5a32dee9e5d61f7d" title="Size of one FAT (unit 512B).">u16_fat_size</a>) + (U32)<a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#b26050633d0597af6c2c6abe9684481b" title="Root directory informations.">rootdir</a>.<a class="code" href="a00007.html#996b5fc79b7527c2b3dc3b34ed98f428" title="For FAT 12 &amp;amp; 16, it is a segment (no cluster list).">seg</a>.<a class="code" href="a00007.html#5e384bddb7393218e17f0329d1b8527f" title="Size of root (unit 512B).">u16_size</a>;
<a name="l00265"></a>00265 
<a name="l00266"></a>00266    <span class="comment">// Compute the data region (clusters space = Total - Sector used) size (unit 512B)</span>
<a name="l00267"></a>00267    u32_tmp -= ((U32)u16_tmp + <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#4666662ac4fa96c340a61e5fb786b83a" title="Offset between the beginning of FAT and the first cluster (unit 512B).">u32_offset_data</a>);
<a name="l00268"></a>00268 
<a name="l00269"></a>00269    <span class="comment">// Compute the count of CLUSTER in the data region</span>
<a name="l00270"></a>00270    <span class="comment">// !!!Optimization -&gt; u32_CountofCluster (unit 512B)/ fs_g_nav.u8_BPB_SecPerClus (unit 512B &amp; power of 2)</span>
<a name="l00271"></a>00271    <span class="keywordflow">if</span> (!<a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#cddebea9972567fdcb5b87327b48125e" title="Cluster size (unit 512B).">u8_BPB_SecPerClus</a>)
<a name="l00272"></a>00272      <span class="keywordflow">return</span> FALSE;
<a name="l00273"></a>00273    <span class="keywordflow">for</span>( u8_tmp = <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#cddebea9972567fdcb5b87327b48125e" title="Cluster size (unit 512B).">u8_BPB_SecPerClus</a>; u8_tmp!=1 ; u8_tmp &gt;&gt;= 1 )
<a name="l00274"></a>00274    {
<a name="l00275"></a>00275      u32_tmp  &gt;&gt;= 1;   <span class="comment">// This computation round down</span>
<a name="l00276"></a>00276    }
<a name="l00277"></a>00277    <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#2f9e0c9af661ea927729c08280e1105e" title="Number of cluster (include the two reserved cluster).">u32_CountofCluster</a> = u32_tmp+2; <span class="comment">// The total of cluster include the two reserved clusters</span>
<a name="l00278"></a>00278 
<a name="l00279"></a>00279    <span class="comment">// Determine the FAT type</span>
<a name="l00280"></a>00280    <span class="keywordflow">if</span> (u32_tmp &lt; <a class="code" href="a00020.html#2f2a41f51db7209b1e068193cd10a9d8">FS_FAT12_MAX_CLUSTERS</a>)
<a name="l00281"></a>00281    {
<a name="l00282"></a>00282       <span class="comment">// Is FAT 12</span>
<a name="l00283"></a>00283 <span class="preprocessor">#if (FS_FAT_12 == DISABLED)</span>
<a name="l00284"></a>00284 <span class="preprocessor"></span>      <span class="keywordflow">return</span> FALSE;
<a name="l00285"></a>00285 <span class="preprocessor">#endif</span>
<a name="l00286"></a>00286 <span class="preprocessor"></span>      <a class="code" href="a00020.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00006.html#74121fb3c8d3a1d018c911650e2ec920" title="FAT type (default = no mounted = FS_TYPE_FAT_UNM).">u8_type_fat</a> = <a class="code" href="a00020.html#cbc6a789e2144cbc0893187e2d665d8c">FS_TYPE_FAT_12</a>;
<a name="l00287"></a>00287    } <span class="keywordflow">else</span> {
<a name="l00288"></a>00288    <span class="keywordflow">if</span> (u32_tmp &lt; <a class="code" href="a00020.html#c1bec4fdf32e8ff9a9afc44b80607336">FS_FAT16_MAX_CLUSTERS</a>)
<a name="l00289"></a>00289    {
<a name="l00290"></a>00290       <span class="comment">// Is FAT 16</span>
<a name="l00291"></a>00291 <span class="preprocessor">#if (FS_FAT_16 == DISABLED)</span>
<a name="l00292"></a>00292 <span class="preprocessor"></span>      <span class="keywordflow">return</span> FS_NO_SUPPORT_PART;
<a name="l00293"></a>00293 <span class="preprocessor">#endif</span>
<a name="l00294"></a>00294 <span class="preprocessor"></span>      <a class="code" href="a00020.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00006.html#74121fb3c8d3a1d018c911650e2ec920" title="FAT type (default = no mounted = FS_TYPE_FAT_UNM).">u8_type_fat</a> = <a class="code" href="a00020.html#3433de4e69ce8d55317158ee2624e8af">FS_TYPE_FAT_16</a>;
<a name="l00295"></a>00295    } <span class="keywordflow">else</span> {
<a name="l00296"></a>00296       <span class="comment">// Is FAT 32</span>
<a name="l00297"></a>00297 <span class="preprocessor">#if (FS_FAT_32 == DISABLED)</span>
<a name="l00298"></a>00298 <span class="preprocessor"></span>      <span class="keywordflow">return</span> FALSE;
<a name="l00299"></a>00299 <span class="preprocessor">#endif</span>
<a name="l00300"></a>00300 <span class="preprocessor"></span>      <a class="code" href="a00020.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00006.html#74121fb3c8d3a1d018c911650e2ec920" title="FAT type (default = no mounted = FS_TYPE_FAT_UNM).">u8_type_fat</a> = <a class="code" href="a00020.html#bed7b1e094b19dac8efa753f59f84fc6">FS_TYPE_FAT_32</a>;
<a name="l00301"></a>00301       <span class="comment">// In FAT32, the root dir is like another directory, this one have a cluster list</span>
<a name="l00302"></a>00302       <span class="comment">// Get the first cluster number of root</span>
<a name="l00303"></a>00303       LSB0( <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#b26050633d0597af6c2c6abe9684481b" title="Root directory informations.">rootdir</a>.<a class="code" href="a00007.html#54d1e701d0705a2b2adb2b2cdc2e604b" title="For FAT32, the root directory is a cluster list.">u32_cluster</a> ) = <a class="code" href="a00020.html#0a4a06552fb3a44093ef87a09fc2840f">LOW0_32_BPB_RootClus</a>;
<a name="l00304"></a>00304       LSB1( <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#b26050633d0597af6c2c6abe9684481b" title="Root directory informations.">rootdir</a>.<a class="code" href="a00007.html#54d1e701d0705a2b2adb2b2cdc2e604b" title="For FAT32, the root directory is a cluster list.">u32_cluster</a> ) = <a class="code" href="a00020.html#dd80ee1ba4292b33a35bb9794e46b91d">LOW1_32_BPB_RootClus</a>;
<a name="l00305"></a>00305       LSB2( <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#b26050633d0597af6c2c6abe9684481b" title="Root directory informations.">rootdir</a>.<a class="code" href="a00007.html#54d1e701d0705a2b2adb2b2cdc2e604b" title="For FAT32, the root directory is a cluster list.">u32_cluster</a> ) = <a class="code" href="a00020.html#47260296ce546b21bd10d3ddc963a2c7">LOW2_32_BPB_RootClus</a>;
<a name="l00306"></a>00306       LSB3( <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#b26050633d0597af6c2c6abe9684481b" title="Root directory informations.">rootdir</a>.<a class="code" href="a00007.html#54d1e701d0705a2b2adb2b2cdc2e604b" title="For FAT32, the root directory is a cluster list.">u32_cluster</a> ) = <a class="code" href="a00020.html#68f0eada6fa2bbfffcdc98fcd463d225">LOW3_32_BPB_RootClus</a>;
<a name="l00307"></a>00307    }
<a name="l00308"></a>00308    }
<a name="l00309"></a>00309 
<a name="l00310"></a>00310    <span class="keywordflow">return</span> TRUE;
<a name="l00311"></a>00311 }
<a name="l00312"></a>00312 
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="1a35321a99150ba643f87cb6c79ec3e5"></a><!-- doxytag: member="fat.h::fat_read_dir" ref="1a35321a99150ba643f87cb6c79ec3e5" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_read_dir           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function fill the internal cache with a sector from current directory. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE in case of error, see global value "fs_g_status" for more detail <p>
TRUE otherwise</dd></dl>
<div class="fragment"><pre class="fragment">
//! Global variable used
//! IN :
//!   fs_g_nav.u32_cluster_sel_dir           First cluster of current directory
//!   fs_g_nav_fast.u16_entry_pos_sel_file   Position in directory (unit entry)
//! </pre></div> 
<p>Definition at line <a class="el" href="a00050.html#l01195">1195</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00050.html#l01794">fat_cache_read_sector()</a>, <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>, <a class="el" href="a00051.html#l00218">FS_512B_SHIFT_BIT</a>, <a class="el" href="a00051.html#l00240">FS_CLUST_ACT_ONE</a>, <a class="el" href="a00051.html#l00394">fs_g_nav</a>, <a class="el" href="a00051.html#l00395">fs_g_nav_fast</a>, <a class="el" href="a00051.html#l00416">fs_g_sectorcache</a>, <a class="el" href="a00051.html#l00400">fs_g_seg</a>, <a class="el" href="a00051.html#l00417">fs_gu32_addrsector</a>, <a class="el" href="a00051.html#l00198">FS_SHIFT_B_TO_FILE_ENTRY</a>, <a class="el" href="a00051.html#l00296">Fs_management_fast::u16_entry_pos_sel_file</a>, <a class="el" href="a00051.html#l00317">Fs_segment::u32_addr</a>, <a class="el" href="a00051.html#l00282">Fs_management::u32_cluster_sel_dir</a>, <a class="el" href="a00051.html#l00350">Fs_sector_cache::u32_clusterlist_pos</a>, <a class="el" href="a00051.html#l00349">Fs_sector_cache::u32_clusterlist_start</a>, <a class="el" href="a00051.html#l00318">Fs_segment::u32_size_or_pos</a>, <a class="el" href="a00051.html#l00269">Fs_management::u8_lun</a>, and <a class="el" href="a00051.html#l00345">Fs_sector_cache::u8_lun</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l01921">fat_alloc_entry_free()</a>, <a class="el" href="a00052.html#l01500">fat_create_entry_file_name()</a>, <a class="el" href="a00052.html#l02074">fat_delete_file()</a>, <a class="el" href="a00052.html#l01768">fat_find_short_entry_name()</a>, <a class="el" href="a00052.html#l02004">fat_garbage_collector_entry()</a>, <a class="el" href="a00053.html#l00747">file_close()</a>, <a class="el" href="a00067.html#l01219">nav_dir_gotoparent()</a>, <a class="el" href="a00067.html#l01361">nav_dir_make()</a>, <a class="el" href="a00067.html#l01988">nav_file_attributset()</a>, <a class="el" href="a00067.html#l01905">nav_file_checkext()</a>, <a class="el" href="a00067.html#l01931">nav_file_dateget()</a>, <a class="el" href="a00067.html#l01966">nav_file_dateset()</a>, <a class="el" href="a00067.html#l01769">nav_file_name()</a>, <a class="el" href="a00067.html#l02096">nav_file_rename()</a>, <a class="el" href="a00067.html#l00726">nav_filelist_set()</a>, <a class="el" href="a00063.html#l00383">nav_filterlist_gotoparent()</a>, and <a class="el" href="a00067.html#l00529">nav_partition_label()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01196"></a>01196 {
<a name="l01197"></a>01197    U32 u32_cluster_pos;
<a name="l01198"></a>01198 
<a name="l01199"></a>01199    <span class="comment">// Compute the cluster list position corresponding of the current entry</span>
<a name="l01200"></a>01200    u32_cluster_pos = <a class="code" href="a00020.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00006.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a> &gt;&gt; (<a class="code" href="a00020.html#aee8167d49f58301e72fa2c546cd5b55">FS_512B_SHIFT_BIT</a> - <a class="code" href="a00020.html#f5a730740b41e20c1a467dcd1d52699f">FS_SHIFT_B_TO_FILE_ENTRY</a>);
<a name="l01201"></a>01201 
<a name="l01202"></a>01202    <span class="keywordflow">if</span>( (<a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#983c3e8973f75815f64897cfdcacd10e" title="LUN of sector.">u8_lun</a>                 == <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a> )
<a name="l01203"></a>01203    &amp;&amp;  (<a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#9aba32679527ef002f0bbf18545108cf" title="first cluster of cluster list">u32_clusterlist_start</a>  == <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#ed8faad36e96ff2f422ddadd3740713f" title="First cluster number of selected directory (0 for the root directory).">u32_cluster_sel_dir</a> )
<a name="l01204"></a>01204    &amp;&amp;  (<a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#0e983c43b8457d480b14ef77113df31f" title="position in cluster list (unit 512B)">u32_clusterlist_pos</a>    == u32_cluster_pos ) )
<a name="l01205"></a>01205    {
<a name="l01206"></a>01206          <span class="keywordflow">return</span> TRUE;      <span class="comment">// The internal cache contains the sector ascked</span>
<a name="l01207"></a>01207    }
<a name="l01208"></a>01208 
<a name="l01209"></a>01209    <span class="comment">// Get sector address corresponding at cluster list position</span>
<a name="l01210"></a>01210    <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a> = <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#ed8faad36e96ff2f422ddadd3740713f" title="First cluster number of selected directory (0 for the root directory).">u32_cluster_sel_dir</a>;
<a name="l01211"></a>01211    <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> = u32_cluster_pos;
<a name="l01212"></a>01212    <span class="keywordflow">if</span>( <a class="code" href="a00019.html#b08a718173c6b1a1966e6395801a32e7" title="This function gets or clears a cluster list.">fat_cluster_list</a>( <a class="code" href="a00020.html#b24c1ca2a8bc9c3e264eb923d3b90666">FS_CLUST_ACT_ONE</a>, FALSE ) )
<a name="l01213"></a>01213    {
<a name="l01214"></a>01214       <span class="comment">// Read the sector</span>
<a name="l01215"></a>01215       <a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a> = <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a>;
<a name="l01216"></a>01216       <span class="keywordflow">if</span>( <a class="code" href="a00019.html#a67dc439478853cefdd226f9c99c9539" title="This function loads a memory sector in internal cache sector.">fat_cache_read_sector</a>( TRUE ) )
<a name="l01217"></a>01217       {
<a name="l01218"></a>01218          <span class="comment">// Update information about internal sector cache</span>
<a name="l01219"></a>01219          <a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#9aba32679527ef002f0bbf18545108cf" title="first cluster of cluster list">u32_clusterlist_start</a>  = <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#ed8faad36e96ff2f422ddadd3740713f" title="First cluster number of selected directory (0 for the root directory).">u32_cluster_sel_dir</a>;
<a name="l01220"></a>01220          <a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#0e983c43b8457d480b14ef77113df31f" title="position in cluster list (unit 512B)">u32_clusterlist_pos</a>    = u32_cluster_pos;
<a name="l01221"></a>01221          <span class="keywordflow">return</span> TRUE;
<a name="l01222"></a>01222       }
<a name="l01223"></a>01223    }
<a name="l01224"></a>01224    <span class="keywordflow">return</span> FALSE;
<a name="l01225"></a>01225 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="0a8beb16a074b07828fc725e0c0ae500"></a><!-- doxytag: member="fat.h::fat_read_fat32_FSInfo" ref="0a8beb16a074b07828fc725e0c0ae500" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">U32 fat_read_fat32_FSInfo           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function returns the space free in the selected FAT32 partition. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>the number of sector free (if 0xFFFFFFFF, then no value available in FSInfo Sector) </dd></dl>

<p>Definition at line <a class="el" href="a00052.html#l00888">888</a> of file <a class="el" href="a00052.html">fat_unusual.c</a>.</p>

<p>References <a class="el" href="a00052.html#l00714">const_FSI_LeadSig</a>, <a class="el" href="a00052.html#l00717">const_FSI_StrucSig</a>, <a class="el" href="a00050.html#l01794">fat_cache_read_sector()</a>, <a class="el" href="a00051.html#l00146">FS_BR_SIGNATURE_HIGH</a>, <a class="el" href="a00051.html#l00145">FS_BR_SIGNATURE_LOW</a>, <a class="el" href="a00051.html#l00394">fs_g_nav</a>, <a class="el" href="a00051.html#l00415">fs_g_sector</a>, <a class="el" href="a00051.html#l00417">fs_gu32_addrsector</a>, <a class="el" href="a00051.html#l00276">Fs_management::u16_offset_FSInfo</a>, and <a class="el" href="a00051.html#l00278">Fs_management::u32_ptr_fat</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l02133">fat_getfreespace()</a>, and <a class="el" href="a00052.html#l02198">fat_getfreespace_percent()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00888"></a>00888 {
<a name="l00889"></a>00889    U32 u32_nb_free_cluster;
<a name="l00890"></a>00890 
<a name="l00891"></a>00891    <span class="comment">// Read FAT32 FSInfo Sector</span>
<a name="l00892"></a>00892    <a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a> = <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#af1d8fda28bded48a54c7eab4d729618" title="FAT address (unit 512B).">u32_ptr_fat</a> - <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#d7fc62fd6868a846c0f242c6cf35fe60" title="Offset between the beginning of FAT and the FSInfo sector (only used by FAT32) (unit...">u16_offset_FSInfo</a>;
<a name="l00893"></a>00893    <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#a67dc439478853cefdd226f9c99c9539" title="This function loads a memory sector in internal cache sector.">fat_cache_read_sector</a>( TRUE ))
<a name="l00894"></a>00894       <span class="keywordflow">return</span> 0xFFFFFFFF;
<a name="l00895"></a>00895 
<a name="l00896"></a>00896    <span class="comment">//* Check signature</span>
<a name="l00897"></a>00897    <span class="comment">// offset 510-511, Signature</span>
<a name="l00898"></a>00898    <span class="keywordflow">if</span>( <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[510] != <a class="code" href="a00020.html#36f09355f7020d410cb43695cab680fa">FS_BR_SIGNATURE_LOW</a> )
<a name="l00899"></a>00899       <span class="keywordflow">return</span> 0xFFFFFFFF;
<a name="l00900"></a>00900    <span class="keywordflow">if</span>( <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[511] != <a class="code" href="a00020.html#b4cd4bfc6a5baebc1d25bbc5d5db2c15">FS_BR_SIGNATURE_HIGH</a>)
<a name="l00901"></a>00901       <span class="keywordflow">return</span> 0xFFFFFFFF;
<a name="l00902"></a>00902    <span class="comment">// offset 00-04, This lead signature</span>
<a name="l00903"></a>00903    <span class="keywordflow">if</span>( 0 != memcmp_code2ram( &amp;<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[0], <a class="code" href="a00021.html#0ab271becae152fb0b33ad5eb33ec22b">const_FSI_LeadSig</a>, <span class="keyword">sizeof</span>(<a class="code" href="a00021.html#0ab271becae152fb0b33ad5eb33ec22b">const_FSI_LeadSig</a>) ))
<a name="l00904"></a>00904       <span class="keywordflow">return</span> 0xFFFFFFFF;
<a name="l00905"></a>00905    <span class="comment">// offset 004-483, reserved (fill with 0)</span>
<a name="l00906"></a>00906    <span class="comment">// offset 484-487, signature</span>
<a name="l00907"></a>00907    <span class="keywordflow">if</span>( 0 != memcmp_code2ram( &amp;<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[484], <a class="code" href="a00021.html#71e0de07d391ec4f20a8a1bb4b446f90">const_FSI_StrucSig</a>, <span class="keyword">sizeof</span>(<a class="code" href="a00021.html#71e0de07d391ec4f20a8a1bb4b446f90">const_FSI_StrucSig</a>)) )
<a name="l00908"></a>00908       <span class="keywordflow">return</span> 0xFFFFFFFF;
<a name="l00909"></a>00909 
<a name="l00910"></a>00910    <span class="comment">//* Read value</span>
<a name="l00911"></a>00911    <span class="comment">// offset 488-491, free cluster count</span>
<a name="l00912"></a>00912    LSB0(u32_nb_free_cluster) = <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[488];
<a name="l00913"></a>00913    LSB1(u32_nb_free_cluster) = <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[489];
<a name="l00914"></a>00914    LSB2(u32_nb_free_cluster) = <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[490];
<a name="l00915"></a>00915    LSB3(u32_nb_free_cluster) = <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[491];
<a name="l00916"></a>00916    <span class="keywordflow">return</span> u32_nb_free_cluster;
<a name="l00917"></a>00917 }
<a name="l00918"></a>00918 <span class="preprocessor">#endif  // FS_FAT_32</span>
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="d8c9c9a63c821e8cea06c340c029668d"></a><!-- doxytag: member="fat.h::fat_read_file" ref="d8c9c9a63c821e8cea06c340c029668d" args="(U8 mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_read_file           </td>
          <td>(</td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>mode</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function gets or clears a cluster list at the current position in the selected file. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mode</em>&nbsp;</td><td>Choose action <br>
 FS_CLUST_ACT_SEG Get memory segment corresponding at the position in selected file <br>
 FS_CLUST_ACT_ONE Store in internal cache the sector corresponding at the position in selected file <br>
 FS_CLUST_ACT_CLR Clear the cluster list corresponding at the position in selected file <br>
</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE in case of error, see global value "fs_g_status" for more detail <p>
TRUE otherwise</dd></dl>
<div class="fragment"><pre class="fragment">
//! Global variable used
//! IN :
//!   fs_g_nav_entry.u32_cluster       First cluster of selected file
//!   fs_g_nav_entry.u32_pos_in_file   Position in file (unit byte)
//! </pre></div> 
<p>Definition at line <a class="el" href="a00050.html#l01035">1035</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00050.html#l01794">fat_cache_read_sector()</a>, <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>, <a class="el" href="a00051.html#l00217">FS_512B_MASK</a>, <a class="el" href="a00051.html#l00218">FS_512B_SHIFT_BIT</a>, <a class="el" href="a00051.html#l00241">FS_CLUST_ACT_CLR</a>, <a class="el" href="a00051.html#l00240">FS_CLUST_ACT_ONE</a>, <a class="el" href="a00051.html#l00239">FS_CLUST_ACT_SEG</a>, <a class="el" href="a00055.html#l00215">FS_ERR_OUT_LIST</a>, <a class="el" href="a00051.html#l00394">fs_g_nav</a>, <a class="el" href="a00051.html#l00396">fs_g_nav_entry</a>, <a class="el" href="a00051.html#l00416">fs_g_sectorcache</a>, <a class="el" href="a00051.html#l00400">fs_g_seg</a>, <a class="el" href="a00055.html#l00256">fs_g_status</a>, <a class="el" href="a00051.html#l00417">fs_gu32_addrsector</a>, <a class="el" href="a00051.html#l00317">Fs_segment::u32_addr</a>, <a class="el" href="a00051.html#l00305">Fs_management_entry::u32_cluster</a>, <a class="el" href="a00051.html#l00350">Fs_sector_cache::u32_clusterlist_pos</a>, <a class="el" href="a00051.html#l00349">Fs_sector_cache::u32_clusterlist_start</a>, <a class="el" href="a00051.html#l00307">Fs_management_entry::u32_pos_in_file</a>, <a class="el" href="a00051.html#l00318">Fs_segment::u32_size_or_pos</a>, <a class="el" href="a00051.html#l00269">Fs_management::u8_lun</a>, and <a class="el" href="a00051.html#l00345">Fs_sector_cache::u8_lun</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l02074">fat_delete_file()</a>, <a class="el" href="a00050.html#l01117">fat_write_file()</a>, <a class="el" href="a00053.html#l00363">file_getc()</a>, <a class="el" href="a00053.html#l00172">file_read()</a>, <a class="el" href="a00053.html#l00249">file_read_buf()</a>, and <a class="el" href="a00053.html#l00460">file_set_eof()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01036"></a>01036 {
<a name="l01037"></a>01037    U32   u32_sector_pos;
<a name="l01038"></a>01038 
<a name="l01039"></a>01039    <span class="comment">// Compute sector position</span>
<a name="l01040"></a>01040    u32_sector_pos = <a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#1e1dae249ae6839c1b8cce0fecbbf7af" title="Current position in file (unit Bytes).">u32_pos_in_file</a> &gt;&gt; <a class="code" href="a00020.html#aee8167d49f58301e72fa2c546cd5b55">FS_512B_SHIFT_BIT</a>;
<a name="l01041"></a>01041 
<a name="l01042"></a>01042    <span class="keywordflow">if</span>(<a class="code" href="a00020.html#b24c1ca2a8bc9c3e264eb923d3b90666">FS_CLUST_ACT_ONE</a>  == mode)
<a name="l01043"></a>01043    {
<a name="l01044"></a>01044       <span class="keywordflow">if</span>( (<a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#983c3e8973f75815f64897cfdcacd10e" title="LUN of sector.">u8_lun</a>                 == <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a> )
<a name="l01045"></a>01045       &amp;&amp;  (<a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#9aba32679527ef002f0bbf18545108cf" title="first cluster of cluster list">u32_clusterlist_start</a>  == <a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a> )
<a name="l01046"></a>01046       &amp;&amp;  (<a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#0e983c43b8457d480b14ef77113df31f" title="position in cluster list (unit 512B)">u32_clusterlist_pos</a>    == u32_sector_pos ) )
<a name="l01047"></a>01047       {
<a name="l01048"></a>01048          <span class="keywordflow">return</span> TRUE;      <span class="comment">// The internal cache contains the sector ascked</span>
<a name="l01049"></a>01049       }
<a name="l01050"></a>01050    }
<a name="l01051"></a>01051    <span class="keywordflow">else</span>
<a name="l01052"></a>01052    {
<a name="l01053"></a>01053       <span class="keywordflow">if</span>( <a class="code" href="a00020.html#b314d14ba33772e9bcbae993a8d17e9f">FS_CLUST_ACT_CLR</a> == mode )
<a name="l01054"></a>01054       {
<a name="l01055"></a>01055          <span class="comment">// Clear cluster list</span>
<a name="l01056"></a>01056          <span class="keywordflow">if</span>( 0 == <a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a> )
<a name="l01057"></a>01057             <span class="keywordflow">return</span> TRUE;   <span class="comment">// No cluster list is linked with the file, then no clear is necessary</span>
<a name="l01058"></a>01058 
<a name="l01059"></a>01059          <span class="keywordflow">if</span>(0 != (<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#1e1dae249ae6839c1b8cce0fecbbf7af" title="Current position in file (unit Bytes).">u32_pos_in_file</a> &amp; <a class="code" href="a00020.html#88ac363f9c597edc80e1185f99434056">FS_512B_MASK</a>) )
<a name="l01060"></a>01060          {
<a name="l01061"></a>01061             <span class="comment">// The actual sector is used, then start clear on the next sector</span>
<a name="l01062"></a>01062             u32_sector_pos++;
<a name="l01063"></a>01063          }
<a name="l01064"></a>01064       }
<a name="l01065"></a>01065    }
<a name="l01066"></a>01066 
<a name="l01067"></a>01067    <span class="comment">// Get the segment which start at the current position</span>
<a name="l01068"></a>01068    <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a> = <a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a>;
<a name="l01069"></a>01069    <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> = u32_sector_pos;
<a name="l01070"></a>01070    <span class="keywordflow">if</span>( <a class="code" href="a00020.html#b24c1ca2a8bc9c3e264eb923d3b90666">FS_CLUST_ACT_ONE</a> != mode )
<a name="l01071"></a>01071    {
<a name="l01072"></a>01072       <span class="keywordflow">if</span>( <a class="code" href="a00019.html#b08a718173c6b1a1966e6395801a32e7" title="This function gets or clears a cluster list.">fat_cluster_list</a>( mode, TRUE ) )
<a name="l01073"></a>01073          <span class="keywordflow">return</span> TRUE;      <span class="comment">// Get or clear segment OK</span>
<a name="l01074"></a>01074    }
<a name="l01075"></a>01075    <span class="keywordflow">else</span>
<a name="l01076"></a>01076    {
<a name="l01077"></a>01077       <span class="keywordflow">if</span>( <a class="code" href="a00019.html#b08a718173c6b1a1966e6395801a32e7" title="This function gets or clears a cluster list.">fat_cluster_list</a>( <a class="code" href="a00020.html#67f38f48a73531bf4bcd7bf87c7b1db5">FS_CLUST_ACT_SEG</a>, TRUE ) )   <span class="comment">// Read all segment</span>
<a name="l01078"></a>01078       {
<a name="l01079"></a>01079          <span class="comment">// Read the sector corresponding at the position file (= first sector of segment)</span>
<a name="l01080"></a>01080          <a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a> = <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a> ;
<a name="l01081"></a>01081          <span class="keywordflow">if</span>( <a class="code" href="a00019.html#a67dc439478853cefdd226f9c99c9539" title="This function loads a memory sector in internal cache sector.">fat_cache_read_sector</a>( TRUE ) )
<a name="l01082"></a>01082          {
<a name="l01083"></a>01083             <a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#9aba32679527ef002f0bbf18545108cf" title="first cluster of cluster list">u32_clusterlist_start</a>  = <a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a>;
<a name="l01084"></a>01084             <a class="code" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>.<a class="code" href="a00008.html#0e983c43b8457d480b14ef77113df31f" title="position in cluster list (unit 512B)">u32_clusterlist_pos</a>    = u32_sector_pos;
<a name="l01085"></a>01085             <span class="keywordflow">return</span> TRUE;
<a name="l01086"></a>01086          }
<a name="l01087"></a>01087       }
<a name="l01088"></a>01088    }
<a name="l01089"></a>01089    <span class="keywordflow">if</span>( (<a class="code" href="a00020.html#b314d14ba33772e9bcbae993a8d17e9f">FS_CLUST_ACT_CLR</a> == mode       )
<a name="l01090"></a>01090    &amp;&amp;  (<a class="code" href="a00024.html#e8798a89bfc4f49da50fc55b14a5b07f" title="The position is outside the cluster list.">FS_ERR_OUT_LIST</a>  == <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a>) )
<a name="l01091"></a>01091    {
<a name="l01092"></a>01092       <span class="comment">// It is possible to clear nothing</span>
<a name="l01093"></a>01093       <span class="keywordflow">return</span> TRUE;
<a name="l01094"></a>01094    }
<a name="l01095"></a>01095    <span class="keywordflow">return</span> FALSE;
<a name="l01096"></a>01096 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="2ff43f97db7a5d76f46f4fb1b683d192"></a><!-- doxytag: member="fat.h::fat_serialnumber" ref="2ff43f97db7a5d76f46f4fb1b683d192" args="(Bool b_action, U8 _MEM_TYPE_SLOW_ *a_u8_sn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_serialnumber           </td>
          <td>(</td>
          <td class="paramtype">Bool&nbsp;</td>
          <td class="paramname"> <em>b_action</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U8 _MEM_TYPE_SLOW_ *&nbsp;</td>
          <td class="paramname"> <em>a_u8_sn</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function reads or writes a serial number. 
<p>
This function reads or writes a serial number.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>b_action</em>&nbsp;</td><td>choose action (FS_SN_READ or FS_SN_WRITE) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>a_u8_sn</em>&nbsp;</td><td>array to store or get the serial number (U8[4])</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE in case of error, see global value "fs_g_status" for more detail <p>
TRUE otherwise </dd></dl>

<p>Definition at line <a class="el" href="a00052.html#l01044">1044</a> of file <a class="el" href="a00052.html">fat_unusual.c</a>.</p>

<p>References <a class="el" href="a00050.html#l01860">fat_cache_flush()</a>, <a class="el" href="a00050.html#l01848">fat_cache_mark_sector_as_dirty()</a>, <a class="el" href="a00050.html#l01794">fat_cache_read_sector()</a>, <a class="el" href="a00051.html#l00394">fs_g_nav</a>, <a class="el" href="a00051.html#l00415">fs_g_sector</a>, <a class="el" href="a00051.html#l00417">fs_gu32_addrsector</a>, <a class="el" href="a00055.html#l00090">FS_SN_READ</a>, <a class="el" href="a00051.html#l00075">Is_fat12</a>, <a class="el" href="a00051.html#l00080">Is_fat16</a>, and <a class="el" href="a00051.html#l00278">Fs_management::u32_ptr_fat</a>.</p>

<p>Referenced by <a class="el" href="a00067.html#l00508">nav_partition_serialnumber()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01044"></a>01044 {
<a name="l01045"></a>01045    <span class="comment">// Compute PBR address</span>
<a name="l01046"></a>01046    <span class="keywordflow">if</span> ( <a class="code" href="a00020.html#c2ce5473766316396fb472c1bdd685e9">Is_fat12</a> || <a class="code" href="a00020.html#2dcd74d640da1e20ad510413c9ef4c85">Is_fat16</a> )
<a name="l01047"></a>01047    {  <span class="comment">// FAT 12 &amp; 16 (BPB_ResvSecCnt must be ega to 1)</span>
<a name="l01048"></a>01048       <a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a> = <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#af1d8fda28bded48a54c7eab4d729618" title="FAT address (unit 512B).">u32_ptr_fat</a>-1;
<a name="l01049"></a>01049    }
<a name="l01050"></a>01050    <span class="keywordflow">else</span>
<a name="l01051"></a>01051    {  <span class="comment">// FAT 32 (BPB_ResvSecCnt must be ega to 32)</span>
<a name="l01052"></a>01052       <a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a> = <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#af1d8fda28bded48a54c7eab4d729618" title="FAT address (unit 512B).">u32_ptr_fat</a>-32;
<a name="l01053"></a>01053    }
<a name="l01054"></a>01054    <span class="comment">// Read PBR</span>
<a name="l01055"></a>01055    <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#a67dc439478853cefdd226f9c99c9539" title="This function loads a memory sector in internal cache sector.">fat_cache_read_sector</a>( TRUE ))
<a name="l01056"></a>01056       <span class="keywordflow">return</span> FALSE;
<a name="l01057"></a>01057 
<a name="l01058"></a>01058    <span class="comment">// The serial is storaged at invert</span>
<a name="l01059"></a>01059    <span class="keywordflow">if</span>( b_action == <a class="code" href="a00024.html#030606a7731d280a91dd5b796e50804e">FS_SN_READ</a> )
<a name="l01060"></a>01060    {
<a name="l01061"></a>01061       <span class="comment">// Read serial number</span>
<a name="l01062"></a>01062       a_u8_sn[0] = <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[42];
<a name="l01063"></a>01063       a_u8_sn[1] = <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[41];
<a name="l01064"></a>01064       a_u8_sn[2] = <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[40];
<a name="l01065"></a>01065       a_u8_sn[3] = <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[39];
<a name="l01066"></a>01066       <span class="keywordflow">return</span> TRUE;
<a name="l01067"></a>01067    }<span class="keywordflow">else</span>{
<a name="l01068"></a>01068       <span class="comment">// Write serial number</span>
<a name="l01069"></a>01069       <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[42] = a_u8_sn[0];
<a name="l01070"></a>01070       <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[41] = a_u8_sn[1];
<a name="l01071"></a>01071       <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[40] = a_u8_sn[2];
<a name="l01072"></a>01072       <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[39] = a_u8_sn[3];
<a name="l01073"></a>01073       <a class="code" href="a00019.html#45c0f16885c9e414ddb4b5afaa1cde34" title="This function sets a flag to signal that sector cache is modified.">fat_cache_mark_sector_as_dirty</a>();
<a name="l01074"></a>01074       <span class="keywordflow">return</span> <a class="code" href="a00019.html#578ab4800128cde17c0820a5027c1c06" title="This function flushs the sector cache on the memory if necessary.">fat_cache_flush</a>();
<a name="l01075"></a>01075    }
<a name="l01076"></a>01076 }
<a name="l01077"></a>01077 
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="838253d384d03898e6fcb2b3a7687e43"></a><!-- doxytag: member="fat.h::fat_set_date" ref="838253d384d03898e6fcb2b3a7687e43" args="(const FS_STRING sz_date, Bool type_date)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fat_set_date           </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="a00024.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a>&nbsp;</td>
          <td class="paramname"> <em>sz_date</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Bool&nbsp;</td>
          <td class="paramname"> <em>type_date</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function changes the date information. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>type_date</em>&nbsp;</td><td>choose date field (FS_DATE_LAST_WRITE or FS_DATE_CREATION) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sz_date</em>&nbsp;</td><td>table with date information <br>
 storage format (ASCII) = "YYYYMMDDHHMMSSMS" = year, month, day, hour, minute, seconde, miliseconde</td></tr>
  </table>
</dl>
<div class="fragment"><pre class="fragment">
//! OUT, update cache sector with the new date
//! </pre></div> 
<p>Definition at line <a class="el" href="a00052.html#l01349">1349</a> of file <a class="el" href="a00052.html">fat_unusual.c</a>.</p>

<p>References <a class="el" href="a00050.html#l01848">fat_cache_mark_sector_as_dirty()</a>, <a class="el" href="a00050.html#l01773">fat_get_ptr_entry()</a>, <a class="el" href="a00052.html#l01378">fat_translatedate_ascii_to_number()</a>, and <a class="el" href="a00055.html#l00110">FS_DATE_LAST_WRITE</a>.</p>

<p>Referenced by <a class="el" href="a00067.html#l01966">nav_file_dateset()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01349"></a>01349 {
<a name="l01350"></a>01350    <a class="code" href="a00020.html#119f57abfa3b1f77fd0514b26da6afb4">PTR_CACHE</a> ptr_entry;
<a name="l01351"></a>01351 
<a name="l01352"></a>01352    <a class="code" href="a00019.html#45c0f16885c9e414ddb4b5afaa1cde34" title="This function sets a flag to signal that sector cache is modified.">fat_cache_mark_sector_as_dirty</a>();
<a name="l01353"></a>01353    ptr_entry = <a class="code" href="a00019.html#0c24a717d004b7194e2c566522348fd5" title="This function returns a cache pointer on the current entry.">fat_get_ptr_entry</a>();
<a name="l01354"></a>01354 
<a name="l01355"></a>01355    <span class="keywordflow">if</span>( <a class="code" href="a00024.html#fbbd68bf71e1e73a9162dd04f3dec8fe">FS_DATE_LAST_WRITE</a> == type_date )
<a name="l01356"></a>01356    {
<a name="l01357"></a>01357       <a class="code" href="a00021.html#f2d2b930b3953ad1cfc996de5970a138" title="This function translates a date ascii string to date FAT value.">fat_translatedate_ascii_to_number</a>( sz_date , &amp;ptr_entry[22] , FALSE );
<a name="l01358"></a>01358    }
<a name="l01359"></a>01359    <span class="keywordflow">else</span>
<a name="l01360"></a>01360    {
<a name="l01361"></a>01361       <a class="code" href="a00021.html#f2d2b930b3953ad1cfc996de5970a138" title="This function translates a date ascii string to date FAT value.">fat_translatedate_ascii_to_number</a>( sz_date , &amp;ptr_entry[13] , TRUE );
<a name="l01362"></a>01362    }
<a name="l01363"></a>01363 }
<a name="l01364"></a>01364 
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="8145cff91620fc1b70aa0eef5750db72"></a><!-- doxytag: member="fat.h::fat_update_fat2" ref="8145cff91620fc1b70aa0eef5750db72" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_update_fat2           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function copys the modifications of the first FAT to the second FAT. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE in case of error, see global value "fs_g_status" for more detail <p>
TRUE otherwise </dd></dl>

<p>Definition at line <a class="el" href="a00052.html#l02439">2439</a> of file <a class="el" href="a00052.html">fat_unusual.c</a>.</p>

<p>References <a class="el" href="a00050.html#l01848">fat_cache_mark_sector_as_dirty()</a>, <a class="el" href="a00050.html#l01794">fat_cache_read_sector()</a>, <a class="el" href="a00051.html#l00394">fs_g_nav</a>, <a class="el" href="a00051.html#l00408">fs_g_u16_first_mod_fat</a>, <a class="el" href="a00051.html#l00409">fs_g_u16_last_mod_fat</a>, <a class="el" href="a00051.html#l00417">fs_gu32_addrsector</a>, <a class="el" href="a00051.html#l00275">Fs_management::u16_fat_size</a>, and <a class="el" href="a00051.html#l00278">Fs_management::u32_ptr_fat</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l02294">fat_allocfreespace()</a>, and <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l02439"></a>02439 {
<a name="l02440"></a>02440   <span class="keywordflow">while</span>( <a class="code" href="a00020.html#b55b94c50b63cf8b83e2afcf2e0c2981" title="Offset (unit 512B) in fat of the first sector (unit 512B).">fs_g_u16_first_mod_fat</a> &lt;= <a class="code" href="a00020.html#e8c6fce6d75eb9ddbf1e63e46659e9cc" title="Offset (unit 512B) in fat of the last sector (unit 512B).">fs_g_u16_last_mod_fat</a> )
<a name="l02441"></a>02441   {
<a name="l02442"></a>02442      <span class="comment">// Compute the modification position of FAT 1</span>
<a name="l02443"></a>02443      <a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a> = <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#af1d8fda28bded48a54c7eab4d729618" title="FAT address (unit 512B).">u32_ptr_fat</a> + <a class="code" href="a00020.html#b55b94c50b63cf8b83e2afcf2e0c2981" title="Offset (unit 512B) in fat of the first sector (unit 512B).">fs_g_u16_first_mod_fat</a>;
<a name="l02444"></a>02444      <span class="comment">// Read FAT1</span>
<a name="l02445"></a>02445       <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#a67dc439478853cefdd226f9c99c9539" title="This function loads a memory sector in internal cache sector.">fat_cache_read_sector</a>( TRUE ))
<a name="l02446"></a>02446          <span class="keywordflow">return</span> FALSE;
<a name="l02447"></a>02447      <span class="comment">// Compute the modification position of FAT 2</span>
<a name="l02448"></a>02448      <a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a> = <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#af1d8fda28bded48a54c7eab4d729618" title="FAT address (unit 512B).">u32_ptr_fat</a> + ((U32)<a class="code" href="a00020.html#b55b94c50b63cf8b83e2afcf2e0c2981" title="Offset (unit 512B) in fat of the first sector (unit 512B).">fs_g_u16_first_mod_fat</a> + <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#68924ecf6935ab3e5a32dee9e5d61f7d" title="Size of one FAT (unit 512B).">u16_fat_size</a>);
<a name="l02449"></a>02449      <span class="comment">// Init the sector FAT2 with the previous sector of the FAT1</span>
<a name="l02450"></a>02450      <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#a67dc439478853cefdd226f9c99c9539" title="This function loads a memory sector in internal cache sector.">fat_cache_read_sector</a>( FALSE ))
<a name="l02451"></a>02451          <span class="keywordflow">return</span> FALSE;
<a name="l02452"></a>02452      <span class="comment">// Flag the sector FAT2 like modify</span>
<a name="l02453"></a>02453      <a class="code" href="a00019.html#45c0f16885c9e414ddb4b5afaa1cde34" title="This function sets a flag to signal that sector cache is modified.">fat_cache_mark_sector_as_dirty</a>();
<a name="l02454"></a>02454      <a class="code" href="a00020.html#b55b94c50b63cf8b83e2afcf2e0c2981" title="Offset (unit 512B) in fat of the first sector (unit 512B).">fs_g_u16_first_mod_fat</a>++;
<a name="l02455"></a>02455   }
<a name="l02456"></a>02456   <span class="keywordflow">return</span> TRUE;
<a name="l02457"></a>02457 }
<a name="l02458"></a>02458 <span class="preprocessor">#endif  // FS_LEVEL_FEATURES</span>
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="40035dc41d435ed3281155cdf800cf02"></a><!-- doxytag: member="fat.h::fat_write_entry_file" ref="40035dc41d435ed3281155cdf800cf02" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fat_write_entry_file           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function writes the information about selected file. 
<p>
<div class="fragment"><pre class="fragment">
//! Global variable used
//! IN :
//!   fs_g_sector       The directory sector corresponding at the current position
//!   fs_g_nav_fast.u16_entry_pos_sel_file    Position in directory of the entry file (unit entry)
//! OUT:
//!   fs_g_sector    Updated
//! </pre></div> 
<p>
Write the attribut<p>
Write the size of file 
<p>Definition at line <a class="el" href="a00050.html#l01421">1421</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00050.html#l01848">fat_cache_mark_sector_as_dirty()</a>, <a class="el" href="a00050.html#l01773">fat_get_ptr_entry()</a>, <a class="el" href="a00055.html#l00132">FS_ATTR_DIRECTORY</a>, <a class="el" href="a00051.html#l00396">fs_g_nav_entry</a>, <a class="el" href="a00051.html#l00305">Fs_management_entry::u32_cluster</a>, <a class="el" href="a00051.html#l00306">Fs_management_entry::u32_size</a>, and <a class="el" href="a00051.html#l00304">Fs_management_entry::u8_attr</a>.</p>

<p>Referenced by <a class="el" href="a00053.html#l00747">file_close()</a>, <a class="el" href="a00067.html#l01361">nav_dir_make()</a>, <a class="el" href="a00067.html#l01988">nav_file_attributset()</a>, and <a class="el" href="a00067.html#l02096">nav_file_rename()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01422"></a>01422 {
<a name="l01423"></a>01423    <a class="code" href="a00020.html#119f57abfa3b1f77fd0514b26da6afb4">PTR_CACHE</a> ptr_entry;
<a name="l01424"></a>01424 
<a name="l01425"></a>01425    <a class="code" href="a00019.html#45c0f16885c9e414ddb4b5afaa1cde34" title="This function sets a flag to signal that sector cache is modified.">fat_cache_mark_sector_as_dirty</a>();
<a name="l01426"></a>01426    ptr_entry = <a class="code" href="a00019.html#0c24a717d004b7194e2c566522348fd5" title="This function returns a cache pointer on the current entry.">fat_get_ptr_entry</a>();
<a name="l01427"></a>01427 
<a name="l01428"></a>01428    <span class="keywordflow">if</span>( !(<a class="code" href="a00024.html#99004e3e756391a7ac1c4dde4db6864c">FS_ATTR_DIRECTORY</a> | <a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#c4f33191c9fd60c7520012bbe6005267" title="Attribut of the selected file.">u8_attr</a>))
<a name="l01429"></a>01429    {
<a name="l01430"></a>01430       <span class="keywordflow">if</span>( 0 == <a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#6ffedc3932826a337dfb3e656a09edcc" title="Size of selected file (unit Bytes).">u32_size</a> )
<a name="l01431"></a>01431          <a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a> = 0;
<a name="l01432"></a>01432    }
<a name="l01433"></a>01433 
<a name="l01435"></a>01435    ptr_entry+= 11;
<a name="l01436"></a>01436    ptr_entry[0] = <a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#c4f33191c9fd60c7520012bbe6005267" title="Attribut of the selected file.">u8_attr</a>;
<a name="l01437"></a>01437 
<a name="l01438"></a>01438    <span class="comment">// Write the first cluster of file cluster list</span>
<a name="l01439"></a>01439    ptr_entry += (20-11);
<a name="l01440"></a>01440    ptr_entry[0] = LSB2(<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a>);
<a name="l01441"></a>01441    ptr_entry[1] = LSB3(<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a>);
<a name="l01442"></a>01442    ptr_entry += (26-20);
<a name="l01443"></a>01443    ptr_entry[0] = LSB0(<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a>);
<a name="l01444"></a>01444    ptr_entry[1] = LSB1(<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a>);
<a name="l01445"></a>01445 
<a name="l01447"></a>01447    ptr_entry += (28-26);
<a name="l01448"></a>01448    ptr_entry[0] = LSB0(<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#6ffedc3932826a337dfb3e656a09edcc" title="Size of selected file (unit Bytes).">u32_size</a>);
<a name="l01449"></a>01449    ptr_entry[1] = LSB1(<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#6ffedc3932826a337dfb3e656a09edcc" title="Size of selected file (unit Bytes).">u32_size</a>);
<a name="l01450"></a>01450    ptr_entry[2] = LSB2(<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#6ffedc3932826a337dfb3e656a09edcc" title="Size of selected file (unit Bytes).">u32_size</a>);
<a name="l01451"></a>01451    ptr_entry[3] = LSB3(<a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#6ffedc3932826a337dfb3e656a09edcc" title="Size of selected file (unit Bytes).">u32_size</a>);
<a name="l01452"></a>01452 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="9cf154ffe36bc2c00b1d589e523b449c"></a><!-- doxytag: member="fat.h::fat_write_fat32_FSInfo" ref="9cf154ffe36bc2c00b1d589e523b449c" args="(U32 u32_nb_free_cluster)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_write_fat32_FSInfo           </td>
          <td>(</td>
          <td class="paramtype">U32&nbsp;</td>
          <td class="paramname"> <em>u32_nb_free_cluster</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function writes the space free number in selected FAT32 partition. 
<p>
Read global value "fs_g_status" in case of error : FS_ERR_HW Hardware driver error FS_ERR_HW_NO_PRESENT Device not present FS_LUN_WP Drive is read only<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE in case of error, see global value "fs_g_status" for more detail <p>
TRUE otherwise </dd></dl>

<p>Definition at line <a class="el" href="a00052.html#l00853">853</a> of file <a class="el" href="a00052.html">fat_unusual.c</a>.</p>

<p>References <a class="el" href="a00052.html#l00714">const_FSI_LeadSig</a>, <a class="el" href="a00052.html#l00717">const_FSI_StrucSig</a>, <a class="el" href="a00050.html#l01840">fat_cache_clear()</a>, <a class="el" href="a00050.html#l01848">fat_cache_mark_sector_as_dirty()</a>, <a class="el" href="a00050.html#l01794">fat_cache_read_sector()</a>, <a class="el" href="a00051.html#l00146">FS_BR_SIGNATURE_HIGH</a>, <a class="el" href="a00051.html#l00145">FS_BR_SIGNATURE_LOW</a>, <a class="el" href="a00051.html#l00394">fs_g_nav</a>, <a class="el" href="a00051.html#l00415">fs_g_sector</a>, <a class="el" href="a00051.html#l00417">fs_gu32_addrsector</a>, <a class="el" href="a00051.html#l00276">Fs_management::u16_offset_FSInfo</a>, and <a class="el" href="a00051.html#l00278">Fs_management::u32_ptr_fat</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l02294">fat_allocfreespace()</a>, <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>, <a class="el" href="a00052.html#l02133">fat_getfreespace()</a>, and <a class="el" href="a00052.html#l00730">fat_write_PBR()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00853"></a>00853 {
<a name="l00854"></a>00854    <span class="comment">// Init sector</span>
<a name="l00855"></a>00855    <a class="code" href="a00020.html#8e617688fc42b47e56cce053123fd05f" title="Store the address of futur cache (unit 512B).">fs_gu32_addrsector</a> = <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#af1d8fda28bded48a54c7eab4d729618" title="FAT address (unit 512B).">u32_ptr_fat</a> - <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#d7fc62fd6868a846c0f242c6cf35fe60" title="Offset between the beginning of FAT and the FSInfo sector (only used by FAT32) (unit...">u16_offset_FSInfo</a>;
<a name="l00856"></a>00856 
<a name="l00857"></a>00857    <span class="keywordflow">if</span>( !<a class="code" href="a00019.html#a67dc439478853cefdd226f9c99c9539" title="This function loads a memory sector in internal cache sector.">fat_cache_read_sector</a>( FALSE ))
<a name="l00858"></a>00858       <span class="keywordflow">return</span> FALSE;
<a name="l00859"></a>00859    <a class="code" href="a00019.html#45c0f16885c9e414ddb4b5afaa1cde34" title="This function sets a flag to signal that sector cache is modified.">fat_cache_mark_sector_as_dirty</a>();
<a name="l00860"></a>00860    <a class="code" href="a00019.html#5948c1de515852418670d3fb8ae1e832" title="This function clears the sector cache.">fat_cache_clear</a>();
<a name="l00861"></a>00861 
<a name="l00862"></a>00862    <span class="comment">// Fill sector</span>
<a name="l00863"></a>00863    <span class="comment">// offset 00-04, This lead signature</span>
<a name="l00864"></a>00864    memcpy_code2ram( &amp;<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[0], <a class="code" href="a00021.html#0ab271becae152fb0b33ad5eb33ec22b">const_FSI_LeadSig</a>, <span class="keyword">sizeof</span>(<a class="code" href="a00021.html#0ab271becae152fb0b33ad5eb33ec22b">const_FSI_LeadSig</a>) );
<a name="l00865"></a>00865    <span class="comment">// offset 004-483, reserved (fill with 0)</span>
<a name="l00866"></a>00866    <span class="comment">// offset 484-487, signature</span>
<a name="l00867"></a>00867    memcpy_code2ram( &amp;<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[484], <a class="code" href="a00021.html#71e0de07d391ec4f20a8a1bb4b446f90">const_FSI_StrucSig</a>, <span class="keyword">sizeof</span>(<a class="code" href="a00021.html#71e0de07d391ec4f20a8a1bb4b446f90">const_FSI_StrucSig</a>) );
<a name="l00868"></a>00868    <span class="comment">// offset 488-491, free cluster count (by default NO value)</span>
<a name="l00869"></a>00869    <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[488] = LSB0(u32_nb_free_cluster);
<a name="l00870"></a>00870    <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[489] = LSB1(u32_nb_free_cluster);
<a name="l00871"></a>00871    <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[490] = LSB2(u32_nb_free_cluster);
<a name="l00872"></a>00872    <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[491] = LSB3(u32_nb_free_cluster);
<a name="l00873"></a>00873    <span class="comment">// offset 492-495, indicates the cluster number at which the driver should start looking for free clusters (by default NO value)</span>
<a name="l00874"></a>00874    memset( &amp;<a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[492] , 0xFF , 4 );
<a name="l00875"></a>00875    <span class="comment">// offset 496-509, reserved (fill with 0)</span>
<a name="l00876"></a>00876    <span class="comment">// offset 510-511, Signature</span>
<a name="l00877"></a>00877    <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[510] = <a class="code" href="a00020.html#36f09355f7020d410cb43695cab680fa">FS_BR_SIGNATURE_LOW</a>;
<a name="l00878"></a>00878    <a class="code" href="a00020.html#a84f1da7d8ef3aa46b236f6a7a3b0fa1" title="Use &amp;quot;FAT sector cache&amp;quot; to store a sector from a file (see file_putc(),...">fs_g_sector</a>[511] = <a class="code" href="a00020.html#b4cd4bfc6a5baebc1d25bbc5d5db2c15">FS_BR_SIGNATURE_HIGH</a>;
<a name="l00879"></a>00879    <span class="keywordflow">return</span> TRUE;
<a name="l00880"></a>00880 }
<a name="l00881"></a>00881 
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="8723a199c01163d9f9839bd42ac60693"></a><!-- doxytag: member="fat.h::fat_write_file" ref="8723a199c01163d9f9839bd42ac60693" args="(U8 mode, U32 u32_nb_sector_write)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool fat_write_file           </td>
          <td>(</td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U32&nbsp;</td>
          <td class="paramname"> <em>u32_nb_sector_write</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function gets and eventually allocs a cluster list at the current position in the selected file. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mode</em>&nbsp;</td><td>Choose action <br>
 FS_CLUST_ACT_SEG Get and eventuelly alloc a cluster list <br>
 FS_CLUST_ACT_ONE Get and eventually alloc a cluster list for one sector, and load this sector in internal cache <br>
 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>u32_nb_sector_write</em>&nbsp;</td><td>maximum number of sector to get and eventually to alloc for the selected file (ignored if mode = FS_CLUST_ACT_ONE)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE in case of error, see global value "fs_g_status" for more detail <p>
TRUE otherwise</dd></dl>
<div class="fragment"><pre class="fragment">
//! Global variable used
//! IN :
//!   fs_g_nav_entry.u32_cluster       First cluster of selected file
//!   fs_g_nav_entry.u32_pos_in_file   Position in the file (unit byte)
//! </pre></div> 
<p>Definition at line <a class="el" href="a00050.html#l01117">1117</a> of file <a class="el" href="a00050.html">fat.c</a>.</p>

<p>References <a class="el" href="a00052.html#l02294">fat_allocfreespace()</a>, <a class="el" href="a00050.html#l00924">fat_cache_clusterlist_update_finish()</a>, <a class="el" href="a00050.html#l00900">fat_cache_clusterlist_update_start()</a>, <a class="el" href="a00050.html#l01035">fat_read_file()</a>, <a class="el" href="a00051.html#l00239">FS_CLUST_ACT_SEG</a>, <a class="el" href="a00055.html#l00215">FS_ERR_OUT_LIST</a>, <a class="el" href="a00050.html#l00068">fs_g_cache_clusterlist</a>, <a class="el" href="a00051.html#l00394">fs_g_nav</a>, <a class="el" href="a00051.html#l00396">fs_g_nav_entry</a>, <a class="el" href="a00051.html#l00400">fs_g_seg</a>, <a class="el" href="a00055.html#l00256">fs_g_status</a>, <a class="el" href="a00050.html#l00069">fs_g_u8_current_cache</a>, <a class="el" href="a00051.html#l00317">Fs_segment::u32_addr</a>, <a class="el" href="a00051.html#l00336">Fs_clusterlist_cache::u32_cluster</a>, <a class="el" href="a00051.html#l00305">Fs_management_entry::u32_cluster</a>, <a class="el" href="a00051.html#l00279">Fs_management::u32_offset_data</a>, <a class="el" href="a00051.html#l00278">Fs_management::u32_ptr_fat</a>, <a class="el" href="a00051.html#l00318">Fs_segment::u32_size_or_pos</a>, <a class="el" href="a00051.html#l00337">Fs_clusterlist_cache::u32_start</a>, <a class="el" href="a00051.html#l00273">Fs_management::u8_BPB_SecPerClus</a>, and <a class="el" href="a00051.html#l00335">Fs_clusterlist_cache::u8_lun</a>.</p>

<p>Referenced by <a class="el" href="a00053.html#l00599">file_putc()</a>, <a class="el" href="a00053.html#l00415">file_write()</a>, and <a class="el" href="a00053.html#l00489">file_write_buf()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l01118"></a>01118 {
<a name="l01119"></a>01119    <span class="keywordflow">if</span>( 0 == <a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a> )
<a name="l01120"></a>01120    {
<a name="l01121"></a>01121       <span class="comment">// File don't have a cluster list, then alloc the first cluster list of the file</span>
<a name="l01122"></a>01122       MSB0(<a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a>)    = 0xFF;     <span class="comment">// It is a new cluster list</span>
<a name="l01123"></a>01123       <span class="comment">// Update cluster list caches</span>
<a name="l01124"></a>01124       <span class="comment">// fs_g_cluster.u32_pos    = ?         // To fill after alloc</span>
<a name="l01125"></a>01125       <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a>   = 0;
<a name="l01126"></a>01126       <a class="code" href="a00019.html#98a226b82d5df9c085d050fb341d8c6c" title="This function initializes a cache in cluster list caches.">fat_cache_clusterlist_update_start</a>(TRUE);
<a name="l01127"></a>01127    }
<a name="l01128"></a>01128    <span class="keywordflow">else</span>
<a name="l01129"></a>01129    {
<a name="l01130"></a>01130       <span class="keywordflow">if</span>( <a class="code" href="a00019.html#d8c9c9a63c821e8cea06c340c029668d" title="This function gets or clears a cluster list at the current position in the selected...">fat_read_file</a>( mode ) )
<a name="l01131"></a>01131          <span class="keywordflow">return</span> TRUE;      <span class="comment">// A segment is availabled (no alloc necessary)</span>
<a name="l01132"></a>01132 
<a name="l01133"></a>01133       <span class="keywordflow">if</span>( <a class="code" href="a00024.html#e8798a89bfc4f49da50fc55b14a5b07f" title="The position is outside the cluster list.">FS_ERR_OUT_LIST</a> != <a class="code" href="a00024.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> )
<a name="l01134"></a>01134       {
<a name="l01135"></a>01135          <span class="keywordflow">return</span> FALSE;     <span class="comment">// Error system</span>
<a name="l01136"></a>01136       }
<a name="l01137"></a>01137       <span class="comment">// fat_read_file is outsize the list then the current cluster list cache contains the last cluster</span>
<a name="l01138"></a>01138 
<a name="l01139"></a>01139       <span class="comment">// Initialize cluster list caches before alloc routine</span>
<a name="l01140"></a>01140       <a class="code" href="a00019.html#2c119a8b66b97a6c14624fb941889a24">fs_g_cache_clusterlist</a>[<a class="code" href="a00019.html#07bae2654ebf3c7d64078af69ccebd3b">fs_g_u8_current_cache</a>].<a class="code" href="a00001.html#9fbad8d6dc29d31a77b92c759ecfeba8" title="LUN of cluster list.">u8_lun</a>       = 0xFF;                     <span class="comment">// unvalid cache</span>
<a name="l01141"></a>01141       <span class="comment">// fs_g_cache_clusterlist[fs_g_u8_current_cache].u32_cluster  = fs_g_cluster.u32_pos;  // it is the same</span>
<a name="l01142"></a>01142       <a class="code" href="a00019.html#2c119a8b66b97a6c14624fb941889a24">fs_g_cache_clusterlist</a>[<a class="code" href="a00019.html#07bae2654ebf3c7d64078af69ccebd3b">fs_g_u8_current_cache</a>].<a class="code" href="a00001.html#9b3cb7c527c5e7e02cc5f4e76fdcd90c" title="Start position in the cluster list (unit 512B).">u32_start</a> += <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#cddebea9972567fdcb5b87327b48125e" title="Cluster size (unit 512B).">u8_BPB_SecPerClus</a>; <span class="comment">// Position of next cluster (the first new)</span>
<a name="l01143"></a>01143    }
<a name="l01144"></a>01144 
<a name="l01145"></a>01145    <span class="comment">// Alloc a cluster list</span>
<a name="l01146"></a>01146    <span class="keywordflow">if</span>( <a class="code" href="a00020.html#67f38f48a73531bf4bcd7bf87c7b1db5">FS_CLUST_ACT_SEG</a> == mode )
<a name="l01147"></a>01147    {
<a name="l01148"></a>01148       <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> = u32_nb_sector_write;
<a name="l01149"></a>01149    }<span class="keywordflow">else</span>{
<a name="l01150"></a>01150       <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> = 1;                                                          <span class="comment">// only one sector</span>
<a name="l01151"></a>01151    }
<a name="l01152"></a>01152 
<a name="l01153"></a>01153    <span class="comment">//note: fs_g_seg.u32_addr is already initialized with the last cluster value (see fat_cluster_list())</span>
<a name="l01154"></a>01154    <span class="keywordflow">if</span>( !<a class="code" href="a00020.html#1fa62b2728e71cff2e95556db7ed1b9c" title="This function allocs a cluster list.">fat_allocfreespace</a>())
<a name="l01155"></a>01155       <span class="keywordflow">return</span> FALSE;
<a name="l01156"></a>01156    <span class="comment">//note: fs_g_seg.u32_addr is the first cluster of the cluster list allocated by alloc_free_space()</span>
<a name="l01157"></a>01157    <span class="comment">//note: fs_g_seg.u32_size_or_pos = number of sectors remaining</span>
<a name="l01158"></a>01158 
<a name="l01159"></a>01159    <span class="keywordflow">if</span>( 0 == <a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a> )
<a name="l01160"></a>01160    {
<a name="l01161"></a>01161       <span class="comment">// It is the first cluster list of file, then update following values in cluster list cache</span>
<a name="l01162"></a>01162       <span class="comment">// fs_g_seg.u32_addr = already contzins the first cluster of the file (see alloc_free_space())</span>
<a name="l01163"></a>01163       <a class="code" href="a00019.html#2c119a8b66b97a6c14624fb941889a24">fs_g_cache_clusterlist</a>[<a class="code" href="a00019.html#07bae2654ebf3c7d64078af69ccebd3b">fs_g_u8_current_cache</a>].<a class="code" href="a00001.html#3993609419d886d6bbd71d4b1381d5d8" title="First cluster of cluster list.">u32_cluster</a> = <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a>;
<a name="l01164"></a>01164       <span class="comment">// Update file entry</span>
<a name="l01165"></a>01165       <a class="code" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00005.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a> = <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a>;
<a name="l01166"></a>01166    }
<a name="l01167"></a>01167 
<a name="l01168"></a>01168    <span class="comment">// Update cluster list cache</span>
<a name="l01169"></a>01169    <span class="keywordflow">if</span>( <a class="code" href="a00020.html#67f38f48a73531bf4bcd7bf87c7b1db5">FS_CLUST_ACT_SEG</a> == mode )
<a name="l01170"></a>01170    {
<a name="l01171"></a>01171       <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> = u32_nb_sector_write - <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a>;
<a name="l01172"></a>01172    }<span class="keywordflow">else</span>{
<a name="l01173"></a>01173       <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> = 1 - <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a>;
<a name="l01174"></a>01174    }
<a name="l01175"></a>01175    <a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a> = ((<a class="code" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00009.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a> - 2) * <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#cddebea9972567fdcb5b87327b48125e" title="Cluster size (unit 512B).">u8_BPB_SecPerClus</a>)
<a name="l01176"></a>01176                      + <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#af1d8fda28bded48a54c7eab4d729618" title="FAT address (unit 512B).">u32_ptr_fat</a> + <a class="code" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00004.html#4666662ac4fa96c340a61e5fb786b83a" title="Offset between the beginning of FAT and the first cluster (unit 512B).">u32_offset_data</a>;
<a name="l01177"></a>01177    <a class="code" href="a00019.html#2ae33c7eebc67cd4cf420593aa2c97d6" title="This function updates a cache of cluster list caches.">fat_cache_clusterlist_update_finish</a>();
<a name="l01178"></a>01178 
<a name="l01179"></a>01179    <span class="keywordflow">return</span> <a class="code" href="a00019.html#d8c9c9a63c821e8cea06c340c029668d" title="This function gets or clears a cluster list at the current position in the selected...">fat_read_file</a>( mode );    <span class="comment">// load the new cluster list</span>
<a name="l01180"></a>01180 }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="f1ca07cf6181c8e6af3fa988a0b0539d"></a><!-- doxytag: member="fat.h::fs_g_cluster" ref="f1ca07cf6181c8e6af3fa988a0b0539d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_GLOBEXT_ _MEM_TYPE_FAST_ <a class="el" href="a00012.html">Fs_cluster</a> <a class="el" href="a00020.html#f1ca07cf6181c8e6af3fa988a0b0539d">fs_g_cluster</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
To take time in functions: fat_getfreespace, fat_cluster_list, fat_cluster_val, fat_checkcluster. 
<p>

<p>Definition at line <a class="el" href="a00051.html#l00403">403</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l02294">fat_allocfreespace()</a>, <a class="el" href="a00050.html#l00964">fat_cache_clusterlist_update_read()</a>, <a class="el" href="a00050.html#l00900">fat_cache_clusterlist_update_start()</a>, <a class="el" href="a00050.html#l00845">fat_checkcluster()</a>, <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>, <a class="el" href="a00050.html#l00798">fat_cluster_readnext()</a>, <a class="el" href="a00050.html#l00603">fat_cluster_val()</a>, <a class="el" href="a00052.html#l02133">fat_getfreespace()</a>, and <a class="el" href="a00052.html#l02198">fat_getfreespace_percent()</a>.</p>

</div>
</div><p>
<a class="anchor" name="5c5e563664aa146853ff976ce0b412ec"></a><!-- doxytag: member="fat.h::fs_g_nav" ref="5c5e563664aa146853ff976ce0b412ec" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_GLOBEXT_ _MEM_TYPE_SLOW_ <a class="el" href="a00004.html">Fs_management</a> <a class="el" href="a00020.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00394">394</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l02294">fat_allocfreespace()</a>, <a class="el" href="a00050.html#l00924">fat_cache_clusterlist_update_finish()</a>, <a class="el" href="a00050.html#l00964">fat_cache_clusterlist_update_read()</a>, <a class="el" href="a00050.html#l01794">fat_cache_read_sector()</a>, <a class="el" href="a00050.html#l00091">fat_check_device()</a>, <a class="el" href="a00050.html#l01888">fat_check_nav_access_disk()</a>, <a class="el" href="a00050.html#l01920">fat_check_nav_access_file()</a>, <a class="el" href="a00052.html#l00929">fat_clean_zone()</a>, <a class="el" href="a00052.html#l02474">fat_clear_cluster()</a>, <a class="el" href="a00050.html#l01394">fat_clear_entry_info_and_ptr()</a>, <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>, <a class="el" href="a00050.html#l00603">fat_cluster_val()</a>, <a class="el" href="a00050.html#l01994">fat_copy_nav()</a>, <a class="el" href="a00052.html#l00341">fat_format()</a>, <a class="el" href="a00052.html#l02133">fat_getfreespace()</a>, <a class="el" href="a00052.html#l02198">fat_getfreespace_percent()</a>, <a class="el" href="a00052.html#l01181">fat_initialize_dir()</a>, <a class="el" href="a00052.html#l01006">fat_initialize_fat()</a>, <a class="el" href="a00050.html#l01968">fat_invert_nav()</a>, <a class="el" href="a00052.html#l00105">fat_mount()</a>, <a class="el" href="a00050.html#l01195">fat_read_dir()</a>, <a class="el" href="a00052.html#l00888">fat_read_fat32_FSInfo()</a>, <a class="el" href="a00050.html#l01035">fat_read_file()</a>, <a class="el" href="a00052.html#l00484">fat_select_filesystem()</a>, <a class="el" href="a00052.html#l01044">fat_serialnumber()</a>, <a class="el" href="a00052.html#l02439">fat_update_fat2()</a>, <a class="el" href="a00052.html#l00853">fat_write_fat32_FSInfo()</a>, <a class="el" href="a00050.html#l01117">fat_write_file()</a>, <a class="el" href="a00052.html#l00730">fat_write_PBR()</a>, <a class="el" href="a00053.html#l00147">file_load_segment_value()</a>, <a class="el" href="a00053.html#l00092">file_open()</a>, <a class="el" href="a00053.html#l00172">file_read()</a>, <a class="el" href="a00053.html#l00249">file_read_buf()</a>, <a class="el" href="a00053.html#l00489">file_write_buf()</a>, <a class="el" href="a00067.html#l01189">nav_dir_cd()</a>, <a class="el" href="a00067.html#l01219">nav_dir_gotoparent()</a>, <a class="el" href="a00067.html#l01170">nav_dir_is_root()</a>, <a class="el" href="a00067.html#l01267">nav_dir_name()</a>, <a class="el" href="a00067.html#l00353">nav_drive_get()</a>, <a class="el" href="a00067.html#l00370">nav_drive_getname()</a>, <a class="el" href="a00067.html#l00324">nav_drive_set()</a>, <a class="el" href="a00067.html#l02156">nav_file_create()</a>, <a class="el" href="a00067.html#l01877">nav_file_isreadonly()</a>, <a class="el" href="a00067.html#l02096">nav_file_rename()</a>, <a class="el" href="a00067.html#l00923">nav_filelist_eol()</a>, <a class="el" href="a00067.html#l00965">nav_filelist_exist()</a>, <a class="el" href="a00067.html#l01034">nav_filelist_first()</a>, <a class="el" href="a00067.html#l00846">nav_filelist_get()</a>, <a class="el" href="a00067.html#l00991">nav_filelist_nb()</a>, <a class="el" href="a00067.html#l00726">nav_filelist_set()</a>, <a class="el" href="a00067.html#l00664">nav_filelist_single_disable()</a>, <a class="el" href="a00067.html#l00648">nav_filelist_single_enable()</a>, <a class="el" href="a00061.html#l00298">nav_filterflat_cd()</a>, <a class="el" href="a00061.html#l00201">nav_filterflat_get()</a>, <a class="el" href="a00061.html#l00317">nav_filterflat_gotoparent()</a>, <a class="el" href="a00061.html#l00070">nav_filterflat_mount()</a>, <a class="el" href="a00061.html#l00113">nav_filterflat_next()</a>, <a class="el" href="a00061.html#l00155">nav_filterflat_previous()</a>, <a class="el" href="a00061.html#l00096">nav_filterflat_reset()</a>, <a class="el" href="a00061.html#l00083">nav_filterflat_root()</a>, <a class="el" href="a00063.html#l00366">nav_filterlist_cd()</a>, <a class="el" href="a00063.html#l00139">nav_filterlist_get()</a>, <a class="el" href="a00063.html#l00152">nav_filterlist_goto()</a>, <a class="el" href="a00063.html#l00432">nav_filterlist_gotoindex()</a>, <a class="el" href="a00063.html#l00383">nav_filterlist_gotoparent()</a>, <a class="el" href="a00063.html#l00337">nav_filterlist_mount()</a>, <a class="el" href="a00063.html#l00257">nav_filterlist_nb_ex()</a>, <a class="el" href="a00063.html#l00088">nav_filterlist_next()</a>, <a class="el" href="a00063.html#l00116">nav_filterlist_previous()</a>, <a class="el" href="a00063.html#l00076">nav_filterlist_reset()</a>, <a class="el" href="a00063.html#l00349">nav_filterlist_root()</a>, <a class="el" href="a00063.html#l00064">nav_filterlist_setfilter()</a>, <a class="el" href="a00065.html#l00324">nav_flat_cd()</a>, <a class="el" href="a00065.html#l00223">nav_flat_get()</a>, <a class="el" href="a00065.html#l00343">nav_flat_gotoparent()</a>, <a class="el" href="a00065.html#l00071">nav_flat_mount()</a>, <a class="el" href="a00065.html#l00135">nav_flat_next()</a>, <a class="el" href="a00065.html#l00177">nav_flat_previous()</a>, <a class="el" href="a00065.html#l00096">nav_flat_reset()</a>, <a class="el" href="a00065.html#l00084">nav_flat_root()</a>, <a class="el" href="a00067.html#l01093">nav_getindex()</a>, <a class="el" href="a00067.html#l01120">nav_gotoindex()</a>, <a class="el" href="a00067.html#l00595">nav_partition_cluster_size()</a>, <a class="el" href="a00067.html#l00461">nav_partition_mount()</a>, <a class="el" href="a00067.html#l00434">nav_partition_set()</a>, <a class="el" href="a00067.html#l00582">nav_partition_space()</a>, and <a class="el" href="a00067.html#l00165">nav_reset()</a>.</p>

</div>
</div><p>
<a class="anchor" name="fcc9a3eb6084fd54807483346dfc5d09"></a><!-- doxytag: member="fat.h::fs_g_nav_entry" ref="fcc9a3eb6084fd54807483346dfc5d09" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_GLOBEXT_ _MEM_TYPE_SLOW_ <a class="el" href="a00005.html">Fs_management_entry</a> <a class="el" href="a00020.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00396">396</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l01394">fat_clear_entry_info_and_ptr()</a>, <a class="el" href="a00050.html#l01994">fat_copy_nav()</a>, <a class="el" href="a00052.html#l02074">fat_delete_file()</a>, <a class="el" href="a00050.html#l01385">fat_entry_is_dir()</a>, <a class="el" href="a00050.html#l01353">fat_get_entry_info()</a>, <a class="el" href="a00052.html#l01181">fat_initialize_dir()</a>, <a class="el" href="a00050.html#l01968">fat_invert_nav()</a>, <a class="el" href="a00050.html#l01035">fat_read_file()</a>, <a class="el" href="a00050.html#l01421">fat_write_entry_file()</a>, <a class="el" href="a00050.html#l01117">fat_write_file()</a>, <a class="el" href="a00053.html#l00711">file_bof()</a>, <a class="el" href="a00053.html#l00747">file_close()</a>, <a class="el" href="a00053.html#l00726">file_eof()</a>, <a class="el" href="a00053.html#l00736">file_flush()</a>, <a class="el" href="a00053.html#l00363">file_getc()</a>, <a class="el" href="a00053.html#l00632">file_getpos()</a>, <a class="el" href="a00053.html#l00092">file_open()</a>, <a class="el" href="a00053.html#l00599">file_putc()</a>, <a class="el" href="a00053.html#l00172">file_read()</a>, <a class="el" href="a00053.html#l00249">file_read_buf()</a>, <a class="el" href="a00053.html#l00653">file_seek()</a>, <a class="el" href="a00053.html#l00460">file_set_eof()</a>, <a class="el" href="a00053.html#l00415">file_write()</a>, <a class="el" href="a00053.html#l00489">file_write_buf()</a>, <a class="el" href="a00067.html#l01189">nav_dir_cd()</a>, <a class="el" href="a00067.html#l01219">nav_dir_gotoparent()</a>, <a class="el" href="a00067.html#l01361">nav_dir_make()</a>, <a class="el" href="a00067.html#l01267">nav_dir_name()</a>, <a class="el" href="a00067.html#l01948">nav_file_attributget()</a>, <a class="el" href="a00067.html#l01988">nav_file_attributset()</a>, <a class="el" href="a00067.html#l02156">nav_file_create()</a>, <a class="el" href="a00067.html#l01877">nav_file_isreadonly()</a>, <a class="el" href="a00067.html#l01856">nav_file_lgt()</a>, <a class="el" href="a00067.html#l01866">nav_file_lgtsector()</a>, <a class="el" href="a00067.html#l02096">nav_file_rename()</a>, <a class="el" href="a00063.html#l00383">nav_filterlist_gotoparent()</a>, <a class="el" href="a00071.html#l00103">reader_txt_beg()</a>, <a class="el" href="a00071.html#l00142">reader_txt_get_line()</a>, <a class="el" href="a00071.html#l00082">reader_txt_new()</a>, and <a class="el" href="a00071.html#l00123">reader_txt_select_format()</a>.</p>

</div>
</div><p>
<a class="anchor" name="14ab00294275fb02f822b22d7dcc6b13"></a><!-- doxytag: member="fat.h::fs_g_nav_fast" ref="14ab00294275fb02f822b22d7dcc6b13" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_GLOBEXT_ _MEM_TYPE_FAST_ <a class="el" href="a00006.html">Fs_management_fast</a> <a class="el" href="a00020.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00395">395</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l01921">fat_alloc_entry_free()</a>, <a class="el" href="a00052.html#l02294">fat_allocfreespace()</a>, <a class="el" href="a00050.html#l00091">fat_check_device()</a>, <a class="el" href="a00050.html#l00154">fat_check_mount()</a>, <a class="el" href="a00050.html#l01920">fat_check_nav_access_file()</a>, <a class="el" href="a00050.html#l00175">fat_check_noopen()</a>, <a class="el" href="a00050.html#l00211">fat_check_select()</a>, <a class="el" href="a00050.html#l01394">fat_clear_entry_info_and_ptr()</a>, <a class="el" href="a00050.html#l01994">fat_copy_nav()</a>, <a class="el" href="a00052.html#l01500">fat_create_entry_file_name()</a>, <a class="el" href="a00052.html#l02074">fat_delete_file()</a>, <a class="el" href="a00052.html#l01768">fat_find_short_entry_name()</a>, <a class="el" href="a00052.html#l02004">fat_garbage_collector_entry()</a>, <a class="el" href="a00050.html#l01773">fat_get_ptr_entry()</a>, <a class="el" href="a00050.html#l01968">fat_invert_nav()</a>, <a class="el" href="a00052.html#l00105">fat_mount()</a>, <a class="el" href="a00050.html#l01195">fat_read_dir()</a>, <a class="el" href="a00052.html#l00484">fat_select_filesystem()</a>, <a class="el" href="a00067.html#l01189">nav_dir_cd()</a>, <a class="el" href="a00067.html#l01219">nav_dir_gotoparent()</a>, <a class="el" href="a00067.html#l01267">nav_dir_name()</a>, <a class="el" href="a00067.html#l00324">nav_drive_set()</a>, <a class="el" href="a00067.html#l01769">nav_file_name()</a>, <a class="el" href="a00067.html#l02096">nav_file_rename()</a>, <a class="el" href="a00067.html#l00923">nav_filelist_eol()</a>, <a class="el" href="a00067.html#l00726">nav_filelist_set()</a>, <a class="el" href="a00063.html#l00432">nav_filterlist_gotoindex()</a>, <a class="el" href="a00063.html#l00383">nav_filterlist_gotoparent()</a>, <a class="el" href="a00067.html#l01093">nav_getindex()</a>, <a class="el" href="a00067.html#l01120">nav_gotoindex()</a>, <a class="el" href="a00067.html#l00609">nav_partition_freespace()</a>, <a class="el" href="a00067.html#l00627">nav_partition_freespace_percent()</a>, <a class="el" href="a00067.html#l00529">nav_partition_label()</a>, <a class="el" href="a00067.html#l00461">nav_partition_mount()</a>, <a class="el" href="a00067.html#l00434">nav_partition_set()</a>, <a class="el" href="a00067.html#l00582">nav_partition_space()</a>, <a class="el" href="a00067.html#l00485">nav_partition_type()</a>, and <a class="el" href="a00067.html#l00165">nav_reset()</a>.</p>

</div>
</div><p>
<a class="anchor" name="a84f1da7d8ef3aa46b236f6a7a3b0fa1"></a><!-- doxytag: member="fat.h::fs_g_sector" ref="a84f1da7d8ef3aa46b236f6a7a3b0fa1" args="[FS_CACHE_SIZE]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_GLOBEXT_ _MEM_TYPE_SLOW_ U8 <a class="el" href="a00022.html#dc631d0afa2c6ca656d3d3ac255504ce">fs_g_sector</a>[FS_CACHE_SIZE]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Use "FAT sector cache" to store a sector from a file (see <a class="el" href="a00022.html#44de4bc08663fbddbd11946bbb06e2ce" title="This function writes a byte in the file.">file_putc()</a>, <a class="el" href="a00022.html#952fd54b2e49943d138e44d3bdf569bf" title="This function returns the next byte of file.">file_getc()</a>, <a class="el" href="a00022.html#7b7c08bde8cb93a792dd578cf4310d0a" title="This function copys in a buffer the file data corresponding at the current position...">file_read_buf()</a>, <a class="el" href="a00022.html#415ad1a43ac79c02c294a4e32246c519" title="This function transfer a buffer to a file at the current file position.">file_write_buf()</a>). 
<p>

<p>Definition at line <a class="el" href="a00051.html#l00415">415</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l01840">fat_cache_clear()</a>, <a class="el" href="a00050.html#l01860">fat_cache_flush()</a>, <a class="el" href="a00050.html#l01794">fat_cache_read_sector()</a>, <a class="el" href="a00052.html#l00929">fat_clean_zone()</a>, <a class="el" href="a00050.html#l00798">fat_cluster_readnext()</a>, <a class="el" href="a00050.html#l00603">fat_cluster_val()</a>, <a class="el" href="a00050.html#l00299">fat_get_nbpartition()</a>, <a class="el" href="a00050.html#l01773">fat_get_ptr_entry()</a>, <a class="el" href="a00052.html#l02198">fat_getfreespace_percent()</a>, <a class="el" href="a00052.html#l01181">fat_initialize_dir()</a>, <a class="el" href="a00052.html#l01006">fat_initialize_fat()</a>, <a class="el" href="a00052.html#l00105">fat_mount()</a>, <a class="el" href="a00052.html#l00888">fat_read_fat32_FSInfo()</a>, <a class="el" href="a00052.html#l01044">fat_serialnumber()</a>, <a class="el" href="a00052.html#l00853">fat_write_fat32_FSInfo()</a>, <a class="el" href="a00052.html#l00623">fat_write_MBR()</a>, and <a class="el" href="a00052.html#l00730">fat_write_PBR()</a>.</p>

</div>
</div><p>
<a class="anchor" name="140fe136917dd9c8db4239a2027be1a2"></a><!-- doxytag: member="fat.h::fs_g_sectorcache" ref="140fe136917dd9c8db4239a2027be1a2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_GLOBEXT_ _MEM_TYPE_SLOW_ <a class="el" href="a00008.html">Fs_sector_cache</a> <a class="el" href="a00020.html#140fe136917dd9c8db4239a2027be1a2">fs_g_sectorcache</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00051.html#l00416">416</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l01860">fat_cache_flush()</a>, <a class="el" href="a00050.html#l01848">fat_cache_mark_sector_as_dirty()</a>, <a class="el" href="a00050.html#l01794">fat_cache_read_sector()</a>, <a class="el" href="a00050.html#l01829">fat_cache_reset()</a>, <a class="el" href="a00050.html#l00091">fat_check_device()</a>, <a class="el" href="a00050.html#l01195">fat_read_dir()</a>, and <a class="el" href="a00050.html#l01035">fat_read_file()</a>.</p>

</div>
</div><p>
<a class="anchor" name="6d934f26f97b442c30712e57ee8b21e5"></a><!-- doxytag: member="fat.h::fs_g_seg" ref="6d934f26f97b442c30712e57ee8b21e5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_GLOBEXT_ _MEM_TYPE_FAST_ <a class="el" href="a00009.html">Fs_segment</a> <a class="el" href="a00020.html#6d934f26f97b442c30712e57ee8b21e5">fs_g_seg</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Variable frequently used by many function (optimization, no parameter in function). 
<p>

<p>Definition at line <a class="el" href="a00051.html#l00400">400</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l01921">fat_alloc_entry_free()</a>, <a class="el" href="a00052.html#l02294">fat_allocfreespace()</a>, <a class="el" href="a00050.html#l00924">fat_cache_clusterlist_update_finish()</a>, <a class="el" href="a00050.html#l00964">fat_cache_clusterlist_update_read()</a>, <a class="el" href="a00050.html#l00900">fat_cache_clusterlist_update_start()</a>, <a class="el" href="a00052.html#l02474">fat_clear_cluster()</a>, <a class="el" href="a00050.html#l00364">fat_cluster_list()</a>, <a class="el" href="a00050.html#l01195">fat_read_dir()</a>, <a class="el" href="a00050.html#l01035">fat_read_file()</a>, <a class="el" href="a00050.html#l01117">fat_write_file()</a>, <a class="el" href="a00053.html#l00147">file_load_segment_value()</a>, <a class="el" href="a00053.html#l00172">file_read()</a>, <a class="el" href="a00053.html#l00249">file_read_buf()</a>, <a class="el" href="a00053.html#l00415">file_write()</a>, <a class="el" href="a00053.html#l00489">file_write_buf()</a>, and <a class="el" href="a00067.html#l01361">nav_dir_make()</a>.</p>

</div>
</div><p>
<a class="anchor" name="b55b94c50b63cf8b83e2afcf2e0c2981"></a><!-- doxytag: member="fat.h::fs_g_u16_first_mod_fat" ref="b55b94c50b63cf8b83e2afcf2e0c2981" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_GLOBEXT_ _MEM_TYPE_SLOW_ U16 <a class="el" href="a00020.html#b55b94c50b63cf8b83e2afcf2e0c2981">fs_g_u16_first_mod_fat</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Offset (unit 512B) in fat of the first sector (unit 512B). 
<p>

<p>Definition at line <a class="el" href="a00051.html#l00408">408</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l02425">fat_clear_info_fat_mod()</a>, <a class="el" href="a00050.html#l00603">fat_cluster_val()</a>, and <a class="el" href="a00052.html#l02439">fat_update_fat2()</a>.</p>

</div>
</div><p>
<a class="anchor" name="e8c6fce6d75eb9ddbf1e63e46659e9cc"></a><!-- doxytag: member="fat.h::fs_g_u16_last_mod_fat" ref="e8c6fce6d75eb9ddbf1e63e46659e9cc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_GLOBEXT_ _MEM_TYPE_SLOW_ U16 <a class="el" href="a00020.html#e8c6fce6d75eb9ddbf1e63e46659e9cc">fs_g_u16_last_mod_fat</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Offset (unit 512B) in fat of the last sector (unit 512B). 
<p>

<p>Definition at line <a class="el" href="a00051.html#l00409">409</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00052.html#l02425">fat_clear_info_fat_mod()</a>, <a class="el" href="a00050.html#l00603">fat_cluster_val()</a>, and <a class="el" href="a00052.html#l02439">fat_update_fat2()</a>.</p>

</div>
</div><p>
<a class="anchor" name="8e617688fc42b47e56cce053123fd05f"></a><!-- doxytag: member="fat.h::fs_gu32_addrsector" ref="8e617688fc42b47e56cce053123fd05f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_GLOBEXT_ _MEM_TYPE_SLOW_ U32 <a class="el" href="a00020.html#8e617688fc42b47e56cce053123fd05f">fs_gu32_addrsector</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Store the address of futur cache (unit 512B). 
<p>

<p>Definition at line <a class="el" href="a00051.html#l00417">417</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l01794">fat_cache_read_sector()</a>, <a class="el" href="a00052.html#l00929">fat_clean_zone()</a>, <a class="el" href="a00052.html#l02474">fat_clear_cluster()</a>, <a class="el" href="a00050.html#l00798">fat_cluster_readnext()</a>, <a class="el" href="a00050.html#l00603">fat_cluster_val()</a>, <a class="el" href="a00050.html#l00299">fat_get_nbpartition()</a>, <a class="el" href="a00052.html#l02198">fat_getfreespace_percent()</a>, <a class="el" href="a00052.html#l01006">fat_initialize_fat()</a>, <a class="el" href="a00052.html#l00105">fat_mount()</a>, <a class="el" href="a00050.html#l01195">fat_read_dir()</a>, <a class="el" href="a00052.html#l00888">fat_read_fat32_FSInfo()</a>, <a class="el" href="a00050.html#l01035">fat_read_file()</a>, <a class="el" href="a00052.html#l01044">fat_serialnumber()</a>, <a class="el" href="a00052.html#l02439">fat_update_fat2()</a>, <a class="el" href="a00052.html#l00853">fat_write_fat32_FSInfo()</a>, <a class="el" href="a00052.html#l00623">fat_write_MBR()</a>, <a class="el" href="a00052.html#l00730">fat_write_PBR()</a>, and <a class="el" href="a00053.html#l00489">file_write_buf()</a>.</p>

</div>
</div><p>
<a class="anchor" name="6e59f1ec12b7954a956be7185df3ec05"></a><!-- doxytag: member="fat.h::g_b_no_check_disk" ref="6e59f1ec12b7954a956be7185df3ec05" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_GLOBEXT_ Bool <a class="el" href="a00020.html#6e59f1ec12b7954a956be7185df3ec05">g_b_no_check_disk</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Variables to enable/disable the disk check before each action on disk. 
<p>

<p>Definition at line <a class="el" href="a00051.html#l00390">390</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l00091">fat_check_device()</a>, <a class="el" href="a00067.html#l00137">nav_checkdisk_disable()</a>, <a class="el" href="a00067.html#l00149">nav_checkdisk_enable()</a>, and <a class="el" href="a00067.html#l00165">nav_reset()</a>.</p>

</div>
</div><p>
<a class="anchor" name="6d450fc3016f0d8a7f5674d9e3a05c83"></a><!-- doxytag: member="fat.h::g_b_string_length" ref="6d450fc3016f0d8a7f5674d9e3a05c83" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_GLOBEXT_ Bool <a class="el" href="a00020.html#6d450fc3016f0d8a7f5674d9e3a05c83">g_b_string_length</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Variables to select LENGTH string mode (initialised in <a class="el" href="a00036.html#605dfecfa334f8ced2cebfa5162a931b" title="This function resets ALL navigations to init file system core.">nav_reset()</a>). 
<p>

<p>Definition at line <a class="el" href="a00051.html#l00387">387</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00050.html#l01607">fat_entry_longname()</a>, <a class="el" href="a00050.html#l01476">fat_entry_shortname()</a>, <a class="el" href="a00067.html#l01267">nav_dir_name()</a>, <a class="el" href="a00067.html#l01769">nav_file_name()</a>, <a class="el" href="a00067.html#l01411">nav_getcwd()</a>, <a class="el" href="a00067.html#l00165">nav_reset()</a>, <a class="el" href="a00067.html#l00122">nav_string_length_disable()</a>, and <a class="el" href="a00067.html#l00111">nav_string_length_enable()</a>.</p>

</div>
</div><p>
<a class="anchor" name="fdc963fda511dd9e790c81b6a6b33d34"></a><!-- doxytag: member="fat.h::g_b_unicode" ref="fdc963fda511dd9e790c81b6a6b33d34" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_GLOBEXT_ Bool <a class="el" href="a00020.html#fdc963fda511dd9e790c81b6a6b33d34">g_b_unicode</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Variables to select string format (initialised in <a class="el" href="a00036.html#605dfecfa334f8ced2cebfa5162a931b" title="This function resets ALL navigations to init file system core.">nav_reset()</a>). 
<p>

<p>Definition at line <a class="el" href="a00051.html#l00385">385</a> of file <a class="el" href="a00051.html">fat.h</a>.</p>

<p>Referenced by <a class="el" href="a00067.html#l00165">nav_reset()</a>, <a class="el" href="a00067.html#l00098">nav_string_ascii()</a>, and <a class="el" href="a00067.html#l00087">nav_string_unicode()</a>.</p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Dec 21 18:30:57 2009 for AVR32 UC3 - FSACCESS Services by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
