<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>AVR32 - FAT Services: reader_txt.h File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>reader_txt.h File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
FAT 12/16/32 text reader service. 
<p>
This file defines a useful set of functions for the text file accesses on AVR32 devices.<p>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Atmel Corporation: <a href="http://www.atmel.com">http://www.atmel.com</a> <br>
 Support and FAQ: <a href="http://support.atmel.no/">http://support.atmel.no/</a> </dd></dl>

<p>Definition in file <a class="el" href="a00099.html">reader_txt.h</a>.</p>

<p>
<code>#include &quot;<a class="el" href="a00078.html">fs_com.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="a00072.html">fat.h</a>&quot;</code><br>

<p>
<a href="a00099.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00052.html#4f6bbd93a0b11365b77518a22b1ae098">reader_txt_beg</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function goes at the beginning of file and read the text header.  <a href="#4f6bbd93a0b11365b77518a22b1ae098"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00052.html#1859333aec56b71c6126da66452231c1">reader_txt_close</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Close text file.  <a href="#1859333aec56b71c6126da66452231c1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">U16&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00052.html#29030022836887d64ee7b516b93f2d4e">reader_txt_get_line</a> (Bool b_unicode, <a class="el" href="a00031.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> string, U16 u16_str_size)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function fills an ASCII buffer with the current text line of opened file.  <a href="#29030022836887d64ee7b516b93f2d4e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00052.html#a294dece909ef8dc6c56dd13f1b78aa5">reader_txt_jump_line</a> (U16 nb_line)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function jumps text lines.  <a href="#a294dece909ef8dc6c56dd13f1b78aa5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00052.html#ef8e9a323aab9e3c839130f47a79453a">reader_txt_new</a> (const <a class="el" href="a00031.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> sz_name, U8 u8_txt_format)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a new text file.  <a href="#ef8e9a323aab9e3c839130f47a79453a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00052.html#ee4bf4e140c9a4893547bf41459e57f3">reader_txt_open</a> (Bool b_readonly)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Open a selected text file in the current navigator.  <a href="#ee4bf4e140c9a4893547bf41459e57f3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00052.html#277e7970bcc003a9e9823b70e259d0b5">reader_txt_select_format</a> (U8 u8_txt_format)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function allow to select the text format to decode.  <a href="#277e7970bcc003a9e9823b70e259d0b5"></a><br></td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="4f6bbd93a0b11365b77518a22b1ae098"></a><!-- doxytag: member="reader_txt.h::reader_txt_beg" ref="4f6bbd93a0b11365b77518a22b1ae098" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void reader_txt_beg           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function goes at the beginning of file and read the text header. 
<p>

<p>Definition at line <a class="el" href="a00098.html#l00103">103</a> of file <a class="el" href="a00098.html">reader_txt.c</a>.</p>

<p>References <a class="el" href="a00075.html#l00249">file_read_buf()</a>, <a class="el" href="a00075.html#l00653">file_seek()</a>, <a class="el" href="a00072.html#l00396">fs_g_nav_entry</a>, <a class="el" href="a00076.html#l00054">FS_SEEK_SET</a>, <a class="el" href="a00072.html#l00303">Fs_management_entry::u8_txt_format</a>, <a class="el" href="a00101.html#l00048">UNI_MAX_HEADER_SIZE</a>, <a class="el" href="a00100.html#l00088">unicode_header_get()</a>, and <a class="el" href="a00100.html#l00059">unicode_header_scan()</a>.</p>

<p>Referenced by <a class="el" href="a00096.html#l00163">pl_main_open()</a>, <a class="el" href="a00096.html#l00502">pl_nav_readentry()</a>, <a class="el" href="a00096.html#l00444">pl_nav_setpos()</a>, and <a class="el" href="a00098.html#l00065">reader_txt_open()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00104"></a>00104 {
<a name="l00105"></a>00105    <span class="comment">// Table to store the header of text file</span>
<a name="l00106"></a>00106    U8    string_header[<a class="code" href="a00054.html#fe277837248b15658de12b35d5319c23">UNI_MAX_HEADER_SIZE</a>];
<a name="l00107"></a>00107 
<a name="l00108"></a>00108    <a class="code" href="a00028.html#2599f935c7e1b69f2650e0943091ddca" title="This function changes the position in the file.">file_seek</a>( 0, <a class="code" href="a00029.html#5b33d405a458db1db212d345b21454f8" title="start at the beginning">FS_SEEK_SET</a> );  <span class="comment">// go to at the beginning of file</span>
<a name="l00109"></a>00109 
<a name="l00110"></a>00110    <span class="comment">// Read the header to detect the text format (ASCII, UNICODE LE, UNICODE BE, UTF8)</span>
<a name="l00111"></a>00111    memset( string_header, 0, <a class="code" href="a00054.html#fe277837248b15658de12b35d5319c23">UNI_MAX_HEADER_SIZE</a> );     <span class="comment">// By default ASCII</span>
<a name="l00112"></a>00112    <a class="code" href="a00028.html#7b7c08bde8cb93a792dd578cf4310d0a" title="This function copys in a buffer the file data corresponding at the current position...">file_read_buf</a>( string_header , <a class="code" href="a00054.html#fe277837248b15658de12b35d5319c23">UNI_MAX_HEADER_SIZE</a> );
<a name="l00113"></a>00113    <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#1fa472bb197fe1edfa95b67fe66ea089" title="format of text used in selected file (only for reader_txt module)">u8_txt_format</a> = <a class="code" href="a00053.html#72ca402da21dd99d43772a4761e61bd7" title="Detect the text format via a header (3 bytes).">unicode_header_scan</a>( string_header );
<a name="l00114"></a>00114    <span class="comment">// Set cursor after header</span>
<a name="l00115"></a>00115    <a class="code" href="a00028.html#2599f935c7e1b69f2650e0943091ddca" title="This function changes the position in the file.">file_seek</a>( <a class="code" href="a00053.html#806fc5bfe128cc4a4e6ccce39b55049a" title="Return the header corresponding at text format identifier.">unicode_header_get</a>( string_header, <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#1fa472bb197fe1edfa95b67fe66ea089" title="format of text used in selected file (only for reader_txt module)">u8_txt_format</a> ), <a class="code" href="a00029.html#5b33d405a458db1db212d345b21454f8" title="start at the beginning">FS_SEEK_SET</a> );
<a name="l00116"></a>00116 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="1859333aec56b71c6126da66452231c1"></a><!-- doxytag: member="reader_txt.h::reader_txt_close" ref="1859333aec56b71c6126da66452231c1" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void reader_txt_close           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Close text file. 
<p>

<p>Definition at line <a class="el" href="a00098.html#l00271">271</a> of file <a class="el" href="a00098.html">reader_txt.c</a>.</p>

<p>References <a class="el" href="a00075.html#l00747">file_close()</a>.</p>

<p>Referenced by <a class="el" href="a00096.html#l00140">pl_main_new()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00272"></a>00272 {
<a name="l00273"></a>00273    <a class="code" href="a00028.html#7f4f3b65455595cb5be0f7cd7d12e02d" title="This function closes the file.">file_close</a>();
<a name="l00274"></a>00274 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="29030022836887d64ee7b516b93f2d4e"></a><!-- doxytag: member="reader_txt.h::reader_txt_get_line" ref="29030022836887d64ee7b516b93f2d4e" args="(Bool b_unicode, FS_STRING string, U16 u16_str_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">U16 reader_txt_get_line           </td>
          <td>(</td>
          <td class="paramtype">Bool&nbsp;</td>
          <td class="paramname"> <em>b_unicode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00031.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a>&nbsp;</td>
          <td class="paramname"> <em>string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U16&nbsp;</td>
          <td class="paramname"> <em>u16_str_size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function fills an ASCII buffer with the current text line of opened file. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>b_unicode</em>&nbsp;</td><td>TRUE to return a unicode string (UTF16), ASCII otherwise over there </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>string</em>&nbsp;</td><td>string used to store text line </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>u16_str_size</em>&nbsp;</td><td>maximum size of string (unit character, 1B for ASCII, 2B for unicode)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>size of the line (may be &lt; or &gt; at u16_str_size) <p>
0, in case of error</dd></dl>
<div class="fragment"><pre class="fragment">
//! This routine remove the character '\n' '\r'
//! </pre></div> 
<p>Definition at line <a class="el" href="a00098.html#l00142">142</a> of file <a class="el" href="a00098.html">reader_txt.c</a>.</p>

<p>References <a class="el" href="a00075.html#l00726">file_eof()</a>, <a class="el" href="a00075.html#l00363">file_getc()</a>, <a class="el" href="a00075.html#l00249">file_read_buf()</a>, <a class="el" href="a00075.html#l00653">file_seek()</a>, <a class="el" href="a00078.html#l00152">FS_EOF</a>, <a class="el" href="a00078.html#l00221">FS_ERR_EOF</a>, <a class="el" href="a00072.html#l00396">fs_g_nav_entry</a>, <a class="el" href="a00078.html#l00256">fs_g_status</a>, <a class="el" href="a00076.html#l00056">FS_SEEK_CUR_RE</a>, <a class="el" href="a00094.html#l00137">nav_checkdisk_disable()</a>, <a class="el" href="a00094.html#l00149">nav_checkdisk_enable()</a>, <a class="el" href="a00072.html#l00303">Fs_management_entry::u8_txt_format</a>, <a class="el" href="a00101.html#l00049">UNI_MAX_UTF8_SIZE</a>, <a class="el" href="a00101.html#l00057">UNI_TYPE_UTF16BE</a>, <a class="el" href="a00101.html#l00056">UNI_TYPE_UTF16LE</a>, <a class="el" href="a00101.html#l00058">UNI_TYPE_UTF8</a>, and <a class="el" href="a00100.html#l00118">utf8_to_unicode()</a>.</p>

<p>Referenced by <a class="el" href="a00096.html#l00577">pl_main_readline()</a>, and <a class="el" href="a00098.html#l00256">reader_txt_jump_line()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00143"></a>00143 {
<a name="l00144"></a>00144    U8    utf8[<a class="code" href="a00054.html#c48a8938847701b354657c41c992f89c">UNI_MAX_UTF8_SIZE</a>];
<a name="l00145"></a>00145    U8    size_utf8_buf=0;
<a name="l00146"></a>00146    U8    size_utf8_dec=0;
<a name="l00147"></a>00147    U16   u16_size_line = 1;   <span class="comment">// 1 to compute null terminator</span>
<a name="l00148"></a>00148    U16   u16_unicode;
<a name="l00149"></a>00149    Bool  b_error = FALSE;
<a name="l00150"></a>00150 
<a name="l00151"></a>00151    <a class="code" href="a00047.html#c7a2bc65b27a1d7a449d18b07fde6629" title="This function disables the disk check before each actions on disk.">nav_checkdisk_disable</a>();   <span class="comment">// To optimize speed</span>
<a name="l00152"></a>00152    
<a name="l00153"></a>00153    <span class="keywordflow">while</span>( 0 == <a class="code" href="a00028.html#bed52ba7230c6eecf100a3709b9ed74e" title="This function checks the end of file.">file_eof</a>() &amp;&amp; !b_error )
<a name="l00154"></a>00154    {
<a name="l00155"></a>00155       <span class="comment">// Get a unicode value</span>
<a name="l00156"></a>00156       <span class="keywordflow">switch</span>( <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#1fa472bb197fe1edfa95b67fe66ea089" title="format of text used in selected file (only for reader_txt module)">u8_txt_format</a> )
<a name="l00157"></a>00157       {
<a name="l00158"></a>00158          <span class="keywordflow">case</span> <a class="code" href="a00054.html#601edc3012275aa2753840f0bc83c850">UNI_TYPE_UTF8</a>:
<a name="l00159"></a>00159          <span class="comment">// Remove UTF8 codes used</span>
<a name="l00160"></a>00160          <span class="keywordflow">if</span>( 0 != size_utf8_dec )
<a name="l00161"></a>00161          {
<a name="l00162"></a>00162             U8 u8_i;
<a name="l00163"></a>00163             <span class="keywordflow">for</span>( u8_i=0; u8_i&lt;(<a class="code" href="a00054.html#c48a8938847701b354657c41c992f89c">UNI_MAX_UTF8_SIZE</a>-size_utf8_dec); u8_i++ )
<a name="l00164"></a>00164             {
<a name="l00165"></a>00165                utf8[u8_i]=utf8[u8_i+size_utf8_dec];
<a name="l00166"></a>00166             }
<a name="l00167"></a>00167             size_utf8_buf -= size_utf8_dec;
<a name="l00168"></a>00168             size_utf8_dec =0;
<a name="l00169"></a>00169          }
<a name="l00170"></a>00170          <span class="comment">// Complet UTF8 array</span>
<a name="l00171"></a>00171          size_utf8_buf += <a class="code" href="a00028.html#7b7c08bde8cb93a792dd578cf4310d0a" title="This function copys in a buffer the file data corresponding at the current position...">file_read_buf</a>( &amp;utf8[size_utf8_buf], (<a class="code" href="a00054.html#c48a8938847701b354657c41c992f89c">UNI_MAX_UTF8_SIZE</a>-size_utf8_buf) );
<a name="l00172"></a>00172          <span class="comment">// Decode UTF8 to unicode</span>
<a name="l00173"></a>00173          size_utf8_dec = <a class="code" href="a00053.html#2a3ec3b9a79a59f2983ccee1bb8948e1" title="Conversion UTF-8 to unicode.">utf8_to_unicode</a>( &amp;utf8[0], &amp;u16_unicode );
<a name="l00174"></a>00174          <span class="keywordflow">break</span>;
<a name="l00175"></a>00175       
<a name="l00176"></a>00176          <span class="keywordflow">case</span> <a class="code" href="a00054.html#06075fdf01ba0cb5926bfe54e1bfc91e">UNI_TYPE_UTF16BE</a>:
<a name="l00177"></a>00177          MSB(u16_unicode) = <a class="code" href="a00028.html#952fd54b2e49943d138e44d3bdf569bf" title="This function returns the next byte of file.">file_getc</a>();
<a name="l00178"></a>00178          LSB(u16_unicode) = <a class="code" href="a00028.html#952fd54b2e49943d138e44d3bdf569bf" title="This function returns the next byte of file.">file_getc</a>();
<a name="l00179"></a>00179          <span class="keywordflow">if</span> (LSB(u16_unicode) == (<a class="code" href="a00031.html#02e7b232f5280b690d2c1ab5ae4871f9">FS_EOF</a> &amp; 0xFF) &amp;&amp; <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> != <a class="code" href="a00031.html#ca57c3036b23f86097252cfe4bb6b9c8" title="End of file.">FS_ERR_EOF</a>)
<a name="l00180"></a>00180            b_error = TRUE;
<a name="l00181"></a>00181          <span class="keywordflow">break</span>;
<a name="l00182"></a>00182 
<a name="l00183"></a>00183          <span class="keywordflow">case</span> <a class="code" href="a00054.html#64a1135a22b253eb478b4213249b9456">UNI_TYPE_UTF16LE</a>:
<a name="l00184"></a>00184          LSB(u16_unicode) = <a class="code" href="a00028.html#952fd54b2e49943d138e44d3bdf569bf" title="This function returns the next byte of file.">file_getc</a>();
<a name="l00185"></a>00185          MSB(u16_unicode) = <a class="code" href="a00028.html#952fd54b2e49943d138e44d3bdf569bf" title="This function returns the next byte of file.">file_getc</a>();
<a name="l00186"></a>00186          <span class="keywordflow">if</span> (MSB(u16_unicode) == (<a class="code" href="a00031.html#02e7b232f5280b690d2c1ab5ae4871f9">FS_EOF</a> &amp; 0xFF) &amp;&amp; <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> != <a class="code" href="a00031.html#ca57c3036b23f86097252cfe4bb6b9c8" title="End of file.">FS_ERR_EOF</a>)
<a name="l00187"></a>00187            b_error = TRUE;
<a name="l00188"></a>00188          <span class="keywordflow">break</span>;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190          <span class="keywordflow">default</span>: <span class="comment">// ASCII or other</span>
<a name="l00191"></a>00191          u16_unicode = <a class="code" href="a00028.html#952fd54b2e49943d138e44d3bdf569bf" title="This function returns the next byte of file.">file_getc</a>();
<a name="l00192"></a>00192          <span class="keywordflow">if</span> (u16_unicode == <a class="code" href="a00031.html#02e7b232f5280b690d2c1ab5ae4871f9">FS_EOF</a> &amp;&amp; <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> != <a class="code" href="a00031.html#ca57c3036b23f86097252cfe4bb6b9c8" title="End of file.">FS_ERR_EOF</a>)
<a name="l00193"></a>00193            b_error = TRUE;
<a name="l00194"></a>00194          <span class="keywordflow">break</span>;
<a name="l00195"></a>00195       }
<a name="l00196"></a>00196 
<a name="l00197"></a>00197       <span class="comment">// Check character to remove</span>
<a name="l00198"></a>00198       <span class="keywordflow">if</span>( <span class="charliteral">'\r'</span> == u16_unicode )
<a name="l00199"></a>00199          <span class="keywordflow">continue</span>;   <span class="comment">// Ignore character</span>
<a name="l00200"></a>00200       
<a name="l00201"></a>00201       <span class="comment">// Check end of line</span>
<a name="l00202"></a>00202       <span class="keywordflow">if</span>((  0  == u16_unicode )
<a name="l00203"></a>00203       || (<span class="charliteral">'\n'</span> == u16_unicode ) )
<a name="l00204"></a>00204          <span class="keywordflow">break</span>;      <span class="comment">// End of line</span>
<a name="l00205"></a>00205 
<a name="l00206"></a>00206       u16_size_line++;
<a name="l00207"></a>00207       <span class="comment">// Fill string</span>
<a name="l00208"></a>00208       <span class="keywordflow">if</span>( 1 &lt; u16_str_size )
<a name="l00209"></a>00209       {
<a name="l00210"></a>00210          <span class="keywordflow">if</span>( b_unicode )
<a name="l00211"></a>00211          {
<a name="l00212"></a>00212             ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)<span class="keywordtype">string</span>)[0] = u16_unicode;
<a name="l00213"></a>00213          }<span class="keywordflow">else</span>{
<a name="l00214"></a>00214             <span class="keywordtype">string</span>[0] = u16_unicode;
<a name="l00215"></a>00215          }
<a name="l00216"></a>00216          <span class="keywordtype">string</span> += (b_unicode? 2 : 1 );
<a name="l00217"></a>00217          u16_str_size--;
<a name="l00218"></a>00218       }
<a name="l00219"></a>00219    }
<a name="l00220"></a>00220    <span class="comment">// HERE, the line is readed</span>
<a name="l00221"></a>00221    
<a name="l00222"></a>00222    <span class="keywordflow">if</span>( <a class="code" href="a00054.html#601edc3012275aa2753840f0bc83c850">UNI_TYPE_UTF8</a> == <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#1fa472bb197fe1edfa95b67fe66ea089" title="format of text used in selected file (only for reader_txt module)">u8_txt_format</a> )
<a name="l00223"></a>00223    {
<a name="l00224"></a>00224       <span class="comment">// Re position cursor on next UTF8</span>
<a name="l00225"></a>00225       <a class="code" href="a00028.html#2599f935c7e1b69f2650e0943091ddca" title="This function changes the position in the file.">file_seek</a>( (size_utf8_buf-size_utf8_dec) , <a class="code" href="a00029.html#f546c33414158e18f0a25b795f402ccf" title="start at the current position and rewind">FS_SEEK_CUR_RE</a> );
<a name="l00226"></a>00226    }
<a name="l00227"></a>00227 
<a name="l00228"></a>00228    <span class="comment">// Handle error cases</span>
<a name="l00229"></a>00229    <span class="keywordflow">if</span> (b_error)
<a name="l00230"></a>00230    {
<a name="l00231"></a>00231      <a class="code" href="a00047.html#e4c0e8aa28b3bd3fa3122a931c19eab9" title="This function enables the disk check before each actions on disk.">nav_checkdisk_enable</a>();
<a name="l00232"></a>00232      <span class="keywordflow">return</span> 0;
<a name="l00233"></a>00233    }
<a name="l00234"></a>00234 
<a name="l00235"></a>00235    <span class="comment">// Add Null terminate</span>
<a name="l00236"></a>00236    <span class="keywordflow">if</span>( 0 != u16_str_size )
<a name="l00237"></a>00237    {
<a name="l00238"></a>00238       <span class="keywordflow">if</span>( b_unicode )
<a name="l00239"></a>00239       {
<a name="l00240"></a>00240          ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)<span class="keywordtype">string</span>)[0] = 0;
<a name="l00241"></a>00241       }<span class="keywordflow">else</span>{
<a name="l00242"></a>00242          <span class="keywordtype">string</span>[0] = 0;
<a name="l00243"></a>00243       }
<a name="l00244"></a>00244    }
<a name="l00245"></a>00245    <a class="code" href="a00047.html#e4c0e8aa28b3bd3fa3122a931c19eab9" title="This function enables the disk check before each actions on disk.">nav_checkdisk_enable</a>();
<a name="l00246"></a>00246    <span class="keywordflow">return</span> u16_size_line;
<a name="l00247"></a>00247 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="a294dece909ef8dc6c56dd13f1b78aa5"></a><!-- doxytag: member="reader_txt.h::reader_txt_jump_line" ref="a294dece909ef8dc6c56dd13f1b78aa5" args="(U16 nb_line)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool reader_txt_jump_line           </td>
          <td>(</td>
          <td class="paramtype">U16&nbsp;</td>
          <td class="paramname"> <em>nb_line</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function jumps text lines. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>nb_line</em>&nbsp;</td><td>number of lines to jump</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE in case of error </dd></dl>

<p>Definition at line <a class="el" href="a00098.html#l00256">256</a> of file <a class="el" href="a00098.html">reader_txt.c</a>.</p>

<p>References <a class="el" href="a00075.html#l00726">file_eof()</a>, and <a class="el" href="a00098.html#l00142">reader_txt_get_line()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00257"></a>00257 {
<a name="l00258"></a>00258    <span class="keywordflow">while</span>( 0 != nb_line )
<a name="l00259"></a>00259    {
<a name="l00260"></a>00260       <span class="keywordflow">if</span>( 0 != <a class="code" href="a00028.html#bed52ba7230c6eecf100a3709b9ed74e" title="This function checks the end of file.">file_eof</a>() )
<a name="l00261"></a>00261          <span class="keywordflow">return</span> FALSE;
<a name="l00262"></a>00262       <a class="code" href="a00051.html#29030022836887d64ee7b516b93f2d4e" title="This function fills an ASCII buffer with the current text line of opened file.">reader_txt_get_line</a>( FALSE, NULL, 0 );
<a name="l00263"></a>00263       nb_line--;
<a name="l00264"></a>00264    }
<a name="l00265"></a>00265    <span class="keywordflow">return</span> TRUE;
<a name="l00266"></a>00266 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="ef8e9a323aab9e3c839130f47a79453a"></a><!-- doxytag: member="reader_txt.h::reader_txt_new" ref="ef8e9a323aab9e3c839130f47a79453a" args="(const FS_STRING sz_name, U8 u8_txt_format)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool reader_txt_new           </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="a00031.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a>&nbsp;</td>
          <td class="paramname"> <em>sz_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>u8_txt_format</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Create a new text file. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sz_name</em>&nbsp;</td><td>contains the file name (ASCII or UNICODE ) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>u8_txt_format</em>&nbsp;</td><td>text format to use (UNI_TYPE_UTF8, UNI_TYPE_UTF16BE, UNI_TYPE_UTF16LE, UNI_TYPE_ASCII)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE in case of error, see global value "fs_g_status" for more detail <p>
TRUE otherwise </dd></dl>

<p>Definition at line <a class="el" href="a00098.html#l00082">82</a> of file <a class="el" href="a00098.html">reader_txt.c</a>.</p>

<p>References <a class="el" href="a00075.html#l00489">file_write_buf()</a>, <a class="el" href="a00072.html#l00396">fs_g_nav_entry</a>, <a class="el" href="a00094.html#l02156">nav_file_create()</a>, <a class="el" href="a00072.html#l00303">Fs_management_entry::u8_txt_format</a>, <a class="el" href="a00101.html#l00048">UNI_MAX_HEADER_SIZE</a>, and <a class="el" href="a00100.html#l00088">unicode_header_get()</a>.</p>

<p>Referenced by <a class="el" href="a00096.html#l00140">pl_main_new()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00083"></a>00083 {
<a name="l00084"></a>00084    <span class="comment">// Table to store the header of text file</span>
<a name="l00085"></a>00085    U8    string_header[<a class="code" href="a00054.html#fe277837248b15658de12b35d5319c23">UNI_MAX_HEADER_SIZE</a>];
<a name="l00086"></a>00086    U8    u8_header_size;
<a name="l00087"></a>00087 
<a name="l00088"></a>00088    <span class="comment">// Create empty file</span>
<a name="l00089"></a>00089    <span class="keywordflow">if</span> ( !<a class="code" href="a00047.html#27b550ee0cf2326498755b429818b145" title="This function creates a file with NULL size and NULL attribut.">nav_file_create</a>( sz_name ))
<a name="l00090"></a>00090       <span class="keywordflow">return</span> FALSE;
<a name="l00091"></a>00091 
<a name="l00092"></a>00092    <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#1fa472bb197fe1edfa95b67fe66ea089" title="format of text used in selected file (only for reader_txt module)">u8_txt_format</a> = u8_txt_format;
<a name="l00093"></a>00093 
<a name="l00094"></a>00094    <span class="comment">// Write at the beginning of file the text header</span>
<a name="l00095"></a>00095    u8_header_size = <a class="code" href="a00053.html#806fc5bfe128cc4a4e6ccce39b55049a" title="Return the header corresponding at text format identifier.">unicode_header_get</a>( string_header, <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#1fa472bb197fe1edfa95b67fe66ea089" title="format of text used in selected file (only for reader_txt module)">u8_txt_format</a> );
<a name="l00096"></a>00096    <a class="code" href="a00028.html#415ad1a43ac79c02c294a4e32246c519" title="This function transfer a buffer to a file at the current file position.">file_write_buf</a>( string_header , u8_header_size );
<a name="l00097"></a>00097    <span class="keywordflow">return</span> TRUE;
<a name="l00098"></a>00098 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="ee4bf4e140c9a4893547bf41459e57f3"></a><!-- doxytag: member="reader_txt.h::reader_txt_open" ref="ee4bf4e140c9a4893547bf41459e57f3" args="(Bool b_readonly)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool reader_txt_open           </td>
          <td>(</td>
          <td class="paramtype">Bool&nbsp;</td>
          <td class="paramname"> <em>b_readonly</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Open a selected text file in the current navigator. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>b_readonly</em>&nbsp;</td><td>TRUE to open the text file in read only access</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE in case of error, see global value "fs_g_status" for more detail <p>
TRUE otherwise </dd></dl>

<p>Definition at line <a class="el" href="a00098.html#l00065">65</a> of file <a class="el" href="a00098.html">reader_txt.c</a>.</p>

<p>References <a class="el" href="a00075.html#l00092">file_open()</a>, <a class="el" href="a00078.html#l00144">FOPEN_MODE_R</a>, <a class="el" href="a00078.html#l00145">FOPEN_MODE_R_PLUS</a>, and <a class="el" href="a00098.html#l00103">reader_txt_beg()</a>.</p>

<p>Referenced by <a class="el" href="a00096.html#l00163">pl_main_open()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00066"></a>00066 {
<a name="l00067"></a>00067    <span class="keywordflow">if</span>( !<a class="code" href="a00028.html#310a118fba8ffb01c998e5087f32d815" title="This function opens the selected file.">file_open</a>( (b_readonly)? <a class="code" href="a00031.html#438cf836f3fb6b9064a6215b8d1d6b91" title="R access, flux pointer = 0, size not modify.">FOPEN_MODE_R</a> : <a class="code" href="a00031.html#d7905db5e099b8dc19b081a213918f65" title="R/W access, flux pointer = 0, size not modify.">FOPEN_MODE_R_PLUS</a> ) )
<a name="l00068"></a>00068       <span class="keywordflow">return</span> FALSE; <span class="comment">// Open error</span>
<a name="l00069"></a>00069    <a class="code" href="a00051.html#4f6bbd93a0b11365b77518a22b1ae098" title="This function goes at the beginning of file and read the text header.">reader_txt_beg</a>();
<a name="l00070"></a>00070    <span class="keywordflow">return</span> TRUE;
<a name="l00071"></a>00071 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="277e7970bcc003a9e9823b70e259d0b5"></a><!-- doxytag: member="reader_txt.h::reader_txt_select_format" ref="277e7970bcc003a9e9823b70e259d0b5" args="(U8 u8_txt_format)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void reader_txt_select_format           </td>
          <td>(</td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>u8_txt_format</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This function allow to select the text format to decode. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>u8_txt_format</em>&nbsp;</td><td>text format selected (UNI_TYPE_UTF8, UNI_TYPE_UTF16BE, UNI_TYPE_UTF16LE, UNI_TYPE_ASCII) </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="a00098.html#l00123">123</a> of file <a class="el" href="a00098.html">reader_txt.c</a>.</p>

<p>References <a class="el" href="a00072.html#l00396">fs_g_nav_entry</a>, and <a class="el" href="a00072.html#l00303">Fs_management_entry::u8_txt_format</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00124"></a>00124 {
<a name="l00125"></a>00125    <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#1fa472bb197fe1edfa95b67fe66ea089" title="format of text used in selected file (only for reader_txt module)">u8_txt_format</a> = u8_txt_format;
<a name="l00126"></a>00126 }
</pre></div>
<p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Dec 21 18:30:25 2009 for AVR32 - FAT Services by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
