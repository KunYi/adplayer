<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>AVR32 - FAT Services: ctrl_access.h File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>ctrl_access.h File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
Abstraction layer for memory interfaces. 
<p>
This module contains the interfaces:<ul>
<li>MEM &lt;-&gt; USB;</li><li>MEM &lt;-&gt; RAM;</li><li>MEM &lt;-&gt; MEM.</li></ul>
<p>
This module may be configured and expanded to support the following features:<ul>
<li>write-protected globals;</li><li>password-protected data;</li><li>specific features;</li><li>etc.</li></ul>
<p>
<ul>
<li>Compiler: IAR EWAVR32 and GNU GCC for AVR32</li><li>Supported devices: All AVR32 devices can be used.</li><li>AppNote:</li></ul>
<p>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Atmel Corporation: <a href="http://www.atmel.com">http://www.atmel.com</a> <br>
 Support and FAQ: <a href="http://support.atmel.no/">http://support.atmel.no/</a> </dd></dl>

<p>Definition in file <a class="el" href="a00070.html">ctrl_access.h</a>.</p>

<p>
<code>#include &quot;compiler.h&quot;</code><br>
<code>#include &quot;<a class="el" href="a00066.html">conf_access.h</a>&quot;</code><br>
<code>#include &quot;virtual_mem.h&quot;</code><br>
<code>#include &quot;at45dbx_mem.h&quot;</code><br>
<code>#include &quot;sd_mmc_spi_mem.h&quot;</code><br>
<code>#include &lt;LUN_3_INCLUDE&gt;</code><br>
<code>#include &lt;LUN_4_INCLUDE&gt;</code><br>
<code>#include &lt;LUN_5_INCLUDE&gt;</code><br>
<code>#include &lt;LUN_6_INCLUDE&gt;</code><br>
<code>#include &lt;LUN_7_INCLUDE&gt;</code><br>
<code>#include &quot;host_mem.h&quot;</code><br>

<p>
<a href="a00070.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Streaming MEM &lt;-&gt; MEM Interface</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#3d068dfd6cc43279a8f57456a9898754">ID_STREAM_ERR</a>&nbsp;&nbsp;&nbsp;0xFF</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Erroneous streaming data transfer ID.  <a href="#3d068dfd6cc43279a8f57456a9898754"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291">Ctrl_status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#0cd4af35ac08482fa4eca9afdd511345">stream_mem_to_mem</a> (U8 src_lun, U32 src_addr, U8 dest_lun, U32 dest_addr, U16 nb_sector)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Copies data from one memory to another.  <a href="#0cd4af35ac08482fa4eca9afdd511345"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291">Ctrl_status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#bc5895af9a6e16c6e0f90cdce48bdb3a">stream_state</a> (U8 id)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the state of a streaming data transfer.  <a href="#bc5895af9a6e16c6e0f90cdce48bdb3a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">U16&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#21c3bfd3da12736296fe092d97cc7acc">stream_stop</a> (U8 id)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Stops a streaming data transfer.  <a href="#21c3bfd3da12736296fe092d97cc7acc"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td colspan="2"><div class="groupHeader">LUN IDs</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#8478c6bce28f4472fdd027649a00936a">LUN_ID_0</a>&nbsp;&nbsp;&nbsp;(0)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">First static LUN.  <a href="#8478c6bce28f4472fdd027649a00936a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#b72bedb034b51576845800ce42bcda84">LUN_ID_1</a>&nbsp;&nbsp;&nbsp;(LUN_ID_0 + LUN_0)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#af7bf9d1b9d4f06e66adf3312926f3f7">LUN_ID_2</a>&nbsp;&nbsp;&nbsp;(LUN_ID_1 + LUN_1)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#02323cea2ea4516346f76a53c788a2a5">LUN_ID_3</a>&nbsp;&nbsp;&nbsp;(LUN_ID_2 + LUN_2)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#50a96ea24ad9df763bc8a8b37dce203b">LUN_ID_4</a>&nbsp;&nbsp;&nbsp;(LUN_ID_3 + LUN_3)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#6a7ba2468bda4b81503724ed75d174f8">LUN_ID_5</a>&nbsp;&nbsp;&nbsp;(LUN_ID_4 + LUN_4)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#27808eb30579fcdb9ccf05976e3b0b05">LUN_ID_6</a>&nbsp;&nbsp;&nbsp;(LUN_ID_5 + LUN_5)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#8c461fee14d04ce21755a95403ff11dc">LUN_ID_7</a>&nbsp;&nbsp;&nbsp;(LUN_ID_6 + LUN_6)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#53974b414816e4504cc9d35a55e42485">LUN_ID_USB</a>&nbsp;&nbsp;&nbsp;(MAX_LUN)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">First dynamic LUN (USB host mass storage).  <a href="#53974b414816e4504cc9d35a55e42485"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#33dc06d3beb17145bde7011bd90c34fc">MAX_LUN</a>&nbsp;&nbsp;&nbsp;(LUN_ID_7 + LUN_7)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Number of static LUNs.  <a href="#33dc06d3beb17145bde7011bd90c34fc"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291">Ctrl_status</a> { <a class="el" href="a00023.html#910a0fdf1e7a70b08981dce14e86e2918cc674c935507be438bb2d9b6e70d6b8">CTRL_GOOD</a> =  PASS, 
<a class="el" href="a00023.html#910a0fdf1e7a70b08981dce14e86e29187a15d70a7619b7e4aa918f7a0d953ea">CTRL_FAIL</a> =  FAIL, 
<a class="el" href="a00023.html#910a0fdf1e7a70b08981dce14e86e29172ef3612d2c1df6f137934d4b89b18b7">CTRL_NO_PRESENT</a> =  FAIL + 1, 
<a class="el" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291a647d0a662ac6400be3b843dfae52c65">CTRL_BUSY</a> =  FAIL + 2
 }</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Status returned by CTRL_ACCESS interfaces.  <a href="a00023.html#910a0fdf1e7a70b08981dce14e86e291">More...</a><br></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td colspan="2"><div class="groupHeader">Control Interface</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">U8&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#9d5baae83f29b7cdc490ff7b63281bfd">get_cur_lun</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the current LUN.  <a href="#9d5baae83f29b7cdc490ff7b63281bfd"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">U8&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#877a4f5ff11d5d9b96019ee2c2cee5cd">get_nb_lun</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the number of LUNs.  <a href="#877a4f5ff11d5d9b96019ee2c2cee5cd"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#818e7326fb732481be2c9714347a51d7">mem_name</a> (U8 lun)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns a pointer to the LUN name.  <a href="#818e7326fb732481be2c9714347a51d7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291">Ctrl_status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#0bafaa7d437e08a1727e2124db423f18">mem_read_capacity</a> (U8 lun, U32 *u32_nb_sector)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the address of the last valid sector (512 bytes) in the memory.  <a href="#0bafaa7d437e08a1727e2124db423f18"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#b56313733936ea087a9eb2285a913554">mem_removal</a> (U8 lun)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Tells whether the memory is removable.  <a href="#b56313733936ea087a9eb2285a913554"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">U8&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#6f34e66828041ff96e8bc09efa5a4bec">mem_sector_size</a> (U8 lun)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the size of the physical sector.  <a href="#6f34e66828041ff96e8bc09efa5a4bec"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291">Ctrl_status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#51555be425eeacfd88e603b9cba97049">mem_test_unit_ready</a> (U8 lun)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Tests the memory state and initializes the memory if required.  <a href="#51555be425eeacfd88e603b9cba97049"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#f4b64acad5f46d01e082d7a7301078df">mem_wr_protect</a> (U8 lun)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the write-protection state of the memory.  <a href="#f4b64acad5f46d01e082d7a7301078df"></a><br></td></tr>
<tr><td colspan="2"><div class="groupHeader">MEM &lt;-&gt; RAM Interface</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291">Ctrl_status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#dde05eb39b542eb5a7d3f78cf7006f28">memory_2_ram</a> (U8 lun, U32 addr, void *ram)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Copies 1 data sector from the memory to RAM.  <a href="#dde05eb39b542eb5a7d3f78cf7006f28"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291">Ctrl_status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#61739dc73f8bff39c3d291f2e47a5bce">ram_2_memory</a> (U8 lun, U32 addr, const void *ram)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Copies 1 data sector from RAM to the memory.  <a href="#61739dc73f8bff39c3d291f2e47a5bce"></a><br></td></tr>
<tr><td colspan="2"><div class="groupHeader">MEM &lt;-&gt; USB Interface</div></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291">Ctrl_status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#1bc5f6636e0c33423bd45149c8b52aa5">memory_2_usb</a> (U8 lun, U32 addr, U16 nb_sector)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Tranfers data from the memory to USB.  <a href="#1bc5f6636e0c33423bd45149c8b52aa5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291">Ctrl_status</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#009fb70f78b2582820da7d32ecbcb44f">usb_2_memory</a> (U8 lun, U32 addr, U16 nb_sector)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Tranfers data from USB to the memory.  <a href="#009fb70f78b2582820da7d32ecbcb44f"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">Bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00023.html#334166d5cb0ef1b8f7790655dc6da2d0">g_wr_protect</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write protect.  <a href="#334166d5cb0ef1b8f7790655dc6da2d0"></a><br></td></tr>
</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="3d068dfd6cc43279a8f57456a9898754"></a><!-- doxytag: member="ctrl_access.h::ID_STREAM_ERR" ref="3d068dfd6cc43279a8f57456a9898754" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ID_STREAM_ERR&nbsp;&nbsp;&nbsp;0xFF          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Erroneous streaming data transfer ID. 
<p>

<p>Definition at line <a class="el" href="a00070.html#l00325">325</a> of file <a class="el" href="a00070.html">ctrl_access.h</a>.</p>

<p>Referenced by <a class="el" href="a00094.html#l02215">nav_file_paste_start()</a>, and <a class="el" href="a00094.html#l02263">nav_file_paste_state()</a>.</p>

</div>
</div><p>
<a class="anchor" name="8478c6bce28f4472fdd027649a00936a"></a><!-- doxytag: member="ctrl_access.h::LUN_ID_0" ref="8478c6bce28f4472fdd027649a00936a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LUN_ID_0&nbsp;&nbsp;&nbsp;(0)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
First static LUN. 
<p>

<p>Definition at line <a class="el" href="a00070.html#l00108">108</a> of file <a class="el" href="a00070.html">ctrl_access.h</a>.</p>

<p>Referenced by <a class="el" href="a00069.html#l00277">get_cur_lun()</a>.</p>

</div>
</div><p>
<a class="anchor" name="b72bedb034b51576845800ce42bcda84"></a><!-- doxytag: member="ctrl_access.h::LUN_ID_1" ref="b72bedb034b51576845800ce42bcda84" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LUN_ID_1&nbsp;&nbsp;&nbsp;(LUN_ID_0 + LUN_0)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00070.html#l00109">109</a> of file <a class="el" href="a00070.html">ctrl_access.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="af7bf9d1b9d4f06e66adf3312926f3f7"></a><!-- doxytag: member="ctrl_access.h::LUN_ID_2" ref="af7bf9d1b9d4f06e66adf3312926f3f7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LUN_ID_2&nbsp;&nbsp;&nbsp;(LUN_ID_1 + LUN_1)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00070.html#l00110">110</a> of file <a class="el" href="a00070.html">ctrl_access.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="02323cea2ea4516346f76a53c788a2a5"></a><!-- doxytag: member="ctrl_access.h::LUN_ID_3" ref="02323cea2ea4516346f76a53c788a2a5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LUN_ID_3&nbsp;&nbsp;&nbsp;(LUN_ID_2 + LUN_2)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00070.html#l00111">111</a> of file <a class="el" href="a00070.html">ctrl_access.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="50a96ea24ad9df763bc8a8b37dce203b"></a><!-- doxytag: member="ctrl_access.h::LUN_ID_4" ref="50a96ea24ad9df763bc8a8b37dce203b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LUN_ID_4&nbsp;&nbsp;&nbsp;(LUN_ID_3 + LUN_3)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00070.html#l00112">112</a> of file <a class="el" href="a00070.html">ctrl_access.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="6a7ba2468bda4b81503724ed75d174f8"></a><!-- doxytag: member="ctrl_access.h::LUN_ID_5" ref="6a7ba2468bda4b81503724ed75d174f8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LUN_ID_5&nbsp;&nbsp;&nbsp;(LUN_ID_4 + LUN_4)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00070.html#l00113">113</a> of file <a class="el" href="a00070.html">ctrl_access.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="27808eb30579fcdb9ccf05976e3b0b05"></a><!-- doxytag: member="ctrl_access.h::LUN_ID_6" ref="27808eb30579fcdb9ccf05976e3b0b05" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LUN_ID_6&nbsp;&nbsp;&nbsp;(LUN_ID_5 + LUN_5)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00070.html#l00114">114</a> of file <a class="el" href="a00070.html">ctrl_access.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="8c461fee14d04ce21755a95403ff11dc"></a><!-- doxytag: member="ctrl_access.h::LUN_ID_7" ref="8c461fee14d04ce21755a95403ff11dc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LUN_ID_7&nbsp;&nbsp;&nbsp;(LUN_ID_6 + LUN_6)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="a00070.html#l00115">115</a> of file <a class="el" href="a00070.html">ctrl_access.h</a>.</p>

</div>
</div><p>
<a class="anchor" name="53974b414816e4504cc9d35a55e42485"></a><!-- doxytag: member="ctrl_access.h::LUN_ID_USB" ref="53974b414816e4504cc9d35a55e42485" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LUN_ID_USB&nbsp;&nbsp;&nbsp;(MAX_LUN)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
First dynamic LUN (USB host mass storage). 
<p>

<p>Definition at line <a class="el" href="a00070.html#l00117">117</a> of file <a class="el" href="a00070.html">ctrl_access.h</a>.</p>

<p>Referenced by <a class="el" href="a00069.html#l00305">mem_read_capacity()</a>, <a class="el" href="a00069.html#l00327">mem_sector_size()</a>, <a class="el" href="a00069.html#l00283">mem_test_unit_ready()</a>, and <a class="el" href="a00069.html#l00349">mem_wr_protect()</a>.</p>

</div>
</div><p>
<a class="anchor" name="33dc06d3beb17145bde7011bd90c34fc"></a><!-- doxytag: member="ctrl_access.h::MAX_LUN" ref="33dc06d3beb17145bde7011bd90c34fc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_LUN&nbsp;&nbsp;&nbsp;(LUN_ID_7 + LUN_7)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Number of static LUNs. 
<p>

<p>Definition at line <a class="el" href="a00070.html#l00116">116</a> of file <a class="el" href="a00070.html">ctrl_access.h</a>.</p>

<p>Referenced by <a class="el" href="a00069.html#l00259">get_nb_lun()</a>, <a class="el" href="a00069.html#l00393">mem_name()</a>, <a class="el" href="a00069.html#l00305">mem_read_capacity()</a>, <a class="el" href="a00069.html#l00371">mem_removal()</a>, <a class="el" href="a00069.html#l00327">mem_sector_size()</a>, <a class="el" href="a00069.html#l00283">mem_test_unit_ready()</a>, <a class="el" href="a00069.html#l00349">mem_wr_protect()</a>, <a class="el" href="a00069.html#l00469">memory_2_ram()</a>, <a class="el" href="a00069.html#l00417">memory_2_usb()</a>, <a class="el" href="a00069.html#l00493">ram_2_memory()</a>, and <a class="el" href="a00069.html#l00437">usb_2_memory()</a>.</p>

</div>
</div><p>
<hr><h2>Enumeration Type Documentation</h2>
<a class="anchor" name="910a0fdf1e7a70b08981dce14e86e291"></a><!-- doxytag: member="ctrl_access.h::Ctrl_status" ref="910a0fdf1e7a70b08981dce14e86e291" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291">Ctrl_status</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Status returned by CTRL_ACCESS interfaces. 
<p>
<dl compact><dt><b>Enumerator: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" name="910a0fdf1e7a70b08981dce14e86e2918cc674c935507be438bb2d9b6e70d6b8"></a><!-- doxytag: member="CTRL_GOOD" ref="910a0fdf1e7a70b08981dce14e86e2918cc674c935507be438bb2d9b6e70d6b8" args="" -->CTRL_GOOD</em>&nbsp;</td><td>
Success, memory ready. </td></tr>
<tr><td valign="top"><em><a class="anchor" name="910a0fdf1e7a70b08981dce14e86e29187a15d70a7619b7e4aa918f7a0d953ea"></a><!-- doxytag: member="CTRL_FAIL" ref="910a0fdf1e7a70b08981dce14e86e29187a15d70a7619b7e4aa918f7a0d953ea" args="" -->CTRL_FAIL</em>&nbsp;</td><td>
An error occurred. </td></tr>
<tr><td valign="top"><em><a class="anchor" name="910a0fdf1e7a70b08981dce14e86e29172ef3612d2c1df6f137934d4b89b18b7"></a><!-- doxytag: member="CTRL_NO_PRESENT" ref="910a0fdf1e7a70b08981dce14e86e29172ef3612d2c1df6f137934d4b89b18b7" args="" -->CTRL_NO_PRESENT</em>&nbsp;</td><td>
Memory unplugged. </td></tr>
<tr><td valign="top"><em><a class="anchor" name="910a0fdf1e7a70b08981dce14e86e291a647d0a662ac6400be3b843dfae52c65"></a><!-- doxytag: member="CTRL_BUSY" ref="910a0fdf1e7a70b08981dce14e86e291a647d0a662ac6400be3b843dfae52c65" args="" -->CTRL_BUSY</em>&nbsp;</td><td>
Memory not initialized or changed. </td></tr>
</table>
</dl>

<p>Definition at line <a class="el" href="a00070.html#l00065">65</a> of file <a class="el" href="a00070.html">ctrl_access.h</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00066"></a>00066 {
<a name="l00067"></a>00067   <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e2918cc674c935507be438bb2d9b6e70d6b8" title="Success, memory ready.">CTRL_GOOD</a>       = PASS,     
<a name="l00068"></a>00068   <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e29187a15d70a7619b7e4aa918f7a0d953ea" title="An error occurred.">CTRL_FAIL</a>       = FAIL,     
<a name="l00069"></a>00069   <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e29172ef3612d2c1df6f137934d4b89b18b7" title="Memory unplugged.">CTRL_NO_PRESENT</a> = FAIL + 1, 
<a name="l00070"></a>00070   <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291a647d0a662ac6400be3b843dfae52c65" title="Memory not initialized or changed.">CTRL_BUSY</a>       = FAIL + 2  
<a name="l00071"></a>00071 } <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291" title="Status returned by CTRL_ACCESS interfaces.">Ctrl_status</a>;
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="9d5baae83f29b7cdc490ff7b63281bfd"></a><!-- doxytag: member="ctrl_access.h::get_cur_lun" ref="9d5baae83f29b7cdc490ff7b63281bfd" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">U8 get_cur_lun           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns the current LUN. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Current LUN.</dd></dl>
<dl compact><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>Implement. </dd></dl>

<p>Definition at line <a class="el" href="a00069.html#l00277">277</a> of file <a class="el" href="a00069.html">ctrl_access.c</a>.</p>

<p>References <a class="el" href="a00070.html#l00108">LUN_ID_0</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00278"></a>00278 {
<a name="l00279"></a>00279   <span class="keywordflow">return</span> <a class="code" href="a00023.html#8478c6bce28f4472fdd027649a00936a" title="First static LUN.">LUN_ID_0</a>;
<a name="l00280"></a>00280 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="877a4f5ff11d5d9b96019ee2c2cee5cd"></a><!-- doxytag: member="ctrl_access.h::get_nb_lun" ref="877a4f5ff11d5d9b96019ee2c2cee5cd" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">U8 get_nb_lun           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns the number of LUNs. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Number of LUNs in the system. </dd></dl>

<p>Definition at line <a class="el" href="a00069.html#l00259">259</a> of file <a class="el" href="a00069.html">ctrl_access.c</a>.</p>

<p>References <a class="el" href="a00069.html#l00101">Ctrl_access_lock</a>, <a class="el" href="a00069.html#l00105">Ctrl_access_unlock</a>, and <a class="el" href="a00070.html#l00116">MAX_LUN</a>.</p>

<p>Referenced by <a class="el" href="a00094.html#l00311">nav_drive_nb()</a>, and <a class="el" href="a00094.html#l00324">nav_drive_set()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00260"></a>00260 {
<a name="l00261"></a>00261 <span class="preprocessor">#if MEM_USB == ENABLE</span>
<a name="l00262"></a>00262 <span class="preprocessor"></span>  U8 nb_lun;
<a name="l00263"></a>00263 
<a name="l00264"></a>00264   <span class="keywordflow">if</span> (!<a class="code" href="a00022.html#9a7743d577aaea92185af696c56dabd1" title="Locks accesses to LUNs.">Ctrl_access_lock</a>()) <span class="keywordflow">return</span> <a class="code" href="a00023.html#33dc06d3beb17145bde7011bd90c34fc" title="Number of static LUNs.">MAX_LUN</a>;
<a name="l00265"></a>00265 
<a name="l00266"></a>00266   nb_lun = <a class="code" href="a00023.html#33dc06d3beb17145bde7011bd90c34fc" title="Number of static LUNs.">MAX_LUN</a> + host_get_lun();
<a name="l00267"></a>00267 
<a name="l00268"></a>00268   <a class="code" href="a00022.html#1d494d86c31626387c329de7f87bb1e4" title="Unlocks accesses to LUNs.">Ctrl_access_unlock</a>();
<a name="l00269"></a>00269 
<a name="l00270"></a>00270   <span class="keywordflow">return</span> nb_lun;
<a name="l00271"></a>00271 <span class="preprocessor">#else</span>
<a name="l00272"></a>00272 <span class="preprocessor"></span>  <span class="keywordflow">return</span> <a class="code" href="a00023.html#33dc06d3beb17145bde7011bd90c34fc" title="Number of static LUNs.">MAX_LUN</a>;
<a name="l00273"></a>00273 <span class="preprocessor">#endif</span>
<a name="l00274"></a>00274 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="818e7326fb732481be2c9714347a51d7"></a><!-- doxytag: member="ctrl_access.h::mem_name" ref="818e7326fb732481be2c9714347a51d7" args="(U8 lun)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* mem_name           </td>
          <td>(</td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>lun</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns a pointer to the LUN name. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>lun</em>&nbsp;</td><td>Logical Unit Number.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Pointer to the LUN name string. </dd></dl>

<p>Definition at line <a class="el" href="a00069.html#l00393">393</a> of file <a class="el" href="a00069.html">ctrl_access.c</a>.</p>

<p>References <a class="el" href="a00066.html#l00067">LUN_USB</a>, <a class="el" href="a00066.html#l00134">LUN_USB_NAME</a>, and <a class="el" href="a00070.html#l00116">MAX_LUN</a>.</p>

<p>Referenced by <a class="el" href="a00073.html#l00602">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00394"></a>00394 {
<a name="l00395"></a>00395   <span class="keywordflow">return</span>
<a name="l00396"></a>00396 <span class="preprocessor">#if MAX_LUN</span>
<a name="l00397"></a>00397 <span class="preprocessor"></span>         (lun &lt; <a class="code" href="a00023.html#33dc06d3beb17145bde7011bd90c34fc" title="Number of static LUNs.">MAX_LUN</a>) ? lun_desc[lun].name :
<a name="l00398"></a>00398 #endif
<a name="l00399"></a>00399 #<span class="keywordflow">if</span> <a class="code" href="a00019.html#6ca962958d08fc150875fd995e98fa0d" title="Host Mass-Storage Memory.">LUN_USB</a> == ENABLE
<a name="l00400"></a>00400                            <a class="code" href="a00019.html#7609fb44791a2ff0f30304ebce9d3bf9">LUN_USB_NAME</a>;
<a name="l00401"></a>00401 <span class="preprocessor">#else</span>
<a name="l00402"></a>00402 <span class="preprocessor"></span>                           NULL;
<a name="l00403"></a>00403 <span class="preprocessor">#endif</span>
<a name="l00404"></a>00404 <span class="preprocessor"></span>}
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="0bafaa7d437e08a1727e2124db423f18"></a><!-- doxytag: member="ctrl_access.h::mem_read_capacity" ref="0bafaa7d437e08a1727e2124db423f18" args="(U8 lun, U32 *u32_nb_sector)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291">Ctrl_status</a> mem_read_capacity           </td>
          <td>(</td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>lun</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U32 *&nbsp;</td>
          <td class="paramname"> <em>u32_nb_sector</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns the address of the last valid sector (512 bytes) in the memory. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>lun</em>&nbsp;</td><td>Logical Unit Number. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>u32_nb_sector</em>&nbsp;</td><td>Pointer to the address of the last valid sector.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Status. </dd></dl>

<p>Definition at line <a class="el" href="a00069.html#l00305">305</a> of file <a class="el" href="a00069.html">ctrl_access.c</a>.</p>

<p>References <a class="el" href="a00069.html#l00101">Ctrl_access_lock</a>, <a class="el" href="a00069.html#l00105">Ctrl_access_unlock</a>, <a class="el" href="a00070.html#l00068">CTRL_FAIL</a>, <a class="el" href="a00070.html#l00117">LUN_ID_USB</a>, <a class="el" href="a00066.html#l00128">Lun_usb_read_capacity</a>, and <a class="el" href="a00070.html#l00116">MAX_LUN</a>.</p>

<p>Referenced by <a class="el" href="a00074.html#l00341">fat_format()</a>, and <a class="el" href="a00073.html#l00602">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00306"></a>00306 {
<a name="l00307"></a>00307   <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291" title="Status returned by CTRL_ACCESS interfaces.">Ctrl_status</a> status;
<a name="l00308"></a>00308 
<a name="l00309"></a>00309   <span class="keywordflow">if</span> (!<a class="code" href="a00022.html#9a7743d577aaea92185af696c56dabd1" title="Locks accesses to LUNs.">Ctrl_access_lock</a>()) <span class="keywordflow">return</span> <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e29187a15d70a7619b7e4aa918f7a0d953ea" title="An error occurred.">CTRL_FAIL</a>;
<a name="l00310"></a>00310 
<a name="l00311"></a>00311   status =
<a name="l00312"></a>00312 <span class="preprocessor">#if MAX_LUN</span>
<a name="l00313"></a>00313 <span class="preprocessor"></span>           (lun &lt; <a class="code" href="a00023.html#33dc06d3beb17145bde7011bd90c34fc" title="Number of static LUNs.">MAX_LUN</a>) ? lun_desc[lun].read_capacity(u32_nb_sector) :
<a name="l00314"></a>00314 <span class="preprocessor">#endif</span>
<a name="l00315"></a>00315 <span class="preprocessor"></span><span class="preprocessor">#if LUN_USB == ENABLE</span>
<a name="l00316"></a>00316 <span class="preprocessor"></span>                             <a class="code" href="a00019.html#9bfff2d37df47231243a8ae013ae9091">Lun_usb_read_capacity</a>(lun - <a class="code" href="a00023.html#53974b414816e4504cc9d35a55e42485" title="First dynamic LUN (USB host mass storage).">LUN_ID_USB</a>, u32_nb_sector);
<a name="l00317"></a>00317 <span class="preprocessor">#else</span>
<a name="l00318"></a>00318 <span class="preprocessor"></span>                             <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e29187a15d70a7619b7e4aa918f7a0d953ea" title="An error occurred.">CTRL_FAIL</a>;
<a name="l00319"></a>00319 <span class="preprocessor">#endif</span>
<a name="l00320"></a>00320 <span class="preprocessor"></span>
<a name="l00321"></a>00321   <a class="code" href="a00022.html#1d494d86c31626387c329de7f87bb1e4" title="Unlocks accesses to LUNs.">Ctrl_access_unlock</a>();
<a name="l00322"></a>00322 
<a name="l00323"></a>00323   <span class="keywordflow">return</span> status;
<a name="l00324"></a>00324 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="b56313733936ea087a9eb2285a913554"></a><!-- doxytag: member="ctrl_access.h::mem_removal" ref="b56313733936ea087a9eb2285a913554" args="(U8 lun)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool mem_removal           </td>
          <td>(</td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>lun</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Tells whether the memory is removable. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>lun</em>&nbsp;</td><td>Logical Unit Number.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd><code>TRUE</code> if the memory is removable, else <code>FALSE</code>. </dd></dl>

<p>Definition at line <a class="el" href="a00069.html#l00371">371</a> of file <a class="el" href="a00069.html">ctrl_access.c</a>.</p>

<p>References <a class="el" href="a00069.html#l00101">Ctrl_access_lock</a>, <a class="el" href="a00069.html#l00105">Ctrl_access_unlock</a>, <a class="el" href="a00066.html#l00131">Lun_usb_removal</a>, and <a class="el" href="a00070.html#l00116">MAX_LUN</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00372"></a>00372 {
<a name="l00373"></a>00373   Bool removal;
<a name="l00374"></a>00374 
<a name="l00375"></a>00375   <span class="keywordflow">if</span> (!<a class="code" href="a00022.html#9a7743d577aaea92185af696c56dabd1" title="Locks accesses to LUNs.">Ctrl_access_lock</a>()) <span class="keywordflow">return</span> TRUE;
<a name="l00376"></a>00376 
<a name="l00377"></a>00377   removal =
<a name="l00378"></a>00378 <span class="preprocessor">#if MAX_LUN</span>
<a name="l00379"></a>00379 <span class="preprocessor"></span>            (lun &lt; <a class="code" href="a00023.html#33dc06d3beb17145bde7011bd90c34fc" title="Number of static LUNs.">MAX_LUN</a>) ? lun_desc[lun].removal() :
<a name="l00380"></a>00380 <span class="preprocessor">#endif</span>
<a name="l00381"></a>00381 <span class="preprocessor"></span><span class="preprocessor">#if LUN_USB == ENABLE</span>
<a name="l00382"></a>00382 <span class="preprocessor"></span>                              <a class="code" href="a00019.html#aedab3f5af1774aa668d301ad1e2b1f4">Lun_usb_removal</a>();
<a name="l00383"></a>00383 <span class="preprocessor">#else</span>
<a name="l00384"></a>00384 <span class="preprocessor"></span>                              TRUE;
<a name="l00385"></a>00385 <span class="preprocessor">#endif</span>
<a name="l00386"></a>00386 <span class="preprocessor"></span>
<a name="l00387"></a>00387   <a class="code" href="a00022.html#1d494d86c31626387c329de7f87bb1e4" title="Unlocks accesses to LUNs.">Ctrl_access_unlock</a>();
<a name="l00388"></a>00388 
<a name="l00389"></a>00389   <span class="keywordflow">return</span> removal;
<a name="l00390"></a>00390 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="6f34e66828041ff96e8bc09efa5a4bec"></a><!-- doxytag: member="ctrl_access.h::mem_sector_size" ref="6f34e66828041ff96e8bc09efa5a4bec" args="(U8 lun)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">U8 mem_sector_size           </td>
          <td>(</td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>lun</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns the size of the physical sector. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>lun</em>&nbsp;</td><td>Logical Unit Number.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Sector size (unit: 512 bytes). </dd></dl>

<p>Definition at line <a class="el" href="a00069.html#l00327">327</a> of file <a class="el" href="a00069.html">ctrl_access.c</a>.</p>

<p>References <a class="el" href="a00069.html#l00101">Ctrl_access_lock</a>, <a class="el" href="a00069.html#l00105">Ctrl_access_unlock</a>, <a class="el" href="a00070.html#l00117">LUN_ID_USB</a>, <a class="el" href="a00066.html#l00067">LUN_USB</a>, <a class="el" href="a00066.html#l00129">Lun_usb_read_sector_size</a>, and <a class="el" href="a00070.html#l00116">MAX_LUN</a>.</p>

<p>Referenced by <a class="el" href="a00074.html#l00105">fat_mount()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00328"></a>00328 {
<a name="l00329"></a>00329   U8 sector_size;
<a name="l00330"></a>00330 
<a name="l00331"></a>00331   <span class="keywordflow">if</span> (!<a class="code" href="a00022.html#9a7743d577aaea92185af696c56dabd1" title="Locks accesses to LUNs.">Ctrl_access_lock</a>()) <span class="keywordflow">return</span> 0;
<a name="l00332"></a>00332 
<a name="l00333"></a>00333   sector_size =
<a name="l00334"></a>00334 <span class="preprocessor">#if MAX_LUN</span>
<a name="l00335"></a>00335 <span class="preprocessor"></span>                (lun &lt; <a class="code" href="a00023.html#33dc06d3beb17145bde7011bd90c34fc" title="Number of static LUNs.">MAX_LUN</a>) ? 1 :
<a name="l00336"></a>00336 #endif
<a name="l00337"></a>00337 #<span class="keywordflow">if</span> <a class="code" href="a00019.html#6ca962958d08fc150875fd995e98fa0d" title="Host Mass-Storage Memory.">LUN_USB</a> == ENABLE
<a name="l00338"></a>00338                                   <a class="code" href="a00019.html#22e4a0f4bce582bca2f449076a0696d7">Lun_usb_read_sector_size</a>(lun - <a class="code" href="a00023.html#53974b414816e4504cc9d35a55e42485" title="First dynamic LUN (USB host mass storage).">LUN_ID_USB</a>);
<a name="l00339"></a>00339 <span class="preprocessor">#else</span>
<a name="l00340"></a>00340 <span class="preprocessor"></span>                                  0;
<a name="l00341"></a>00341 <span class="preprocessor">#endif</span>
<a name="l00342"></a>00342 <span class="preprocessor"></span>
<a name="l00343"></a>00343   <a class="code" href="a00022.html#1d494d86c31626387c329de7f87bb1e4" title="Unlocks accesses to LUNs.">Ctrl_access_unlock</a>();
<a name="l00344"></a>00344 
<a name="l00345"></a>00345   <span class="keywordflow">return</span> sector_size;
<a name="l00346"></a>00346 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="51555be425eeacfd88e603b9cba97049"></a><!-- doxytag: member="ctrl_access.h::mem_test_unit_ready" ref="51555be425eeacfd88e603b9cba97049" args="(U8 lun)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291">Ctrl_status</a> mem_test_unit_ready           </td>
          <td>(</td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>lun</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Tests the memory state and initializes the memory if required. 
<p>
The TEST UNIT READY SCSI primary command allows an application client to poll a LUN until it is ready without having to allocate memory for returned data.<p>
This command may be used to check the media status of LUNs with removable media.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>lun</em>&nbsp;</td><td>Logical Unit Number.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Status. </dd></dl>

<p>Definition at line <a class="el" href="a00069.html#l00283">283</a> of file <a class="el" href="a00069.html">ctrl_access.c</a>.</p>

<p>References <a class="el" href="a00069.html#l00101">Ctrl_access_lock</a>, <a class="el" href="a00069.html#l00105">Ctrl_access_unlock</a>, <a class="el" href="a00070.html#l00068">CTRL_FAIL</a>, <a class="el" href="a00070.html#l00117">LUN_ID_USB</a>, <a class="el" href="a00066.html#l00127">Lun_usb_test_unit_ready</a>, and <a class="el" href="a00070.html#l00116">MAX_LUN</a>.</p>

<p>Referenced by <a class="el" href="a00071.html#l00091">fat_check_device()</a>, and <a class="el" href="a00073.html#l00602">main()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00284"></a>00284 {
<a name="l00285"></a>00285   <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291" title="Status returned by CTRL_ACCESS interfaces.">Ctrl_status</a> status;
<a name="l00286"></a>00286 
<a name="l00287"></a>00287   <span class="keywordflow">if</span> (!<a class="code" href="a00022.html#9a7743d577aaea92185af696c56dabd1" title="Locks accesses to LUNs.">Ctrl_access_lock</a>()) <span class="keywordflow">return</span> <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e29187a15d70a7619b7e4aa918f7a0d953ea" title="An error occurred.">CTRL_FAIL</a>;
<a name="l00288"></a>00288 
<a name="l00289"></a>00289   status =
<a name="l00290"></a>00290 <span class="preprocessor">#if MAX_LUN</span>
<a name="l00291"></a>00291 <span class="preprocessor"></span>           (lun &lt; <a class="code" href="a00023.html#33dc06d3beb17145bde7011bd90c34fc" title="Number of static LUNs.">MAX_LUN</a>) ? lun_desc[lun].test_unit_ready() :
<a name="l00292"></a>00292 <span class="preprocessor">#endif</span>
<a name="l00293"></a>00293 <span class="preprocessor"></span><span class="preprocessor">#if LUN_USB == ENABLE</span>
<a name="l00294"></a>00294 <span class="preprocessor"></span>                             <a class="code" href="a00019.html#c863497753884129015cfeec0a70bb34">Lun_usb_test_unit_ready</a>(lun - <a class="code" href="a00023.html#53974b414816e4504cc9d35a55e42485" title="First dynamic LUN (USB host mass storage).">LUN_ID_USB</a>);
<a name="l00295"></a>00295 <span class="preprocessor">#else</span>
<a name="l00296"></a>00296 <span class="preprocessor"></span>                             <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e29187a15d70a7619b7e4aa918f7a0d953ea" title="An error occurred.">CTRL_FAIL</a>;
<a name="l00297"></a>00297 <span class="preprocessor">#endif</span>
<a name="l00298"></a>00298 <span class="preprocessor"></span>
<a name="l00299"></a>00299   <a class="code" href="a00022.html#1d494d86c31626387c329de7f87bb1e4" title="Unlocks accesses to LUNs.">Ctrl_access_unlock</a>();
<a name="l00300"></a>00300 
<a name="l00301"></a>00301   <span class="keywordflow">return</span> status;
<a name="l00302"></a>00302 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="f4b64acad5f46d01e082d7a7301078df"></a><!-- doxytag: member="ctrl_access.h::mem_wr_protect" ref="f4b64acad5f46d01e082d7a7301078df" args="(U8 lun)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool mem_wr_protect           </td>
          <td>(</td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>lun</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns the write-protection state of the memory. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>lun</em>&nbsp;</td><td>Logical Unit Number.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd><code>TRUE</code> if the memory is write-protected, else <code>FALSE</code>.</dd></dl>
<dl class="note" compact><dt><b>Note:</b></dt><dd>Only used by removable memories with hardware-specific write protection. </dd></dl>

<p>Definition at line <a class="el" href="a00069.html#l00349">349</a> of file <a class="el" href="a00069.html">ctrl_access.c</a>.</p>

<p>References <a class="el" href="a00069.html#l00101">Ctrl_access_lock</a>, <a class="el" href="a00069.html#l00105">Ctrl_access_unlock</a>, <a class="el" href="a00070.html#l00117">LUN_ID_USB</a>, <a class="el" href="a00066.html#l00130">Lun_usb_wr_protect</a>, and <a class="el" href="a00070.html#l00116">MAX_LUN</a>.</p>

<p>Referenced by <a class="el" href="a00071.html#l01860">fat_cache_flush()</a>, <a class="el" href="a00075.html#l00092">file_open()</a>, and <a class="el" href="a00094.html#l01877">nav_file_isreadonly()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00350"></a>00350 {
<a name="l00351"></a>00351   Bool wr_protect;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353   <span class="keywordflow">if</span> (!<a class="code" href="a00022.html#9a7743d577aaea92185af696c56dabd1" title="Locks accesses to LUNs.">Ctrl_access_lock</a>()) <span class="keywordflow">return</span> TRUE;
<a name="l00354"></a>00354 
<a name="l00355"></a>00355   wr_protect =
<a name="l00356"></a>00356 <span class="preprocessor">#if MAX_LUN</span>
<a name="l00357"></a>00357 <span class="preprocessor"></span>               (lun &lt; <a class="code" href="a00023.html#33dc06d3beb17145bde7011bd90c34fc" title="Number of static LUNs.">MAX_LUN</a>) ? lun_desc[lun].wr_protect() :
<a name="l00358"></a>00358 <span class="preprocessor">#endif</span>
<a name="l00359"></a>00359 <span class="preprocessor"></span><span class="preprocessor">#if LUN_USB == ENABLE</span>
<a name="l00360"></a>00360 <span class="preprocessor"></span>                                 <a class="code" href="a00019.html#d12b0e4ec81404e6332715696ac56135">Lun_usb_wr_protect</a>(lun - <a class="code" href="a00023.html#53974b414816e4504cc9d35a55e42485" title="First dynamic LUN (USB host mass storage).">LUN_ID_USB</a>);
<a name="l00361"></a>00361 <span class="preprocessor">#else</span>
<a name="l00362"></a>00362 <span class="preprocessor"></span>                                 TRUE;
<a name="l00363"></a>00363 <span class="preprocessor">#endif</span>
<a name="l00364"></a>00364 <span class="preprocessor"></span>
<a name="l00365"></a>00365   <a class="code" href="a00022.html#1d494d86c31626387c329de7f87bb1e4" title="Unlocks accesses to LUNs.">Ctrl_access_unlock</a>();
<a name="l00366"></a>00366 
<a name="l00367"></a>00367   <span class="keywordflow">return</span> wr_protect;
<a name="l00368"></a>00368 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="dde05eb39b542eb5a7d3f78cf7006f28"></a><!-- doxytag: member="ctrl_access.h::memory_2_ram" ref="dde05eb39b542eb5a7d3f78cf7006f28" args="(U8 lun, U32 addr, void *ram)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291">Ctrl_status</a> memory_2_ram           </td>
          <td>(</td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>lun</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U32&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>ram</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Copies 1 data sector from the memory to RAM. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>lun</em>&nbsp;</td><td>Logical Unit Number. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>addr</em>&nbsp;</td><td>Address of first memory sector to read. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ram</em>&nbsp;</td><td>Pointer to RAM buffer to write.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Status. </dd></dl>

<p>Definition at line <a class="el" href="a00069.html#l00469">469</a> of file <a class="el" href="a00069.html">ctrl_access.c</a>.</p>

<p>References <a class="el" href="a00069.html#l00101">Ctrl_access_lock</a>, <a class="el" href="a00069.html#l00105">Ctrl_access_unlock</a>, <a class="el" href="a00070.html#l00068">CTRL_FAIL</a>, <a class="el" href="a00066.html#l00132">Lun_usb_mem_2_ram</a>, <a class="el" href="a00070.html#l00116">MAX_LUN</a>, <a class="el" href="a00066.html#l00161">memory_start_read_action</a>, and <a class="el" href="a00066.html#l00162">memory_stop_read_action</a>.</p>

<p>Referenced by <a class="el" href="a00071.html#l01794">fat_cache_read_sector()</a>, <a class="el" href="a00075.html#l00249">file_read_buf()</a>, and <a class="el" href="a00069.html#l00533">stream_mem_to_mem()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00470"></a>00470 {
<a name="l00471"></a>00471   <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291" title="Status returned by CTRL_ACCESS interfaces.">Ctrl_status</a> status;
<a name="l00472"></a>00472 
<a name="l00473"></a>00473   <span class="keywordflow">if</span> (!<a class="code" href="a00022.html#9a7743d577aaea92185af696c56dabd1" title="Locks accesses to LUNs.">Ctrl_access_lock</a>()) <span class="keywordflow">return</span> <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e29187a15d70a7619b7e4aa918f7a0d953ea" title="An error occurred.">CTRL_FAIL</a>;
<a name="l00474"></a>00474 
<a name="l00475"></a>00475   <a class="code" href="a00019.html#f55c16532e1c90a0f8df3cb1f88cc5c1">memory_start_read_action</a>(1);
<a name="l00476"></a>00476   status =
<a name="l00477"></a>00477 <span class="preprocessor">#if MAX_LUN</span>
<a name="l00478"></a>00478 <span class="preprocessor"></span>           (lun &lt; <a class="code" href="a00023.html#33dc06d3beb17145bde7011bd90c34fc" title="Number of static LUNs.">MAX_LUN</a>) ? lun_desc[lun].mem_2_ram(addr, ram) :
<a name="l00479"></a>00479 <span class="preprocessor">#endif</span>
<a name="l00480"></a>00480 <span class="preprocessor"></span><span class="preprocessor">#if LUN_USB == ENABLE</span>
<a name="l00481"></a>00481 <span class="preprocessor"></span>                             <a class="code" href="a00019.html#cb9ed85f664f7ed0e0f1e7e80821cd49">Lun_usb_mem_2_ram</a>(addr, ram);
<a name="l00482"></a>00482 <span class="preprocessor">#else</span>
<a name="l00483"></a>00483 <span class="preprocessor"></span>                             <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e29187a15d70a7619b7e4aa918f7a0d953ea" title="An error occurred.">CTRL_FAIL</a>;
<a name="l00484"></a>00484 <span class="preprocessor">#endif</span>
<a name="l00485"></a>00485 <span class="preprocessor"></span>  <a class="code" href="a00019.html#f25f322d6e60fa59166e8dda50469ef4">memory_stop_read_action</a>();
<a name="l00486"></a>00486 
<a name="l00487"></a>00487   <a class="code" href="a00022.html#1d494d86c31626387c329de7f87bb1e4" title="Unlocks accesses to LUNs.">Ctrl_access_unlock</a>();
<a name="l00488"></a>00488 
<a name="l00489"></a>00489   <span class="keywordflow">return</span> status;
<a name="l00490"></a>00490 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="1bc5f6636e0c33423bd45149c8b52aa5"></a><!-- doxytag: member="ctrl_access.h::memory_2_usb" ref="1bc5f6636e0c33423bd45149c8b52aa5" args="(U8 lun, U32 addr, U16 nb_sector)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291">Ctrl_status</a> memory_2_usb           </td>
          <td>(</td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>lun</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U32&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U16&nbsp;</td>
          <td class="paramname"> <em>nb_sector</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Tranfers data from the memory to USB. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>lun</em>&nbsp;</td><td>Logical Unit Number. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>addr</em>&nbsp;</td><td>Address of first memory sector to read. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nb_sector</em>&nbsp;</td><td>Number of sectors to transfer.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Status. </dd></dl>

<p>Definition at line <a class="el" href="a00069.html#l00417">417</a> of file <a class="el" href="a00069.html">ctrl_access.c</a>.</p>

<p>References <a class="el" href="a00069.html#l00101">Ctrl_access_lock</a>, <a class="el" href="a00069.html#l00105">Ctrl_access_unlock</a>, <a class="el" href="a00070.html#l00068">CTRL_FAIL</a>, <a class="el" href="a00070.html#l00116">MAX_LUN</a>, <a class="el" href="a00066.html#l00161">memory_start_read_action</a>, and <a class="el" href="a00066.html#l00162">memory_stop_read_action</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00418"></a>00418 {
<a name="l00419"></a>00419   <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291" title="Status returned by CTRL_ACCESS interfaces.">Ctrl_status</a> status;
<a name="l00420"></a>00420 
<a name="l00421"></a>00421   <span class="keywordflow">if</span> (!<a class="code" href="a00022.html#9a7743d577aaea92185af696c56dabd1" title="Locks accesses to LUNs.">Ctrl_access_lock</a>()) <span class="keywordflow">return</span> <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e29187a15d70a7619b7e4aa918f7a0d953ea" title="An error occurred.">CTRL_FAIL</a>;
<a name="l00422"></a>00422 
<a name="l00423"></a>00423   <a class="code" href="a00019.html#f55c16532e1c90a0f8df3cb1f88cc5c1">memory_start_read_action</a>(nb_sector);
<a name="l00424"></a>00424   status =
<a name="l00425"></a>00425 <span class="preprocessor">#if MAX_LUN</span>
<a name="l00426"></a>00426 <span class="preprocessor"></span>           (lun &lt; <a class="code" href="a00023.html#33dc06d3beb17145bde7011bd90c34fc" title="Number of static LUNs.">MAX_LUN</a>) ? lun_desc[lun].usb_read_10(addr, nb_sector) :
<a name="l00427"></a>00427 <span class="preprocessor">#endif</span>
<a name="l00428"></a>00428 <span class="preprocessor"></span>                             <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e29187a15d70a7619b7e4aa918f7a0d953ea" title="An error occurred.">CTRL_FAIL</a>;
<a name="l00429"></a>00429   <a class="code" href="a00019.html#f25f322d6e60fa59166e8dda50469ef4">memory_stop_read_action</a>();
<a name="l00430"></a>00430 
<a name="l00431"></a>00431   <a class="code" href="a00022.html#1d494d86c31626387c329de7f87bb1e4" title="Unlocks accesses to LUNs.">Ctrl_access_unlock</a>();
<a name="l00432"></a>00432 
<a name="l00433"></a>00433   <span class="keywordflow">return</span> status;
<a name="l00434"></a>00434 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="61739dc73f8bff39c3d291f2e47a5bce"></a><!-- doxytag: member="ctrl_access.h::ram_2_memory" ref="61739dc73f8bff39c3d291f2e47a5bce" args="(U8 lun, U32 addr, const void *ram)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291">Ctrl_status</a> ram_2_memory           </td>
          <td>(</td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>lun</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U32&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>ram</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Copies 1 data sector from RAM to the memory. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>lun</em>&nbsp;</td><td>Logical Unit Number. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>addr</em>&nbsp;</td><td>Address of first memory sector to write. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ram</em>&nbsp;</td><td>Pointer to RAM buffer to read.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Status. </dd></dl>

<p>Definition at line <a class="el" href="a00069.html#l00493">493</a> of file <a class="el" href="a00069.html">ctrl_access.c</a>.</p>

<p>References <a class="el" href="a00069.html#l00101">Ctrl_access_lock</a>, <a class="el" href="a00069.html#l00105">Ctrl_access_unlock</a>, <a class="el" href="a00070.html#l00068">CTRL_FAIL</a>, <a class="el" href="a00066.html#l00133">Lun_usb_ram_2_mem</a>, <a class="el" href="a00070.html#l00116">MAX_LUN</a>, <a class="el" href="a00066.html#l00163">memory_start_write_action</a>, and <a class="el" href="a00066.html#l00164">memory_stop_write_action</a>.</p>

<p>Referenced by <a class="el" href="a00071.html#l01860">fat_cache_flush()</a>, <a class="el" href="a00075.html#l00489">file_write_buf()</a>, and <a class="el" href="a00069.html#l00533">stream_mem_to_mem()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00494"></a>00494 {
<a name="l00495"></a>00495   <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291" title="Status returned by CTRL_ACCESS interfaces.">Ctrl_status</a> status;
<a name="l00496"></a>00496 
<a name="l00497"></a>00497   <span class="keywordflow">if</span> (!<a class="code" href="a00022.html#9a7743d577aaea92185af696c56dabd1" title="Locks accesses to LUNs.">Ctrl_access_lock</a>()) <span class="keywordflow">return</span> <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e29187a15d70a7619b7e4aa918f7a0d953ea" title="An error occurred.">CTRL_FAIL</a>;
<a name="l00498"></a>00498 
<a name="l00499"></a>00499   <a class="code" href="a00019.html#e6fb476039ed2b321e6db4074ba15013">memory_start_write_action</a>(1);
<a name="l00500"></a>00500   status =
<a name="l00501"></a>00501 <span class="preprocessor">#if MAX_LUN</span>
<a name="l00502"></a>00502 <span class="preprocessor"></span>           (lun &lt; <a class="code" href="a00023.html#33dc06d3beb17145bde7011bd90c34fc" title="Number of static LUNs.">MAX_LUN</a>) ? lun_desc[lun].ram_2_mem(addr, ram) :
<a name="l00503"></a>00503 <span class="preprocessor">#endif</span>
<a name="l00504"></a>00504 <span class="preprocessor"></span><span class="preprocessor">#if LUN_USB == ENABLE</span>
<a name="l00505"></a>00505 <span class="preprocessor"></span>                             <a class="code" href="a00019.html#1291eb02dab4cb8918856035f20f3532">Lun_usb_ram_2_mem</a>(addr, ram);
<a name="l00506"></a>00506 <span class="preprocessor">#else</span>
<a name="l00507"></a>00507 <span class="preprocessor"></span>                             <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e29187a15d70a7619b7e4aa918f7a0d953ea" title="An error occurred.">CTRL_FAIL</a>;
<a name="l00508"></a>00508 <span class="preprocessor">#endif</span>
<a name="l00509"></a>00509 <span class="preprocessor"></span>  <a class="code" href="a00019.html#1499064859ebae139a53fd9045d078cd">memory_stop_write_action</a>();
<a name="l00510"></a>00510 
<a name="l00511"></a>00511   <a class="code" href="a00022.html#1d494d86c31626387c329de7f87bb1e4" title="Unlocks accesses to LUNs.">Ctrl_access_unlock</a>();
<a name="l00512"></a>00512 
<a name="l00513"></a>00513   <span class="keywordflow">return</span> status;
<a name="l00514"></a>00514 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="0cd4af35ac08482fa4eca9afdd511345"></a><!-- doxytag: member="ctrl_access.h::stream_mem_to_mem" ref="0cd4af35ac08482fa4eca9afdd511345" args="(U8 src_lun, U32 src_addr, U8 dest_lun, U32 dest_addr, U16 nb_sector)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291">Ctrl_status</a> stream_mem_to_mem           </td>
          <td>(</td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>src_lun</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U32&nbsp;</td>
          <td class="paramname"> <em>src_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>dest_lun</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U32&nbsp;</td>
          <td class="paramname"> <em>dest_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U16&nbsp;</td>
          <td class="paramname"> <em>nb_sector</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Copies data from one memory to another. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>src_lun</em>&nbsp;</td><td>Source Logical Unit Number. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>src_addr</em>&nbsp;</td><td>Source address of first memory sector to read. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dest_lun</em>&nbsp;</td><td>Destination Logical Unit Number. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dest_addr</em>&nbsp;</td><td>Destination address of first memory sector to write. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nb_sector</em>&nbsp;</td><td>Number of sectors to copy.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Status. </dd></dl>

<p>Definition at line <a class="el" href="a00069.html#l00533">533</a> of file <a class="el" href="a00069.html">ctrl_access.c</a>.</p>

<p>References <a class="el" href="a00070.html#l00067">CTRL_GOOD</a>, <a class="el" href="a00072.html#l00216">FS_512B</a>, <a class="el" href="a00069.html#l00469">memory_2_ram()</a>, and <a class="el" href="a00069.html#l00493">ram_2_memory()</a>.</p>

<p>Referenced by <a class="el" href="a00094.html#l02263">nav_file_paste_state()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00534"></a>00534 {
<a name="l00535"></a>00535 <span class="preprocessor">#if (defined __GNUC__) &amp;&amp; (defined __AVR32__)</span>
<a name="l00536"></a>00536 <span class="preprocessor"></span>  __attribute__((__aligned__(4)))
<a name="l00537"></a>00537 <span class="preprocessor">#elif (defined __ICCAVR32__)</span>
<a name="l00538"></a>00538 <span class="preprocessor"></span><span class="preprocessor">  #pragma data_alignment = 4</span>
<a name="l00539"></a>00539 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00540"></a>00540 <span class="preprocessor"></span>  <span class="keyword">static</span> U8 sector_buf[<a class="code" href="a00025.html#e6e52ba6ed3159395fab025719b91bd0">FS_512B</a>];
<a name="l00541"></a>00541   <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291" title="Status returned by CTRL_ACCESS interfaces.">Ctrl_status</a> status = <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e2918cc674c935507be438bb2d9b6e70d6b8" title="Success, memory ready.">CTRL_GOOD</a>;
<a name="l00542"></a>00542 
<a name="l00543"></a>00543   <span class="keywordflow">while</span> (nb_sector--)
<a name="l00544"></a>00544   {
<a name="l00545"></a>00545     <span class="keywordflow">if</span> ((status = <a class="code" href="a00022.html#dde05eb39b542eb5a7d3f78cf7006f28" title="Copies 1 data sector from the memory to RAM.">memory_2_ram</a>(src_lun, src_addr++, sector_buf)) != <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e2918cc674c935507be438bb2d9b6e70d6b8" title="Success, memory ready.">CTRL_GOOD</a>) <span class="keywordflow">break</span>;
<a name="l00546"></a>00546     <span class="keywordflow">if</span> ((status = <a class="code" href="a00022.html#61739dc73f8bff39c3d291f2e47a5bce" title="Copies 1 data sector from RAM to the memory.">ram_2_memory</a>(dest_lun, dest_addr++, sector_buf)) != <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e2918cc674c935507be438bb2d9b6e70d6b8" title="Success, memory ready.">CTRL_GOOD</a>) <span class="keywordflow">break</span>;
<a name="l00547"></a>00547   }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549   <span class="keywordflow">return</span> status;
<a name="l00550"></a>00550 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="bc5895af9a6e16c6e0f90cdce48bdb3a"></a><!-- doxytag: member="ctrl_access.h::stream_state" ref="bc5895af9a6e16c6e0f90cdce48bdb3a" args="(U8 id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291">Ctrl_status</a> stream_state           </td>
          <td>(</td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>id</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns the state of a streaming data transfer. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>id</em>&nbsp;</td><td>Transfer ID.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Status.</dd></dl>
<dl compact><dt><b><a class="el" href="todo.html#_todo000002">Todo:</a></b></dt><dd>Implement. </dd></dl>

<p>Definition at line <a class="el" href="a00069.html#l00555">555</a> of file <a class="el" href="a00069.html">ctrl_access.c</a>.</p>

<p>References <a class="el" href="a00070.html#l00067">CTRL_GOOD</a>.</p>

<p>Referenced by <a class="el" href="a00094.html#l02263">nav_file_paste_state()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00556"></a>00556 {
<a name="l00557"></a>00557   <span class="keywordflow">return</span> <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e2918cc674c935507be438bb2d9b6e70d6b8" title="Success, memory ready.">CTRL_GOOD</a>;
<a name="l00558"></a>00558 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="21c3bfd3da12736296fe092d97cc7acc"></a><!-- doxytag: member="ctrl_access.h::stream_stop" ref="21c3bfd3da12736296fe092d97cc7acc" args="(U8 id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">U16 stream_stop           </td>
          <td>(</td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>id</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Stops a streaming data transfer. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>id</em>&nbsp;</td><td>Transfer ID.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Number of remaining sectors.</dd></dl>
<dl compact><dt><b><a class="el" href="todo.html#_todo000003">Todo:</a></b></dt><dd>Implement. </dd></dl>

<p>Definition at line <a class="el" href="a00069.html#l00561">561</a> of file <a class="el" href="a00069.html">ctrl_access.c</a>.</p>

<p>Referenced by <a class="el" href="a00094.html#l02263">nav_file_paste_state()</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00562"></a>00562 {
<a name="l00563"></a>00563   <span class="keywordflow">return</span> 0;
<a name="l00564"></a>00564 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="009fb70f78b2582820da7d32ecbcb44f"></a><!-- doxytag: member="ctrl_access.h::usb_2_memory" ref="009fb70f78b2582820da7d32ecbcb44f" args="(U8 lun, U32 addr, U16 nb_sector)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291">Ctrl_status</a> usb_2_memory           </td>
          <td>(</td>
          <td class="paramtype">U8&nbsp;</td>
          <td class="paramname"> <em>lun</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U32&nbsp;</td>
          <td class="paramname"> <em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">U16&nbsp;</td>
          <td class="paramname"> <em>nb_sector</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Tranfers data from USB to the memory. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>lun</em>&nbsp;</td><td>Logical Unit Number. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>addr</em>&nbsp;</td><td>Address of first memory sector to write. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nb_sector</em>&nbsp;</td><td>Number of sectors to transfer.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Status. </dd></dl>

<p>Definition at line <a class="el" href="a00069.html#l00437">437</a> of file <a class="el" href="a00069.html">ctrl_access.c</a>.</p>

<p>References <a class="el" href="a00069.html#l00101">Ctrl_access_lock</a>, <a class="el" href="a00069.html#l00105">Ctrl_access_unlock</a>, <a class="el" href="a00070.html#l00068">CTRL_FAIL</a>, <a class="el" href="a00070.html#l00116">MAX_LUN</a>, <a class="el" href="a00066.html#l00163">memory_start_write_action</a>, and <a class="el" href="a00066.html#l00164">memory_stop_write_action</a>.</p>
<div class="fragment"><pre class="fragment"><a name="l00438"></a>00438 {
<a name="l00439"></a>00439   <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291" title="Status returned by CTRL_ACCESS interfaces.">Ctrl_status</a> status;
<a name="l00440"></a>00440 
<a name="l00441"></a>00441   <span class="keywordflow">if</span> (!<a class="code" href="a00022.html#9a7743d577aaea92185af696c56dabd1" title="Locks accesses to LUNs.">Ctrl_access_lock</a>()) <span class="keywordflow">return</span> <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e29187a15d70a7619b7e4aa918f7a0d953ea" title="An error occurred.">CTRL_FAIL</a>;
<a name="l00442"></a>00442 
<a name="l00443"></a>00443   <a class="code" href="a00019.html#e6fb476039ed2b321e6db4074ba15013">memory_start_write_action</a>(nb_sector);
<a name="l00444"></a>00444   status =
<a name="l00445"></a>00445 <span class="preprocessor">#if MAX_LUN</span>
<a name="l00446"></a>00446 <span class="preprocessor"></span>           (lun &lt; <a class="code" href="a00023.html#33dc06d3beb17145bde7011bd90c34fc" title="Number of static LUNs.">MAX_LUN</a>) ? lun_desc[lun].usb_write_10(addr, nb_sector) :
<a name="l00447"></a>00447 <span class="preprocessor">#endif</span>
<a name="l00448"></a>00448 <span class="preprocessor"></span>                             <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e29187a15d70a7619b7e4aa918f7a0d953ea" title="An error occurred.">CTRL_FAIL</a>;
<a name="l00449"></a>00449   <a class="code" href="a00019.html#1499064859ebae139a53fd9045d078cd">memory_stop_write_action</a>();
<a name="l00450"></a>00450 
<a name="l00451"></a>00451   <a class="code" href="a00022.html#1d494d86c31626387c329de7f87bb1e4" title="Unlocks accesses to LUNs.">Ctrl_access_unlock</a>();
<a name="l00452"></a>00452 
<a name="l00453"></a>00453   <span class="keywordflow">return</span> status;
<a name="l00454"></a>00454 }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="334166d5cb0ef1b8f7790655dc6da2d0"></a><!-- doxytag: member="ctrl_access.h::g_wr_protect" ref="334166d5cb0ef1b8f7790655dc6da2d0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bool <a class="el" href="a00023.html#334166d5cb0ef1b8f7790655dc6da2d0">g_wr_protect</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Write protect. 
<p>

<p>Definition at line <a class="el" href="a00069.html#l00214">214</a> of file <a class="el" href="a00069.html">ctrl_access.c</a>.</p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Dec 21 18:30:20 2009 for AVR32 - FAT Services by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
