<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>AVR32 - FAT Services: navigation.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>navigation.c</h1><a href="a00047.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*This file has been prepared for Doxygen automatic documentation generation.*/</span>
<a name="l00013"></a>00013 <span class="comment">/* Copyright (c) 2009 Atmel Corporation. All rights reserved.</span>
<a name="l00014"></a>00014 <span class="comment"> *</span>
<a name="l00015"></a>00015 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
<a name="l00016"></a>00016 <span class="comment"> * modification, are permitted provided that the following conditions are met:</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * 1. Redistributions of source code must retain the above copyright notice, this</span>
<a name="l00019"></a>00019 <span class="comment"> * list of conditions and the following disclaimer.</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * 2. Redistributions in binary form must reproduce the above copyright notice,</span>
<a name="l00022"></a>00022 <span class="comment"> * this list of conditions and the following disclaimer in the documentation</span>
<a name="l00023"></a>00023 <span class="comment"> * and/or other materials provided with the distribution.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * 3. The name of Atmel may not be used to endorse or promote products derived</span>
<a name="l00026"></a>00026 <span class="comment"> * from this software without specific prior written permission.</span>
<a name="l00027"></a>00027 <span class="comment"> *</span>
<a name="l00028"></a>00028 <span class="comment"> * 4. This software may only be redistributed and used in connection with an Atmel</span>
<a name="l00029"></a>00029 <span class="comment"> * AVR product.</span>
<a name="l00030"></a>00030 <span class="comment"> *</span>
<a name="l00031"></a>00031 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY ATMEL "AS IS" AND ANY EXPRESS OR IMPLIED</span>
<a name="l00032"></a>00032 <span class="comment"> * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF</span>
<a name="l00033"></a>00033 <span class="comment"> * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT ARE</span>
<a name="l00034"></a>00034 <span class="comment"> * EXPRESSLY AND SPECIFICALLY DISCLAIMED. IN NO EVENT SHALL ATMEL BE LIABLE FOR</span>
<a name="l00035"></a>00035 <span class="comment"> * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
<a name="l00036"></a>00036 <span class="comment"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span>
<a name="l00037"></a>00037 <span class="comment"> * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span>
<a name="l00038"></a>00038 <span class="comment"> * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00039"></a>00039 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<a name="l00040"></a>00040 <span class="comment"> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE</span>
<a name="l00041"></a>00041 <span class="comment"> *</span>
<a name="l00042"></a>00042 <span class="comment"> */</span>
<a name="l00043"></a>00043 <span class="comment">//_____  I N C L U D E S ___________________________________________________</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;ctype.h&gt;</span> <span class="comment">// Use of toupper</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="preprocessor">#include "<a class="code" href="a00021.html" title="FAT configuration file.">conf_explorer.h</a>"</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include "<a class="code" href="a00048.html" title="FAT 12/16/32 Services.">navigation.h</a>"</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include "<a class="code" href="a00029.html" title="FAT 12/16/32 Services.">file.h</a>"</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include LIB_CTRLACCESS</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span>
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="comment">//_____ M A C R O S ________________________________________________________</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="comment">//_____ D E F I N I T I O N S ______________________________________________</span>
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="preprocessor">#if (FSFEATURE_WRITE == (FS_LEVEL_FEATURES &amp; FSFEATURE_WRITE))</span>
<a name="l00059"></a><a class="code" href="a00047.html#b4aa634e7d90eb225f80597a0e80125d">00059</a> <span class="preprocessor">   _MEM_TYPE_SLOW_ U8 g_id_trans_memtomem = ID_STREAM_ERR;</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span>
<a name="l00062"></a>00062 <span class="preprocessor">#if (FS_NB_NAVIGATOR &gt; 1)</span>
<a name="l00064"></a><a class="code" href="a00047.html#b84a05017e426fd46d9eb3698642f133">00064</a> <span class="preprocessor">   _MEM_TYPE_SLOW_ U8 fs_g_u8_nav_selected;</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span>
<a name="l00067"></a>00067 <span class="preprocessor">#if (FSFEATURE_WRITE == (FS_LEVEL_FEATURES &amp; FSFEATURE_WRITE))</span>
<a name="l00068"></a><a class="code" href="a00047.html#58faf0ae085fe0224bba93f0adc2e644">00068</a> <span class="preprocessor"></span>   _MEM_TYPE_SLOW_ <a class="code" href="a00007.html">Fs_file_segment</a> <a class="code" href="a00047.html#58faf0ae085fe0224bba93f0adc2e644">g_segment_src</a>;
<a name="l00069"></a><a class="code" href="a00047.html#5622b91c7a68a74d8910567c78d66127">00069</a>    _MEM_TYPE_SLOW_ <a class="code" href="a00007.html">Fs_file_segment</a> <a class="code" href="a00047.html#5622b91c7a68a74d8910567c78d66127">g_segment_dest</a>;
<a name="l00070"></a>00070 <span class="preprocessor">#endif</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span>
<a name="l00072"></a><a class="code" href="a00047.html#15a9bf910f2e50518c3e6b6b376c017f">00072</a> <span class="preprocessor">#define SIZE_OF_SPLIT_COPY    ((1*1024*1024L)/512L)    // 1MB - Unit sector (max = 0xFFFF)</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span>
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="comment">//_____ D E C L A R A T I O N S ____________________________________________</span>
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="comment">//**********************************************************************</span>
<a name="l00078"></a>00078 <span class="comment">//************************ String format select ************************</span>
<a name="l00079"></a>00079 <span class="preprocessor">#if( (FS_ASCII == ENABLED) &amp;&amp; (FS_UNICODE == ENABLED))</span>
<a name="l00087"></a><a class="code" href="a00048.html#69ee3def8525352e53819df1f975dd86">00087</a> <span class="preprocessor">void  nav_string_unicode( void )</span>
<a name="l00088"></a>00088 <span class="preprocessor"></span>{
<a name="l00089"></a>00089    <a class="code" href="a00025.html#fdc963fda511dd9e790c81b6a6b33d34" title="Variables to select string format (initialised in nav_reset()).">g_b_unicode</a> = TRUE;
<a name="l00090"></a>00090 }
<a name="l00098"></a><a class="code" href="a00048.html#7489cf6b312750301cb7df5b915b436a">00098</a> <span class="keywordtype">void</span>  <a class="code" href="a00047.html#7489cf6b312750301cb7df5b915b436a" title="This function selects the ASCII mode for all routines with FS_STRING parameter.">nav_string_ascii</a>( <span class="keywordtype">void</span> )
<a name="l00099"></a>00099 {
<a name="l00100"></a>00100    <a class="code" href="a00025.html#fdc963fda511dd9e790c81b6a6b33d34" title="Variables to select string format (initialised in nav_reset()).">g_b_unicode</a> = FALSE;
<a name="l00101"></a>00101 }
<a name="l00102"></a>00102 <span class="preprocessor">#endif</span>
<a name="l00103"></a>00103 <span class="preprocessor"></span>
<a name="l00111"></a><a class="code" href="a00048.html#3793ff44e6ad17641ecb8903115bd683">00111</a> <span class="keywordtype">void</span>  <a class="code" href="a00047.html#3793ff44e6ad17641ecb8903115bd683" title="This function selects the LENGTH string mode for all routines with FS_STRING parameter...">nav_string_length_enable</a>( <span class="keywordtype">void</span> )
<a name="l00112"></a>00112 {
<a name="l00113"></a>00113    <a class="code" href="a00025.html#6d450fc3016f0d8a7f5674d9e3a05c83" title="Variables to select LENGTH string mode (initialised in nav_reset()).">g_b_string_length</a> = TRUE;
<a name="l00114"></a>00114 }
<a name="l00122"></a><a class="code" href="a00048.html#1f44afef13599e2e881e601e36f66d18">00122</a> <span class="keywordtype">void</span>  <a class="code" href="a00047.html#1f44afef13599e2e881e601e36f66d18" title="This function deselects the LENGTH string mode for all routines with FS_STRING parameter...">nav_string_length_disable</a>( <span class="keywordtype">void</span> )
<a name="l00123"></a>00123 {
<a name="l00124"></a>00124    <a class="code" href="a00025.html#6d450fc3016f0d8a7f5674d9e3a05c83" title="Variables to select LENGTH string mode (initialised in nav_reset()).">g_b_string_length</a> = FALSE;
<a name="l00125"></a>00125 }
<a name="l00126"></a>00126 
<a name="l00127"></a>00127 <span class="comment">//**********************************************************************</span>
<a name="l00128"></a>00128 <span class="comment">//********************** To optimize speed access **********************</span>
<a name="l00129"></a>00129 
<a name="l00137"></a><a class="code" href="a00048.html#c7a2bc65b27a1d7a449d18b07fde6629">00137</a> <span class="keywordtype">void</span>  <a class="code" href="a00047.html#c7a2bc65b27a1d7a449d18b07fde6629" title="This function disables the disk check before each actions on disk.">nav_checkdisk_disable</a>( <span class="keywordtype">void</span> )
<a name="l00138"></a>00138 {
<a name="l00139"></a>00139    <a class="code" href="a00025.html#6e59f1ec12b7954a956be7185df3ec05" title="Variables to enable/disable the disk check before each action on disk.">g_b_no_check_disk</a> = TRUE;
<a name="l00140"></a>00140 }
<a name="l00141"></a>00141 
<a name="l00149"></a><a class="code" href="a00048.html#e4c0e8aa28b3bd3fa3122a931c19eab9">00149</a> <span class="keywordtype">void</span>  <a class="code" href="a00047.html#e4c0e8aa28b3bd3fa3122a931c19eab9" title="This function enables the disk check before each actions on disk.">nav_checkdisk_enable</a>( <span class="keywordtype">void</span> )
<a name="l00150"></a>00150 {
<a name="l00151"></a>00151    <a class="code" href="a00025.html#6e59f1ec12b7954a956be7185df3ec05" title="Variables to enable/disable the disk check before each action on disk.">g_b_no_check_disk</a> = FALSE;
<a name="l00152"></a>00152 }
<a name="l00153"></a>00153 
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 <span class="comment">//**********************************************************************</span>
<a name="l00156"></a>00156 <span class="comment">//************** Initialise or Stop navigation module ******************</span>
<a name="l00157"></a>00157 
<a name="l00158"></a>00158 
<a name="l00165"></a><a class="code" href="a00048.html#605dfecfa334f8ced2cebfa5162a931b">00165</a> <span class="keywordtype">void</span>  <a class="code" href="a00047.html#605dfecfa334f8ced2cebfa5162a931b" title="This function resets ALL navigations to init file system core.">nav_reset</a>( <span class="keywordtype">void</span> )
<a name="l00166"></a>00166 {
<a name="l00167"></a>00167 <span class="preprocessor">#if ( (FS_ASCII   == ENABLED) &amp;&amp; (FS_UNICODE == ENABLED))</span>
<a name="l00168"></a>00168 <span class="preprocessor"></span>   <a class="code" href="a00025.html#fdc963fda511dd9e790c81b6a6b33d34" title="Variables to select string format (initialised in nav_reset()).">g_b_unicode</a> = TRUE;
<a name="l00169"></a>00169 <span class="preprocessor">#endif</span>
<a name="l00170"></a>00170 <span class="preprocessor"></span>   <a class="code" href="a00025.html#6d450fc3016f0d8a7f5674d9e3a05c83" title="Variables to select LENGTH string mode (initialised in nav_reset()).">g_b_string_length</a> = FALSE;
<a name="l00171"></a>00171    <a class="code" href="a00025.html#6e59f1ec12b7954a956be7185df3ec05" title="Variables to enable/disable the disk check before each action on disk.">g_b_no_check_disk</a> = FALSE;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173    <a class="code" href="a00024.html#961692919a93b6cb714ec2a3d57c0141" title="This function resets the sector cache.">fat_cache_reset</a>();
<a name="l00174"></a>00174    <a class="code" href="a00024.html#ecb0d4c200bed41b8bdcf671aa931a2a" title="This function resets the cluster list caches.">fat_cache_clusterlist_reset</a>();
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 <span class="preprocessor">#if (FS_NB_NAVIGATOR &gt; 1)</span>
<a name="l00177"></a>00177 <span class="preprocessor"></span>   {
<a name="l00178"></a>00178    U8 i;
<a name="l00179"></a>00179    <span class="comment">// Reset variables of each navigators</span>
<a name="l00180"></a>00180    <span class="keywordflow">for</span>( i=0 ; i!=<a class="code" href="a00021.html#8ab6bd77e49639be7dc419bcf66bd73f" title="Maximal number of simultaneous navigators.">FS_NB_NAVIGATOR</a> ; i++ )
<a name="l00181"></a>00181    {
<a name="l00182"></a>00182       <a class="code" href="a00047.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>(i);
<a name="l00183"></a>00183       <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#74121fb3c8d3a1d018c911650e2ec920" title="FAT type (default = no mounted = FS_TYPE_FAT_UNM).">u8_type_fat</a> = <a class="code" href="a00025.html#429fbd0498704c3d5864877548040069" title="Partition not mounted.">FS_TYPE_FAT_UNM</a>; <span class="comment">// By default the fat isn't mounted</span>
<a name="l00184"></a>00184       <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a> = 0xFF;                      <span class="comment">// By default don't select a drive</span>
<a name="l00185"></a>00185 <span class="preprocessor">#if (FS_MULTI_PARTITION  ==  ENABLED)</span>
<a name="l00186"></a>00186 <span class="preprocessor"></span>      <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#af482bc02a186c363c37c93e169fbbd4" title="Number of partition - 1 (0 or 1).">u8_partition</a>=0;                     <span class="comment">// By default select the first partition</span>
<a name="l00187"></a>00187 <span class="preprocessor">#endif</span>
<a name="l00188"></a>00188 <span class="preprocessor"></span>      <a class="code" href="a00025.html#55c673ca91c5301834a588e1d5a6515f">Fat_file_close</a>();                            <span class="comment">// By default no file is opened</span>
<a name="l00189"></a>00189       <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#a77329e481dd65221af40a8c26b6541b" title="Navigation File List provide only files or directories.">b_mode_nav_single</a> = FALSE;          <span class="comment">// By default display files and directories</span>
<a name="l00190"></a>00190    }
<a name="l00191"></a>00191    <span class="comment">// By default select the navigator 0</span>
<a name="l00192"></a>00192    <a class="code" href="a00047.html#b84a05017e426fd46d9eb3698642f133" title="Holds the current navigator selected.">fs_g_u8_nav_selected</a> = 0;
<a name="l00193"></a>00193    }
<a name="l00194"></a>00194 <span class="preprocessor">#else</span>
<a name="l00195"></a>00195 <span class="preprocessor"></span>   <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#74121fb3c8d3a1d018c911650e2ec920" title="FAT type (default = no mounted = FS_TYPE_FAT_UNM).">u8_type_fat</a> = <a class="code" href="a00025.html#429fbd0498704c3d5864877548040069" title="Partition not mounted.">FS_TYPE_FAT_UNM</a>;    <span class="comment">// By default the fat isn't mounted</span>
<a name="l00196"></a>00196    <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a> = 0xFF;                         <span class="comment">// By default don't select a drive</span>
<a name="l00197"></a>00197 <span class="preprocessor">#  if (FS_MULTI_PARTITION  ==  ENABLED)</span>
<a name="l00198"></a>00198 <span class="preprocessor"></span>   <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#af482bc02a186c363c37c93e169fbbd4" title="Number of partition - 1 (0 or 1).">u8_partition</a>=0;                        <span class="comment">// By default select the first partition</span>
<a name="l00199"></a>00199 <span class="preprocessor">#  endif</span>
<a name="l00200"></a>00200 <span class="preprocessor"></span>   <a class="code" href="a00025.html#55c673ca91c5301834a588e1d5a6515f">Fat_file_close</a>();                               <span class="comment">// By default no file is opened</span>
<a name="l00201"></a>00201 <span class="preprocessor">#endif // (FS_NB_NAVIGATOR &gt; 1)</span>
<a name="l00202"></a>00202 <span class="preprocessor"></span>}
<a name="l00203"></a>00203 
<a name="l00204"></a>00204 
<a name="l00211"></a><a class="code" href="a00048.html#04e1205f052d0d3c9a123d47eaf034f5">00211</a> <span class="keywordtype">void</span>  <a class="code" href="a00047.html#04e1205f052d0d3c9a123d47eaf034f5" title="This function flush ALL navigations before exit of file system core.">nav_exit</a>( <span class="keywordtype">void</span> )
<a name="l00212"></a>00212 {
<a name="l00213"></a>00213    <span class="comment">// If you have opened files then close them</span>
<a name="l00214"></a>00214 <span class="preprocessor">#if (FS_NB_NAVIGATOR &gt; 1)</span>
<a name="l00215"></a>00215 <span class="preprocessor"></span>   U8 u8_i;
<a name="l00216"></a>00216    <span class="keywordflow">for</span>( u8_i=0; u8_i&lt;<a class="code" href="a00021.html#8ab6bd77e49639be7dc419bcf66bd73f" title="Maximal number of simultaneous navigators.">FS_NB_NAVIGATOR</a>; u8_i++)
<a name="l00217"></a>00217    {
<a name="l00218"></a>00218       <a class="code" href="a00047.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>(u8_i);
<a name="l00219"></a>00219       <a class="code" href="a00028.html#7f4f3b65455595cb5be0f7cd7d12e02d" title="This function closes the file.">file_close</a>();
<a name="l00220"></a>00220    }
<a name="l00221"></a>00221 <span class="preprocessor">#else</span>
<a name="l00222"></a>00222 <span class="preprocessor"></span>   <a class="code" href="a00047.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>(0);
<a name="l00223"></a>00223    <a class="code" href="a00028.html#7f4f3b65455595cb5be0f7cd7d12e02d" title="This function closes the file.">file_close</a>();
<a name="l00224"></a>00224 <span class="preprocessor">#endif</span>
<a name="l00225"></a>00225 <span class="preprocessor"></span>   <span class="comment">// Flush data eventually present in FAT cache</span>
<a name="l00226"></a>00226    <a class="code" href="a00024.html#578ab4800128cde17c0820a5027c1c06" title="This function flushs the sector cache on the memory if necessary.">fat_cache_flush</a>();
<a name="l00227"></a>00227 }
<a name="l00228"></a>00228 
<a name="l00229"></a>00229 
<a name="l00237"></a><a class="code" href="a00048.html#7fac26539a62daf547b5eb159f6a43d4">00237</a> Bool  <a class="code" href="a00047.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( U8 u8_idnav )
<a name="l00238"></a>00238 {
<a name="l00239"></a>00239    <span class="keywordflow">if</span>( <a class="code" href="a00021.html#8ab6bd77e49639be7dc419bcf66bd73f" title="Maximal number of simultaneous navigators.">FS_NB_NAVIGATOR</a> &lt;= u8_idnav )
<a name="l00240"></a>00240    {
<a name="l00241"></a>00241       <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00031.html#6557aec2700008a7501b91d368116ae2" title="The navigator identifier doesn&amp;#39;t existed.">FS_ERR_BAD_NAV</a>;             <span class="comment">// The navigator doesn't exist</span>
<a name="l00242"></a>00242       <span class="keywordflow">return</span> FALSE;
<a name="l00243"></a>00243    }
<a name="l00244"></a>00244 <span class="preprocessor">#if (FS_NB_NAVIGATOR &gt; 1)</span>
<a name="l00245"></a>00245 <span class="preprocessor"></span>   <span class="keywordflow">if</span>( <a class="code" href="a00047.html#b84a05017e426fd46d9eb3698642f133" title="Holds the current navigator selected.">fs_g_u8_nav_selected</a> != u8_idnav )
<a name="l00246"></a>00246    {
<a name="l00247"></a>00247       <a class="code" href="a00024.html#65cfc6e07b1a1bc3a12d564148daca37" title="This function inverts the current navigation with another.">fat_invert_nav</a>( <a class="code" href="a00047.html#b84a05017e426fd46d9eb3698642f133" title="Holds the current navigator selected.">fs_g_u8_nav_selected</a> );   <span class="comment">// Deselect previous navigator = Select default navigator</span>
<a name="l00248"></a>00248       <a class="code" href="a00024.html#65cfc6e07b1a1bc3a12d564148daca37" title="This function inverts the current navigation with another.">fat_invert_nav</a>( u8_idnav );               <span class="comment">// Select new navigator</span>
<a name="l00249"></a>00249       <a class="code" href="a00047.html#b84a05017e426fd46d9eb3698642f133" title="Holds the current navigator selected.">fs_g_u8_nav_selected</a> = u8_idnav;
<a name="l00250"></a>00250    }
<a name="l00251"></a>00251 <span class="preprocessor">#endif</span>
<a name="l00252"></a>00252 <span class="preprocessor"></span>   <span class="keywordflow">return</span> TRUE;
<a name="l00253"></a>00253 }
<a name="l00254"></a>00254 
<a name="l00255"></a>00255 
<a name="l00260"></a><a class="code" href="a00048.html#4a9efd8a5ff4c599be7994c009f0fb5f">00260</a> U8    <a class="code" href="a00047.html#4a9efd8a5ff4c599be7994c009f0fb5f" title="This function returns the navigation identifier used.">nav_get</a>( <span class="keywordtype">void</span> )
<a name="l00261"></a>00261 {
<a name="l00262"></a>00262 <span class="preprocessor">#if (FS_NB_NAVIGATOR &gt; 1)</span>
<a name="l00263"></a>00263 <span class="preprocessor"></span>   <span class="keywordflow">return</span> <a class="code" href="a00047.html#b84a05017e426fd46d9eb3698642f133" title="Holds the current navigator selected.">fs_g_u8_nav_selected</a>;
<a name="l00264"></a>00264 <span class="preprocessor">#else</span>
<a name="l00265"></a>00265 <span class="preprocessor"></span>   <span class="keywordflow">return</span> 0;
<a name="l00266"></a>00266 <span class="preprocessor">#endif</span>
<a name="l00267"></a>00267 <span class="preprocessor"></span>}
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 
<a name="l00281"></a><a class="code" href="a00048.html#3b58f8c4afeb6714cd2c7eb61058da0d">00281</a> Bool  <a class="code" href="a00047.html#3b58f8c4afeb6714cd2c7eb61058da0d" title="This function copys the navigator information to another navigator.">nav_copy</a>( U8 u8_idnav )
<a name="l00282"></a>00282 {
<a name="l00283"></a>00283 <span class="preprocessor">#if (FS_NB_NAVIGATOR &gt; 1)</span>
<a name="l00284"></a>00284 <span class="preprocessor"></span>   <span class="keywordflow">if</span>( <a class="code" href="a00047.html#b84a05017e426fd46d9eb3698642f133" title="Holds the current navigator selected.">fs_g_u8_nav_selected</a> == u8_idnav )
<a name="l00285"></a>00285       <span class="keywordflow">return</span> FALSE;                    <span class="comment">// It is the source and destination is the same navigator</span>
<a name="l00286"></a>00286    <span class="keywordflow">if</span>( 0 == u8_idnav )
<a name="l00287"></a>00287       u8_idnav = <a class="code" href="a00047.html#b84a05017e426fd46d9eb3698642f133" title="Holds the current navigator selected.">fs_g_u8_nav_selected</a>; <span class="comment">// the default navigator is invert with the current navigator</span>
<a name="l00288"></a>00288    <span class="keywordflow">if</span>( 0 == u8_idnav)
<a name="l00289"></a>00289       <span class="keywordflow">return</span> FALSE;                    <span class="comment">// It is the source and destination is the same navigator</span>
<a name="l00290"></a>00290    <a class="code" href="a00024.html#1d133b71ef98fe5945a358bf46680504" title="This function copys the main navigator to another navigator.">fat_copy_nav</a>( u8_idnav );
<a name="l00291"></a>00291    <span class="keywordflow">return</span> TRUE;
<a name="l00292"></a>00292 <span class="preprocessor">#else</span>
<a name="l00293"></a>00293 <span class="preprocessor"></span>   u8_idnav++;
<a name="l00294"></a>00294    <span class="keywordflow">return</span> FALSE;                       <span class="comment">// Copy impossible because only one navigator is available</span>
<a name="l00295"></a>00295 <span class="preprocessor">#endif</span>
<a name="l00296"></a>00296 <span class="preprocessor"></span>}
<a name="l00297"></a>00297 
<a name="l00298"></a>00298 
<a name="l00299"></a>00299 <span class="comment">//**********************************************************************</span>
<a name="l00300"></a>00300 <span class="comment">//********************* Drive navigation functions *********************</span>
<a name="l00301"></a>00301 
<a name="l00302"></a>00302 
<a name="l00311"></a><a class="code" href="a00048.html#976f31ef59e11ac491ffaae703fa4578">00311</a> U8    <a class="code" href="a00047.html#976f31ef59e11ac491ffaae703fa4578" title="This function returns the number of devices availabled.">nav_drive_nb</a>( <span class="keywordtype">void</span> )
<a name="l00312"></a>00312 {
<a name="l00313"></a>00313    <span class="keywordflow">return</span> <a class="code" href="a00022.html#877a4f5ff11d5d9b96019ee2c2cee5cd" title="Returns the number of LUNs.">get_nb_lun</a>(); <span class="comment">// Number of devices = Number of lun</span>
<a name="l00314"></a>00314 }
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 
<a name="l00324"></a><a class="code" href="a00048.html#dd247ba4e5086c74c6f106a55617872a">00324</a> Bool  <a class="code" href="a00047.html#dd247ba4e5086c74c6f106a55617872a" title="This function selects a drive in navigator but don&amp;#39;t mount the disk partition...">nav_drive_set</a>( U8 u8_number )
<a name="l00325"></a>00325 {
<a name="l00326"></a>00326    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#f6f4a9e2d8e7b6dd557871b6bc2c2ee0" title="This function checks if a file is not opened on current navigator.">fat_check_noopen</a>() )
<a name="l00327"></a>00327       <span class="keywordflow">return</span> FALSE;
<a name="l00328"></a>00328 
<a name="l00329"></a>00329    <span class="keywordflow">if</span> (u8_number &gt;= <a class="code" href="a00022.html#877a4f5ff11d5d9b96019ee2c2cee5cd" title="Returns the number of LUNs.">get_nb_lun</a>() )
<a name="l00330"></a>00330    {
<a name="l00331"></a>00331       <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00031.html#d701fa192fb2b5692bf1de16bd43254c" title="There are not other driver.">FS_ERR_END_OF_DRIVE</a>;   <span class="comment">// The drive number is bad</span>
<a name="l00332"></a>00332       <span class="keywordflow">return</span> FALSE;
<a name="l00333"></a>00333    }
<a name="l00334"></a>00334 
<a name="l00335"></a>00335    <span class="keywordflow">if</span> ( <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a> == u8_number)
<a name="l00336"></a>00336       <span class="keywordflow">return</span> TRUE;   <span class="comment">// It is the same drive number</span>
<a name="l00337"></a>00337 
<a name="l00338"></a>00338    <span class="comment">// Go to the device</span>
<a name="l00339"></a>00339    <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a> = u8_number;
<a name="l00340"></a>00340    <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#74121fb3c8d3a1d018c911650e2ec920" title="FAT type (default = no mounted = FS_TYPE_FAT_UNM).">u8_type_fat</a> = <a class="code" href="a00025.html#429fbd0498704c3d5864877548040069" title="Partition not mounted.">FS_TYPE_FAT_UNM</a>;
<a name="l00341"></a>00341 <span class="preprocessor">#if (FS_MULTI_PARTITION  ==  ENABLED)</span>
<a name="l00342"></a>00342 <span class="preprocessor"></span>   <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#af482bc02a186c363c37c93e169fbbd4" title="Number of partition - 1 (0 or 1).">u8_partition</a>=0;   <span class="comment">// by default select the first partition</span>
<a name="l00343"></a>00343 <span class="preprocessor">#endif</span>
<a name="l00344"></a>00344 <span class="preprocessor"></span>   <span class="keywordflow">return</span> TRUE;
<a name="l00345"></a>00345 }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347 
<a name="l00353"></a><a class="code" href="a00048.html#f6d804b75a8fc489e0e8051e585edef5">00353</a> U8    <a class="code" href="a00047.html#f6d804b75a8fc489e0e8051e585edef5" title="This function returns the selected drive number.">nav_drive_get</a>( <span class="keywordtype">void</span> )
<a name="l00354"></a>00354 {
<a name="l00355"></a>00355 <span class="preprocessor">#if (FS_MULTI_PARTITION  ==  ENABLED)</span>
<a name="l00356"></a>00356 <span class="preprocessor"></span>   <span class="keywordflow">if</span>(0xFF == <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a>)
<a name="l00357"></a>00357       <span class="keywordflow">return</span> 0xFF;
<a name="l00358"></a>00358    <span class="keywordflow">return</span> ((<a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a>*4) + <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#af482bc02a186c363c37c93e169fbbd4" title="Number of partition - 1 (0 or 1).">u8_partition</a>); <span class="comment">// Maximum 4 partitions per device</span>
<a name="l00359"></a>00359 <span class="preprocessor">#else</span>
<a name="l00360"></a>00360 <span class="preprocessor"></span>   <span class="keywordflow">return</span> (<a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a>);
<a name="l00361"></a>00361 <span class="preprocessor">#endif</span>
<a name="l00362"></a>00362 <span class="preprocessor"></span>}
<a name="l00363"></a>00363 
<a name="l00364"></a>00364 
<a name="l00370"></a><a class="code" href="a00048.html#cf3be5c3ce9b724a135162437642e091">00370</a> U8    <a class="code" href="a00047.html#cf3be5c3ce9b724a135162437642e091" title="This function returns the selected drive letter.">nav_drive_getname</a>( <span class="keywordtype">void</span> )
<a name="l00371"></a>00371 {
<a name="l00372"></a>00372    <span class="keywordflow">if</span>(0xFF == <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a>)
<a name="l00373"></a>00373       <span class="keywordflow">return</span> <span class="charliteral">'X'</span>;
<a name="l00374"></a>00374 <span class="preprocessor">#if (FS_MULTI_PARTITION  ==  ENABLED)</span>
<a name="l00375"></a>00375 <span class="preprocessor"></span>   <span class="keywordflow">return</span> (<span class="charliteral">'A'</span> + (<a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a>*4) + <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#af482bc02a186c363c37c93e169fbbd4" title="Number of partition - 1 (0 or 1).">u8_partition</a>); <span class="comment">// Maximum 4 partitions per device</span>
<a name="l00376"></a>00376 <span class="preprocessor">#else</span>
<a name="l00377"></a>00377 <span class="preprocessor"></span>   <span class="keywordflow">return</span> (<span class="charliteral">'A'</span> + <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a>);
<a name="l00378"></a>00378 <span class="preprocessor">#endif</span>
<a name="l00379"></a>00379 <span class="preprocessor"></span>}
<a name="l00380"></a>00380 
<a name="l00381"></a>00381 
<a name="l00382"></a>00382 <span class="preprocessor">#if (FSFEATURE_WRITE_COMPLET == (FS_LEVEL_FEATURES &amp; FSFEATURE_WRITE_COMPLET))</span>
<a name="l00399"></a><a class="code" href="a00048.html#c5cf99297c9a8a75ffdd28b33a07e958">00399</a> <span class="preprocessor">Bool  nav_drive_format( U8 u8_fat_type )</span>
<a name="l00400"></a>00400 <span class="preprocessor"></span>{
<a name="l00401"></a>00401    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#f6f4a9e2d8e7b6dd557871b6bc2c2ee0" title="This function checks if a file is not opened on current navigator.">fat_check_noopen</a>() )
<a name="l00402"></a>00402       <span class="keywordflow">return</span> FALSE;
<a name="l00403"></a>00403    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#3ebe58d94472a1818a38afaf09c19c35" title="This function checks write access.">fat_check_nav_access_disk</a>() )
<a name="l00404"></a>00404       <span class="keywordflow">return</span> FALSE;
<a name="l00405"></a>00405    <span class="keywordflow">if</span> ( !<a class="code" href="a00025.html#6099b0e8fafcc01b8c1769c94c827325" title="This function formats the drive.">fat_format</a>( u8_fat_type ) )
<a name="l00406"></a>00406       <span class="keywordflow">return</span> FALSE;
<a name="l00407"></a>00407    <span class="keywordflow">return</span> <a class="code" href="a00025.html#c0108ea608b547e8d3a405c70644c1e9" title="This function mounts a partition.">fat_mount</a>();
<a name="l00408"></a>00408 }
<a name="l00409"></a>00409 <span class="preprocessor">#endif  // FS_LEVEL_FEATURES</span>
<a name="l00410"></a>00410 <span class="preprocessor"></span>
<a name="l00411"></a>00411 
<a name="l00412"></a>00412 <span class="comment">//**********************************************************************</span>
<a name="l00413"></a>00413 <span class="comment">//******************* Partition navigation functions *******************</span>
<a name="l00414"></a>00414 
<a name="l00415"></a>00415 
<a name="l00416"></a>00416 <span class="preprocessor">#if (FS_MULTI_PARTITION  ==  ENABLED)</span>
<a name="l00421"></a><a class="code" href="a00048.html#a50a8525f7c598dcfebcbe63aa2dfc23">00421</a> <span class="preprocessor">U8    nav_partition_nb( void )</span>
<a name="l00422"></a>00422 <span class="preprocessor"></span>{
<a name="l00423"></a>00423    <span class="keywordflow">return</span> <a class="code" href="a00024.html#920798e6366e8c3c408601c58fed4bb3" title="This function returns the number of partition on current drive.">fat_get_nbpartition</a>();
<a name="l00424"></a>00424 }
<a name="l00425"></a>00425 
<a name="l00426"></a>00426 
<a name="l00434"></a><a class="code" href="a00048.html#43873b28f4ebbd1f092e7f702ee14c61">00434</a> Bool  <a class="code" href="a00047.html#43873b28f4ebbd1f092e7f702ee14c61" title="This function selects a partition on drive.">nav_partition_set</a>( U8 partition_number )
<a name="l00435"></a>00435 {
<a name="l00436"></a>00436    <span class="keywordflow">if</span> ( <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#af482bc02a186c363c37c93e169fbbd4" title="Number of partition - 1 (0 or 1).">u8_partition</a> == partition_number)
<a name="l00437"></a>00437       <span class="keywordflow">return</span> TRUE;   <span class="comment">// It is the same</span>
<a name="l00438"></a>00438 
<a name="l00439"></a>00439    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#f6f4a9e2d8e7b6dd557871b6bc2c2ee0" title="This function checks if a file is not opened on current navigator.">fat_check_noopen</a>() )
<a name="l00440"></a>00440       <span class="keywordflow">return</span> FALSE;
<a name="l00441"></a>00441 
<a name="l00442"></a>00442    <span class="comment">// Go to partition</span>
<a name="l00443"></a>00443    <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#af482bc02a186c363c37c93e169fbbd4" title="Number of partition - 1 (0 or 1).">u8_partition</a> = partition_number;
<a name="l00444"></a>00444    <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#74121fb3c8d3a1d018c911650e2ec920" title="FAT type (default = no mounted = FS_TYPE_FAT_UNM).">u8_type_fat</a> = <a class="code" href="a00025.html#429fbd0498704c3d5864877548040069" title="Partition not mounted.">FS_TYPE_FAT_UNM</a>;
<a name="l00445"></a>00445    <span class="keywordflow">return</span> TRUE;
<a name="l00446"></a>00446 }
<a name="l00447"></a>00447 <span class="preprocessor">#endif</span>
<a name="l00448"></a>00448 <span class="preprocessor"></span>
<a name="l00449"></a>00449 
<a name="l00461"></a><a class="code" href="a00048.html#aa10a2b4e4db0e4eb602b19b4f9ff9b9">00461</a> Bool  <a class="code" href="a00047.html#aa10a2b4e4db0e4eb602b19b4f9ff9b9" title="This function mounts the selected partition.">nav_partition_mount</a>( <span class="keywordtype">void</span> )
<a name="l00462"></a>00462 {
<a name="l00463"></a>00463    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#f6f4a9e2d8e7b6dd557871b6bc2c2ee0" title="This function checks if a file is not opened on current navigator.">fat_check_noopen</a>() )
<a name="l00464"></a>00464       <span class="keywordflow">return</span> FALSE;
<a name="l00465"></a>00465 
<a name="l00466"></a>00466    <span class="keywordflow">if</span>( <a class="code" href="a00025.html#429fbd0498704c3d5864877548040069" title="Partition not mounted.">FS_TYPE_FAT_UNM</a> != <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#74121fb3c8d3a1d018c911650e2ec920" title="FAT type (default = no mounted = FS_TYPE_FAT_UNM).">u8_type_fat</a>)
<a name="l00467"></a>00467    {
<a name="l00468"></a>00468       <span class="comment">// Already mounted</span>
<a name="l00469"></a>00469       <span class="comment">// Go to root directory</span>
<a name="l00470"></a>00470       <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#ed8faad36e96ff2f422ddadd3740713f" title="First cluster number of selected directory (0 for the root directory).">u32_cluster_sel_dir</a>   = 0;
<a name="l00471"></a>00471       <span class="comment">// No file is selected by default</span>
<a name="l00472"></a>00472       <a class="code" href="a00024.html#56d9a210bc2d4b0b5c46cb24a2e9f690" title="This function resets the selection pointers.">fat_clear_entry_info_and_ptr</a>();
<a name="l00473"></a>00473       <span class="keywordflow">return</span> TRUE;
<a name="l00474"></a>00474    }
<a name="l00475"></a>00475 
<a name="l00476"></a>00476    <span class="keywordflow">return</span> <a class="code" href="a00025.html#c0108ea608b547e8d3a405c70644c1e9" title="This function mounts a partition.">fat_mount</a>();
<a name="l00477"></a>00477 }
<a name="l00478"></a>00478 
<a name="l00479"></a>00479 
<a name="l00485"></a><a class="code" href="a00048.html#366957a6691432a94f9ec5d82039eebc">00485</a> U8    <a class="code" href="a00047.html#366957a6691432a94f9ec5d82039eebc" title="This function gives the partition type.">nav_partition_type</a>( <span class="keywordtype">void</span> )
<a name="l00486"></a>00486 {
<a name="l00487"></a>00487    <a class="code" href="a00024.html#eeec0bd6755a6be4c4dda2b4669eb0ae" title="This function checks device state.">fat_check_device</a>();
<a name="l00488"></a>00488    <span class="keywordflow">if</span>( <a class="code" href="a00025.html#429fbd0498704c3d5864877548040069" title="Partition not mounted.">FS_TYPE_FAT_UNM</a> == <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#74121fb3c8d3a1d018c911650e2ec920" title="FAT type (default = no mounted = FS_TYPE_FAT_UNM).">u8_type_fat</a>)
<a name="l00489"></a>00489    {
<a name="l00490"></a>00490       <a class="code" href="a00047.html#aa10a2b4e4db0e4eb602b19b4f9ff9b9" title="This function mounts the selected partition.">nav_partition_mount</a>();
<a name="l00491"></a>00491    }
<a name="l00492"></a>00492    <span class="keywordflow">return</span> <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#74121fb3c8d3a1d018c911650e2ec920" title="FAT type (default = no mounted = FS_TYPE_FAT_UNM).">u8_type_fat</a>;
<a name="l00493"></a>00493 }
<a name="l00494"></a>00494 
<a name="l00495"></a>00495 
<a name="l00508"></a><a class="code" href="a00048.html#14cf001b6b84590bd3da1f3809844f03">00508</a> Bool  <a class="code" href="a00047.html#14cf001b6b84590bd3da1f3809844f03" title="This function reads or writes the serial number on the selected partition.">nav_partition_serialnumber</a>( Bool b_action , U8 _MEM_TYPE_SLOW_ *a_u8_sn )
<a name="l00509"></a>00509 {
<a name="l00510"></a>00510    <span class="keywordflow">if</span>( !<a class="code" href="a00024.html#8ee865aa4c51519c0d141f1f4559c72a" title="This function checks if the partition is mounted.">fat_check_mount</a>())
<a name="l00511"></a>00511       <span class="keywordflow">return</span> FALSE;
<a name="l00512"></a>00512 
<a name="l00513"></a>00513    <span class="keywordflow">return</span> <a class="code" href="a00025.html#2ff43f97db7a5d76f46f4fb1b683d192" title="This function reads or writes a serial number.">fat_serialnumber</a>( b_action , a_u8_sn );
<a name="l00514"></a>00514 }
<a name="l00515"></a>00515 
<a name="l00516"></a>00516 
<a name="l00529"></a><a class="code" href="a00048.html#c2ac7612e00c937c8d83433d2143a4f0">00529</a> Bool  <a class="code" href="a00047.html#c2ac7612e00c937c8d83433d2143a4f0" title="This function reads or writes the label of selected partition.">nav_partition_label</a>( Bool b_action , <a class="code" href="a00031.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> sz_label )
<a name="l00530"></a>00530 {
<a name="l00531"></a>00531    _MEM_TYPE_SLOW_   <a class="code" href="a00008.html">Fs_index</a> index;
<a name="l00532"></a>00532    Bool status = TRUE;
<a name="l00533"></a>00533 
<a name="l00534"></a>00534    index = <a class="code" href="a00047.html#47882923fca657fb23001d23b6b5369d" title="This function returns a small index on the selected file.">nav_getindex</a>();    <span class="comment">// Save current position</span>
<a name="l00535"></a>00535 
<a name="l00536"></a>00536    <span class="comment">// Go to root dir</span>
<a name="l00537"></a>00537    <span class="keywordflow">if</span>( <a class="code" href="a00047.html#9447385c9c400b07b99c61ada1a6ea77" title="This function initializes the file list on the root directory.">nav_dir_root</a>())
<a name="l00538"></a>00538    {
<a name="l00539"></a>00539       <span class="comment">// Find field label</span>
<a name="l00540"></a>00540       <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a> = 0; <span class="comment">// Go to first entry</span>
<a name="l00541"></a>00541       <span class="keywordflow">while</span>( 1 )
<a name="l00542"></a>00542       {
<a name="l00543"></a>00543          <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#1a35321a99150ba643f87cb6c79ec3e5" title="This function fill the internal cache with a sector from current directory.">fat_read_dir</a>())
<a name="l00544"></a>00544          {
<a name="l00545"></a>00545             status = FALSE;
<a name="l00546"></a>00546             <span class="keywordflow">break</span>;               <span class="comment">// error</span>
<a name="l00547"></a>00547          }
<a name="l00548"></a>00548          <span class="keywordflow">if</span>( <a class="code" href="a00025.html#a03d2728f28964e1eb4d78c2bb831718" title="This function reads or writes a label in the partition.">fat_entry_label</a>( <a class="code" href="a00031.html#c1570dd392605e8ff8f7d4cb16487830">FS_LABEL_READ</a> , NULL ) )
<a name="l00549"></a>00549             <span class="keywordflow">break</span>;
<a name="l00550"></a>00550          <span class="keywordflow">if</span>( <a class="code" href="a00031.html#33817136df196a5f0146574b4e1775b6" title="File entry empty.">FS_ERR_ENTRY_EMPTY</a> == <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> )
<a name="l00551"></a>00551             <span class="keywordflow">break</span>;
<a name="l00552"></a>00552          <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a>++;
<a name="l00553"></a>00553       }
<a name="l00554"></a>00554       <span class="keywordflow">if</span>( TRUE == status )
<a name="l00555"></a>00555       {
<a name="l00556"></a>00556          <span class="comment">// Find OK</span>
<a name="l00557"></a>00557          <span class="keywordflow">if</span>( <a class="code" href="a00031.html#c1570dd392605e8ff8f7d4cb16487830">FS_LABEL_READ</a> == b_action )
<a name="l00558"></a>00558          {
<a name="l00559"></a>00559             <span class="comment">// Read field label</span>
<a name="l00560"></a>00560             <span class="keywordflow">if</span>( !<a class="code" href="a00025.html#a03d2728f28964e1eb4d78c2bb831718" title="This function reads or writes a label in the partition.">fat_entry_label</a>( <a class="code" href="a00031.html#c1570dd392605e8ff8f7d4cb16487830">FS_LABEL_READ</a> , sz_label ) )
<a name="l00561"></a>00561                sz_label[0]=0;    <span class="comment">// empty name</span>
<a name="l00562"></a>00562          }<span class="keywordflow">else</span>{
<a name="l00563"></a>00563             <span class="comment">// Change field label</span>
<a name="l00564"></a>00564             status = <a class="code" href="a00025.html#a03d2728f28964e1eb4d78c2bb831718" title="This function reads or writes a label in the partition.">fat_entry_label</a>( <a class="code" href="a00031.html#c5e191f04380ef238255929695f8efcb">FS_LABEL_WRITE</a> , sz_label );
<a name="l00565"></a>00565          }
<a name="l00566"></a>00566       }
<a name="l00567"></a>00567    }
<a name="l00568"></a>00568    <a class="code" href="a00047.html#503f8d42be2b70cb554589ac7974ed78" title="This function selects a file in the navigator via a file index.">nav_gotoindex</a>( &amp;index );   <span class="comment">// Restore the position</span>
<a name="l00569"></a>00569    <span class="keywordflow">return</span> status;
<a name="l00570"></a>00570 }
<a name="l00571"></a>00571 
<a name="l00572"></a>00572 
<a name="l00582"></a><a class="code" href="a00048.html#24053c9202d6999e9e56e96b3b89703e">00582</a> U32   <a class="code" href="a00047.html#24053c9202d6999e9e56e96b3b89703e" title="This function returns partition total space.">nav_partition_space</a>( <span class="keywordtype">void</span> )
<a name="l00583"></a>00583 {
<a name="l00584"></a>00584    <a class="code" href="a00024.html#eeec0bd6755a6be4c4dda2b4669eb0ae" title="This function checks device state.">fat_check_device</a>();
<a name="l00585"></a>00585    <span class="keywordflow">if</span> (<a class="code" href="a00025.html#429fbd0498704c3d5864877548040069" title="Partition not mounted.">FS_TYPE_FAT_UNM</a> == <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#74121fb3c8d3a1d018c911650e2ec920" title="FAT type (default = no mounted = FS_TYPE_FAT_UNM).">u8_type_fat</a>)
<a name="l00586"></a>00586       <span class="keywordflow">return</span> 0;
<a name="l00587"></a>00587    <span class="keywordflow">return</span> (<a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#2f9e0c9af661ea927729c08280e1105e" title="Number of cluster (include the two reserved cluster).">u32_CountofCluster</a> * <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#cddebea9972567fdcb5b87327b48125e" title="Cluster size (unit 512B).">u8_BPB_SecPerClus</a>);
<a name="l00588"></a>00588 }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590 
<a name="l00595"></a><a class="code" href="a00048.html#2e75b77b1d89b5f80ff349aedfb0446f">00595</a> U8    <a class="code" href="a00047.html#2e75b77b1d89b5f80ff349aedfb0446f" title="This function returns the partition cluster size.">nav_partition_cluster_size</a>( <span class="keywordtype">void</span> )
<a name="l00596"></a>00596 {
<a name="l00597"></a>00597    <span class="keywordflow">return</span> <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#cddebea9972567fdcb5b87327b48125e" title="Cluster size (unit 512B).">u8_BPB_SecPerClus</a>;
<a name="l00598"></a>00598 }
<a name="l00599"></a>00599 
<a name="l00609"></a><a class="code" href="a00048.html#44e5b70be51e852438e086225846cea3">00609</a> U32   <a class="code" href="a00047.html#44e5b70be51e852438e086225846cea3" title="This function returns the partition free space.">nav_partition_freespace</a>( <span class="keywordtype">void</span> )
<a name="l00610"></a>00610 {
<a name="l00611"></a>00611    <a class="code" href="a00024.html#eeec0bd6755a6be4c4dda2b4669eb0ae" title="This function checks device state.">fat_check_device</a>();
<a name="l00612"></a>00612    <span class="keywordflow">if</span> (<a class="code" href="a00025.html#429fbd0498704c3d5864877548040069" title="Partition not mounted.">FS_TYPE_FAT_UNM</a> == <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#74121fb3c8d3a1d018c911650e2ec920" title="FAT type (default = no mounted = FS_TYPE_FAT_UNM).">u8_type_fat</a>)
<a name="l00613"></a>00613       <span class="keywordflow">return</span> 0;
<a name="l00614"></a>00614    <span class="keywordflow">return</span> <a class="code" href="a00025.html#e23270781477be5e6c89b90531c01651" title="This function returns the space free in the partition.">fat_getfreespace</a>();
<a name="l00615"></a>00615 }
<a name="l00616"></a>00616 
<a name="l00617"></a>00617 
<a name="l00627"></a><a class="code" href="a00048.html#9e8934635c66157baff2e6bb066ea373">00627</a> U8    <a class="code" href="a00047.html#9e8934635c66157baff2e6bb066ea373" title="This function returns the partition space free in percent.">nav_partition_freespace_percent</a>( <span class="keywordtype">void</span> )
<a name="l00628"></a>00628 {
<a name="l00629"></a>00629    <a class="code" href="a00024.html#eeec0bd6755a6be4c4dda2b4669eb0ae" title="This function checks device state.">fat_check_device</a>();
<a name="l00630"></a>00630    <span class="keywordflow">if</span> (<a class="code" href="a00025.html#429fbd0498704c3d5864877548040069" title="Partition not mounted.">FS_TYPE_FAT_UNM</a> == <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#74121fb3c8d3a1d018c911650e2ec920" title="FAT type (default = no mounted = FS_TYPE_FAT_UNM).">u8_type_fat</a>)
<a name="l00631"></a>00631       <span class="keywordflow">return</span> 0;
<a name="l00632"></a>00632    <span class="keywordflow">return</span> <a class="code" href="a00025.html#14426d5552b72b88ea0d61828c57d6c6" title="This function returns the space free in percent.">fat_getfreespace_percent</a>();
<a name="l00633"></a>00633 }
<a name="l00634"></a>00634 
<a name="l00635"></a>00635 
<a name="l00636"></a>00636 <span class="comment">//**********************************************************************</span>
<a name="l00637"></a>00637 <span class="comment">//****************** File list navigation functions ********************</span>
<a name="l00638"></a>00638 
<a name="l00639"></a>00639 
<a name="l00648"></a><a class="code" href="a00048.html#35c5d7d2795d26f9efcdbe2f04991a39">00648</a> Bool  <a class="code" href="a00047.html#35c5d7d2795d26f9efcdbe2f04991a39" title="To display in File List only the files OR directories.">nav_filelist_single_enable</a>( Bool b_type )
<a name="l00649"></a>00649 {
<a name="l00650"></a>00650    <span class="keywordflow">if</span> ( !<a class="code" href="a00047.html#7ad0aa092d133a156651abe5d871b8eb" title="This function resets the selection pointer, so &amp;quot;no file selected&amp;quot; in file...">nav_filelist_reset</a>())
<a name="l00651"></a>00651       <span class="keywordflow">return</span> FALSE;
<a name="l00652"></a>00652 
<a name="l00653"></a>00653    <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#a77329e481dd65221af40a8c26b6541b" title="Navigation File List provide only files or directories.">b_mode_nav_single</a> = TRUE;
<a name="l00654"></a>00654    <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#f36b5e65540c67c04d0ca489e2f52332" title="Navigation step ( FS_FILE or FS_DIR ).">b_mode_nav</a>        = b_type;
<a name="l00655"></a>00655    <span class="keywordflow">return</span> TRUE;
<a name="l00656"></a>00656 }
<a name="l00657"></a>00657 
<a name="l00658"></a>00658 
<a name="l00664"></a><a class="code" href="a00048.html#128080b653fd0d5d2ec1c568b6670216">00664</a> Bool  <a class="code" href="a00047.html#128080b653fd0d5d2ec1c568b6670216" title="To display in File List the directories AND files.">nav_filelist_single_disable</a>( <span class="keywordtype">void</span> )
<a name="l00665"></a>00665 {
<a name="l00666"></a>00666    <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#a77329e481dd65221af40a8c26b6541b" title="Navigation File List provide only files or directories.">b_mode_nav_single</a> = FALSE;
<a name="l00667"></a>00667    <span class="keywordflow">return</span> <a class="code" href="a00047.html#7ad0aa092d133a156651abe5d871b8eb" title="This function resets the selection pointer, so &amp;quot;no file selected&amp;quot; in file...">nav_filelist_reset</a>();
<a name="l00668"></a>00668 }
<a name="l00669"></a>00669 
<a name="l00670"></a>00670 
<a name="l00676"></a><a class="code" href="a00048.html#7ad0aa092d133a156651abe5d871b8eb">00676</a> Bool  <a class="code" href="a00047.html#7ad0aa092d133a156651abe5d871b8eb" title="This function resets the selection pointer, so &amp;quot;no file selected&amp;quot; in file...">nav_filelist_reset</a>( <span class="keywordtype">void</span> )
<a name="l00677"></a>00677 {
<a name="l00678"></a>00678    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#e9d0f61d0e7b29a4e8e9e95347194f21" title="This function checks if the partition is mounted and no file is opened.">fat_check_mount_noopen</a>())
<a name="l00679"></a>00679       <span class="keywordflow">return</span> FALSE;
<a name="l00680"></a>00680 
<a name="l00681"></a>00681    <span class="comment">// No file selected and reset navigation</span>
<a name="l00682"></a>00682    <a class="code" href="a00024.html#56d9a210bc2d4b0b5c46cb24a2e9f690" title="This function resets the selection pointers.">fat_clear_entry_info_and_ptr</a>();
<a name="l00683"></a>00683    <span class="keywordflow">return</span> TRUE;
<a name="l00684"></a>00684 }
<a name="l00685"></a>00685 
<a name="l00686"></a>00686 
<a name="l00692"></a><a class="code" href="a00048.html#dd6435ba1a2f0a8ddc072883c05a1a64">00692</a> Bool  <a class="code" href="a00047.html#dd6435ba1a2f0a8ddc072883c05a1a64" title="This function checks if a file is selected.">nav_filelist_validpos</a>( <span class="keywordtype">void</span> )
<a name="l00693"></a>00693 {
<a name="l00694"></a>00694    <span class="keywordflow">return</span> <a class="code" href="a00024.html#003f1c81dcb2c7a95f191c30b8a4f258" title="This function checks if the partition is mounted and if no file is opened and a file...">fat_check_mount_select_noopen</a>();
<a name="l00695"></a>00695 }
<a name="l00696"></a>00696 
<a name="l00697"></a>00697 
<a name="l00703"></a><a class="code" href="a00048.html#1d6570347e090b2473510798840a729f">00703</a> Bool  <a class="code" href="a00047.html#1d6570347e090b2473510798840a729f" title="This function checks if no file is open.">nav_filelist_fileisnotopen</a>( <span class="keywordtype">void</span> )
<a name="l00704"></a>00704 {
<a name="l00705"></a>00705    <span class="keywordflow">return</span> <a class="code" href="a00024.html#f6f4a9e2d8e7b6dd557871b6bc2c2ee0" title="This function checks if a file is not opened on current navigator.">fat_check_noopen</a>();
<a name="l00706"></a>00706 }
<a name="l00707"></a>00707 
<a name="l00708"></a>00708 
<a name="l00726"></a><a class="code" href="a00048.html#066eaff61613f07dc5fb1f3313747aef">00726</a> Bool  <a class="code" href="a00047.html#066eaff61613f07dc5fb1f3313747aef" title="This function moves the selection pointer in file list.">nav_filelist_set</a>( U16 u16_nb , Bool b_direction )
<a name="l00727"></a>00727 {
<a name="l00728"></a>00728    U16   u16_ptr_save_entry;
<a name="l00729"></a>00729    U16   u16_save_pos_sel_file;
<a name="l00730"></a>00730    Bool  b_save_entry_type;
<a name="l00731"></a>00731    Bool  b_find_last_entry = FALSE;
<a name="l00732"></a>00732 
<a name="l00733"></a>00733    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#e9d0f61d0e7b29a4e8e9e95347194f21" title="This function checks if the partition is mounted and no file is opened.">fat_check_mount_noopen</a>())
<a name="l00734"></a>00734       <span class="keywordflow">return</span> FALSE;
<a name="l00735"></a>00735 
<a name="l00736"></a>00736    <span class="comment">// Save the current selection</span>
<a name="l00737"></a>00737    u16_ptr_save_entry      = <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a>;
<a name="l00738"></a>00738    u16_save_pos_sel_file   = <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#b0213ed9fc205b282b4c1d92adfa7460" title="File position in the file list (only used by navigation functions).">u16_pos_sel_file</a>;
<a name="l00739"></a>00739    b_save_entry_type       = <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#f36b5e65540c67c04d0ca489e2f52332" title="Navigation step ( FS_FILE or FS_DIR ).">b_mode_nav</a>;
<a name="l00740"></a>00740 
<a name="l00741"></a>00741    <span class="comment">// Loop in directory</span>
<a name="l00742"></a>00742    <span class="keywordflow">while</span>( 1 )
<a name="l00743"></a>00743    {
<a name="l00744"></a>00744       <span class="keywordflow">if</span>(( <a class="code" href="a00048.html#793c4ce9436637d68ab25dc859abc35a" title="move in list to next file">FS_FIND_NEXT</a> == b_direction )
<a name="l00745"></a>00745       || ( b_find_last_entry ) )
<a name="l00746"></a>00746       {
<a name="l00747"></a>00747          <span class="keywordflow">if</span> ( <a class="code" href="a00025.html#fe6257cc919ba9fad5fad6c1e499f6d6" title="Signal that a file entry is the last file entry accessibled by system.">FS_END_FIND</a> == <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a> )
<a name="l00748"></a>00748          {
<a name="l00749"></a>00749             <span class="comment">// Too many files in directory (case impossible)</span>
<a name="l00750"></a>00750             <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00031.html#89613ba21711697c707a3199bf93b9cf" title="File system error.">FS_ERR_FS</a>;
<a name="l00751"></a>00751             <span class="keywordflow">break</span>;
<a name="l00752"></a>00752          }
<a name="l00753"></a>00753          <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a>++;      <span class="comment">// Update entry position</span>
<a name="l00754"></a>00754       }
<a name="l00755"></a>00755       <span class="keywordflow">else</span>
<a name="l00756"></a>00756       {
<a name="l00757"></a>00757          <span class="keywordflow">if</span> ( <a class="code" href="a00025.html#2e16c6cfcb3174f7ad19ad3996a69ae7" title="Signal that a file entry isn&amp;#39;t selected.">FS_NO_SEL</a> == <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a> )
<a name="l00758"></a>00758          {
<a name="l00759"></a>00759             <span class="comment">// No selected file then previous action impossible</span>
<a name="l00760"></a>00760             <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00031.html#1227e9d3b3f7f0c656cfbb9a0b7915f8" title="File no found.">FS_ERR_NO_FIND</a>;
<a name="l00761"></a>00761             <span class="keywordflow">break</span>;
<a name="l00762"></a>00762          }
<a name="l00763"></a>00763          <span class="keywordflow">if</span> ( 0 == <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a> )
<a name="l00764"></a>00764          {
<a name="l00765"></a>00765             <span class="comment">// beginning of directory</span>
<a name="l00766"></a>00766             <span class="keywordflow">if</span> ( (<a class="code" href="a00031.html#d043d9359eeca08e8c5ea4d9136eb15b">FS_DIR</a> == <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#f36b5e65540c67c04d0ca489e2f52332" title="Navigation step ( FS_FILE or FS_DIR ).">b_mode_nav</a> ) || <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#a77329e481dd65221af40a8c26b6541b" title="Navigation File List provide only files or directories.">b_mode_nav_single</a> )
<a name="l00767"></a>00767             {
<a name="l00768"></a>00768                <span class="comment">// End of directory scan, then no previous action possible</span>
<a name="l00769"></a>00769                <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00031.html#1227e9d3b3f7f0c656cfbb9a0b7915f8" title="File no found.">FS_ERR_NO_FIND</a>;
<a name="l00770"></a>00770                <span class="keywordflow">break</span>;
<a name="l00771"></a>00771             }
<a name="l00772"></a>00772             <span class="comment">// End of file scan, then find last directory</span>
<a name="l00773"></a>00773             b_find_last_entry = TRUE;
<a name="l00774"></a>00774          }<span class="keywordflow">else</span>{
<a name="l00775"></a>00775             <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a>--;   <span class="comment">// Update entry position</span>
<a name="l00776"></a>00776          }
<a name="l00777"></a>00777       }
<a name="l00778"></a>00778 
<a name="l00779"></a>00779       <span class="keywordflow">if</span>( !<a class="code" href="a00024.html#1a35321a99150ba643f87cb6c79ec3e5" title="This function fill the internal cache with a sector from current directory.">fat_read_dir</a>())
<a name="l00780"></a>00780       {
<a name="l00781"></a>00781          <span class="keywordflow">if</span>( <a class="code" href="a00031.html#e8798a89bfc4f49da50fc55b14a5b07f" title="The position is outside the cluster list.">FS_ERR_OUT_LIST</a> != <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> )
<a name="l00782"></a>00782             <span class="keywordflow">break</span>; <span class="comment">// Error</span>
<a name="l00783"></a>00783       }<span class="keywordflow">else</span>{
<a name="l00784"></a>00784          <span class="keywordflow">if</span> ( <a class="code" href="a00024.html#ef13c743905d7e0381b3a461da2ebd7a" title="This function checks the entry.">fat_entry_check</a>( <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#f36b5e65540c67c04d0ca489e2f52332" title="Navigation step ( FS_FILE or FS_DIR ).">b_mode_nav</a> ) )
<a name="l00785"></a>00785          {
<a name="l00786"></a>00786            <span class="comment">// HERE, the file entry match with the type seached</span>
<a name="l00787"></a>00787 
<a name="l00788"></a>00788            <span class="keywordflow">if</span>( b_find_last_entry )
<a name="l00789"></a>00789              <span class="keywordflow">continue</span>;  <span class="comment">// The search of last directory is on going then continue the search</span>
<a name="l00790"></a>00790 
<a name="l00791"></a>00791            <span class="comment">// Update position in directory</span>
<a name="l00792"></a>00792            <span class="keywordflow">if</span> ( <a class="code" href="a00048.html#793c4ce9436637d68ab25dc859abc35a" title="move in list to next file">FS_FIND_NEXT</a> == b_direction )
<a name="l00793"></a>00793               <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#b0213ed9fc205b282b4c1d92adfa7460" title="File position in the file list (only used by navigation functions).">u16_pos_sel_file</a>++;
<a name="l00794"></a>00794            <span class="keywordflow">else</span>
<a name="l00795"></a>00795               <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#b0213ed9fc205b282b4c1d92adfa7460" title="File position in the file list (only used by navigation functions).">u16_pos_sel_file</a>--;
<a name="l00796"></a>00796 
<a name="l00797"></a>00797            <span class="keywordflow">if</span> (0 == u16_nb)
<a name="l00798"></a>00798            {
<a name="l00799"></a>00799               <span class="comment">// It is the end of move then update file information</span>
<a name="l00800"></a>00800               <a class="code" href="a00024.html#56b68ed36f194500ce88c22252e3c317" title="This function reads information about selected file.">fat_get_entry_info</a>();
<a name="l00801"></a>00801               <span class="keywordflow">return</span> TRUE;         <span class="comment">// NB FILE FIND</span>
<a name="l00802"></a>00802            }
<a name="l00803"></a>00803            u16_nb--;
<a name="l00804"></a>00804            <span class="keywordflow">continue</span>;
<a name="l00805"></a>00805          }
<a name="l00806"></a>00806       }
<a name="l00807"></a>00807 
<a name="l00808"></a>00808       <span class="comment">// Here error, check type of error</span>
<a name="l00809"></a>00809       <span class="keywordflow">if</span>(( <a class="code" href="a00031.html#33817136df196a5f0146574b4e1775b6" title="File entry empty.">FS_ERR_ENTRY_EMPTY</a> == <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> )
<a name="l00810"></a>00810       || ( <a class="code" href="a00031.html#e8798a89bfc4f49da50fc55b14a5b07f" title="The position is outside the cluster list.">FS_ERR_OUT_LIST</a>    == <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> ) )
<a name="l00811"></a>00811       {
<a name="l00812"></a>00812          <span class="comment">// Here, end of the directory</span>
<a name="l00813"></a>00813          <span class="keywordflow">if</span>( b_find_last_entry )
<a name="l00814"></a>00814          {
<a name="l00815"></a>00815             <span class="comment">// Re enable the previous command at the end of directory to find the last directory entry</span>
<a name="l00816"></a>00816             b_find_last_entry = FALSE;
<a name="l00817"></a>00817             <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#f36b5e65540c67c04d0ca489e2f52332" title="Navigation step ( FS_FILE or FS_DIR ).">b_mode_nav</a> = <a class="code" href="a00031.html#d043d9359eeca08e8c5ea4d9136eb15b">FS_DIR</a>;
<a name="l00818"></a>00818             <span class="keywordflow">continue</span>;
<a name="l00819"></a>00819          }
<a name="l00820"></a>00820          <span class="comment">// Here, a next action is on going</span>
<a name="l00821"></a>00821          <span class="keywordflow">if</span> ( (<a class="code" href="a00031.html#20f0a7ade1270e3923abafeb33864c55">FS_FILE</a> == <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#f36b5e65540c67c04d0ca489e2f52332" title="Navigation step ( FS_FILE or FS_DIR ).">b_mode_nav</a>) || <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#a77329e481dd65221af40a8c26b6541b" title="Navigation File List provide only files or directories.">b_mode_nav_single</a> )
<a name="l00822"></a>00822          {
<a name="l00823"></a>00823             <span class="comment">// End of next file action then end of next action</span>
<a name="l00824"></a>00824             <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00031.html#1227e9d3b3f7f0c656cfbb9a0b7915f8" title="File no found.">FS_ERR_NO_FIND</a>; <span class="comment">// No file found</span>
<a name="l00825"></a>00825             <span class="keywordflow">break</span>;                        <span class="comment">// end of search</span>
<a name="l00826"></a>00826          }<span class="keywordflow">else</span>{
<a name="l00827"></a>00827             <span class="comment">// End of next dir action then starts the next file action at the beginning of directory</span>
<a name="l00828"></a>00828             <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a> = 0xFFFF;
<a name="l00829"></a>00829             <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#f36b5e65540c67c04d0ca489e2f52332" title="Navigation step ( FS_FILE or FS_DIR ).">b_mode_nav</a> = <a class="code" href="a00031.html#20f0a7ade1270e3923abafeb33864c55">FS_FILE</a>;
<a name="l00830"></a>00830          }
<a name="l00831"></a>00831       }
<a name="l00832"></a>00832    }  <span class="comment">// end of loop while(1)</span>
<a name="l00833"></a>00833 
<a name="l00834"></a>00834    <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#f36b5e65540c67c04d0ca489e2f52332" title="Navigation step ( FS_FILE or FS_DIR ).">b_mode_nav</a>                    = b_save_entry_type;
<a name="l00835"></a>00835    <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a>   = u16_ptr_save_entry;
<a name="l00836"></a>00836    <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#b0213ed9fc205b282b4c1d92adfa7460" title="File position in the file list (only used by navigation functions).">u16_pos_sel_file</a>              = u16_save_pos_sel_file;
<a name="l00837"></a>00837    <span class="keywordflow">return</span> FALSE;
<a name="l00838"></a>00838 }
<a name="l00839"></a>00839 
<a name="l00840"></a>00840 
<a name="l00846"></a><a class="code" href="a00048.html#6b1c198eaa70bcb1babce7ad46a865ed">00846</a> U16   <a class="code" href="a00047.html#6b1c198eaa70bcb1babce7ad46a865ed" title="This function returns the position of selected file in file list.">nav_filelist_get</a>( <span class="keywordtype">void</span> )
<a name="l00847"></a>00847 {
<a name="l00848"></a>00848    <span class="keywordflow">return</span> <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#b0213ed9fc205b282b4c1d92adfa7460" title="File position in the file list (only used by navigation functions).">u16_pos_sel_file</a>;
<a name="l00849"></a>00849 }
<a name="l00850"></a>00850 
<a name="l00851"></a>00851 
<a name="l00859"></a><a class="code" href="a00048.html#e725a52dd932465bd1c3ebe61af033c5">00859</a> Bool  <a class="code" href="a00047.html#e725a52dd932465bd1c3ebe61af033c5" title="This function goes at a position in file list.">nav_filelist_goto</a>( U16 u16_newpos )
<a name="l00860"></a>00860 {
<a name="l00861"></a>00861    U16 u16_current_pos;
<a name="l00862"></a>00862 
<a name="l00863"></a>00863    <span class="keywordflow">if</span>( <a class="code" href="a00025.html#2e16c6cfcb3174f7ad19ad3996a69ae7" title="Signal that a file entry isn&amp;#39;t selected.">FS_NO_SEL</a> == u16_newpos )
<a name="l00864"></a>00864       <span class="keywordflow">return</span> <a class="code" href="a00047.html#7ad0aa092d133a156651abe5d871b8eb" title="This function resets the selection pointer, so &amp;quot;no file selected&amp;quot; in file...">nav_filelist_reset</a>();
<a name="l00865"></a>00865 
<a name="l00866"></a>00866    u16_current_pos = <a class="code" href="a00047.html#6b1c198eaa70bcb1babce7ad46a865ed" title="This function returns the position of selected file in file list.">nav_filelist_get</a>();
<a name="l00867"></a>00867    <span class="keywordflow">if</span>( u16_newpos &lt; (u16_current_pos/2) )
<a name="l00868"></a>00868    {
<a name="l00869"></a>00869       <span class="comment">// Restart at the beginning of list to accelerate the search</span>
<a name="l00870"></a>00870       <span class="keywordflow">if</span>( !<a class="code" href="a00047.html#7ad0aa092d133a156651abe5d871b8eb" title="This function resets the selection pointer, so &amp;quot;no file selected&amp;quot; in file...">nav_filelist_reset</a>() )
<a name="l00871"></a>00871          <span class="keywordflow">return</span> FALSE;
<a name="l00872"></a>00872       u16_current_pos = <a class="code" href="a00025.html#2e16c6cfcb3174f7ad19ad3996a69ae7" title="Signal that a file entry isn&amp;#39;t selected.">FS_NO_SEL</a>;
<a name="l00873"></a>00873    }
<a name="l00874"></a>00874    <span class="keywordflow">if</span> (<a class="code" href="a00025.html#2e16c6cfcb3174f7ad19ad3996a69ae7" title="Signal that a file entry isn&amp;#39;t selected.">FS_NO_SEL</a> == u16_current_pos)
<a name="l00875"></a>00875    {
<a name="l00876"></a>00876       <span class="keywordflow">return</span> <a class="code" href="a00047.html#066eaff61613f07dc5fb1f3313747aef" title="This function moves the selection pointer in file list.">nav_filelist_set</a>( u16_newpos, <a class="code" href="a00048.html#793c4ce9436637d68ab25dc859abc35a" title="move in list to next file">FS_FIND_NEXT</a> );
<a name="l00877"></a>00877    }
<a name="l00878"></a>00878    <span class="keywordflow">else</span>
<a name="l00879"></a>00879    {
<a name="l00880"></a>00880       <span class="keywordflow">if</span> (u16_newpos &lt; u16_current_pos)
<a name="l00881"></a>00881       {
<a name="l00882"></a>00882          <span class="keywordflow">return</span> <a class="code" href="a00047.html#066eaff61613f07dc5fb1f3313747aef" title="This function moves the selection pointer in file list.">nav_filelist_set</a>( u16_current_pos -u16_newpos -1 , <a class="code" href="a00048.html#bc7fd11102a5b83b18fefaba9e846c10" title="move in list to previous file">FS_FIND_PREV</a> );
<a name="l00883"></a>00883       }
<a name="l00884"></a>00884       <span class="keywordflow">if</span> (u16_newpos &gt; u16_current_pos)
<a name="l00885"></a>00885       {
<a name="l00886"></a>00886          <span class="keywordflow">return</span> <a class="code" href="a00047.html#066eaff61613f07dc5fb1f3313747aef" title="This function moves the selection pointer in file list.">nav_filelist_set</a>( u16_newpos -u16_current_pos - 1 , <a class="code" href="a00048.html#793c4ce9436637d68ab25dc859abc35a" title="move in list to next file">FS_FIND_NEXT</a> );
<a name="l00887"></a>00887       }
<a name="l00888"></a>00888    }
<a name="l00889"></a>00889    <span class="keywordflow">return</span> TRUE;
<a name="l00890"></a>00890 }
<a name="l00891"></a>00891 
<a name="l00892"></a>00892 
<a name="l00906"></a><a class="code" href="a00048.html#017ce6b53af128e5064a06bc8fadec25">00906</a> Bool  <a class="code" href="a00047.html#017ce6b53af128e5064a06bc8fadec25" title="This function searchs a file name in file list.">nav_filelist_findname</a>( <span class="keyword">const</span> <a class="code" href="a00031.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> sz_name , Bool b_match_case )
<a name="l00907"></a>00907 {
<a name="l00908"></a>00908    <span class="keywordflow">while</span>( 1 )
<a name="l00909"></a>00909    {
<a name="l00910"></a>00910       <span class="keywordflow">if</span> ( !<a class="code" href="a00047.html#066eaff61613f07dc5fb1f3313747aef" title="This function moves the selection pointer in file list.">nav_filelist_set</a>( 0, <a class="code" href="a00048.html#793c4ce9436637d68ab25dc859abc35a" title="move in list to next file">FS_FIND_NEXT</a> ))
<a name="l00911"></a>00911          <span class="keywordflow">return</span> FALSE;
<a name="l00912"></a>00912       <span class="keywordflow">if</span> ( <a class="code" href="a00047.html#10603c2fe89bd66a17cfe3bb49a3fa14" title="This function returns the name of selected file or checks the string with the name...">nav_file_name</a>( sz_name , 0 , <a class="code" href="a00031.html#5f61af4710e43b370997c162777f08b3">FS_NAME_CHECK</a> , b_match_case ))
<a name="l00913"></a>00913          <span class="keywordflow">return</span> TRUE;
<a name="l00914"></a>00914    }
<a name="l00915"></a>00915 }
<a name="l00916"></a>00916 
<a name="l00917"></a>00917 
<a name="l00923"></a><a class="code" href="a00048.html#4f3b7e6c2f7670c02973654dbc1d550e">00923</a> Bool  <a class="code" href="a00047.html#4f3b7e6c2f7670c02973654dbc1d550e" title="This function checks the end of file list.">nav_filelist_eol</a>( <span class="keywordtype">void</span> )
<a name="l00924"></a>00924 {
<a name="l00925"></a>00925    <span class="keywordflow">if</span>( FALSE == <a class="code" href="a00047.html#066eaff61613f07dc5fb1f3313747aef" title="This function moves the selection pointer in file list.">nav_filelist_set</a>( 0 , <a class="code" href="a00048.html#793c4ce9436637d68ab25dc859abc35a" title="move in list to next file">FS_FIND_NEXT</a> ) )
<a name="l00926"></a>00926       <span class="keywordflow">return</span> TRUE;   <span class="comment">// End of list or error (remark: the position haven't changed)</span>
<a name="l00927"></a>00927 
<a name="l00928"></a>00928    <span class="keywordflow">if</span>( 0 != <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#b0213ed9fc205b282b4c1d92adfa7460" title="File position in the file list (only used by navigation functions).">u16_pos_sel_file</a> )
<a name="l00929"></a>00929    {
<a name="l00930"></a>00930       <span class="comment">// Go to previous position</span>
<a name="l00931"></a>00931       <a class="code" href="a00047.html#066eaff61613f07dc5fb1f3313747aef" title="This function moves the selection pointer in file list.">nav_filelist_set</a>( 0 , <a class="code" href="a00048.html#bc7fd11102a5b83b18fefaba9e846c10" title="move in list to previous file">FS_FIND_PREV</a> );
<a name="l00932"></a>00932    }<span class="keywordflow">else</span>{
<a name="l00933"></a>00933       <span class="comment">// No select file before, then reset position</span>
<a name="l00934"></a>00934       <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a>= <a class="code" href="a00025.html#2e16c6cfcb3174f7ad19ad3996a69ae7" title="Signal that a file entry isn&amp;#39;t selected.">FS_NO_SEL</a>;
<a name="l00935"></a>00935       <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#b0213ed9fc205b282b4c1d92adfa7460" title="File position in the file list (only used by navigation functions).">u16_pos_sel_file</a>           = <a class="code" href="a00025.html#2e16c6cfcb3174f7ad19ad3996a69ae7" title="Signal that a file entry isn&amp;#39;t selected.">FS_NO_SEL</a>;
<a name="l00936"></a>00936       <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#f36b5e65540c67c04d0ca489e2f52332" title="Navigation step ( FS_FILE or FS_DIR ).">b_mode_nav</a>                 = <a class="code" href="a00031.html#d043d9359eeca08e8c5ea4d9136eb15b">FS_DIR</a>;
<a name="l00937"></a>00937    }
<a name="l00938"></a>00938    <span class="keywordflow">return</span> FALSE;
<a name="l00939"></a>00939 }
<a name="l00940"></a>00940 
<a name="l00941"></a>00941 
<a name="l00947"></a><a class="code" href="a00048.html#c7da45cc8084fef48a1944772c146ff7">00947</a> Bool  <a class="code" href="a00047.html#c7da45cc8084fef48a1944772c146ff7" title="This function checks the beginning of file list.">nav_filelist_bol</a>( <span class="keywordtype">void</span> )
<a name="l00948"></a>00948 {
<a name="l00949"></a>00949    <span class="keywordflow">if</span>( FALSE == <a class="code" href="a00047.html#066eaff61613f07dc5fb1f3313747aef" title="This function moves the selection pointer in file list.">nav_filelist_set</a>( 0 , <a class="code" href="a00048.html#bc7fd11102a5b83b18fefaba9e846c10" title="move in list to previous file">FS_FIND_PREV</a> ) )
<a name="l00950"></a>00950       <span class="keywordflow">return</span> TRUE;   <span class="comment">// End of list or error (remark: the position haven't changed)</span>
<a name="l00951"></a>00951    <span class="comment">// Go to previous position</span>
<a name="l00952"></a>00952    <a class="code" href="a00047.html#066eaff61613f07dc5fb1f3313747aef" title="This function moves the selection pointer in file list.">nav_filelist_set</a>( 0 , <a class="code" href="a00048.html#793c4ce9436637d68ab25dc859abc35a" title="move in list to next file">FS_FIND_NEXT</a> );
<a name="l00953"></a>00953    <span class="keywordflow">return</span> FALSE;
<a name="l00954"></a>00954 }
<a name="l00955"></a>00955 
<a name="l00956"></a>00956 
<a name="l00965"></a><a class="code" href="a00048.html#d2c6198a0ef77a90abdc9c289f7a2218">00965</a> Bool  <a class="code" href="a00047.html#d2c6198a0ef77a90abdc9c289f7a2218" title="This function checks the presence of files or directories in file list.">nav_filelist_exist</a>( Bool b_type )
<a name="l00966"></a>00966 {
<a name="l00967"></a>00967    Bool status;
<a name="l00968"></a>00968    U16   u16_save_position;
<a name="l00969"></a>00969 
<a name="l00970"></a>00970    <span class="comment">// Save current position</span>
<a name="l00971"></a>00971    u16_save_position = <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#b0213ed9fc205b282b4c1d92adfa7460" title="File position in the file list (only used by navigation functions).">u16_pos_sel_file</a>;
<a name="l00972"></a>00972    <span class="comment">// Go to first file or directory</span>
<a name="l00973"></a>00973    status = <a class="code" href="a00047.html#6f711a14b01a8796caf8d6117d61ab09" title="This function goes to at the first file or directory in file list.">nav_filelist_first</a>( b_type );
<a name="l00974"></a>00974    <span class="comment">// Restore previous position</span>
<a name="l00975"></a>00975    <a class="code" href="a00047.html#7ad0aa092d133a156651abe5d871b8eb" title="This function resets the selection pointer, so &amp;quot;no file selected&amp;quot; in file...">nav_filelist_reset</a>();
<a name="l00976"></a>00976    <span class="keywordflow">if</span> ( u16_save_position != <a class="code" href="a00025.html#2e16c6cfcb3174f7ad19ad3996a69ae7" title="Signal that a file entry isn&amp;#39;t selected.">FS_NO_SEL</a> )
<a name="l00977"></a>00977    {
<a name="l00978"></a>00978       <a class="code" href="a00047.html#066eaff61613f07dc5fb1f3313747aef" title="This function moves the selection pointer in file list.">nav_filelist_set</a>( u16_save_position , <a class="code" href="a00048.html#793c4ce9436637d68ab25dc859abc35a" title="move in list to next file">FS_FIND_NEXT</a> );
<a name="l00979"></a>00979    }
<a name="l00980"></a>00980    <span class="keywordflow">return</span> status;
<a name="l00981"></a>00981 }
<a name="l00982"></a>00982 
<a name="l00983"></a>00983 
<a name="l00991"></a><a class="code" href="a00048.html#a3116b803ef078138f0d32ac2a92a8cf">00991</a> U16   <a class="code" href="a00047.html#a3116b803ef078138f0d32ac2a92a8cf" title="This function computes the number of files or directories in file list.">nav_filelist_nb</a>( Bool b_type )
<a name="l00992"></a>00992 {
<a name="l00993"></a>00993    U16   u16_save_position;
<a name="l00994"></a>00994    U16   u16_save_number_dir;
<a name="l00995"></a>00995    U16   u16_save_number_file;
<a name="l00996"></a>00996 
<a name="l00997"></a>00997    <span class="comment">// Save current position</span>
<a name="l00998"></a>00998    u16_save_position = <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#b0213ed9fc205b282b4c1d92adfa7460" title="File position in the file list (only used by navigation functions).">u16_pos_sel_file</a>;
<a name="l00999"></a>00999    <span class="comment">// Reset position</span>
<a name="l01000"></a>01000    <span class="keywordflow">if</span> ( !<a class="code" href="a00047.html#7ad0aa092d133a156651abe5d871b8eb" title="This function resets the selection pointer, so &amp;quot;no file selected&amp;quot; in file...">nav_filelist_reset</a>())
<a name="l01001"></a>01001       <span class="keywordflow">return</span> 0;
<a name="l01002"></a>01002    <span class="comment">// Scan all directory</span>
<a name="l01003"></a>01003    u16_save_number_dir  = 0;
<a name="l01004"></a>01004    u16_save_number_file = 0;
<a name="l01005"></a>01005    <span class="keywordflow">while</span>( <a class="code" href="a00047.html#066eaff61613f07dc5fb1f3313747aef" title="This function moves the selection pointer in file list.">nav_filelist_set</a>( 0 , <a class="code" href="a00048.html#793c4ce9436637d68ab25dc859abc35a" title="move in list to next file">FS_FIND_NEXT</a> ) )
<a name="l01006"></a>01006    {
<a name="l01007"></a>01007       <span class="keywordflow">if</span>( <a class="code" href="a00031.html#20f0a7ade1270e3923abafeb33864c55">FS_FILE</a> == <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#f36b5e65540c67c04d0ca489e2f52332" title="Navigation step ( FS_FILE or FS_DIR ).">b_mode_nav</a> )
<a name="l01008"></a>01008          u16_save_number_file++;    <span class="comment">// It is a file</span>
<a name="l01009"></a>01009       <span class="keywordflow">else</span>
<a name="l01010"></a>01010          u16_save_number_dir++;     <span class="comment">// It is a directory</span>
<a name="l01011"></a>01011    }
<a name="l01012"></a>01012    <span class="comment">// Restore previous position</span>
<a name="l01013"></a>01013    <a class="code" href="a00047.html#7ad0aa092d133a156651abe5d871b8eb" title="This function resets the selection pointer, so &amp;quot;no file selected&amp;quot; in file...">nav_filelist_reset</a>();
<a name="l01014"></a>01014    <span class="keywordflow">if</span> ( u16_save_position != <a class="code" href="a00025.html#2e16c6cfcb3174f7ad19ad3996a69ae7" title="Signal that a file entry isn&amp;#39;t selected.">FS_NO_SEL</a> )
<a name="l01015"></a>01015    {
<a name="l01016"></a>01016       <a class="code" href="a00047.html#066eaff61613f07dc5fb1f3313747aef" title="This function moves the selection pointer in file list.">nav_filelist_set</a>( u16_save_position , <a class="code" href="a00048.html#793c4ce9436637d68ab25dc859abc35a" title="move in list to next file">FS_FIND_NEXT</a> );
<a name="l01017"></a>01017    }
<a name="l01018"></a>01018    <span class="comment">// Return the value asked</span>
<a name="l01019"></a>01019    <span class="keywordflow">if</span>( <a class="code" href="a00031.html#20f0a7ade1270e3923abafeb33864c55">FS_FILE</a> == b_type )
<a name="l01020"></a>01020       <span class="keywordflow">return</span> u16_save_number_file;
<a name="l01021"></a>01021    <span class="keywordflow">else</span>
<a name="l01022"></a>01022       <span class="keywordflow">return</span> u16_save_number_dir;
<a name="l01023"></a>01023 }
<a name="l01024"></a>01024 
<a name="l01025"></a>01025 
<a name="l01034"></a><a class="code" href="a00048.html#6f711a14b01a8796caf8d6117d61ab09">01034</a> Bool  <a class="code" href="a00047.html#6f711a14b01a8796caf8d6117d61ab09" title="This function goes to at the first file or directory in file list.">nav_filelist_first</a>( Bool b_type )
<a name="l01035"></a>01035 {
<a name="l01036"></a>01036    <span class="comment">// Reset position</span>
<a name="l01037"></a>01037    <span class="keywordflow">if</span> ( !<a class="code" href="a00047.html#7ad0aa092d133a156651abe5d871b8eb" title="This function resets the selection pointer, so &amp;quot;no file selected&amp;quot; in file...">nav_filelist_reset</a>())
<a name="l01038"></a>01038       <span class="keywordflow">return</span> FALSE;
<a name="l01039"></a>01039    <span class="comment">// Find the first file or directory</span>
<a name="l01040"></a>01040    <span class="keywordflow">while</span>( <a class="code" href="a00047.html#066eaff61613f07dc5fb1f3313747aef" title="This function moves the selection pointer in file list.">nav_filelist_set</a>( 0 , <a class="code" href="a00048.html#793c4ce9436637d68ab25dc859abc35a" title="move in list to next file">FS_FIND_NEXT</a> ) )
<a name="l01041"></a>01041    {
<a name="l01042"></a>01042       <span class="keywordflow">if</span>( b_type == <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#f36b5e65540c67c04d0ca489e2f52332" title="Navigation step ( FS_FILE or FS_DIR ).">b_mode_nav</a> )
<a name="l01043"></a>01043          <span class="keywordflow">return</span> TRUE;   <span class="comment">// First file or directory found</span>
<a name="l01044"></a>01044    }
<a name="l01045"></a>01045    <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00031.html#1227e9d3b3f7f0c656cfbb9a0b7915f8" title="File no found.">FS_ERR_NO_FIND</a>;
<a name="l01046"></a>01046    <span class="keywordflow">return</span> FALSE;
<a name="l01047"></a>01047 }
<a name="l01048"></a>01048 
<a name="l01049"></a>01049 
<a name="l01058"></a><a class="code" href="a00048.html#d7dbd335c9b54a9ebefddf5308df0409">01058</a> Bool  <a class="code" href="a00047.html#d7dbd335c9b54a9ebefddf5308df0409" title="This function goes to at the last file or directory in file list.">nav_filelist_last</a>( Bool b_type )
<a name="l01059"></a>01059 {
<a name="l01060"></a>01060    U16 u16_nb;
<a name="l01061"></a>01061 
<a name="l01062"></a>01062    <span class="comment">// Get number of file or directory</span>
<a name="l01063"></a>01063    u16_nb = <a class="code" href="a00047.html#a3116b803ef078138f0d32ac2a92a8cf" title="This function computes the number of files or directories in file list.">nav_filelist_nb</a>( b_type  );
<a name="l01064"></a>01064    <span class="keywordflow">if</span>( 0 == u16_nb )
<a name="l01065"></a>01065    {
<a name="l01066"></a>01066       <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00031.html#1227e9d3b3f7f0c656cfbb9a0b7915f8" title="File no found.">FS_ERR_NO_FIND</a>;
<a name="l01067"></a>01067       <span class="keywordflow">return</span> FALSE;  <span class="comment">// NO FILE FOUND</span>
<a name="l01068"></a>01068    }
<a name="l01069"></a>01069    <span class="comment">// Go to the first file or directory</span>
<a name="l01070"></a>01070    <span class="keywordflow">if</span> ( !<a class="code" href="a00047.html#6f711a14b01a8796caf8d6117d61ab09" title="This function goes to at the first file or directory in file list.">nav_filelist_first</a>( b_type ))
<a name="l01071"></a>01071       <span class="keywordflow">return</span> FALSE;
<a name="l01072"></a>01072    <span class="comment">// If there are more one file or directory, then go to at the last of list</span>
<a name="l01073"></a>01073    <span class="keywordflow">if</span>( 1 == u16_nb )
<a name="l01074"></a>01074       <span class="keywordflow">return</span> TRUE;
<a name="l01075"></a>01075    u16_nb -= 2;
<a name="l01076"></a>01076    <span class="keywordflow">return</span> <a class="code" href="a00047.html#066eaff61613f07dc5fb1f3313747aef" title="This function moves the selection pointer in file list.">nav_filelist_set</a>( u16_nb , <a class="code" href="a00048.html#793c4ce9436637d68ab25dc859abc35a" title="move in list to next file">FS_FIND_NEXT</a> );
<a name="l01077"></a>01077 }
<a name="l01078"></a>01078 
<a name="l01079"></a>01079 
<a name="l01080"></a>01080 <span class="comment">//**********************************************************************</span>
<a name="l01081"></a>01081 <span class="comment">//************************ Index functions *****************************</span>
<a name="l01082"></a>01082 
<a name="l01083"></a>01083 
<a name="l01093"></a><a class="code" href="a00048.html#47882923fca657fb23001d23b6b5369d">01093</a> <a class="code" href="a00008.html">Fs_index</a> <a class="code" href="a00047.html#47882923fca657fb23001d23b6b5369d" title="This function returns a small index on the selected file.">nav_getindex</a>( <span class="keywordtype">void</span> )
<a name="l01094"></a>01094 {
<a name="l01095"></a>01095    <a class="code" href="a00008.html">Fs_index</a> index;
<a name="l01096"></a>01096 
<a name="l01097"></a>01097    <span class="comment">// Fill index structure</span>
<a name="l01098"></a>01098    index.<a class="code" href="a00008.html#899865da18622a376013236b67e60589" title="number of the logical driver">u8_lun</a>                  = <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a>;
<a name="l01099"></a>01099 <span class="preprocessor">#if (FS_MULTI_PARTITION  ==  ENABLED)</span>
<a name="l01100"></a>01100 <span class="preprocessor"></span>   index.<a class="code" href="a00008.html#b22d052cbc61c0a53fa3b69d66b5c554" title="number of the partition - 1 (0 or 1) (if FS_MULTI_PARTITION == ENABLED)">u8_partition</a>            = <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#af482bc02a186c363c37c93e169fbbd4" title="Number of partition - 1 (0 or 1).">u8_partition</a>;
<a name="l01101"></a>01101 <span class="preprocessor">#endif</span>
<a name="l01102"></a>01102 <span class="preprocessor"></span>   index.<a class="code" href="a00008.html#81c36fb7d9ef7ce58e5d61928b5d1881" title="first cluster of the directory corresponding at the selected file">u32_cluster_sel_dir</a>     = <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#ed8faad36e96ff2f422ddadd3740713f" title="First cluster number of selected directory (0 for the root directory).">u32_cluster_sel_dir</a>;
<a name="l01103"></a>01103    index.<a class="code" href="a00008.html#04ad3c4e9406002cd8e09cf9eaa9a9e0" title="entry offset of selected file in selected directory (unit = FS_SIZE_FILE_ENTRY)">u16_entry_pos_sel_file</a>  = <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a>;
<a name="l01104"></a>01104    <span class="keywordflow">return</span> index;
<a name="l01105"></a>01105 }
<a name="l01106"></a>01106 
<a name="l01107"></a>01107 
<a name="l01120"></a><a class="code" href="a00048.html#503f8d42be2b70cb554589ac7974ed78">01120</a> Bool  <a class="code" href="a00047.html#503f8d42be2b70cb554589ac7974ed78" title="This function selects a file in the navigator via a file index.">nav_gotoindex</a>( <span class="keyword">const</span> <a class="code" href="a00008.html">Fs_index</a> _MEM_TYPE_SLOW_ *index )
<a name="l01121"></a>01121 {
<a name="l01122"></a>01122    <span class="comment">// Select the drive and partition corresponding at file index</span>
<a name="l01123"></a>01123    <span class="keywordflow">if</span>( !<a class="code" href="a00047.html#dd247ba4e5086c74c6f106a55617872a" title="This function selects a drive in navigator but don&amp;#39;t mount the disk partition...">nav_drive_set</a>( index-&gt;u8_lun ))
<a name="l01124"></a>01124       <span class="keywordflow">return</span> FALSE;
<a name="l01125"></a>01125 <span class="preprocessor">#if (FS_MULTI_PARTITION  ==  ENABLED)</span>
<a name="l01126"></a>01126 <span class="preprocessor"></span>   <span class="keywordflow">if</span>( !<a class="code" href="a00047.html#43873b28f4ebbd1f092e7f702ee14c61" title="This function selects a partition on drive.">nav_partition_set</a>(index-&gt;u8_partition))
<a name="l01127"></a>01127       <span class="keywordflow">return</span> FALSE;
<a name="l01128"></a>01128 <span class="preprocessor">#endif</span>
<a name="l01129"></a>01129 <span class="preprocessor"></span>   <span class="keywordflow">if</span>( !<a class="code" href="a00047.html#aa10a2b4e4db0e4eb602b19b4f9ff9b9" title="This function mounts the selected partition.">nav_partition_mount</a>())
<a name="l01130"></a>01130       <span class="keywordflow">return</span> FALSE;
<a name="l01131"></a>01131 
<a name="l01132"></a>01132    <span class="comment">// Select the directory corresponding at file index</span>
<a name="l01133"></a>01133    <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#ed8faad36e96ff2f422ddadd3740713f" title="First cluster number of selected directory (0 for the root directory).">u32_cluster_sel_dir</a>   = index-&gt;u32_cluster_sel_dir;
<a name="l01134"></a>01134 
<a name="l01135"></a>01135    <span class="comment">// Search the file position corresponding at file index</span>
<a name="l01136"></a>01136    <span class="keywordflow">if</span> ( !<a class="code" href="a00047.html#7ad0aa092d133a156651abe5d871b8eb" title="This function resets the selection pointer, so &amp;quot;no file selected&amp;quot; in file...">nav_filelist_reset</a>())
<a name="l01137"></a>01137       <span class="keywordflow">return</span> FALSE;
<a name="l01138"></a>01138    <span class="keywordflow">while</span>( <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a> != index-&gt;u16_entry_pos_sel_file )
<a name="l01139"></a>01139    {
<a name="l01140"></a>01140       <span class="keywordflow">if</span>( !<a class="code" href="a00047.html#066eaff61613f07dc5fb1f3313747aef" title="This function moves the selection pointer in file list.">nav_filelist_set</a>( 0 , <a class="code" href="a00048.html#793c4ce9436637d68ab25dc859abc35a" title="move in list to next file">FS_FIND_NEXT</a> ) )
<a name="l01141"></a>01141       {
<a name="l01142"></a>01142          <a class="code" href="a00047.html#7ad0aa092d133a156651abe5d871b8eb" title="This function resets the selection pointer, so &amp;quot;no file selected&amp;quot; in file...">nav_filelist_reset</a>();
<a name="l01143"></a>01143          <span class="keywordflow">return</span> FALSE;
<a name="l01144"></a>01144       }
<a name="l01145"></a>01145    }
<a name="l01146"></a>01146    <span class="keywordflow">return</span> TRUE;
<a name="l01147"></a>01147 }
<a name="l01148"></a>01148 
<a name="l01149"></a>01149 
<a name="l01150"></a>01150 <span class="comment">//**********************************************************************</span>
<a name="l01151"></a>01151 <span class="comment">//************************ Directory functions *************************</span>
<a name="l01152"></a>01152 
<a name="l01153"></a>01153 
<a name="l01159"></a><a class="code" href="a00048.html#9447385c9c400b07b99c61ada1a6ea77">01159</a> Bool  <a class="code" href="a00047.html#9447385c9c400b07b99c61ada1a6ea77" title="This function initializes the file list on the root directory.">nav_dir_root</a>( <span class="keywordtype">void</span> )
<a name="l01160"></a>01160 {
<a name="l01161"></a>01161    <span class="keywordflow">return</span> <a class="code" href="a00047.html#aa10a2b4e4db0e4eb602b19b4f9ff9b9" title="This function mounts the selected partition.">nav_partition_mount</a>();
<a name="l01162"></a>01162 }
<a name="l01163"></a>01163 
<a name="l01164"></a>01164 
<a name="l01170"></a><a class="code" href="a00048.html#3f63edd511478579b8bfedeeb00042e6">01170</a> Bool  <a class="code" href="a00047.html#3f63edd511478579b8bfedeeb00042e6" title="This function check the current directory.">nav_dir_is_root</a>( <span class="keywordtype">void</span> )
<a name="l01171"></a>01171 {
<a name="l01172"></a>01172    <span class="keywordflow">if</span> (!<a class="code" href="a00024.html#e9d0f61d0e7b29a4e8e9e95347194f21" title="This function checks if the partition is mounted and no file is opened.">fat_check_mount_noopen</a>())
<a name="l01173"></a>01173       <span class="keywordflow">return</span> FALSE;
<a name="l01174"></a>01174 
<a name="l01175"></a>01175    <span class="keywordflow">return</span> (0 == <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#ed8faad36e96ff2f422ddadd3740713f" title="First cluster number of selected directory (0 for the root directory).">u32_cluster_sel_dir</a>);
<a name="l01176"></a>01176 }
<a name="l01177"></a>01177 
<a name="l01178"></a>01178 
<a name="l01189"></a><a class="code" href="a00048.html#dca006b356e65cb05459f7bd7917a1ed">01189</a> Bool  <a class="code" href="a00047.html#dca006b356e65cb05459f7bd7917a1ed" title="This function enters in the selected directory in file list.">nav_dir_cd</a>( <span class="keywordtype">void</span> )
<a name="l01190"></a>01190 {
<a name="l01191"></a>01191    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#003f1c81dcb2c7a95f191c30b8a4f258" title="This function checks if the partition is mounted and if no file is opened and a file...">fat_check_mount_select_noopen</a>())
<a name="l01192"></a>01192       <span class="keywordflow">return</span> FALSE;
<a name="l01193"></a>01193 
<a name="l01194"></a>01194    <span class="comment">// The current selection, is it a directory ?</span>
<a name="l01195"></a>01195    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#e0caae1c6e4a737af4ad0aa5d4171e79" title="This function checks if the entry file is a directory.">fat_entry_is_dir</a>())
<a name="l01196"></a>01196       <span class="keywordflow">return</span> FALSE;
<a name="l01197"></a>01197 
<a name="l01198"></a>01198    <span class="comment">// Select the current directory</span>
<a name="l01199"></a>01199    <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#47c03de42c9dd1a11a9a6592ddfab3ad" title="Position of selected directory in her parent directory (only use to speed up the...">u16_entry_pos_sel_dir</a> = <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a>;
<a name="l01200"></a>01200    <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#ed8faad36e96ff2f422ddadd3740713f" title="First cluster number of selected directory (0 for the root directory).">u32_cluster_sel_dir</a> = <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a>;
<a name="l01201"></a>01201 
<a name="l01202"></a>01202    <span class="comment">// Reset file list</span>
<a name="l01203"></a>01203    <span class="keywordflow">if</span>( FALSE == <a class="code" href="a00047.html#7ad0aa092d133a156651abe5d871b8eb" title="This function resets the selection pointer, so &amp;quot;no file selected&amp;quot; in file...">nav_filelist_reset</a>())
<a name="l01204"></a>01204       <span class="keywordflow">return</span> FALSE;
<a name="l01205"></a>01205    <span class="keywordflow">return</span> TRUE;
<a name="l01206"></a>01206 }
<a name="l01207"></a>01207 
<a name="l01208"></a>01208 
<a name="l01219"></a><a class="code" href="a00048.html#b37aa8fc84aca800a020da78724d729e">01219</a> Bool  <a class="code" href="a00047.html#b37aa8fc84aca800a020da78724d729e" title="This function goes to the parent directory.">nav_dir_gotoparent</a>( <span class="keywordtype">void</span> )
<a name="l01220"></a>01220 {
<a name="l01221"></a>01221    U32 u32_cluster_old_dir;
<a name="l01222"></a>01222 
<a name="l01223"></a>01223    <span class="keywordflow">if</span> (!<a class="code" href="a00024.html#e9d0f61d0e7b29a4e8e9e95347194f21" title="This function checks if the partition is mounted and no file is opened.">fat_check_mount_noopen</a>())
<a name="l01224"></a>01224       <span class="keywordflow">return</span> FALSE;
<a name="l01225"></a>01225 
<a name="l01226"></a>01226    <span class="keywordflow">if</span> (0 == <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#ed8faad36e96ff2f422ddadd3740713f" title="First cluster number of selected directory (0 for the root directory).">u32_cluster_sel_dir</a>)
<a name="l01227"></a>01227    {
<a name="l01228"></a>01228       <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00031.html#94e90e580e7ef16c72c2f2cb187af995" title="There aren&amp;#39;t parent because the current directory is a root directory.">FS_ERR_IS_ROOT</a>;        <span class="comment">// There aren't parent</span>
<a name="l01229"></a>01229       <span class="keywordflow">return</span> FALSE;
<a name="l01230"></a>01230    }
<a name="l01231"></a>01231 
<a name="l01232"></a>01232    <span class="comment">// Select and read information about directory ".."</span>
<a name="l01233"></a>01233    <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a> = 1;
<a name="l01234"></a>01234    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#1a35321a99150ba643f87cb6c79ec3e5" title="This function fill the internal cache with a sector from current directory.">fat_read_dir</a>())
<a name="l01235"></a>01235       <span class="keywordflow">return</span> FALSE;
<a name="l01236"></a>01236    <a class="code" href="a00024.html#56b68ed36f194500ce88c22252e3c317" title="This function reads information about selected file.">fat_get_entry_info</a>();
<a name="l01237"></a>01237    <span class="comment">// Save the children directory cluster</span>
<a name="l01238"></a>01238    u32_cluster_old_dir = <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#ed8faad36e96ff2f422ddadd3740713f" title="First cluster number of selected directory (0 for the root directory).">u32_cluster_sel_dir</a>;
<a name="l01239"></a>01239 
<a name="l01240"></a>01240    <span class="comment">// Select the parent directory via information present in the current directory ".."</span>
<a name="l01241"></a>01241    <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#ed8faad36e96ff2f422ddadd3740713f" title="First cluster number of selected directory (0 for the root directory).">u32_cluster_sel_dir</a> = <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a>;
<a name="l01242"></a>01242 
<a name="l01243"></a>01243    <span class="comment">// Select the children directory in new directory (=parent directory)</span>
<a name="l01244"></a>01244    <span class="keywordflow">if</span>( FALSE == <a class="code" href="a00047.html#7ad0aa092d133a156651abe5d871b8eb" title="This function resets the selection pointer, so &amp;quot;no file selected&amp;quot; in file...">nav_filelist_reset</a>())
<a name="l01245"></a>01245       <span class="keywordflow">return</span> FALSE;
<a name="l01246"></a>01246    <span class="keywordflow">if</span>( <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#a77329e481dd65221af40a8c26b6541b" title="Navigation File List provide only files or directories.">b_mode_nav_single</a> &amp;&amp; (<a class="code" href="a00031.html#d043d9359eeca08e8c5ea4d9136eb15b">FS_DIR</a> != <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#f36b5e65540c67c04d0ca489e2f52332" title="Navigation step ( FS_FILE or FS_DIR ).">b_mode_nav</a>) )
<a name="l01247"></a>01247       <span class="keywordflow">return</span> TRUE;
<a name="l01248"></a>01248    
<a name="l01249"></a>01249    <span class="keywordflow">while</span>( <a class="code" href="a00047.html#066eaff61613f07dc5fb1f3313747aef" title="This function moves the selection pointer in file list.">nav_filelist_set</a>( 0 , <a class="code" href="a00048.html#793c4ce9436637d68ab25dc859abc35a" title="move in list to next file">FS_FIND_NEXT</a> ) )
<a name="l01250"></a>01250    {
<a name="l01251"></a>01251       <span class="keywordflow">if</span> (<a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a> == u32_cluster_old_dir)
<a name="l01252"></a>01252          <span class="keywordflow">return</span> TRUE;         <span class="comment">// It is the children directory</span>
<a name="l01253"></a>01253    }
<a name="l01254"></a>01254    <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00031.html#89613ba21711697c707a3199bf93b9cf" title="File system error.">FS_ERR_FS</a>;
<a name="l01255"></a>01255    <span class="keywordflow">return</span> FALSE;
<a name="l01256"></a>01256 }
<a name="l01257"></a>01257 
<a name="l01258"></a>01258 
<a name="l01267"></a><a class="code" href="a00048.html#46a870ca37a6fb671f93596b9bc4b171">01267</a> Bool  <a class="code" href="a00047.html#46a870ca37a6fb671f93596b9bc4b171" title="This function returns the directory name corresponding at the file list.">nav_dir_name</a>( <a class="code" href="a00031.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> sz_path  , U8 u8_size_max  )
<a name="l01268"></a>01268 {
<a name="l01269"></a>01269    U8 u8_i, u8_character;
<a name="l01270"></a>01270    Bool status = FALSE;
<a name="l01271"></a>01271    U16 save_u16_entry_pos_sel_file;
<a name="l01272"></a>01272    U32 save_u32_cluster_sel_dir;
<a name="l01273"></a>01273    U8  save_u8_attr          ;
<a name="l01274"></a>01274    U32 save_u32_cluster      ;
<a name="l01275"></a>01275    U32 save_u32_size         ;
<a name="l01276"></a>01276    Bool b_mode_nav_single_save;
<a name="l01277"></a>01277    Bool b_mode_nav_mode_save;
<a name="l01278"></a>01278 
<a name="l01279"></a>01279    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#e9d0f61d0e7b29a4e8e9e95347194f21" title="This function checks if the partition is mounted and no file is opened.">fat_check_mount_noopen</a>())
<a name="l01280"></a>01280       <span class="keywordflow">return</span> FALSE;
<a name="l01281"></a>01281 
<a name="l01282"></a>01282    <span class="keywordflow">if</span> (0 != <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#ed8faad36e96ff2f422ddadd3740713f" title="First cluster number of selected directory (0 for the root directory).">u32_cluster_sel_dir</a>)
<a name="l01283"></a>01283    {
<a name="l01284"></a>01284       <span class="comment">// Save context</span>
<a name="l01285"></a>01285       save_u16_entry_pos_sel_file= <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a>;
<a name="l01286"></a>01286       save_u32_cluster_sel_dir   = <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#ed8faad36e96ff2f422ddadd3740713f" title="First cluster number of selected directory (0 for the root directory).">u32_cluster_sel_dir</a>        ;
<a name="l01287"></a>01287       save_u8_attr               = <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#c4f33191c9fd60c7520012bbe6005267" title="Attribut of the selected file.">u8_attr</a>              ;
<a name="l01288"></a>01288       save_u32_cluster           = <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a>          ;
<a name="l01289"></a>01289       save_u32_size              = <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#6ffedc3932826a337dfb3e656a09edcc" title="Size of selected file (unit Bytes).">u32_size</a>             ;
<a name="l01290"></a>01290       b_mode_nav_single_save = <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#a77329e481dd65221af40a8c26b6541b" title="Navigation File List provide only files or directories.">b_mode_nav_single</a>;
<a name="l01291"></a>01291       b_mode_nav_mode_save   = <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#f36b5e65540c67c04d0ca489e2f52332" title="Navigation step ( FS_FILE or FS_DIR ).">b_mode_nav</a>;
<a name="l01292"></a>01292       <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#a77329e481dd65221af40a8c26b6541b" title="Navigation File List provide only files or directories.">b_mode_nav_single</a> = TRUE;
<a name="l01293"></a>01293       <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#f36b5e65540c67c04d0ca489e2f52332" title="Navigation step ( FS_FILE or FS_DIR ).">b_mode_nav</a> = <a class="code" href="a00031.html#20f0a7ade1270e3923abafeb33864c55">FS_FILE</a>;
<a name="l01294"></a>01294       <span class="comment">// Go to parent directory and select the children directory</span>
<a name="l01295"></a>01295       <span class="keywordflow">if</span>( !<a class="code" href="a00047.html#b37aa8fc84aca800a020da78724d729e" title="This function goes to the parent directory.">nav_dir_gotoparent</a>() )
<a name="l01296"></a>01296       {
<a name="l01297"></a>01297          <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#a77329e481dd65221af40a8c26b6541b" title="Navigation File List provide only files or directories.">b_mode_nav_single</a> = b_mode_nav_single_save;
<a name="l01298"></a>01298          <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#f36b5e65540c67c04d0ca489e2f52332" title="Navigation step ( FS_FILE or FS_DIR ).">b_mode_nav</a> = b_mode_nav_mode_save;
<a name="l01299"></a>01299          <span class="keywordflow">return</span> FALSE;
<a name="l01300"></a>01300       }
<a name="l01301"></a>01301       <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#a77329e481dd65221af40a8c26b6541b" title="Navigation File List provide only files or directories.">b_mode_nav_single</a> = b_mode_nav_single_save ;
<a name="l01302"></a>01302       <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#f36b5e65540c67c04d0ca489e2f52332" title="Navigation step ( FS_FILE or FS_DIR ).">b_mode_nav</a> = b_mode_nav_mode_save;
<a name="l01303"></a>01303       <span class="comment">// Go to directory name position</span>
<a name="l01304"></a>01304       <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a> = <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#47c03de42c9dd1a11a9a6592ddfab3ad" title="Position of selected directory in her parent directory (only use to speed up the...">u16_entry_pos_sel_dir</a>;
<a name="l01305"></a>01305       status = <a class="code" href="a00047.html#10603c2fe89bd66a17cfe3bb49a3fa14" title="This function returns the name of selected file or checks the string with the name...">nav_file_name</a>( sz_path  , u8_size_max , <a class="code" href="a00031.html#a07ca9c4f511c7e1f326c27aeecb7178">FS_NAME_GET</a> , FALSE  );
<a name="l01306"></a>01306       <span class="comment">// Restore previous context</span>
<a name="l01307"></a>01307       <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a>= save_u16_entry_pos_sel_file;
<a name="l01308"></a>01308       <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#ed8faad36e96ff2f422ddadd3740713f" title="First cluster number of selected directory (0 for the root directory).">u32_cluster_sel_dir</a>        = save_u32_cluster_sel_dir   ;
<a name="l01309"></a>01309       <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#c4f33191c9fd60c7520012bbe6005267" title="Attribut of the selected file.">u8_attr</a>              = save_u8_attr               ;
<a name="l01310"></a>01310       <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a>          = save_u32_cluster           ;
<a name="l01311"></a>01311       <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#6ffedc3932826a337dfb3e656a09edcc" title="Size of selected file (unit Bytes).">u32_size</a>             = save_u32_size              ;
<a name="l01312"></a>01312    }
<a name="l01313"></a>01313    <span class="keywordflow">else</span>
<a name="l01314"></a>01314    {
<a name="l01315"></a>01315       <span class="comment">// No parent directory, then it is the root directory</span>
<a name="l01316"></a>01316       <span class="keywordflow">if</span>( <a class="code" href="a00025.html#6d450fc3016f0d8a7f5674d9e3a05c83" title="Variables to select LENGTH string mode (initialised in nav_reset()).">g_b_string_length</a> )
<a name="l01317"></a>01317       {
<a name="l01318"></a>01318          ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[0] = 3;  <span class="comment">// 3 chars for path "x:"</span>
<a name="l01319"></a>01319          status = TRUE;
<a name="l01320"></a>01320       }<span class="keywordflow">else</span>
<a name="l01321"></a>01321 
<a name="l01322"></a>01322       <span class="comment">// Create a device name</span>
<a name="l01323"></a>01323       <span class="keywordflow">for</span>( u8_i = 0 ; u8_i&lt;3 ; u8_i++ )
<a name="l01324"></a>01324       {
<a name="l01325"></a>01325          <span class="keywordflow">switch</span>( u8_i )
<a name="l01326"></a>01326          {
<a name="l01327"></a>01327             <span class="keywordflow">case</span> 0:
<a name="l01328"></a>01328             u8_character = <a class="code" href="a00047.html#cf3be5c3ce9b724a135162437642e091" title="This function returns the selected drive letter.">nav_drive_getname</a>();    <span class="comment">// Letter</span>
<a name="l01329"></a>01329             <span class="keywordflow">break</span>;
<a name="l01330"></a>01330             <span class="keywordflow">case</span> 1:
<a name="l01331"></a>01331             u8_character = <span class="charliteral">':'</span>;                     <span class="comment">// ":"</span>
<a name="l01332"></a>01332             <span class="keywordflow">break</span>;
<a name="l01333"></a>01333             <span class="keywordflow">case</span> 2:
<a name="l01334"></a>01334             <span class="keywordflow">default</span>:
<a name="l01335"></a>01335             u8_character = 0;                       <span class="comment">// end of string</span>
<a name="l01336"></a>01336             <span class="keywordflow">break</span>;
<a name="l01337"></a>01337          }
<a name="l01338"></a>01338          <span class="keywordflow">if</span>( <a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a> )
<a name="l01339"></a>01339          {
<a name="l01340"></a>01340             ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[0] = u8_character;
<a name="l01341"></a>01341          }<span class="keywordflow">else</span>{
<a name="l01342"></a>01342             sz_path [0] = u8_character;
<a name="l01343"></a>01343          }
<a name="l01344"></a>01344          sz_path  += (<a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>? 2 : 1 );
<a name="l01345"></a>01345       }
<a name="l01346"></a>01346       status = TRUE;
<a name="l01347"></a>01347 
<a name="l01348"></a>01348    }
<a name="l01349"></a>01349    <span class="keywordflow">return</span> status;
<a name="l01350"></a>01350 }
<a name="l01351"></a>01351 
<a name="l01352"></a>01352 
<a name="l01353"></a>01353 <span class="preprocessor">#if (FSFEATURE_WRITE_COMPLET == (FS_LEVEL_FEATURES &amp; FSFEATURE_WRITE_COMPLET))</span>
<a name="l01361"></a><a class="code" href="a00048.html#3e6857f4edb9c88949bd56e2233da650">01361</a> <span class="preprocessor">Bool  nav_dir_make( const FS_STRING sz_name  )</span>
<a name="l01362"></a>01362 <span class="preprocessor"></span>{
<a name="l01363"></a>01363    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#e9d0f61d0e7b29a4e8e9e95347194f21" title="This function checks if the partition is mounted and no file is opened.">fat_check_mount_noopen</a>())
<a name="l01364"></a>01364       <span class="keywordflow">return</span> FALSE;
<a name="l01365"></a>01365 
<a name="l01366"></a>01366    <span class="comment">// Create an entry file</span>
<a name="l01367"></a>01367    <span class="keywordflow">if</span> ( !<a class="code" href="a00047.html#27b550ee0cf2326498755b429818b145" title="This function creates a file with NULL size and NULL attribut.">nav_file_create</a>( sz_name ))
<a name="l01368"></a>01368       <span class="keywordflow">return</span> FALSE;
<a name="l01369"></a>01369 
<a name="l01370"></a>01370    <span class="comment">// Allocate one cluster for the new directory</span>
<a name="l01371"></a>01371    MSB0(<a class="code" href="a00025.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00014.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a>)=0xFF;    <span class="comment">// It is a new cluster list</span>
<a name="l01372"></a>01372    <a class="code" href="a00025.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00014.html#09c9847870bc2202980b54e38ea62fae" title="segment size (unit 512B), or position in cluster list (unit 512B)">u32_size_or_pos</a> = 1;    <span class="comment">// Only one sector (= one cluster)</span>
<a name="l01373"></a>01373    <span class="keywordflow">if</span> ( !<a class="code" href="a00025.html#1fa62b2728e71cff2e95556db7ed1b9c" title="This function allocs a cluster list.">fat_allocfreespace</a>())
<a name="l01374"></a>01374    {
<a name="l01375"></a>01375       <a class="code" href="a00025.html#797fc629a4a513e6a5f2951720da5d47" title="This function deletes the file entries and cluster list.">fat_delete_file</a>( FALSE );
<a name="l01376"></a>01376       <a class="code" href="a00024.html#578ab4800128cde17c0820a5027c1c06" title="This function flushs the sector cache on the memory if necessary.">fat_cache_flush</a>();
<a name="l01377"></a>01377       <span class="keywordflow">return</span> FALSE;
<a name="l01378"></a>01378    }
<a name="l01379"></a>01379    
<a name="l01380"></a>01380    <span class="comment">// Save information about the new directory</span>
<a name="l01381"></a>01381    <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a> = <a class="code" href="a00025.html#6d934f26f97b442c30712e57ee8b21e5" title="Variable frequently used by many function (optimization, no parameter in function)...">fs_g_seg</a>.<a class="code" href="a00014.html#da7b79119fecdfb1faab2512eb0ee172" title="segment address (unit 512B), or cluster number">u32_addr</a>; <span class="comment">// First cluster of the directory returned by alloc_free_space</span>
<a name="l01382"></a>01382    <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#6ffedc3932826a337dfb3e656a09edcc" title="Size of selected file (unit Bytes).">u32_size</a>    = 0;                 <span class="comment">// The directory size is null</span>
<a name="l01383"></a>01383    <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#c4f33191c9fd60c7520012bbe6005267" title="Attribut of the selected file.">u8_attr</a>     = <a class="code" href="a00031.html#99004e3e756391a7ac1c4dde4db6864c">FS_ATTR_DIRECTORY</a>; <span class="comment">// Directory attribut</span>
<a name="l01384"></a>01384 
<a name="l01385"></a>01385    <span class="comment">// Initialize the values in the new directory</span>
<a name="l01386"></a>01386    <span class="keywordflow">if</span> ( !<a class="code" href="a00025.html#9510bd193c1e70f2307c5b9b07078511" title="This function writes the directory information.">fat_initialize_dir</a>())
<a name="l01387"></a>01387       <span class="keywordflow">return</span> FALSE;
<a name="l01388"></a>01388 
<a name="l01389"></a>01389    <span class="comment">// Write directory information in her entry file</span>
<a name="l01390"></a>01390    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#1a35321a99150ba643f87cb6c79ec3e5" title="This function fill the internal cache with a sector from current directory.">fat_read_dir</a>())
<a name="l01391"></a>01391       <span class="keywordflow">return</span> FALSE;
<a name="l01392"></a>01392    <a class="code" href="a00024.html#40035dc41d435ed3281155cdf800cf02" title="This function writes the information about selected file.">fat_write_entry_file</a>();
<a name="l01393"></a>01393    <span class="keywordflow">if</span>( !<a class="code" href="a00024.html#578ab4800128cde17c0820a5027c1c06" title="This function flushs the sector cache on the memory if necessary.">fat_cache_flush</a>())
<a name="l01394"></a>01394       <span class="keywordflow">return</span> FALSE;
<a name="l01395"></a>01395 
<a name="l01396"></a>01396    <span class="comment">// Go to position of new directory (it is the last directory)</span>
<a name="l01397"></a>01397    <span class="keywordflow">return</span> <a class="code" href="a00047.html#d7dbd335c9b54a9ebefddf5308df0409" title="This function goes to at the last file or directory in file list.">nav_filelist_last</a>( <a class="code" href="a00031.html#d043d9359eeca08e8c5ea4d9136eb15b">FS_DIR</a> );
<a name="l01398"></a>01398 }
<a name="l01399"></a>01399 <span class="preprocessor">#endif  // FS_LEVEL_FEATURES</span>
<a name="l01400"></a>01400 <span class="preprocessor"></span>
<a name="l01401"></a>01401 
<a name="l01411"></a><a class="code" href="a00048.html#661d4a0464a9da163de1e07aa9196f0d">01411</a> Bool  <a class="code" href="a00047.html#661d4a0464a9da163de1e07aa9196f0d" title="This function returns the full path of the selection.">nav_getcwd</a>( <a class="code" href="a00031.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> sz_path  , U8 u8_size_path , Bool b_view_file_select  )
<a name="l01412"></a>01412 {
<a name="l01413"></a>01413    _MEM_TYPE_SLOW_   <a class="code" href="a00008.html">Fs_index</a> index;
<a name="l01414"></a>01414    _MEM_TYPE_SLOW_   U16 u16_lgt=0;    <span class="comment">// Only used if LENGTH string mode enabled</span>
<a name="l01415"></a>01415    U8 u8_save_size_path=0, u8_i;
<a name="l01416"></a>01416    Bool status = FALSE;                <span class="comment">// Error by default</span>
<a name="l01417"></a>01417 
<a name="l01418"></a>01418    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#e9d0f61d0e7b29a4e8e9e95347194f21" title="This function checks if the partition is mounted and no file is opened.">fat_check_mount_noopen</a>())
<a name="l01419"></a>01419       <span class="keywordflow">return</span> FALSE;
<a name="l01420"></a>01420 
<a name="l01421"></a>01421    index = <a class="code" href="a00047.html#47882923fca657fb23001d23b6b5369d" title="This function returns a small index on the selected file.">nav_getindex</a>();             <span class="comment">// Save current position</span>
<a name="l01422"></a>01422 
<a name="l01423"></a>01423    <span class="keywordflow">if</span>( <a class="code" href="a00025.html#6d450fc3016f0d8a7f5674d9e3a05c83" title="Variables to select LENGTH string mode (initialised in nav_reset()).">g_b_string_length</a> )
<a name="l01424"></a>01424    {
<a name="l01425"></a>01425       u16_lgt = 1;   <span class="comment">// 1 for NULL terminate</span>
<a name="l01426"></a>01426    }
<a name="l01427"></a>01427    <span class="keywordflow">else</span>
<a name="l01428"></a>01428    {
<a name="l01429"></a>01429       u8_save_size_path = u8_size_path;
<a name="l01430"></a>01430       <span class="comment">// Set NULL terminator at the end of path</span>
<a name="l01431"></a>01431       u8_size_path--;
<a name="l01432"></a>01432       <span class="keywordflow">if</span>( <a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a> )
<a name="l01433"></a>01433       {
<a name="l01434"></a>01434          ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[u8_size_path] = 0;
<a name="l01435"></a>01435       }<span class="keywordflow">else</span>{
<a name="l01436"></a>01436          sz_path [u8_size_path]   = 0;
<a name="l01437"></a>01437       }
<a name="l01438"></a>01438    }
<a name="l01439"></a>01439 
<a name="l01440"></a>01440    <span class="comment">// For each directory of path</span>
<a name="l01441"></a>01441    <span class="keywordflow">while</span>( 1 )
<a name="l01442"></a>01442    {
<a name="l01443"></a>01443       <span class="keywordflow">if</span>( b_view_file_select )
<a name="l01444"></a>01444       {
<a name="l01445"></a>01445          <span class="comment">// Write the selected file or directory in path</span>
<a name="l01446"></a>01446          b_view_file_select = FALSE;
<a name="l01447"></a>01447          <span class="keywordflow">if</span>( !<a class="code" href="a00024.html#909da9e84afbebf8ed5838cbe5002f60" title="This function checks if a file is selected on current navigator.">fat_check_select</a>() )
<a name="l01448"></a>01448             <span class="keywordflow">continue</span>;   <span class="comment">// No selected file or directory, then restart loop to go at the first directory of path</span>
<a name="l01449"></a>01449       }
<a name="l01450"></a>01450       <span class="keywordflow">else</span>
<a name="l01451"></a>01451       {
<a name="l01452"></a>01452          <span class="comment">// Go to parent directory and selects the children directory</span>
<a name="l01453"></a>01453          <span class="keywordflow">if</span>( !<a class="code" href="a00047.html#b37aa8fc84aca800a020da78724d729e" title="This function goes to the parent directory.">nav_dir_gotoparent</a>() )
<a name="l01454"></a>01454             <span class="keywordflow">break</span>;
<a name="l01455"></a>01455       }
<a name="l01456"></a>01456 
<a name="l01457"></a>01457       <span class="comment">// Read name of selected file or directory</span>
<a name="l01458"></a>01458       <span class="keywordflow">if</span>( !<a class="code" href="a00047.html#10603c2fe89bd66a17cfe3bb49a3fa14" title="This function returns the name of selected file or checks the string with the name...">nav_file_name</a>( sz_path  , u8_size_path , <a class="code" href="a00031.html#a07ca9c4f511c7e1f326c27aeecb7178">FS_NAME_GET</a>, FALSE  ))
<a name="l01459"></a>01459          <span class="keywordflow">break</span>;
<a name="l01460"></a>01460 
<a name="l01461"></a>01461       <span class="keywordflow">if</span>( <a class="code" href="a00025.html#6d450fc3016f0d8a7f5674d9e3a05c83" title="Variables to select LENGTH string mode (initialised in nav_reset()).">g_b_string_length</a> )
<a name="l01462"></a>01462       {
<a name="l01463"></a>01463          <span class="comment">// Update total length</span>
<a name="l01464"></a>01464          u16_lgt += ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[0]; <span class="comment">// 0 = -1 to remove NULL terminated and +1 for '\\'</span>
<a name="l01465"></a>01465          <span class="keywordflow">continue</span>;
<a name="l01466"></a>01466       }
<a name="l01467"></a>01467 
<a name="l01468"></a>01468       <span class="comment">// Compute the size of name</span>
<a name="l01469"></a>01469       u8_i = 0;
<a name="l01470"></a>01470       <span class="keywordflow">while</span>( 1 )
<a name="l01471"></a>01471       {
<a name="l01472"></a>01472          <span class="keywordflow">if</span>( <a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a> )
<a name="l01473"></a>01473          {
<a name="l01474"></a>01474             <span class="keywordflow">if</span>( 0 == ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[u8_i])
<a name="l01475"></a>01475                <span class="keywordflow">break</span>;
<a name="l01476"></a>01476          }<span class="keywordflow">else</span>{
<a name="l01477"></a>01477             <span class="keywordflow">if</span>( 0 == sz_path [u8_i])
<a name="l01478"></a>01478                <span class="keywordflow">break</span>;
<a name="l01479"></a>01479          }
<a name="l01480"></a>01480          u8_i++;
<a name="l01481"></a>01481       }
<a name="l01482"></a>01482 
<a name="l01483"></a>01483       <span class="comment">// Check the string size</span>
<a name="l01484"></a>01484       <span class="keywordflow">if</span>( (u8_i+1) == u8_size_path )
<a name="l01485"></a>01485       {
<a name="l01486"></a>01486          <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00031.html#51829972f3c3b325c18cdddec0962d77" title="Buffer is too small.">FS_ERR_BUFFER_FULL</a>;   <span class="comment">// The path string is full</span>
<a name="l01487"></a>01487          <span class="keywordflow">break</span>;
<a name="l01488"></a>01488       }
<a name="l01489"></a>01489 
<a name="l01490"></a>01490       <span class="comment">// Move the name at the end of path</span>
<a name="l01491"></a>01491       <span class="keywordflow">while</span>( 0 != u8_i )
<a name="l01492"></a>01492       {
<a name="l01493"></a>01493          u8_i--;
<a name="l01494"></a>01494          u8_size_path--;
<a name="l01495"></a>01495          <span class="keywordflow">if</span>( <a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a> )
<a name="l01496"></a>01496          {
<a name="l01497"></a>01497             ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[u8_size_path] = ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[u8_i];
<a name="l01498"></a>01498          }<span class="keywordflow">else</span>{
<a name="l01499"></a>01499             sz_path [u8_size_path]   = sz_path [u8_i];
<a name="l01500"></a>01500          }
<a name="l01501"></a>01501       }
<a name="l01502"></a>01502       <span class="comment">// Set '\' char before the name</span>
<a name="l01503"></a>01503       u8_size_path--;
<a name="l01504"></a>01504       <span class="keywordflow">if</span>( <a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a> )
<a name="l01505"></a>01505       {
<a name="l01506"></a>01506          ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[u8_size_path] = <span class="charliteral">'\\'</span>;
<a name="l01507"></a>01507       }<span class="keywordflow">else</span>{
<a name="l01508"></a>01508          sz_path [u8_size_path]   = <span class="charliteral">'\\'</span>;
<a name="l01509"></a>01509       }
<a name="l01510"></a>01510    }
<a name="l01511"></a>01511 
<a name="l01512"></a>01512    <span class="keywordflow">if</span> ( <a class="code" href="a00031.html#94e90e580e7ef16c72c2f2cb187af995" title="There aren&amp;#39;t parent because the current directory is a root directory.">FS_ERR_IS_ROOT</a> == <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> )
<a name="l01513"></a>01513    {
<a name="l01514"></a>01514       <span class="keywordflow">if</span>( <a class="code" href="a00025.html#6d450fc3016f0d8a7f5674d9e3a05c83" title="Variables to select LENGTH string mode (initialised in nav_reset()).">g_b_string_length</a> )
<a name="l01515"></a>01515       {
<a name="l01516"></a>01516          <span class="comment">// Update and write total length</span>
<a name="l01517"></a>01517          ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[0] = u16_lgt +2 ; <span class="comment">//+2 for "x:"</span>
<a name="l01518"></a>01518          status = TRUE;
<a name="l01519"></a>01519       }
<a name="l01520"></a>01520       <span class="keywordflow">else</span>
<a name="l01521"></a>01521       {
<a name="l01522"></a>01522          <span class="comment">// End of path then add device name</span>
<a name="l01523"></a>01523          <span class="keywordflow">if</span>( 2 &gt; u8_size_path )
<a name="l01524"></a>01524          {
<a name="l01525"></a>01525             <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00031.html#51829972f3c3b325c18cdddec0962d77" title="Buffer is too small.">FS_ERR_BUFFER_FULL</a>;   <span class="comment">// The path string is full</span>
<a name="l01526"></a>01526          }
<a name="l01527"></a>01527          <span class="keywordflow">else</span>
<a name="l01528"></a>01528          {
<a name="l01529"></a>01529             <span class="comment">// Create a device name</span>
<a name="l01530"></a>01530             <span class="keywordflow">if</span>( <a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a> )
<a name="l01531"></a>01531             {
<a name="l01532"></a>01532                ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[0] = <a class="code" href="a00047.html#cf3be5c3ce9b724a135162437642e091" title="This function returns the selected drive letter.">nav_drive_getname</a>();    <span class="comment">// Letter</span>
<a name="l01533"></a>01533                ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[1] = <span class="charliteral">':'</span>;                   <span class="comment">// ":"</span>
<a name="l01534"></a>01534             }<span class="keywordflow">else</span>{
<a name="l01535"></a>01535                sz_path [0] = <a class="code" href="a00047.html#cf3be5c3ce9b724a135162437642e091" title="This function returns the selected drive letter.">nav_drive_getname</a>();    <span class="comment">// Letter</span>
<a name="l01536"></a>01536                sz_path [1] = <span class="charliteral">':'</span>;                      <span class="comment">// ":"</span>
<a name="l01537"></a>01537             }
<a name="l01538"></a>01538 
<a name="l01539"></a>01539             <span class="comment">// The path is stored at the end, then move the path at the beginning</span>
<a name="l01540"></a>01540             u8_i = 2;
<a name="l01541"></a>01541             <span class="keywordflow">while</span>( u8_save_size_path != u8_size_path )
<a name="l01542"></a>01542             {
<a name="l01543"></a>01543                <span class="keywordflow">if</span>( <a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a> )
<a name="l01544"></a>01544                {
<a name="l01545"></a>01545                   ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[u8_i] = ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[u8_size_path];
<a name="l01546"></a>01546                }<span class="keywordflow">else</span>{
<a name="l01547"></a>01547                   sz_path [u8_i] = sz_path [u8_size_path];
<a name="l01548"></a>01548                }
<a name="l01549"></a>01549                u8_i++;
<a name="l01550"></a>01550                u8_size_path++;
<a name="l01551"></a>01551             }
<a name="l01552"></a>01552             status = TRUE;
<a name="l01553"></a>01553          }
<a name="l01554"></a>01554       }
<a name="l01555"></a>01555    } <span class="comment">// else Error system</span>
<a name="l01556"></a>01556 
<a name="l01557"></a>01557    <a class="code" href="a00047.html#503f8d42be2b70cb554589ac7974ed78" title="This function selects a file in the navigator via a file index.">nav_gotoindex</a>( &amp;index );   <span class="comment">// Restore the position</span>
<a name="l01558"></a>01558    <span class="keywordflow">return</span> status;
<a name="l01559"></a>01559 }
<a name="l01560"></a>01560 
<a name="l01561"></a>01561 
<a name="l01578"></a><a class="code" href="a00048.html#3d3f2ed17daf26a7aedc2a561cee2558">01578</a> Bool  <a class="code" href="a00047.html#3d3f2ed17daf26a7aedc2a561cee2558" title="This function selects a disk position via a path.">nav_setcwd</a>( <a class="code" href="a00031.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> sz_path , Bool b_match_case , Bool b_create )
<a name="l01579"></a>01579 {
<a name="l01580"></a>01580    _MEM_TYPE_SLOW_   <a class="code" href="a00008.html">Fs_index</a> index;
<a name="l01581"></a>01581 <span class="preprocessor">#if (FSFEATURE_WRITE == (FS_LEVEL_FEATURES &amp; FSFEATURE_WRITE)) ||              \</span>
<a name="l01582"></a>01582 <span class="preprocessor">    (FSFEATURE_WRITE_COMPLET == (FS_LEVEL_FEATURES &amp; FSFEATURE_WRITE_COMPLET))</span>
<a name="l01583"></a>01583 <span class="preprocessor"></span>   <a class="code" href="a00031.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> sz_save_path = 0;
<a name="l01584"></a>01584 <span class="preprocessor">#endif</span>
<a name="l01585"></a>01585 <span class="preprocessor"></span>   Bool b_create_name = FALSE;
<a name="l01586"></a>01586 
<a name="l01587"></a>01587    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#f6f4a9e2d8e7b6dd557871b6bc2c2ee0" title="This function checks if a file is not opened on current navigator.">fat_check_noopen</a>())
<a name="l01588"></a>01588       <span class="keywordflow">return</span> FALSE;
<a name="l01589"></a>01589 
<a name="l01590"></a>01590    index = <a class="code" href="a00047.html#47882923fca657fb23001d23b6b5369d" title="This function returns a small index on the selected file.">nav_getindex</a>();             <span class="comment">// Save current position</span>
<a name="l01591"></a>01591 
<a name="l01592"></a>01592    <span class="comment">// Check syntact "\path..."</span>
<a name="l01593"></a>01593    <span class="keywordflow">if</span>( (( <a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>) &amp;&amp; ((<span class="charliteral">'\\'</span>  == ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[0]) || (<span class="charliteral">'/'</span>  == ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[0])) )
<a name="l01594"></a>01594    ||  ((!<a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>) &amp;&amp; ((<span class="charliteral">'\\'</span>  == sz_path [0]) || (<span class="charliteral">'/'</span>  == sz_path [0])) ) )
<a name="l01595"></a>01595    {
<a name="l01596"></a>01596       <span class="comment">// Go to the root of current drive</span>
<a name="l01597"></a>01597       <span class="keywordflow">if</span>( !<a class="code" href="a00047.html#9447385c9c400b07b99c61ada1a6ea77" title="This function initializes the file list on the root directory.">nav_dir_root</a>())
<a name="l01598"></a>01598          <span class="keywordflow">goto</span> nav_setcwd_fail;
<a name="l01599"></a>01599       sz_path  += (<a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>? 2 : 1 );
<a name="l01600"></a>01600    }<span class="keywordflow">else</span>
<a name="l01601"></a>01601 
<a name="l01602"></a>01602    <span class="comment">// Check syntact "x:\path..."</span>
<a name="l01603"></a>01603    <span class="keywordflow">if</span>( (( <a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>) &amp;&amp; (( <span class="charliteral">':'</span>  == ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[1] ) &amp;&amp; ((<span class="charliteral">'\\'</span>  == ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[2] ) || (<span class="charliteral">'/'</span>  == ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[2]))) )
<a name="l01604"></a>01604    ||  ((!<a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>) &amp;&amp; (( <span class="charliteral">':'</span>  == sz_path [1] ) &amp;&amp; ((<span class="charliteral">'\\'</span>  == sz_path [2] ) || (<span class="charliteral">'/'</span>  == sz_path [2]))) ) )
<a name="l01605"></a>01605    {
<a name="l01606"></a>01606       <span class="comment">// Go to the drive</span>
<a name="l01607"></a>01607       <span class="keywordflow">if</span>( <a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a> )
<a name="l01608"></a>01608       {
<a name="l01609"></a>01609          <span class="keywordflow">if</span>( !<a class="code" href="a00047.html#dd247ba4e5086c74c6f106a55617872a" title="This function selects a drive in navigator but don&amp;#39;t mount the disk partition...">nav_drive_set</a>( toupper(((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[0])-<span class="charliteral">'A'</span> ) )
<a name="l01610"></a>01610             <span class="keywordflow">goto</span> nav_setcwd_fail;
<a name="l01611"></a>01611       }<span class="keywordflow">else</span>{
<a name="l01612"></a>01612          <span class="keywordflow">if</span>( !<a class="code" href="a00047.html#dd247ba4e5086c74c6f106a55617872a" title="This function selects a drive in navigator but don&amp;#39;t mount the disk partition...">nav_drive_set</a>( toupper(sz_path [0])-<span class="charliteral">'A'</span> ) )
<a name="l01613"></a>01613             <span class="keywordflow">goto</span> nav_setcwd_fail;
<a name="l01614"></a>01614       }
<a name="l01615"></a>01615       <span class="keywordflow">if</span>( !<a class="code" href="a00047.html#aa10a2b4e4db0e4eb602b19b4f9ff9b9" title="This function mounts the selected partition.">nav_partition_mount</a>())
<a name="l01616"></a>01616          <span class="keywordflow">goto</span> nav_setcwd_fail;
<a name="l01617"></a>01617       sz_path  += 3*(<a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>? 2 : 1 );
<a name="l01618"></a>01618    }<span class="keywordflow">else</span>
<a name="l01619"></a>01619 
<a name="l01620"></a>01620    <span class="comment">// Check syntact ".\path..."</span>
<a name="l01621"></a>01621    <span class="keywordflow">if</span>( (( <a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>) &amp;&amp; (( <span class="charliteral">'.'</span>  == ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[0] ) &amp;&amp; ((<span class="charliteral">'\\'</span>  == ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[1] ) || (<span class="charliteral">'/'</span>  == ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[1] ))) )
<a name="l01622"></a>01622    ||  ((!<a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>) &amp;&amp; (( <span class="charliteral">'.'</span>  == sz_path [0] ) &amp;&amp; ((<span class="charliteral">'\\'</span>  == sz_path [1] ) || (<span class="charliteral">'/'</span>  == sz_path [1] ))) ) )
<a name="l01623"></a>01623    {
<a name="l01624"></a>01624       <span class="comment">// Search in current directory</span>
<a name="l01625"></a>01625       sz_path  += 2*(<a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>? 2 : 1 );
<a name="l01626"></a>01626    }<span class="keywordflow">else</span>
<a name="l01627"></a>01627 
<a name="l01628"></a>01628    {
<a name="l01629"></a>01629       <span class="comment">// Check syntact "..\..\path..."</span>
<a name="l01630"></a>01630       <span class="keywordflow">if</span>( <a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a> )
<a name="l01631"></a>01631       {
<a name="l01632"></a>01632          <span class="keywordflow">while</span>(( <span class="charliteral">'.'</span>  == ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[0] )
<a name="l01633"></a>01633          &amp;&amp;    ( <span class="charliteral">'.'</span>  == ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[1] )
<a name="l01634"></a>01634          &amp;&amp;    ((<span class="charliteral">'\\'</span>  == ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[2]) || (<span class="charliteral">'/'</span>  == ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[2]) || (0  == ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[2])) )
<a name="l01635"></a>01635          {
<a name="l01636"></a>01636             <span class="comment">// Go to parent directory</span>
<a name="l01637"></a>01637             <span class="keywordflow">if</span>( !<a class="code" href="a00047.html#b37aa8fc84aca800a020da78724d729e" title="This function goes to the parent directory.">nav_dir_gotoparent</a>() )
<a name="l01638"></a>01638                <span class="keywordflow">goto</span> nav_setcwd_fail;
<a name="l01639"></a>01639             sz_path  += (2*2); <span class="comment">// jump ".."</span>
<a name="l01640"></a>01640             <span class="keywordflow">if</span>( 0 != ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[0])
<a name="l01641"></a>01641                sz_path  += (2*1); <span class="comment">// jump "/"</span>
<a name="l01642"></a>01642          }
<a name="l01643"></a>01643       }<span class="keywordflow">else</span>{
<a name="l01644"></a>01644          <span class="keywordflow">while</span>(( <span class="charliteral">'.'</span>  == sz_path [0] )
<a name="l01645"></a>01645          &amp;&amp;    ( <span class="charliteral">'.'</span>  == sz_path [1] )
<a name="l01646"></a>01646          &amp;&amp;    ((<span class="charliteral">'\\'</span>  == sz_path [2]) || (<span class="charliteral">'/'</span>  == sz_path [2]) || (0  == sz_path [2])) )
<a name="l01647"></a>01647          {
<a name="l01648"></a>01648          <span class="comment">// Go to parent directory</span>
<a name="l01649"></a>01649          <span class="keywordflow">if</span>( !<a class="code" href="a00047.html#b37aa8fc84aca800a020da78724d729e" title="This function goes to the parent directory.">nav_dir_gotoparent</a>() )
<a name="l01650"></a>01650             <span class="keywordflow">goto</span> nav_setcwd_fail;
<a name="l01651"></a>01651             sz_path  += 2; <span class="comment">// jump ".."</span>
<a name="l01652"></a>01652             <span class="keywordflow">if</span>( 0 != sz_path [0])
<a name="l01653"></a>01653                sz_path  +=1; <span class="comment">// jump "/"</span>
<a name="l01654"></a>01654          }
<a name="l01655"></a>01655       }
<a name="l01656"></a>01656    }
<a name="l01657"></a>01657 
<a name="l01658"></a>01658    <span class="comment">// Reset list to start the search at the beginning</span>
<a name="l01659"></a>01659    <span class="keywordflow">if</span>( !<a class="code" href="a00047.html#7ad0aa092d133a156651abe5d871b8eb" title="This function resets the selection pointer, so &amp;quot;no file selected&amp;quot; in file...">nav_filelist_reset</a>())
<a name="l01660"></a>01660       <span class="keywordflow">goto</span> nav_setcwd_fail;
<a name="l01661"></a>01661 
<a name="l01662"></a>01662    <span class="keywordflow">while</span>( 1 )
<a name="l01663"></a>01663    {
<a name="l01664"></a>01664       <span class="keywordflow">if</span>( (( <a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>) &amp;&amp; ( 0 == ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[0] ) )
<a name="l01665"></a>01665       ||  ((!<a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>) &amp;&amp; ( 0 == sz_path [0] ) ) )
<a name="l01666"></a>01666       {
<a name="l01667"></a>01667          <span class="keywordflow">return</span> TRUE;   <span class="comment">// path (without file) is found or create</span>
<a name="l01668"></a>01668       }
<a name="l01669"></a>01669       <span class="keywordflow">if</span>( !<a class="code" href="a00047.html#017ce6b53af128e5064a06bc8fadec25" title="This function searchs a file name in file list.">nav_filelist_findname</a>( sz_path  , b_match_case  ))
<a name="l01670"></a>01670       {
<a name="l01671"></a>01671          <span class="comment">// The file or directory is not found</span>
<a name="l01672"></a>01672          <span class="keywordflow">if</span>( !b_create )
<a name="l01673"></a>01673             <span class="keywordflow">goto</span> nav_setcwd_fail;   <span class="comment">// don't creat the directory then exit</span>
<a name="l01674"></a>01674          <span class="comment">// Set flag to create the directory</span>
<a name="l01675"></a>01675          b_create_name = TRUE;
<a name="l01676"></a>01676 <span class="preprocessor">#if (FSFEATURE_WRITE == (FS_LEVEL_FEATURES &amp; FSFEATURE_WRITE)) ||              \</span>
<a name="l01677"></a>01677 <span class="preprocessor">    (FSFEATURE_WRITE_COMPLET == (FS_LEVEL_FEATURES &amp; FSFEATURE_WRITE_COMPLET))</span>
<a name="l01678"></a>01678 <span class="preprocessor"></span>         sz_save_path = sz_path;
<a name="l01679"></a>01679 <span class="preprocessor">#endif</span>
<a name="l01680"></a>01680 <span class="preprocessor"></span>      }
<a name="l01681"></a>01681 
<a name="l01682"></a>01682       <span class="keywordflow">while</span>( 1 )
<a name="l01683"></a>01683       {
<a name="l01684"></a>01684          sz_path  += (<a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>? 2 : 1 );
<a name="l01685"></a>01685          <span class="keywordflow">if</span>( (( <a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>) &amp;&amp; ( 0 == ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[0] ) )
<a name="l01686"></a>01686          ||  ((!<a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>) &amp;&amp; ( 0 == sz_path [0] ) ) )
<a name="l01687"></a>01687          {
<a name="l01688"></a>01688             <span class="comment">// Is it the last name of path and it is a file</span>
<a name="l01689"></a>01689             <span class="keywordflow">if</span>( b_create_name )
<a name="l01690"></a>01690             {
<a name="l01691"></a>01691 <span class="preprocessor">#if (FSFEATURE_WRITE == (FS_LEVEL_FEATURES &amp; FSFEATURE_WRITE))</span>
<a name="l01692"></a>01692 <span class="preprocessor"></span>               <span class="comment">// The file must be created</span>
<a name="l01693"></a>01693                <span class="keywordflow">if</span>( !<a class="code" href="a00047.html#27b550ee0cf2326498755b429818b145" title="This function creates a file with NULL size and NULL attribut.">nav_file_create</a>( sz_save_path ) )
<a name="l01694"></a>01694                   <span class="keywordflow">goto</span> nav_setcwd_fail;
<a name="l01695"></a>01695 <span class="preprocessor">#else</span>
<a name="l01696"></a>01696 <span class="preprocessor"></span>               <span class="keywordflow">goto</span> nav_setcwd_fail;
<a name="l01697"></a>01697 <span class="preprocessor">#endif</span>
<a name="l01698"></a>01698 <span class="preprocessor"></span>            }
<a name="l01699"></a>01699             <span class="keywordflow">break</span>;   <span class="comment">// The file include in path is found or created, then end of set_cwd</span>
<a name="l01700"></a>01700          }
<a name="l01701"></a>01701 
<a name="l01702"></a>01702          <span class="keywordflow">if</span>( (( <a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>) &amp;&amp; ((<span class="charliteral">'\\'</span> == ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[0] ) || (<span class="charliteral">'/'</span> == ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_path )[0] )) )
<a name="l01703"></a>01703          ||  ((!<a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>) &amp;&amp; ((<span class="charliteral">'\\'</span> == sz_path [0] ) || (<span class="charliteral">'/'</span> == sz_path [0] )) ) )
<a name="l01704"></a>01704          {
<a name="l01705"></a>01705             <span class="comment">// Is it a folder name</span>
<a name="l01706"></a>01706             <span class="keywordflow">if</span>( b_create_name )
<a name="l01707"></a>01707             {
<a name="l01708"></a>01708 <span class="preprocessor">#if (FSFEATURE_WRITE_COMPLET == (FS_LEVEL_FEATURES &amp; FSFEATURE_WRITE_COMPLET))</span>
<a name="l01709"></a>01709 <span class="preprocessor"></span>               <span class="comment">// The folder doesn't exist and it must be created</span>
<a name="l01710"></a>01710                <span class="keywordflow">if</span>( !<a class="code" href="a00047.html#3e6857f4edb9c88949bd56e2233da650" title="This function creates a directory in the directory corresponding at file list.">nav_dir_make</a>( sz_save_path ))
<a name="l01711"></a>01711                   <span class="keywordflow">goto</span> nav_setcwd_fail;
<a name="l01712"></a>01712 <span class="preprocessor">#else</span>
<a name="l01713"></a>01713 <span class="preprocessor"></span>               <span class="keywordflow">goto</span> nav_setcwd_fail;
<a name="l01714"></a>01714 <span class="preprocessor">#endif</span>
<a name="l01715"></a>01715 <span class="preprocessor"></span>            }
<a name="l01716"></a>01716             <span class="keywordflow">if</span>( !<a class="code" href="a00024.html#e0caae1c6e4a737af4ad0aa5d4171e79" title="This function checks if the entry file is a directory.">fat_entry_is_dir</a>() )
<a name="l01717"></a>01717                <span class="keywordflow">goto</span> nav_setcwd_fail;
<a name="l01718"></a>01718             <span class="comment">// jump '\'</span>
<a name="l01719"></a>01719             sz_path  += (<a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>? 2 : 1 );
<a name="l01720"></a>01720             <span class="keywordflow">if</span>( !<a class="code" href="a00047.html#dca006b356e65cb05459f7bd7917a1ed" title="This function enters in the selected directory in file list.">nav_dir_cd</a>())
<a name="l01721"></a>01721                <span class="keywordflow">goto</span> nav_setcwd_fail;
<a name="l01722"></a>01722             <span class="keywordflow">break</span>;
<a name="l01723"></a>01723          }
<a name="l01724"></a>01724       }
<a name="l01725"></a>01725 
<a name="l01726"></a>01726    }
<a name="l01727"></a>01727 
<a name="l01728"></a>01728 nav_setcwd_fail:
<a name="l01729"></a>01729    <a class="code" href="a00047.html#503f8d42be2b70cb554589ac7974ed78" title="This function selects a file in the navigator via a file index.">nav_gotoindex</a>( &amp;index );   <span class="comment">// Restore the position</span>
<a name="l01730"></a>01730    <span class="keywordflow">return</span> FALSE;
<a name="l01731"></a>01731 }
<a name="l01732"></a>01732 
<a name="l01733"></a>01733 
<a name="l01734"></a>01734 
<a name="l01735"></a>01735 
<a name="l01736"></a>01736 <span class="comment">//**********************************************************************</span>
<a name="l01737"></a>01737 <span class="comment">//*********************** File control functions ***********************</span>
<a name="l01738"></a>01738 
<a name="l01739"></a>01739 
<a name="l01748"></a><a class="code" href="a00048.html#1331bfa6ff5961c4a1d8e890a29f23b0">01748</a> Bool <a class="code" href="a00047.html#1331bfa6ff5961c4a1d8e890a29f23b0" title="This function returns the name of selected file.">nav_file_getname</a>( <a class="code" href="a00031.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> sz_name, U8 u8_size_max )
<a name="l01749"></a>01749 {
<a name="l01750"></a>01750    <span class="keywordflow">return</span> <a class="code" href="a00047.html#10603c2fe89bd66a17cfe3bb49a3fa14" title="This function returns the name of selected file or checks the string with the name...">nav_file_name</a>( sz_name, u8_size_max, <a class="code" href="a00031.html#a07ca9c4f511c7e1f326c27aeecb7178">FS_NAME_GET</a>, FALSE );
<a name="l01751"></a>01751 }
<a name="l01752"></a>01752 
<a name="l01753"></a>01753 
<a name="l01769"></a><a class="code" href="a00048.html#10603c2fe89bd66a17cfe3bb49a3fa14">01769</a> Bool  <a class="code" href="a00047.html#10603c2fe89bd66a17cfe3bb49a3fa14" title="This function returns the name of selected file or checks the string with the name...">nav_file_name</a>( <a class="code" href="a00031.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> sz_name , U8 u8_size_max , Bool b_mode , Bool b_match_case  )
<a name="l01770"></a>01770 {
<a name="l01771"></a>01771    _MEM_TYPE_SLOW_   U16 u16_lgt;   <span class="comment">// Only used if LENGTH string mode enabled</span>
<a name="l01772"></a>01772    U16  u16_ptr_save_entry;
<a name="l01773"></a>01773    Bool  b_readshortname = FALSE;
<a name="l01774"></a>01774 
<a name="l01775"></a>01775    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#47e29fedbed4084c9f8ec6f27b51015d" title="This function checks if the partition is mounted and if a file is selected.">fat_check_mount_select</a>())
<a name="l01776"></a>01776       <span class="keywordflow">return</span> FALSE;
<a name="l01777"></a>01777 
<a name="l01778"></a>01778    <span class="comment">// Check if the string size is not 0</span>
<a name="l01779"></a>01779    <span class="keywordflow">if</span>( (<a class="code" href="a00031.html#a07ca9c4f511c7e1f326c27aeecb7178">FS_NAME_GET</a> == b_mode)
<a name="l01780"></a>01780    &amp;&amp;  (0 == u8_size_max) )
<a name="l01781"></a>01781    {
<a name="l01782"></a>01782       <span class="keywordflow">return</span> TRUE;
<a name="l01783"></a>01783    }
<a name="l01784"></a>01784 
<a name="l01785"></a>01785    <span class="comment">// Save the current entry position</span>
<a name="l01786"></a>01786    u16_ptr_save_entry = <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a>;
<a name="l01787"></a>01787    <span class="comment">// if it is the beginning of the directory</span>
<a name="l01788"></a>01788    <span class="keywordflow">if</span> ( 0 == <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a> )
<a name="l01789"></a>01789    {
<a name="l01790"></a>01790       b_readshortname = TRUE;                   <span class="comment">// It isn't possibled to have a long name</span>
<a name="l01791"></a>01791    }
<a name="l01792"></a>01792    <span class="keywordflow">else</span>
<a name="l01793"></a>01793    {
<a name="l01794"></a>01794       <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a>--;   <span class="comment">// Initialize entry position to search the first long name entry</span>
<a name="l01795"></a>01795    }
<a name="l01796"></a>01796 
<a name="l01797"></a>01797    <span class="comment">// Loop in directory entry</span>
<a name="l01798"></a>01798    u16_lgt = 0;
<a name="l01799"></a>01799    <span class="keywordflow">while</span>( 1 )
<a name="l01800"></a>01800    {
<a name="l01801"></a>01801       <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#1a35321a99150ba643f87cb6c79ec3e5" title="This function fill the internal cache with a sector from current directory.">fat_read_dir</a>())
<a name="l01802"></a>01802          <span class="keywordflow">break</span>; <span class="comment">// error</span>
<a name="l01803"></a>01803 
<a name="l01804"></a>01804       <span class="keywordflow">if</span> ( b_readshortname )
<a name="l01805"></a>01805       {
<a name="l01806"></a>01806          <span class="comment">// No long name present then read short name</span>
<a name="l01807"></a>01807          <span class="keywordflow">return</span> <a class="code" href="a00024.html#6bc798e9f4eac3457cc61e9cd9ba70b9" title="This function returns or compares the short name entry.">fat_entry_shortname</a>( sz_name , u8_size_max , b_mode  );
<a name="l01808"></a>01808       }
<a name="l01809"></a>01809 
<a name="l01810"></a>01810       <span class="comment">// Check or read the part of long file name in this entry</span>
<a name="l01811"></a>01811       <span class="keywordflow">if</span> ( <a class="code" href="a00024.html#c0bdbd911ecf04b3fcebbc2e4ae33166" title="This function returns or compares the long name entry.">fat_entry_longname</a>( sz_name , u8_size_max , b_mode , b_match_case  ))
<a name="l01812"></a>01812       {
<a name="l01813"></a>01813          <span class="keywordflow">if</span>( <a class="code" href="a00025.html#6d450fc3016f0d8a7f5674d9e3a05c83" title="Variables to select LENGTH string mode (initialised in nav_reset()).">g_b_string_length</a> )
<a name="l01814"></a>01814          {
<a name="l01815"></a>01815             ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)sz_name )[0] += u16_lgt;
<a name="l01816"></a>01816          }
<a name="l01817"></a>01817          <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a> = u16_ptr_save_entry;
<a name="l01818"></a>01818          <span class="keywordflow">return</span> TRUE;
<a name="l01819"></a>01819       }
<a name="l01820"></a>01820 
<a name="l01821"></a>01821       <span class="keywordflow">if</span> ( <a class="code" href="a00031.html#2dad540bd4ed9c78eff34ba269371d8d" title="The file entry isn&amp;#39;t the last long file entry.">FS_NO_LAST_LFN_ENTRY</a> != <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> )
<a name="l01822"></a>01822       {
<a name="l01823"></a>01823          <span class="comment">// Go to the main entry file (=short name entry)</span>
<a name="l01824"></a>01824          <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a> = u16_ptr_save_entry;
<a name="l01825"></a>01825 
<a name="l01826"></a>01826          <span class="keywordflow">if</span> ( <a class="code" href="a00031.html#934f48a8e1cb558d75ec00bbd242030d" title="File entry bad.">FS_ERR_ENTRY_BAD</a> == <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> )
<a name="l01827"></a>01827          {
<a name="l01828"></a>01828             <span class="comment">// It isn't a long name entry then there aren't long file name</span>
<a name="l01829"></a>01829             b_readshortname = TRUE;   <span class="comment">// It is mandatory to use the short name</span>
<a name="l01830"></a>01830             <span class="keywordflow">continue</span>;                 <span class="comment">// restart the loop</span>
<a name="l01831"></a>01831          }
<a name="l01832"></a>01832          <span class="comment">// here, it is a error system or the string don't match with the file name</span>
<a name="l01833"></a>01833          <span class="keywordflow">break</span>;
<a name="l01834"></a>01834       }
<a name="l01835"></a>01835       <span class="keywordflow">if</span>( <a class="code" href="a00025.html#6d450fc3016f0d8a7f5674d9e3a05c83" title="Variables to select LENGTH string mode (initialised in nav_reset()).">g_b_string_length</a> )
<a name="l01836"></a>01836       {
<a name="l01837"></a>01837          u16_lgt += <a class="code" href="a00025.html#bbdca2b90701f373bf6c865c88c99697">FS_SIZE_LFN_ENTRY</a>;
<a name="l01838"></a>01838       }
<a name="l01839"></a>01839       <span class="keywordflow">else</span>
<a name="l01840"></a>01840       {
<a name="l01841"></a>01841          <span class="comment">// Increment the string to store the next part of file name</span>
<a name="l01842"></a>01842          sz_name += <a class="code" href="a00025.html#bbdca2b90701f373bf6c865c88c99697">FS_SIZE_LFN_ENTRY</a> * (<a class="code" href="a00025.html#4ad00946d48b5c25c6734344ecf974c1">Is_unicode</a>? 2 : 1 );
<a name="l01843"></a>01843          u8_size_max -= <a class="code" href="a00025.html#bbdca2b90701f373bf6c865c88c99697">FS_SIZE_LFN_ENTRY</a>;
<a name="l01844"></a>01844       }
<a name="l01845"></a>01845       <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a>--;   <span class="comment">// Go to the next part of long file name</span>
<a name="l01846"></a>01846 
<a name="l01847"></a>01847    }  <span class="comment">// end of loop while(1)</span>
<a name="l01848"></a>01848    <span class="keywordflow">return</span> FALSE;
<a name="l01849"></a>01849 }
<a name="l01850"></a>01850 
<a name="l01851"></a>01851 
<a name="l01856"></a><a class="code" href="a00048.html#c3989dc4a26fbbdf0726fafae6fe4648">01856</a> U32   <a class="code" href="a00047.html#c3989dc4a26fbbdf0726fafae6fe4648" title="This function returns the size of selected file (unit byte).">nav_file_lgt</a>( <span class="keywordtype">void</span> )
<a name="l01857"></a>01857 {
<a name="l01858"></a>01858    <span class="keywordflow">return</span> <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#6ffedc3932826a337dfb3e656a09edcc" title="Size of selected file (unit Bytes).">u32_size</a>;
<a name="l01859"></a>01859 }
<a name="l01860"></a>01860 
<a name="l01861"></a>01861 
<a name="l01866"></a><a class="code" href="a00048.html#88385884567371f5d139c8f2b4b03a50">01866</a> U16   <a class="code" href="a00047.html#88385884567371f5d139c8f2b4b03a50" title="This function returns the size of selected file (unit sector).">nav_file_lgtsector</a>( <span class="keywordtype">void</span> )
<a name="l01867"></a>01867 {
<a name="l01868"></a>01868    <span class="keywordflow">return</span> (<a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#6ffedc3932826a337dfb3e656a09edcc" title="Size of selected file (unit Bytes).">u32_size</a> &gt;&gt; <a class="code" href="a00025.html#aee8167d49f58301e72fa2c546cd5b55">FS_512B_SHIFT_BIT</a>);
<a name="l01869"></a>01869 }
<a name="l01870"></a>01870 
<a name="l01871"></a>01871 
<a name="l01877"></a><a class="code" href="a00048.html#414f55acdda5d91d87d0959155c4e615">01877</a> Bool  <a class="code" href="a00047.html#414f55acdda5d91d87d0959155c4e615" title="This function checks the write protection of disk and the attribut &amp;quot;read only&amp;quot;...">nav_file_isreadonly</a>( <span class="keywordtype">void</span> )
<a name="l01878"></a>01878 {
<a name="l01879"></a>01879    <span class="keywordflow">if</span>( !<a class="code" href="a00024.html#47e29fedbed4084c9f8ec6f27b51015d" title="This function checks if the partition is mounted and if a file is selected.">fat_check_mount_select</a>() )
<a name="l01880"></a>01880       <span class="keywordflow">return</span> TRUE;   <span class="comment">// No file selected</span>
<a name="l01881"></a>01881    <span class="keywordflow">if</span>( <a class="code" href="a00022.html#f4b64acad5f46d01e082d7a7301078df" title="Returns the write-protection state of the memory.">mem_wr_protect</a>( <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#43065262a1a7560b143e0b48cbf5ccbd" title="Number of logical driver.">u8_lun</a> ) )
<a name="l01882"></a>01882       <span class="keywordflow">return</span> TRUE;   <span class="comment">// Disk protected</span>
<a name="l01883"></a>01883    <span class="keywordflow">return</span> (0!=(<a class="code" href="a00031.html#1205ff33f705779959e1bc40f6d8374f">FS_ATTR_READ_ONLY</a> &amp; <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#c4f33191c9fd60c7520012bbe6005267" title="Attribut of the selected file.">u8_attr</a>));   <span class="comment">// Check attribut "read only"</span>
<a name="l01884"></a>01884 }
<a name="l01885"></a>01885 
<a name="l01886"></a>01886 
<a name="l01892"></a><a class="code" href="a00048.html#0e9d8d4d0a438b0803c57c775e6c3b9c">01892</a> Bool  <a class="code" href="a00047.html#0e9d8d4d0a438b0803c57c775e6c3b9c" title="This function returns the type of selected file.">nav_file_isdir</a>( <span class="keywordtype">void</span> )
<a name="l01893"></a>01893 {
<a name="l01894"></a>01894    <span class="keywordflow">return</span> <a class="code" href="a00024.html#e0caae1c6e4a737af4ad0aa5d4171e79" title="This function checks if the entry file is a directory.">fat_entry_is_dir</a>();
<a name="l01895"></a>01895 }
<a name="l01896"></a>01896 
<a name="l01897"></a>01897 
<a name="l01905"></a><a class="code" href="a00048.html#4a3e65b107c26de2f7ff4fb1d2a854e3">01905</a> Bool  <a class="code" href="a00047.html#4a3e65b107c26de2f7ff4fb1d2a854e3" title="This function checks the extension of selected file.">nav_file_checkext</a>( <span class="keyword">const</span> <a class="code" href="a00031.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> sz_filterext )
<a name="l01906"></a>01906 {
<a name="l01907"></a>01907    <span class="keywordflow">if</span> ( <a class="code" href="a00024.html#47e29fedbed4084c9f8ec6f27b51015d" title="This function checks if the partition is mounted and if a file is selected.">fat_check_mount_select</a>() )
<a name="l01908"></a>01908    {
<a name="l01909"></a>01909       <span class="comment">// Read selected entry (=short name entry) in directory</span>
<a name="l01910"></a>01910       <span class="keywordflow">if</span> ( <a class="code" href="a00024.html#1a35321a99150ba643f87cb6c79ec3e5" title="This function fill the internal cache with a sector from current directory.">fat_read_dir</a>())
<a name="l01911"></a>01911       {
<a name="l01912"></a>01912          <span class="comment">// Check the extension with filter</span>
<a name="l01913"></a>01913          <span class="keywordflow">if</span> ( <a class="code" href="a00024.html#d690d22df98e6c1fa927c38b1d1a0fae" title="This function checks the file extension.">fat_entry_checkext</a>( (<a class="code" href="a00031.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a>) sz_filterext ) )
<a name="l01914"></a>01914             <span class="keywordflow">return</span> TRUE;
<a name="l01915"></a>01915       }
<a name="l01916"></a>01916    }
<a name="l01917"></a>01917    <span class="keywordflow">return</span> FALSE;
<a name="l01918"></a>01918 }
<a name="l01919"></a>01919 
<a name="l01920"></a>01920 
<a name="l01931"></a><a class="code" href="a00048.html#f3db073297dcfda3195606a50f2607e0">01931</a> Bool  <a class="code" href="a00047.html#f3db073297dcfda3195606a50f2607e0" title="This function returns the date of selected file.">nav_file_dateget</a>( <a class="code" href="a00031.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> sz_date , Bool type_date )
<a name="l01932"></a>01932 {
<a name="l01933"></a>01933    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#47e29fedbed4084c9f8ec6f27b51015d" title="This function checks if the partition is mounted and if a file is selected.">fat_check_mount_select</a>())
<a name="l01934"></a>01934       <span class="keywordflow">return</span> FALSE;
<a name="l01935"></a>01935 
<a name="l01936"></a>01936    <span class="comment">// Read selected entry in directory</span>
<a name="l01937"></a>01937    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#1a35321a99150ba643f87cb6c79ec3e5" title="This function fill the internal cache with a sector from current directory.">fat_read_dir</a>())
<a name="l01938"></a>01938       <span class="keywordflow">return</span> FALSE;
<a name="l01939"></a>01939    <a class="code" href="a00025.html#51041500c2e36ab39aad19b54e93d504" title="This function reads the information about a date.">fat_get_date</a>( sz_date , type_date );
<a name="l01940"></a>01940    <span class="keywordflow">return</span> TRUE;
<a name="l01941"></a>01941 }
<a name="l01942"></a>01942 
<a name="l01943"></a>01943 
<a name="l01948"></a><a class="code" href="a00048.html#577b3a7ebdc2c85ee56cbba554af9b87">01948</a> U8    <a class="code" href="a00047.html#577b3a7ebdc2c85ee56cbba554af9b87" title="This function returns the attribut of selected file.">nav_file_attributget</a>( <span class="keywordtype">void</span> )
<a name="l01949"></a>01949 {
<a name="l01950"></a>01950    <span class="keywordflow">return</span> <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#c4f33191c9fd60c7520012bbe6005267" title="Attribut of the selected file.">u8_attr</a>;
<a name="l01951"></a>01951 }
<a name="l01952"></a>01952 
<a name="l01953"></a>01953 
<a name="l01954"></a>01954 
<a name="l01955"></a>01955 <span class="preprocessor">#if (FSFEATURE_WRITE_COMPLET == (FS_LEVEL_FEATURES &amp; FSFEATURE_WRITE_COMPLET))</span>
<a name="l01966"></a><a class="code" href="a00048.html#2095f8c45dad704dfee904b360ebf45b">01966</a> <span class="preprocessor">Bool  nav_file_dateset( const FS_STRING sz_date , Bool type_date )</span>
<a name="l01967"></a>01967 <span class="preprocessor"></span>{
<a name="l01968"></a>01968    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#47e29fedbed4084c9f8ec6f27b51015d" title="This function checks if the partition is mounted and if a file is selected.">fat_check_mount_select</a>())
<a name="l01969"></a>01969       <span class="keywordflow">return</span> FALSE;
<a name="l01970"></a>01970 
<a name="l01971"></a>01971    <span class="comment">// Read selected entry in directory</span>
<a name="l01972"></a>01972    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#1a35321a99150ba643f87cb6c79ec3e5" title="This function fill the internal cache with a sector from current directory.">fat_read_dir</a>())
<a name="l01973"></a>01973       <span class="keywordflow">return</span> FALSE;
<a name="l01974"></a>01974    <a class="code" href="a00025.html#838253d384d03898e6fcb2b3a7687e43" title="This function changes the date information.">fat_set_date</a>( sz_date , type_date );
<a name="l01975"></a>01975    <span class="keywordflow">return</span> <a class="code" href="a00024.html#578ab4800128cde17c0820a5027c1c06" title="This function flushs the sector cache on the memory if necessary.">fat_cache_flush</a>();  <span class="comment">// To write all data and check write access before exit function</span>
<a name="l01976"></a>01976 }
<a name="l01977"></a>01977 <span class="preprocessor">#endif  // FS_LEVEL_FEATURES</span>
<a name="l01978"></a>01978 <span class="preprocessor"></span>
<a name="l01979"></a>01979 
<a name="l01980"></a>01980 <span class="preprocessor">#if (FSFEATURE_WRITE_COMPLET == (FS_LEVEL_FEATURES &amp; FSFEATURE_WRITE_COMPLET))</span>
<a name="l01988"></a><a class="code" href="a00048.html#2983932f3bf791ef93f633b5b786a04a">01988</a> <span class="preprocessor">Bool  nav_file_attributset( U8 u8_attribut )</span>
<a name="l01989"></a>01989 <span class="preprocessor"></span>{
<a name="l01990"></a>01990    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#47e29fedbed4084c9f8ec6f27b51015d" title="This function checks if the partition is mounted and if a file is selected.">fat_check_mount_select</a>())
<a name="l01991"></a>01991       <span class="keywordflow">return</span> FALSE;
<a name="l01992"></a>01992 
<a name="l01993"></a>01993    <span class="comment">// Read selected entry in directory</span>
<a name="l01994"></a>01994    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#1a35321a99150ba643f87cb6c79ec3e5" title="This function fill the internal cache with a sector from current directory.">fat_read_dir</a>())
<a name="l01995"></a>01995       <span class="keywordflow">return</span> FALSE;
<a name="l01996"></a>01996 
<a name="l01997"></a>01997    <span class="comment">// Write the new attribut</span>
<a name="l01998"></a>01998    <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#c4f33191c9fd60c7520012bbe6005267" title="Attribut of the selected file.">u8_attr</a> &amp;= (~(<a class="code" href="a00031.html#1205ff33f705779959e1bc40f6d8374f">FS_ATTR_READ_ONLY</a>|<a class="code" href="a00031.html#df87e26693107dd4b2f6f31327c6d52c">FS_ATTR_HIDDEN</a>|<a class="code" href="a00031.html#568a047cd2a5eb946b9ebb1f561cfa71">FS_ATTR_SYSTEM</a>|<a class="code" href="a00031.html#6983c8dea538d1ad6e43f7737f4776a3">FS_ATTR_ARCHIVE</a>));
<a name="l01999"></a>01999    <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#c4f33191c9fd60c7520012bbe6005267" title="Attribut of the selected file.">u8_attr</a> |= u8_attribut &amp; (<a class="code" href="a00031.html#1205ff33f705779959e1bc40f6d8374f">FS_ATTR_READ_ONLY</a>|<a class="code" href="a00031.html#df87e26693107dd4b2f6f31327c6d52c">FS_ATTR_HIDDEN</a>|<a class="code" href="a00031.html#568a047cd2a5eb946b9ebb1f561cfa71">FS_ATTR_SYSTEM</a>|<a class="code" href="a00031.html#6983c8dea538d1ad6e43f7737f4776a3">FS_ATTR_ARCHIVE</a>);
<a name="l02000"></a>02000    <a class="code" href="a00024.html#40035dc41d435ed3281155cdf800cf02" title="This function writes the information about selected file.">fat_write_entry_file</a>();
<a name="l02001"></a>02001    <span class="keywordflow">return</span> <a class="code" href="a00024.html#578ab4800128cde17c0820a5027c1c06" title="This function flushs the sector cache on the memory if necessary.">fat_cache_flush</a>();  <span class="comment">// To write all data and check write access before exit function</span>
<a name="l02002"></a>02002 }
<a name="l02003"></a>02003 <span class="preprocessor">#endif  // FS_LEVEL_FEATURES</span>
<a name="l02004"></a>02004 <span class="preprocessor"></span>
<a name="l02005"></a>02005 
<a name="l02006"></a>02006 <span class="preprocessor">#if (FSFEATURE_WRITE == (FS_LEVEL_FEATURES &amp; FSFEATURE_WRITE))</span>
<a name="l02016"></a><a class="code" href="a00048.html#8cf46891df029a9f3b62503d2c3cc065">02016</a> <span class="preprocessor">Bool  nav_file_del( Bool b_only_empty )</span>
<a name="l02017"></a>02017 <span class="preprocessor"></span>{
<a name="l02018"></a>02018    U8 u8_folder_level = 0xFF;
<a name="l02019"></a>02019 
<a name="l02020"></a>02020    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#003f1c81dcb2c7a95f191c30b8a4f258" title="This function checks if the partition is mounted and if no file is opened and a file...">fat_check_mount_select_noopen</a>())
<a name="l02021"></a>02021       <span class="keywordflow">return</span> FALSE;
<a name="l02022"></a>02022 
<a name="l02023"></a>02023    <span class="keywordflow">if</span>( 0xFF == u8_folder_level )  <span class="comment">// to remove a eventually compile warning</span>
<a name="l02024"></a>02024      <span class="keywordflow">goto</span> nav_file_del_test_dir_or_file;
<a name="l02025"></a>02025 
<a name="l02026"></a>02026    <span class="comment">// loop to scan and delete ALL folders and ALL files</span>
<a name="l02027"></a>02027    <span class="keywordflow">while</span>(1)
<a name="l02028"></a>02028    {
<a name="l02029"></a>02029       <span class="keywordflow">while</span>(1)
<a name="l02030"></a>02030       {
<a name="l02031"></a>02031          <span class="keywordflow">if</span>( <a class="code" href="a00047.html#066eaff61613f07dc5fb1f3313747aef" title="This function moves the selection pointer in file list.">nav_filelist_set</a>( 0 , <a class="code" href="a00048.html#793c4ce9436637d68ab25dc859abc35a" title="move in list to next file">FS_FIND_NEXT</a> ) )
<a name="l02032"></a>02032          {
<a name="l02033"></a>02033             <span class="comment">// Directory no empty</span>
<a name="l02034"></a>02034             <span class="keywordflow">if</span>( b_only_empty )
<a name="l02035"></a>02035             {
<a name="l02036"></a>02036                <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00031.html#4bd395871fad334222e972d4c62bf206" title="This function erases only file and empty directory.">FS_ERR_DIR_NOT_EMPTY</a>;      <span class="comment">// Erase only the empty directory</span>
<a name="l02037"></a>02037                <span class="keywordflow">return</span> FALSE;
<a name="l02038"></a>02038             }
<a name="l02039"></a>02039             <span class="keywordflow">break</span>; <span class="comment">// Exit loop to delete files or directories present</span>
<a name="l02040"></a>02040          }
<a name="l02041"></a>02041          <span class="comment">// HERE, directory empty</span>
<a name="l02042"></a>02042 
<a name="l02043"></a>02043          <span class="comment">// Go to parent directory and this one select the children directory</span>
<a name="l02044"></a>02044          <span class="keywordflow">if</span>( !<a class="code" href="a00047.html#b37aa8fc84aca800a020da78724d729e" title="This function goes to the parent directory.">nav_dir_gotoparent</a>() )
<a name="l02045"></a>02045             <span class="keywordflow">return</span> FALSE;
<a name="l02046"></a>02046 
<a name="l02047"></a>02047          <span class="comment">// Delete children directory name and her cluster list</span>
<a name="l02048"></a>02048          <span class="keywordflow">if</span> ( !<a class="code" href="a00025.html#797fc629a4a513e6a5f2951720da5d47" title="This function deletes the file entries and cluster list.">fat_delete_file</a>( TRUE ))
<a name="l02049"></a>02049             <span class="keywordflow">return</span> FALSE;
<a name="l02050"></a>02050 
<a name="l02051"></a>02051          <span class="keywordflow">if</span>( 0 == u8_folder_level )
<a name="l02052"></a>02052          {
<a name="l02053"></a>02053             <span class="comment">// All directory tree is deleted</span>
<a name="l02054"></a>02054             <span class="keywordflow">return</span> TRUE; <span class="comment">//********* END OF DEL TREE **************</span>
<a name="l02055"></a>02055          }
<a name="l02056"></a>02056          u8_folder_level--;
<a name="l02057"></a>02057 
<a name="l02058"></a>02058       } <span class="comment">// end of second while (1)</span>
<a name="l02059"></a>02059 
<a name="l02060"></a>02060 nav_file_del_test_dir_or_file:
<a name="l02061"></a>02061       <span class="keywordflow">if</span>( <a class="code" href="a00047.html#0e9d8d4d0a438b0803c57c775e6c3b9c" title="This function returns the type of selected file.">nav_file_isdir</a>())
<a name="l02062"></a>02062       {
<a name="l02063"></a>02063          <span class="comment">// here, a directory is found and is selected</span>
<a name="l02064"></a>02064          <span class="keywordflow">if</span>( !<a class="code" href="a00047.html#dca006b356e65cb05459f7bd7917a1ed" title="This function enters in the selected directory in file list.">nav_dir_cd</a>())
<a name="l02065"></a>02065             <span class="keywordflow">return</span> FALSE;
<a name="l02066"></a>02066          u8_folder_level++;
<a name="l02067"></a>02067       }
<a name="l02068"></a>02068       <span class="keywordflow">else</span>
<a name="l02069"></a>02069       {
<a name="l02070"></a>02070          <span class="comment">// here, a file is found and is selected</span>
<a name="l02071"></a>02071          <span class="keywordflow">if</span>( !<a class="code" href="a00024.html#07f36d38eda0af16ef7ef899129d7e7b" title="This function checks all access at current file.">fat_check_nav_access_file</a>( TRUE ) )
<a name="l02072"></a>02072             <span class="keywordflow">return</span> FALSE;
<a name="l02073"></a>02073          <span class="comment">// delete file entry name and cluster list</span>
<a name="l02074"></a>02074          <span class="keywordflow">if</span> ( !<a class="code" href="a00025.html#797fc629a4a513e6a5f2951720da5d47" title="This function deletes the file entries and cluster list.">fat_delete_file</a>( TRUE ))
<a name="l02075"></a>02075             <span class="keywordflow">return</span> FALSE;
<a name="l02076"></a>02076          <span class="keywordflow">if</span>( 0xFF == u8_folder_level )
<a name="l02077"></a>02077             <span class="keywordflow">break</span>;   <span class="comment">// only one file to delete</span>
<a name="l02078"></a>02078       } <span class="comment">// if dir OR file</span>
<a name="l02079"></a>02079    } <span class="comment">// end of first while(1)</span>
<a name="l02080"></a>02080 
<a name="l02081"></a>02081    <span class="comment">// Reset selection</span>
<a name="l02082"></a>02082    <a class="code" href="a00047.html#7ad0aa092d133a156651abe5d871b8eb" title="This function resets the selection pointer, so &amp;quot;no file selected&amp;quot; in file...">nav_filelist_reset</a>();
<a name="l02083"></a>02083    <span class="keywordflow">return</span> <a class="code" href="a00024.html#578ab4800128cde17c0820a5027c1c06" title="This function flushs the sector cache on the memory if necessary.">fat_cache_flush</a>();  <span class="comment">// To write all data and check write access before exit function</span>
<a name="l02084"></a>02084 }
<a name="l02085"></a>02085 <span class="preprocessor">#endif  // FS_LEVEL_FEATURES</span>
<a name="l02086"></a>02086 <span class="preprocessor"></span>
<a name="l02087"></a>02087 
<a name="l02088"></a>02088 <span class="preprocessor">#if (FSFEATURE_WRITE_COMPLET == (FS_LEVEL_FEATURES &amp; FSFEATURE_WRITE_COMPLET))</span>
<a name="l02096"></a><a class="code" href="a00048.html#db4a11790eddec97933f80ea44dbefa8">02096</a> <span class="preprocessor">Bool  nav_file_rename( const FS_STRING sz_name  )</span>
<a name="l02097"></a>02097 <span class="preprocessor"></span>{
<a name="l02098"></a>02098    U16 u16_save_entry_pos;
<a name="l02099"></a>02099    Bool b_save_entry_type;
<a name="l02100"></a>02100    U8 u8_attr;
<a name="l02101"></a>02101    U32 u32_cluster;
<a name="l02102"></a>02102    U32 u32_size;
<a name="l02103"></a>02103 
<a name="l02104"></a>02104    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#003f1c81dcb2c7a95f191c30b8a4f258" title="This function checks if the partition is mounted and if no file is opened and a file...">fat_check_mount_select_noopen</a>())
<a name="l02105"></a>02105       <span class="keywordflow">return</span> FALSE;
<a name="l02106"></a>02106 
<a name="l02107"></a>02107    <span class="keywordflow">if</span>( !<a class="code" href="a00024.html#07f36d38eda0af16ef7ef899129d7e7b" title="This function checks all access at current file.">fat_check_nav_access_file</a>( TRUE ) )
<a name="l02108"></a>02108       <span class="keywordflow">return</span> FALSE;
<a name="l02109"></a>02109 
<a name="l02110"></a>02110    <span class="comment">// Note: in case of error, create the new name before delete the current name</span>
<a name="l02111"></a>02111 
<a name="l02112"></a>02112    <span class="comment">// Save information about current name poisition</span>
<a name="l02113"></a>02113    u16_save_entry_pos = <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a>;
<a name="l02114"></a>02114    b_save_entry_type  = <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#f36b5e65540c67c04d0ca489e2f52332" title="Navigation step ( FS_FILE or FS_DIR ).">b_mode_nav</a>;
<a name="l02115"></a>02115    <span class="comment">// Save information about file</span>
<a name="l02116"></a>02116    u8_attr           = <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#c4f33191c9fd60c7520012bbe6005267" title="Attribut of the selected file.">u8_attr</a>;
<a name="l02117"></a>02117    u32_cluster       = <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a>;
<a name="l02118"></a>02118    u32_size          = <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#6ffedc3932826a337dfb3e656a09edcc" title="Size of selected file (unit Bytes).">u32_size</a>;
<a name="l02119"></a>02119 
<a name="l02120"></a>02120    <span class="comment">// Create a name</span>
<a name="l02121"></a>02121    <span class="keywordflow">if</span> ( !<a class="code" href="a00047.html#27b550ee0cf2326498755b429818b145" title="This function creates a file with NULL size and NULL attribut.">nav_file_create</a>( sz_name  ))
<a name="l02122"></a>02122       <span class="keywordflow">return</span> FALSE; <span class="comment">// error</span>
<a name="l02123"></a>02123    <span class="comment">// Restore information about file or directory on the new name entry</span>
<a name="l02124"></a>02124    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#1a35321a99150ba643f87cb6c79ec3e5" title="This function fill the internal cache with a sector from current directory.">fat_read_dir</a>())
<a name="l02125"></a>02125       <span class="keywordflow">return</span> FALSE;
<a name="l02126"></a>02126    <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#c4f33191c9fd60c7520012bbe6005267" title="Attribut of the selected file.">u8_attr</a> = u8_attr;
<a name="l02127"></a>02127    <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a> = u32_cluster;
<a name="l02128"></a>02128    <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#6ffedc3932826a337dfb3e656a09edcc" title="Size of selected file (unit Bytes).">u32_size</a> = u32_size;
<a name="l02129"></a>02129    <a class="code" href="a00024.html#40035dc41d435ed3281155cdf800cf02" title="This function writes the information about selected file.">fat_write_entry_file</a>();
<a name="l02130"></a>02130 
<a name="l02131"></a>02131    <span class="comment">// Delete old entry name</span>
<a name="l02132"></a>02132    <a class="code" href="a00025.html#14ab00294275fb02f822b22d7dcc6b13">fs_g_nav_fast</a>.<a class="code" href="a00011.html#9f50297ed427918e54da99b8c4fbaf04" title="Entry file position in directory (unit = FS_SIZE_FILE_ENTRY) (see value FS_NO_SEL...">u16_entry_pos_sel_file</a> = u16_save_entry_pos; <span class="comment">// go to old entry name</span>
<a name="l02133"></a>02133    <span class="keywordflow">if</span> ( !<a class="code" href="a00025.html#797fc629a4a513e6a5f2951720da5d47" title="This function deletes the file entries and cluster list.">fat_delete_file</a>(FALSE) )
<a name="l02134"></a>02134       <span class="keywordflow">return</span> FALSE;
<a name="l02135"></a>02135    <span class="keywordflow">if</span> ( !<a class="code" href="a00024.html#578ab4800128cde17c0820a5027c1c06" title="This function flushs the sector cache on the memory if necessary.">fat_cache_flush</a>() )
<a name="l02136"></a>02136       <span class="keywordflow">return</span> FALSE;
<a name="l02137"></a>02137 
<a name="l02138"></a>02138    <span class="comment">// Go to at the position of the new name entry (it is the last file or directory )</span>
<a name="l02139"></a>02139    <span class="keywordflow">return</span> <a class="code" href="a00047.html#d7dbd335c9b54a9ebefddf5308df0409" title="This function goes to at the last file or directory in file list.">nav_filelist_last</a>( b_save_entry_type );
<a name="l02140"></a>02140 }
<a name="l02141"></a>02141 <span class="preprocessor">#endif  // FS_LEVEL_FEATURES</span>
<a name="l02142"></a>02142 <span class="preprocessor"></span>
<a name="l02143"></a>02143 <span class="preprocessor">#if (FSFEATURE_WRITE == (FS_LEVEL_FEATURES &amp; FSFEATURE_WRITE))</span>
<a name="l02144"></a>02144 <span class="preprocessor"></span>
<a name="l02156"></a><a class="code" href="a00048.html#27b550ee0cf2326498755b429818b145">02156</a> Bool  <a class="code" href="a00047.html#27b550ee0cf2326498755b429818b145" title="This function creates a file with NULL size and NULL attribut.">nav_file_create</a>( <span class="keyword">const</span> <a class="code" href="a00031.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> sz_name  )
<a name="l02157"></a>02157 {
<a name="l02158"></a>02158    <span class="comment">// Check if the name already exists</span>
<a name="l02159"></a>02159    <span class="keywordflow">if</span> (!<a class="code" href="a00047.html#7ad0aa092d133a156651abe5d871b8eb" title="This function resets the selection pointer, so &amp;quot;no file selected&amp;quot; in file...">nav_filelist_reset</a>())
<a name="l02160"></a>02160       <span class="keywordflow">return</span> FALSE;
<a name="l02161"></a>02161    <span class="keywordflow">if</span> (<a class="code" href="a00047.html#017ce6b53af128e5064a06bc8fadec25" title="This function searchs a file name in file list.">nav_filelist_findname</a>(sz_name , FALSE))
<a name="l02162"></a>02162    {
<a name="l02163"></a>02163       <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00031.html#620feae4af460b0f591356b6408e7b45" title="The file is already existed.">FS_ERR_FILE_EXIST</a>;
<a name="l02164"></a>02164       <span class="keywordflow">return</span> FALSE;  <span class="comment">// File exist -&gt; it is not possible to create this name</span>
<a name="l02165"></a>02165    }
<a name="l02166"></a>02166    <span class="comment">// FYC: here, the selection is at the end of the list</span>
<a name="l02167"></a>02167    <span class="comment">// Create name entrys</span>
<a name="l02168"></a>02168    <span class="keywordflow">if</span> ( !<a class="code" href="a00025.html#da2110d711208b46e93eb269da40bdf1" title="This function creates the short and the long name of a new entry.">fat_create_entry_file_name</a>( sz_name ))
<a name="l02169"></a>02169       <span class="keywordflow">return</span> FALSE; <span class="comment">// error</span>
<a name="l02170"></a>02170    <span class="comment">// By default the information about the new file is NULL</span>
<a name="l02171"></a>02171    <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#eaa27a06eca82fa0f65d848def8a4b87" title="First cluster of the selected file.">u32_cluster</a> = 0;     <span class="comment">// No first cluster</span>
<a name="l02172"></a>02172    <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#6ffedc3932826a337dfb3e656a09edcc" title="Size of selected file (unit Bytes).">u32_size</a>    = 0;     <span class="comment">// The size is null</span>
<a name="l02173"></a>02173    <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#c4f33191c9fd60c7520012bbe6005267" title="Attribut of the selected file.">u8_attr</a>     = 0;     <span class="comment">// Attribut is a file</span>
<a name="l02174"></a>02174 
<a name="l02175"></a>02175    <span class="comment">// It is the last FILE of the list</span>
<a name="l02176"></a>02176    <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#b0213ed9fc205b282b4c1d92adfa7460" title="File position in the file list (only used by navigation functions).">u16_pos_sel_file</a>++;
<a name="l02177"></a>02177    <a class="code" href="a00025.html#5c5e563664aa146853ff976ce0b412ec">fs_g_nav</a>.<a class="code" href="a00009.html#f36b5e65540c67c04d0ca489e2f52332" title="Navigation step ( FS_FILE or FS_DIR ).">b_mode_nav</a> = <a class="code" href="a00031.html#20f0a7ade1270e3923abafeb33864c55">FS_FILE</a>;
<a name="l02178"></a>02178    <span class="keywordflow">return</span> <a class="code" href="a00024.html#578ab4800128cde17c0820a5027c1c06" title="This function flushs the sector cache on the memory if necessary.">fat_cache_flush</a>();
<a name="l02179"></a>02179 }
<a name="l02180"></a>02180 
<a name="l02181"></a>02181 
<a name="l02191"></a><a class="code" href="a00048.html#13a6b054cd7e59bd3e916702f35f7dde">02191</a> Bool  <a class="code" href="a00047.html#13a6b054cd7e59bd3e916702f35f7dde" title="This function updates the COPY navigator with the selected file.">nav_file_copy</a>( <span class="keywordtype">void</span> )
<a name="l02192"></a>02192 {
<a name="l02193"></a>02193    <span class="keywordflow">if</span>( <a class="code" href="a00047.html#0e9d8d4d0a438b0803c57c775e6c3b9c" title="This function returns the type of selected file.">nav_file_isdir</a>() )
<a name="l02194"></a>02194    {
<a name="l02195"></a>02195       <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00031.html#0ecd8f596c1810209c4428aa28be0850" title="Directory copy is not supported.">FS_ERR_COPY_DIR</a>; <span class="comment">// Impossible to copy a directory</span>
<a name="l02196"></a>02196       <span class="keywordflow">return</span> FALSE;
<a name="l02197"></a>02197    }
<a name="l02198"></a>02198    <span class="comment">// In "copy file" navigator select the file</span>
<a name="l02199"></a>02199    <a class="code" href="a00047.html#3b58f8c4afeb6714cd2c7eb61058da0d" title="This function copys the navigator information to another navigator.">nav_copy</a>( <a class="code" href="a00021.html#c0610bdf5a370b9b7e17a892662ed502" title="The explorer uses the navigator ID 1 to open the `copy file&amp;#39; and the ID 0 to...">FS_NAV_ID_COPYFILE</a> );
<a name="l02200"></a>02200    <span class="keywordflow">return</span> TRUE;
<a name="l02201"></a>02201 }
<a name="l02202"></a>02202 
<a name="l02203"></a>02203 
<a name="l02215"></a><a class="code" href="a00048.html#b55eb40d89b96055f71e71533380fdd0">02215</a> Bool  <a class="code" href="a00047.html#b55eb40d89b96055f71e71533380fdd0" title="This function pastes the selected file in COPY navigator in the file list of the...">nav_file_paste_start</a>( <span class="keyword">const</span> <a class="code" href="a00031.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> sz_name  )
<a name="l02216"></a>02216 {
<a name="l02217"></a>02217    U8 nav_id_save;
<a name="l02218"></a>02218    Bool status;
<a name="l02219"></a>02219 
<a name="l02220"></a>02220    <span class="keywordflow">if</span>( <a class="code" href="a00023.html#3d068dfd6cc43279a8f57456a9898754" title="Erroneous streaming data transfer ID.">ID_STREAM_ERR</a> != <a class="code" href="a00047.html#b4aa634e7d90eb225f80597a0e80125d" title="Holds the current ID transfer used by the internal copy-paste routines.">g_id_trans_memtomem</a> )
<a name="l02221"></a>02221    {
<a name="l02222"></a>02222 
<a name="l02223"></a>02223       <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> = <a class="code" href="a00031.html#d5768fc011554b78b4c9fa11ede3b1b9" title="A copy action is always running.">FS_ERR_COPY_RUNNING</a>;  <span class="comment">// A copy action is always running</span>
<a name="l02224"></a>02224       <span class="keywordflow">return</span> FALSE;
<a name="l02225"></a>02225    }
<a name="l02226"></a>02226 
<a name="l02227"></a>02227    <span class="comment">// Create the file to paste</span>
<a name="l02228"></a>02228    <span class="keywordflow">if</span>( !<a class="code" href="a00047.html#27b550ee0cf2326498755b429818b145" title="This function creates a file with NULL size and NULL attribut.">nav_file_create</a>( sz_name  ) )
<a name="l02229"></a>02229       <span class="keywordflow">return</span> FALSE;
<a name="l02230"></a>02230    <span class="comment">// Open the file in write mode with size 0</span>
<a name="l02231"></a>02231    <span class="keywordflow">if</span>( !<a class="code" href="a00028.html#310a118fba8ffb01c998e5087f32d815" title="This function opens the selected file.">file_open</a>( <a class="code" href="a00031.html#ff44d5e228757d47e44edb5e58282579" title="R/W access, flux pointer = 0, size = 0.">FOPEN_MODE_W_PLUS</a> ))
<a name="l02232"></a>02232       <span class="keywordflow">return</span> FALSE;
<a name="l02233"></a>02233 
<a name="l02234"></a>02234    <span class="comment">// Open the file to copy</span>
<a name="l02235"></a>02235    nav_id_save = <a class="code" href="a00047.html#4a9efd8a5ff4c599be7994c009f0fb5f" title="This function returns the navigation identifier used.">nav_get</a>();
<a name="l02236"></a>02236    <a class="code" href="a00047.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( <a class="code" href="a00021.html#c0610bdf5a370b9b7e17a892662ed502" title="The explorer uses the navigator ID 1 to open the `copy file&amp;#39; and the ID 0 to...">FS_NAV_ID_COPYFILE</a> );
<a name="l02237"></a>02237    status = <a class="code" href="a00028.html#310a118fba8ffb01c998e5087f32d815" title="This function opens the selected file.">file_open</a>(<a class="code" href="a00031.html#438cf836f3fb6b9064a6215b8d1d6b91" title="R access, flux pointer = 0, size not modify.">FOPEN_MODE_R</a>);
<a name="l02238"></a>02238    <a class="code" href="a00047.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( nav_id_save );
<a name="l02239"></a>02239 
<a name="l02240"></a>02240    <span class="comment">// If error then close "paste file"</span>
<a name="l02241"></a>02241    <span class="keywordflow">if</span>( !status )
<a name="l02242"></a>02242    {
<a name="l02243"></a>02243       <a class="code" href="a00028.html#7f4f3b65455595cb5be0f7cd7d12e02d" title="This function closes the file.">file_close</a>();
<a name="l02244"></a>02244       <span class="keywordflow">return</span> FALSE;
<a name="l02245"></a>02245    }<span class="keywordflow">else</span>{
<a name="l02246"></a>02246       <span class="comment">// Signal start copy</span>
<a name="l02247"></a>02247       <a class="code" href="a00047.html#b4aa634e7d90eb225f80597a0e80125d" title="Holds the current ID transfer used by the internal copy-paste routines.">g_id_trans_memtomem</a> = <a class="code" href="a00023.html#3d068dfd6cc43279a8f57456a9898754" title="Erroneous streaming data transfer ID.">ID_STREAM_ERR</a>-1;
<a name="l02248"></a>02248       <a class="code" href="a00047.html#58faf0ae085fe0224bba93f0adc2e644">g_segment_src</a>.<a class="code" href="a00007.html#e3431111a456cfa4b80c00e04bdc9816" title="segment size (unit sector), or IN parameter for file_write() and file_read() routines...">u16_size</a> = 0;
<a name="l02249"></a>02249       <span class="keywordflow">return</span> TRUE;
<a name="l02250"></a>02250    }
<a name="l02251"></a>02251 }
<a name="l02252"></a>02252 
<a name="l02253"></a>02253 
<a name="l02263"></a><a class="code" href="a00048.html#c3bfe1b329ff30efaaad183cffa49f03">02263</a> U8    <a class="code" href="a00047.html#c3bfe1b329ff30efaaad183cffa49f03" title="This function executes the copy file.">nav_file_paste_state</a>( Bool b_stop )
<a name="l02264"></a>02264 {
<a name="l02265"></a>02265    <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291" title="Status returned by CTRL_ACCESS interfaces.">Ctrl_status</a> status_stream;
<a name="l02266"></a>02266    U8 status_copy;
<a name="l02267"></a>02267    U8 nav_id_save;
<a name="l02268"></a>02268    _MEM_TYPE_SLOW_ U16 u16_nb_sector_trans;
<a name="l02269"></a>02269 
<a name="l02270"></a>02270    nav_id_save = <a class="code" href="a00047.html#4a9efd8a5ff4c599be7994c009f0fb5f" title="This function returns the navigation identifier used.">nav_get</a>();
<a name="l02271"></a>02271 
<a name="l02272"></a>02272    <span class="comment">// Check, if the copy is running</span>
<a name="l02273"></a>02273    <span class="keywordflow">if</span>( <a class="code" href="a00023.html#3d068dfd6cc43279a8f57456a9898754" title="Erroneous streaming data transfer ID.">ID_STREAM_ERR</a> == <a class="code" href="a00047.html#b4aa634e7d90eb225f80597a0e80125d" title="Holds the current ID transfer used by the internal copy-paste routines.">g_id_trans_memtomem</a> )
<a name="l02274"></a>02274       <span class="keywordflow">return</span> <a class="code" href="a00031.html#fd3d634f2538bd115434b5c9ac6147b1">COPY_FAIL</a>;
<a name="l02275"></a>02275 
<a name="l02276"></a>02276    <span class="keywordflow">if</span>( b_stop )
<a name="l02277"></a>02277    {
<a name="l02278"></a>02278       status_copy = <a class="code" href="a00031.html#fd3d634f2538bd115434b5c9ac6147b1">COPY_FAIL</a>;
<a name="l02279"></a>02279    }
<a name="l02280"></a>02280    <span class="keywordflow">else</span>
<a name="l02281"></a>02281    {
<a name="l02282"></a>02282       <span class="keywordflow">if</span>( (<a class="code" href="a00023.html#3d068dfd6cc43279a8f57456a9898754" title="Erroneous streaming data transfer ID.">ID_STREAM_ERR</a>-1) != <a class="code" href="a00047.html#b4aa634e7d90eb225f80597a0e80125d" title="Holds the current ID transfer used by the internal copy-paste routines.">g_id_trans_memtomem</a> )
<a name="l02283"></a>02283       {
<a name="l02284"></a>02284          <span class="comment">// It isn't the beginning of copy action, then check current stream</span>
<a name="l02285"></a>02285          status_stream = <a class="code" href="a00022.html#bc5895af9a6e16c6e0f90cdce48bdb3a" title="Returns the state of a streaming data transfer.">stream_state</a>( <a class="code" href="a00047.html#b4aa634e7d90eb225f80597a0e80125d" title="Holds the current ID transfer used by the internal copy-paste routines.">g_id_trans_memtomem</a> );
<a name="l02286"></a>02286          <span class="keywordflow">switch</span>( status_stream )
<a name="l02287"></a>02287          {
<a name="l02288"></a>02288          <span class="keywordflow">case</span> <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e291a647d0a662ac6400be3b843dfae52c65" title="Memory not initialized or changed.">CTRL_BUSY</a>:
<a name="l02289"></a>02289             status_copy = <a class="code" href="a00031.html#a2e2285edc2ee3ef3a4ba10af70524ef">COPY_BUSY</a>;
<a name="l02290"></a>02290             <span class="keywordflow">break</span>;
<a name="l02291"></a>02291          <span class="keywordflow">case</span> <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e2918cc674c935507be438bb2d9b6e70d6b8" title="Success, memory ready.">CTRL_GOOD</a>:
<a name="l02292"></a>02292             status_copy = <a class="code" href="a00031.html#49311dbf1b3e2f5d778938655895b17a">COPY_FINISH</a>;
<a name="l02293"></a>02293             <span class="keywordflow">break</span>;
<a name="l02294"></a>02294          <span class="keywordflow">case</span> <a class="code" href="a00023.html#910a0fdf1e7a70b08981dce14e86e29187a15d70a7619b7e4aa918f7a0d953ea" title="An error occurred.">CTRL_FAIL</a>:
<a name="l02295"></a>02295          <span class="keywordflow">default</span>:
<a name="l02296"></a>02296             status_copy = <a class="code" href="a00031.html#fd3d634f2538bd115434b5c9ac6147b1">COPY_FAIL</a>;
<a name="l02297"></a>02297             <span class="keywordflow">break</span>;
<a name="l02298"></a>02298          }
<a name="l02299"></a>02299       }<span class="keywordflow">else</span>{
<a name="l02300"></a>02300          status_copy = <a class="code" href="a00031.html#49311dbf1b3e2f5d778938655895b17a">COPY_FINISH</a>;
<a name="l02301"></a>02301       }
<a name="l02302"></a>02302 
<a name="l02303"></a>02303       <span class="comment">// Compute the new segment to copy</span>
<a name="l02304"></a>02304       <span class="keywordflow">if</span>( <a class="code" href="a00031.html#49311dbf1b3e2f5d778938655895b17a">COPY_FINISH</a> == status_copy )
<a name="l02305"></a>02305       {
<a name="l02306"></a>02306          <a class="code" href="a00022.html#21c3bfd3da12736296fe092d97cc7acc" title="Stops a streaming data transfer.">stream_stop</a>( <a class="code" href="a00047.html#b4aa634e7d90eb225f80597a0e80125d" title="Holds the current ID transfer used by the internal copy-paste routines.">g_id_trans_memtomem</a> );
<a name="l02307"></a>02307 
<a name="l02308"></a>02308          <span class="keywordflow">if</span>( 0 != <a class="code" href="a00047.html#58faf0ae085fe0224bba93f0adc2e644">g_segment_src</a>.<a class="code" href="a00007.html#e3431111a456cfa4b80c00e04bdc9816" title="segment size (unit sector), or IN parameter for file_write() and file_read() routines...">u16_size</a> )
<a name="l02309"></a>02309          {
<a name="l02310"></a>02310             status_copy = <a class="code" href="a00031.html#a2e2285edc2ee3ef3a4ba10af70524ef">COPY_BUSY</a>;            <span class="comment">// start the next continue stream</span>
<a name="l02311"></a>02311          }
<a name="l02312"></a>02312          <span class="keywordflow">else</span>
<a name="l02313"></a>02313          {
<a name="l02314"></a>02314             <span class="comment">// check eof source file</span>
<a name="l02315"></a>02315             <a class="code" href="a00047.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( <a class="code" href="a00021.html#c0610bdf5a370b9b7e17a892662ed502" title="The explorer uses the navigator ID 1 to open the `copy file&amp;#39; and the ID 0 to...">FS_NAV_ID_COPYFILE</a> );
<a name="l02316"></a>02316             <span class="keywordflow">if</span>( 0 == <a class="code" href="a00028.html#bed52ba7230c6eecf100a3709b9ed74e" title="This function checks the end of file.">file_eof</a>() )
<a name="l02317"></a>02317             {
<a name="l02318"></a>02318                status_copy = <a class="code" href="a00031.html#a2e2285edc2ee3ef3a4ba10af70524ef">COPY_BUSY</a>;
<a name="l02319"></a>02319                <a class="code" href="a00047.html#58faf0ae085fe0224bba93f0adc2e644">g_segment_src</a>.<a class="code" href="a00007.html#e3431111a456cfa4b80c00e04bdc9816" title="segment size (unit sector), or IN parameter for file_write() and file_read() routines...">u16_size</a> = 0xFFFF; <span class="comment">// Get the maximum segment supported by navigation (U16)</span>
<a name="l02320"></a>02320                <span class="keywordflow">if</span>( !<a class="code" href="a00028.html#d0fc50dbdd1849e9fe0e81b215ce9335" title="This function returns a segment (position &amp;amp; size) in a physical memory corresponding...">file_read</a>( &amp;<a class="code" href="a00047.html#58faf0ae085fe0224bba93f0adc2e644">g_segment_src</a> ))
<a name="l02321"></a>02321                {
<a name="l02322"></a>02322                   status_copy = <a class="code" href="a00031.html#fd3d634f2538bd115434b5c9ac6147b1">COPY_FAIL</a>;
<a name="l02323"></a>02323                }
<a name="l02324"></a>02324             }
<a name="l02325"></a>02325             <a class="code" href="a00047.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( nav_id_save );
<a name="l02326"></a>02326            
<a name="l02327"></a>02327             <span class="comment">// Check destination file</span>
<a name="l02328"></a>02328             <span class="keywordflow">if</span>( <a class="code" href="a00031.html#a2e2285edc2ee3ef3a4ba10af70524ef">COPY_BUSY</a> == status_copy )
<a name="l02329"></a>02329             {
<a name="l02330"></a>02330                 <a class="code" href="a00047.html#5622b91c7a68a74d8910567c78d66127">g_segment_dest</a>.<a class="code" href="a00007.html#e3431111a456cfa4b80c00e04bdc9816" title="segment size (unit sector), or IN parameter for file_write() and file_read() routines...">u16_size</a> = <a class="code" href="a00047.html#58faf0ae085fe0224bba93f0adc2e644">g_segment_src</a>.<a class="code" href="a00007.html#e3431111a456cfa4b80c00e04bdc9816" title="segment size (unit sector), or IN parameter for file_write() and file_read() routines...">u16_size</a>; <span class="comment">// Ask the segment no more larger than source segment</span>
<a name="l02331"></a>02331                 <span class="keywordflow">if</span>( !<a class="code" href="a00028.html#1b5c29ddedddd73a1279b9920ea1642f" title="This function allocs and returns a segment (position &amp;amp; size) in a physical memory...">file_write</a>( &amp;<a class="code" href="a00047.html#5622b91c7a68a74d8910567c78d66127">g_segment_dest</a> ))
<a name="l02332"></a>02332                {
<a name="l02333"></a>02333                   status_copy = <a class="code" href="a00031.html#fd3d634f2538bd115434b5c9ac6147b1">COPY_FAIL</a>;
<a name="l02334"></a>02334                }
<a name="l02335"></a>02335             }
<a name="l02336"></a>02336            
<a name="l02337"></a>02337             <span class="comment">// Start new segment copy</span>
<a name="l02338"></a>02338             <span class="keywordflow">if</span>( <a class="code" href="a00031.html#a2e2285edc2ee3ef3a4ba10af70524ef">COPY_BUSY</a> == status_copy )
<a name="l02339"></a>02339             {
<a name="l02340"></a>02340                <span class="comment">// Compute a minimal segment</span>
<a name="l02341"></a>02341                 <span class="keywordflow">if</span>( <a class="code" href="a00047.html#58faf0ae085fe0224bba93f0adc2e644">g_segment_src</a>.<a class="code" href="a00007.html#e3431111a456cfa4b80c00e04bdc9816" title="segment size (unit sector), or IN parameter for file_write() and file_read() routines...">u16_size</a> &gt; <a class="code" href="a00047.html#5622b91c7a68a74d8910567c78d66127">g_segment_dest</a>.<a class="code" href="a00007.html#e3431111a456cfa4b80c00e04bdc9816" title="segment size (unit sector), or IN parameter for file_write() and file_read() routines...">u16_size</a> )
<a name="l02342"></a>02342                {
<a name="l02343"></a>02343                   <span class="comment">// Reposition source file</span>
<a name="l02344"></a>02344                   <a class="code" href="a00047.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( <a class="code" href="a00021.html#c0610bdf5a370b9b7e17a892662ed502" title="The explorer uses the navigator ID 1 to open the `copy file&amp;#39; and the ID 0 to...">FS_NAV_ID_COPYFILE</a> );
<a name="l02345"></a>02345                    <span class="keywordflow">if</span>( !<a class="code" href="a00028.html#2599f935c7e1b69f2650e0943091ddca" title="This function changes the position in the file.">file_seek</a>( (U32)(<a class="code" href="a00047.html#58faf0ae085fe0224bba93f0adc2e644">g_segment_src</a>.<a class="code" href="a00007.html#e3431111a456cfa4b80c00e04bdc9816" title="segment size (unit sector), or IN parameter for file_write() and file_read() routines...">u16_size</a> - <a class="code" href="a00047.html#5622b91c7a68a74d8910567c78d66127">g_segment_dest</a>.<a class="code" href="a00007.html#e3431111a456cfa4b80c00e04bdc9816" title="segment size (unit sector), or IN parameter for file_write() and file_read() routines...">u16_size</a>)*<a class="code" href="a00025.html#e6e52ba6ed3159395fab025719b91bd0">FS_512B</a> , <a class="code" href="a00029.html#f546c33414158e18f0a25b795f402ccf" title="start at the current position and rewind">FS_SEEK_CUR_RE</a> ))
<a name="l02346"></a>02346                   {
<a name="l02347"></a>02347                      status_copy = <a class="code" href="a00031.html#fd3d634f2538bd115434b5c9ac6147b1">COPY_FAIL</a>;
<a name="l02348"></a>02348                   }
<a name="l02349"></a>02349                   <a class="code" href="a00047.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( nav_id_save );
<a name="l02350"></a>02350                    <a class="code" href="a00047.html#58faf0ae085fe0224bba93f0adc2e644">g_segment_src</a>.<a class="code" href="a00007.html#e3431111a456cfa4b80c00e04bdc9816" title="segment size (unit sector), or IN parameter for file_write() and file_read() routines...">u16_size</a> = <a class="code" href="a00047.html#5622b91c7a68a74d8910567c78d66127">g_segment_dest</a>.<a class="code" href="a00007.html#e3431111a456cfa4b80c00e04bdc9816" title="segment size (unit sector), or IN parameter for file_write() and file_read() routines...">u16_size</a>; <span class="comment">// Update source to start a correct transfer</span>
<a name="l02351"></a>02351                }
<a name="l02352"></a>02352             }
<a name="l02353"></a>02353          }
<a name="l02354"></a>02354          <span class="keywordflow">if</span>( <a class="code" href="a00031.html#a2e2285edc2ee3ef3a4ba10af70524ef">COPY_BUSY</a> == status_copy )
<a name="l02355"></a>02355          {
<a name="l02356"></a>02356             <span class="comment">// Split transfer by step of SIZE_OF_SPLIT_COPY</span>
<a name="l02357"></a>02357             <span class="keywordflow">if</span>( <a class="code" href="a00047.html#58faf0ae085fe0224bba93f0adc2e644">g_segment_src</a>.<a class="code" href="a00007.html#e3431111a456cfa4b80c00e04bdc9816" title="segment size (unit sector), or IN parameter for file_write() and file_read() routines...">u16_size</a> &lt; <a class="code" href="a00047.html#15a9bf910f2e50518c3e6b6b376c017f">SIZE_OF_SPLIT_COPY</a> )
<a name="l02358"></a>02358                u16_nb_sector_trans = <a class="code" href="a00047.html#58faf0ae085fe0224bba93f0adc2e644">g_segment_src</a>.<a class="code" href="a00007.html#e3431111a456cfa4b80c00e04bdc9816" title="segment size (unit sector), or IN parameter for file_write() and file_read() routines...">u16_size</a>;
<a name="l02359"></a>02359             <span class="keywordflow">else</span>
<a name="l02360"></a>02360                u16_nb_sector_trans = <a class="code" href="a00047.html#15a9bf910f2e50518c3e6b6b376c017f">SIZE_OF_SPLIT_COPY</a>;
<a name="l02361"></a>02361 
<a name="l02362"></a>02362             <a class="code" href="a00047.html#b4aa634e7d90eb225f80597a0e80125d" title="Holds the current ID transfer used by the internal copy-paste routines.">g_id_trans_memtomem</a> = <a class="code" href="a00022.html#0cd4af35ac08482fa4eca9afdd511345" title="Copies data from one memory to another.">stream_mem_to_mem</a>( <a class="code" href="a00047.html#58faf0ae085fe0224bba93f0adc2e644">g_segment_src</a>.<a class="code" href="a00007.html#b34b8d353020e5be9c7dc9649d657009" title="logical unit(drive) number">u8_lun</a> , <a class="code" href="a00047.html#58faf0ae085fe0224bba93f0adc2e644">g_segment_src</a>.<a class="code" href="a00007.html#9fcd8d370afa82dbeaefff77625056c3" title="segment address (unit sector)">u32_addr</a> , <a class="code" href="a00047.html#5622b91c7a68a74d8910567c78d66127">g_segment_dest</a>.<a class="code" href="a00007.html#b34b8d353020e5be9c7dc9649d657009" title="logical unit(drive) number">u8_lun</a> , <a class="code" href="a00047.html#5622b91c7a68a74d8910567c78d66127">g_segment_dest</a>.<a class="code" href="a00007.html#9fcd8d370afa82dbeaefff77625056c3" title="segment address (unit sector)">u32_addr</a> , u16_nb_sector_trans );
<a name="l02363"></a>02363             <span class="keywordflow">if</span>( <a class="code" href="a00023.html#3d068dfd6cc43279a8f57456a9898754" title="Erroneous streaming data transfer ID.">ID_STREAM_ERR</a> == <a class="code" href="a00047.html#b4aa634e7d90eb225f80597a0e80125d" title="Holds the current ID transfer used by the internal copy-paste routines.">g_id_trans_memtomem</a> )
<a name="l02364"></a>02364                   status_copy = <a class="code" href="a00031.html#fd3d634f2538bd115434b5c9ac6147b1">COPY_FAIL</a>;
<a name="l02365"></a>02365             <a class="code" href="a00047.html#58faf0ae085fe0224bba93f0adc2e644">g_segment_src</a>.<a class="code" href="a00007.html#9fcd8d370afa82dbeaefff77625056c3" title="segment address (unit sector)">u32_addr</a> +=u16_nb_sector_trans;
<a name="l02366"></a>02366             <a class="code" href="a00047.html#5622b91c7a68a74d8910567c78d66127">g_segment_dest</a>.<a class="code" href="a00007.html#9fcd8d370afa82dbeaefff77625056c3" title="segment address (unit sector)">u32_addr</a>+=u16_nb_sector_trans;
<a name="l02367"></a>02367             <a class="code" href="a00047.html#58faf0ae085fe0224bba93f0adc2e644">g_segment_src</a>.<a class="code" href="a00007.html#e3431111a456cfa4b80c00e04bdc9816" title="segment size (unit sector), or IN parameter for file_write() and file_read() routines...">u16_size</a> -=u16_nb_sector_trans;
<a name="l02368"></a>02368          }
<a name="l02369"></a>02369       }
<a name="l02370"></a>02370    }
<a name="l02371"></a>02371 
<a name="l02372"></a>02372    <span class="comment">// Check end of copy</span>
<a name="l02373"></a>02373    <span class="keywordflow">if</span>( <a class="code" href="a00031.html#a2e2285edc2ee3ef3a4ba10af70524ef">COPY_BUSY</a> != status_copy )
<a name="l02374"></a>02374    {
<a name="l02375"></a>02375       U32 u32_size_exact;
<a name="l02376"></a>02376 
<a name="l02377"></a>02377       <span class="comment">// Stop copy</span>
<a name="l02378"></a>02378       <a class="code" href="a00022.html#21c3bfd3da12736296fe092d97cc7acc" title="Stops a streaming data transfer.">stream_stop</a>( <a class="code" href="a00047.html#b4aa634e7d90eb225f80597a0e80125d" title="Holds the current ID transfer used by the internal copy-paste routines.">g_id_trans_memtomem</a> );
<a name="l02379"></a>02379       <a class="code" href="a00047.html#b4aa634e7d90eb225f80597a0e80125d" title="Holds the current ID transfer used by the internal copy-paste routines.">g_id_trans_memtomem</a> = <a class="code" href="a00023.html#3d068dfd6cc43279a8f57456a9898754" title="Erroneous streaming data transfer ID.">ID_STREAM_ERR</a>;
<a name="l02380"></a>02380 
<a name="l02381"></a>02381       <span class="comment">// Get exact size and close the source file</span>
<a name="l02382"></a>02382       <a class="code" href="a00047.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( <a class="code" href="a00021.html#c0610bdf5a370b9b7e17a892662ed502" title="The explorer uses the navigator ID 1 to open the `copy file&amp;#39; and the ID 0 to...">FS_NAV_ID_COPYFILE</a> );
<a name="l02383"></a>02383       u32_size_exact = <a class="code" href="a00047.html#c3989dc4a26fbbdf0726fafae6fe4648" title="This function returns the size of selected file (unit byte).">nav_file_lgt</a>();
<a name="l02384"></a>02384       <a class="code" href="a00028.html#7f4f3b65455595cb5be0f7cd7d12e02d" title="This function closes the file.">file_close</a>();
<a name="l02385"></a>02385       <a class="code" href="a00047.html#7fac26539a62daf547b5eb159f6a43d4" title="This function selects the navigation to use.">nav_select</a>( nav_id_save );
<a name="l02386"></a>02386 
<a name="l02387"></a>02387       <span class="comment">// If no error then set the exact size on the destination file</span>
<a name="l02388"></a>02388       <span class="keywordflow">if</span>( <a class="code" href="a00031.html#49311dbf1b3e2f5d778938655895b17a">COPY_FINISH</a> == status_copy )
<a name="l02389"></a>02389       {
<a name="l02390"></a>02390          <span class="keywordflow">if</span>( !<a class="code" href="a00028.html#2599f935c7e1b69f2650e0943091ddca" title="This function changes the position in the file.">file_seek</a>( u32_size_exact , <a class="code" href="a00029.html#5b33d405a458db1db212d345b21454f8" title="start at the beginning">FS_SEEK_SET</a> ))
<a name="l02391"></a>02391          {
<a name="l02392"></a>02392             status_copy = <a class="code" href="a00031.html#fd3d634f2538bd115434b5c9ac6147b1">COPY_FAIL</a>;
<a name="l02393"></a>02393          }<span class="keywordflow">else</span>{
<a name="l02394"></a>02394             <span class="keywordflow">if</span>( !<a class="code" href="a00028.html#07a8faa41a278961fccc5c0793b01ab1" title="This function sets the end of file at the current position.">file_set_eof</a>() )
<a name="l02395"></a>02395             {
<a name="l02396"></a>02396                status_copy = <a class="code" href="a00031.html#fd3d634f2538bd115434b5c9ac6147b1">COPY_FAIL</a>;
<a name="l02397"></a>02397             }
<a name="l02398"></a>02398          }
<a name="l02399"></a>02399       }
<a name="l02400"></a>02400       <a class="code" href="a00028.html#7f4f3b65455595cb5be0f7cd7d12e02d" title="This function closes the file.">file_close</a>();
<a name="l02401"></a>02401       <span class="comment">// If error then delete the destination file</span>
<a name="l02402"></a>02402       <span class="keywordflow">if</span>( <a class="code" href="a00031.html#fd3d634f2538bd115434b5c9ac6147b1">COPY_FAIL</a> == status_copy )
<a name="l02403"></a>02403       {
<a name="l02404"></a>02404          <a class="code" href="a00047.html#8cf46891df029a9f3b62503d2c3cc065" title="This function deletes the selected file or directory.">nav_file_del</a>( TRUE );
<a name="l02405"></a>02405       }
<a name="l02406"></a>02406    }
<a name="l02407"></a>02407    <span class="keywordflow">return</span> status_copy;
<a name="l02408"></a>02408 }
<a name="l02409"></a>02409 <span class="preprocessor">#endif  // FS_LEVEL_FEATURES</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Dec 21 18:30:19 2009 for AVR32 - FAT Services by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
