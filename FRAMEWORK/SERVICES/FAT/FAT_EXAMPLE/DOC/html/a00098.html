<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>AVR32 - FAT Services: reader_txt.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>reader_txt.c</h1><a href="a00051.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*This file has been prepared for Doxygen automatic documentation generation.*/</span>
<a name="l00014"></a>00014 <span class="comment">/* Copyright (c) 2009 Atmel Corporation. All rights reserved.</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
<a name="l00017"></a>00017 <span class="comment"> * modification, are permitted provided that the following conditions are met:</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * 1. Redistributions of source code must retain the above copyright notice, this</span>
<a name="l00020"></a>00020 <span class="comment"> * list of conditions and the following disclaimer.</span>
<a name="l00021"></a>00021 <span class="comment"> *</span>
<a name="l00022"></a>00022 <span class="comment"> * 2. Redistributions in binary form must reproduce the above copyright notice,</span>
<a name="l00023"></a>00023 <span class="comment"> * this list of conditions and the following disclaimer in the documentation</span>
<a name="l00024"></a>00024 <span class="comment"> * and/or other materials provided with the distribution.</span>
<a name="l00025"></a>00025 <span class="comment"> *</span>
<a name="l00026"></a>00026 <span class="comment"> * 3. The name of Atmel may not be used to endorse or promote products derived</span>
<a name="l00027"></a>00027 <span class="comment"> * from this software without specific prior written permission.</span>
<a name="l00028"></a>00028 <span class="comment"> *</span>
<a name="l00029"></a>00029 <span class="comment"> * 4. This software may only be redistributed and used in connection with an Atmel</span>
<a name="l00030"></a>00030 <span class="comment"> * AVR product.</span>
<a name="l00031"></a>00031 <span class="comment"> *</span>
<a name="l00032"></a>00032 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY ATMEL "AS IS" AND ANY EXPRESS OR IMPLIED</span>
<a name="l00033"></a>00033 <span class="comment"> * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF</span>
<a name="l00034"></a>00034 <span class="comment"> * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT ARE</span>
<a name="l00035"></a>00035 <span class="comment"> * EXPRESSLY AND SPECIFICALLY DISCLAIMED. IN NO EVENT SHALL ATMEL BE LIABLE FOR</span>
<a name="l00036"></a>00036 <span class="comment"> * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
<a name="l00037"></a>00037 <span class="comment"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span>
<a name="l00038"></a>00038 <span class="comment"> * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span>
<a name="l00039"></a>00039 <span class="comment"> * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00040"></a>00040 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<a name="l00041"></a>00041 <span class="comment"> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE</span>
<a name="l00042"></a>00042 <span class="comment"> *</span>
<a name="l00043"></a>00043 <span class="comment"> */</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="comment">//_____  I N C L U D E S ___________________________________________________</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="preprocessor">#include "<a class="code" href="a00021.html" title="FAT configuration file.">conf_explorer.h</a>"</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include LIB_MEM</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="a00029.html" title="FAT 12/16/32 Services.">file.h</a>"</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include "<a class="code" href="a00048.html" title="FAT 12/16/32 Services.">navigation.h</a>"</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include "<a class="code" href="a00052.html" title="FAT 12/16/32 text reader service.">reader_txt.h</a>"</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include "<a class="code" href="a00054.html" title="FAT 12/16/32 Unicode Service.">unicode.h</a>"</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="comment">//_____ D E F I N I T I O N S ______________________________________________</span>
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 
<a name="l00065"></a><a class="code" href="a00052.html#ee4bf4e140c9a4893547bf41459e57f3">00065</a> Bool  <a class="code" href="a00051.html#ee4bf4e140c9a4893547bf41459e57f3" title="Open a selected text file in the current navigator.">reader_txt_open</a>( Bool b_readonly )
<a name="l00066"></a>00066 {
<a name="l00067"></a>00067    <span class="keywordflow">if</span>( !<a class="code" href="a00028.html#310a118fba8ffb01c998e5087f32d815" title="This function opens the selected file.">file_open</a>( (b_readonly)? <a class="code" href="a00031.html#438cf836f3fb6b9064a6215b8d1d6b91" title="R access, flux pointer = 0, size not modify.">FOPEN_MODE_R</a> : <a class="code" href="a00031.html#d7905db5e099b8dc19b081a213918f65" title="R/W access, flux pointer = 0, size not modify.">FOPEN_MODE_R_PLUS</a> ) )
<a name="l00068"></a>00068       <span class="keywordflow">return</span> FALSE; <span class="comment">// Open error</span>
<a name="l00069"></a>00069    <a class="code" href="a00051.html#4f6bbd93a0b11365b77518a22b1ae098" title="This function goes at the beginning of file and read the text header.">reader_txt_beg</a>();
<a name="l00070"></a>00070    <span class="keywordflow">return</span> TRUE;
<a name="l00071"></a>00071 }
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 
<a name="l00082"></a><a class="code" href="a00052.html#ef8e9a323aab9e3c839130f47a79453a">00082</a> Bool  <a class="code" href="a00051.html#ef8e9a323aab9e3c839130f47a79453a" title="Create a new text file.">reader_txt_new</a>( <span class="keyword">const</span> <a class="code" href="a00031.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> sz_name , U8 u8_txt_format )
<a name="l00083"></a>00083 {
<a name="l00084"></a>00084    <span class="comment">// Table to store the header of text file</span>
<a name="l00085"></a>00085    U8    string_header[<a class="code" href="a00054.html#fe277837248b15658de12b35d5319c23">UNI_MAX_HEADER_SIZE</a>];
<a name="l00086"></a>00086    U8    u8_header_size;
<a name="l00087"></a>00087 
<a name="l00088"></a>00088    <span class="comment">// Create empty file</span>
<a name="l00089"></a>00089    <span class="keywordflow">if</span> ( !<a class="code" href="a00047.html#27b550ee0cf2326498755b429818b145" title="This function creates a file with NULL size and NULL attribut.">nav_file_create</a>( sz_name ))
<a name="l00090"></a>00090       <span class="keywordflow">return</span> FALSE;
<a name="l00091"></a>00091 
<a name="l00092"></a>00092    <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#1fa472bb197fe1edfa95b67fe66ea089" title="format of text used in selected file (only for reader_txt module)">u8_txt_format</a> = u8_txt_format;
<a name="l00093"></a>00093 
<a name="l00094"></a>00094    <span class="comment">// Write at the beginning of file the text header</span>
<a name="l00095"></a>00095    u8_header_size = <a class="code" href="a00053.html#806fc5bfe128cc4a4e6ccce39b55049a" title="Return the header corresponding at text format identifier.">unicode_header_get</a>( string_header, <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#1fa472bb197fe1edfa95b67fe66ea089" title="format of text used in selected file (only for reader_txt module)">u8_txt_format</a> );
<a name="l00096"></a>00096    <a class="code" href="a00028.html#415ad1a43ac79c02c294a4e32246c519" title="This function transfer a buffer to a file at the current file position.">file_write_buf</a>( string_header , u8_header_size );
<a name="l00097"></a>00097    <span class="keywordflow">return</span> TRUE;
<a name="l00098"></a>00098 }
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 
<a name="l00103"></a><a class="code" href="a00052.html#4f6bbd93a0b11365b77518a22b1ae098">00103</a> <span class="keywordtype">void</span>  <a class="code" href="a00051.html#4f6bbd93a0b11365b77518a22b1ae098" title="This function goes at the beginning of file and read the text header.">reader_txt_beg</a>( <span class="keywordtype">void</span> )
<a name="l00104"></a>00104 {
<a name="l00105"></a>00105    <span class="comment">// Table to store the header of text file</span>
<a name="l00106"></a>00106    U8    string_header[<a class="code" href="a00054.html#fe277837248b15658de12b35d5319c23">UNI_MAX_HEADER_SIZE</a>];
<a name="l00107"></a>00107 
<a name="l00108"></a>00108    <a class="code" href="a00028.html#2599f935c7e1b69f2650e0943091ddca" title="This function changes the position in the file.">file_seek</a>( 0, <a class="code" href="a00029.html#5b33d405a458db1db212d345b21454f8" title="start at the beginning">FS_SEEK_SET</a> );  <span class="comment">// go to at the beginning of file</span>
<a name="l00109"></a>00109 
<a name="l00110"></a>00110    <span class="comment">// Read the header to detect the text format (ASCII, UNICODE LE, UNICODE BE, UTF8)</span>
<a name="l00111"></a>00111    memset( string_header, 0, <a class="code" href="a00054.html#fe277837248b15658de12b35d5319c23">UNI_MAX_HEADER_SIZE</a> );     <span class="comment">// By default ASCII</span>
<a name="l00112"></a>00112    <a class="code" href="a00028.html#7b7c08bde8cb93a792dd578cf4310d0a" title="This function copys in a buffer the file data corresponding at the current position...">file_read_buf</a>( string_header , <a class="code" href="a00054.html#fe277837248b15658de12b35d5319c23">UNI_MAX_HEADER_SIZE</a> );
<a name="l00113"></a>00113    <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#1fa472bb197fe1edfa95b67fe66ea089" title="format of text used in selected file (only for reader_txt module)">u8_txt_format</a> = <a class="code" href="a00053.html#72ca402da21dd99d43772a4761e61bd7" title="Detect the text format via a header (3 bytes).">unicode_header_scan</a>( string_header );
<a name="l00114"></a>00114    <span class="comment">// Set cursor after header</span>
<a name="l00115"></a>00115    <a class="code" href="a00028.html#2599f935c7e1b69f2650e0943091ddca" title="This function changes the position in the file.">file_seek</a>( <a class="code" href="a00053.html#806fc5bfe128cc4a4e6ccce39b55049a" title="Return the header corresponding at text format identifier.">unicode_header_get</a>( string_header, <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#1fa472bb197fe1edfa95b67fe66ea089" title="format of text used in selected file (only for reader_txt module)">u8_txt_format</a> ), <a class="code" href="a00029.html#5b33d405a458db1db212d345b21454f8" title="start at the beginning">FS_SEEK_SET</a> );
<a name="l00116"></a>00116 }
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 
<a name="l00123"></a><a class="code" href="a00052.html#277e7970bcc003a9e9823b70e259d0b5">00123</a> <span class="keywordtype">void</span>  <a class="code" href="a00051.html#277e7970bcc003a9e9823b70e259d0b5" title="This function allow to select the text format to decode.">reader_txt_select_format</a>( U8 u8_txt_format )
<a name="l00124"></a>00124 {
<a name="l00125"></a>00125    <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#1fa472bb197fe1edfa95b67fe66ea089" title="format of text used in selected file (only for reader_txt module)">u8_txt_format</a> = u8_txt_format;
<a name="l00126"></a>00126 }
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 
<a name="l00142"></a><a class="code" href="a00052.html#29030022836887d64ee7b516b93f2d4e">00142</a> U16   <a class="code" href="a00051.html#29030022836887d64ee7b516b93f2d4e" title="This function fills an ASCII buffer with the current text line of opened file.">reader_txt_get_line</a>( Bool b_unicode, <a class="code" href="a00031.html#caff53a7315dfcce82e06ae11c771e8c">FS_STRING</a> <span class="keywordtype">string</span> , U16 u16_str_size )
<a name="l00143"></a>00143 {
<a name="l00144"></a>00144    U8    utf8[<a class="code" href="a00054.html#c48a8938847701b354657c41c992f89c">UNI_MAX_UTF8_SIZE</a>];
<a name="l00145"></a>00145    U8    size_utf8_buf=0;
<a name="l00146"></a>00146    U8    size_utf8_dec=0;
<a name="l00147"></a>00147    U16   u16_size_line = 1;   <span class="comment">// 1 to compute null terminator</span>
<a name="l00148"></a>00148    U16   u16_unicode;
<a name="l00149"></a>00149    Bool  b_error = FALSE;
<a name="l00150"></a>00150 
<a name="l00151"></a>00151    <a class="code" href="a00047.html#c7a2bc65b27a1d7a449d18b07fde6629" title="This function disables the disk check before each actions on disk.">nav_checkdisk_disable</a>();   <span class="comment">// To optimize speed</span>
<a name="l00152"></a>00152    
<a name="l00153"></a>00153    <span class="keywordflow">while</span>( 0 == <a class="code" href="a00028.html#bed52ba7230c6eecf100a3709b9ed74e" title="This function checks the end of file.">file_eof</a>() &amp;&amp; !b_error )
<a name="l00154"></a>00154    {
<a name="l00155"></a>00155       <span class="comment">// Get a unicode value</span>
<a name="l00156"></a>00156       <span class="keywordflow">switch</span>( <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#1fa472bb197fe1edfa95b67fe66ea089" title="format of text used in selected file (only for reader_txt module)">u8_txt_format</a> )
<a name="l00157"></a>00157       {
<a name="l00158"></a>00158          <span class="keywordflow">case</span> <a class="code" href="a00054.html#601edc3012275aa2753840f0bc83c850">UNI_TYPE_UTF8</a>:
<a name="l00159"></a>00159          <span class="comment">// Remove UTF8 codes used</span>
<a name="l00160"></a>00160          <span class="keywordflow">if</span>( 0 != size_utf8_dec )
<a name="l00161"></a>00161          {
<a name="l00162"></a>00162             U8 u8_i;
<a name="l00163"></a>00163             <span class="keywordflow">for</span>( u8_i=0; u8_i&lt;(<a class="code" href="a00054.html#c48a8938847701b354657c41c992f89c">UNI_MAX_UTF8_SIZE</a>-size_utf8_dec); u8_i++ )
<a name="l00164"></a>00164             {
<a name="l00165"></a>00165                utf8[u8_i]=utf8[u8_i+size_utf8_dec];
<a name="l00166"></a>00166             }
<a name="l00167"></a>00167             size_utf8_buf -= size_utf8_dec;
<a name="l00168"></a>00168             size_utf8_dec =0;
<a name="l00169"></a>00169          }
<a name="l00170"></a>00170          <span class="comment">// Complet UTF8 array</span>
<a name="l00171"></a>00171          size_utf8_buf += <a class="code" href="a00028.html#7b7c08bde8cb93a792dd578cf4310d0a" title="This function copys in a buffer the file data corresponding at the current position...">file_read_buf</a>( &amp;utf8[size_utf8_buf], (<a class="code" href="a00054.html#c48a8938847701b354657c41c992f89c">UNI_MAX_UTF8_SIZE</a>-size_utf8_buf) );
<a name="l00172"></a>00172          <span class="comment">// Decode UTF8 to unicode</span>
<a name="l00173"></a>00173          size_utf8_dec = <a class="code" href="a00053.html#2a3ec3b9a79a59f2983ccee1bb8948e1" title="Conversion UTF-8 to unicode.">utf8_to_unicode</a>( &amp;utf8[0], &amp;u16_unicode );
<a name="l00174"></a>00174          <span class="keywordflow">break</span>;
<a name="l00175"></a>00175       
<a name="l00176"></a>00176          <span class="keywordflow">case</span> <a class="code" href="a00054.html#06075fdf01ba0cb5926bfe54e1bfc91e">UNI_TYPE_UTF16BE</a>:
<a name="l00177"></a>00177          MSB(u16_unicode) = <a class="code" href="a00028.html#952fd54b2e49943d138e44d3bdf569bf" title="This function returns the next byte of file.">file_getc</a>();
<a name="l00178"></a>00178          LSB(u16_unicode) = <a class="code" href="a00028.html#952fd54b2e49943d138e44d3bdf569bf" title="This function returns the next byte of file.">file_getc</a>();
<a name="l00179"></a>00179          <span class="keywordflow">if</span> (LSB(u16_unicode) == (<a class="code" href="a00031.html#02e7b232f5280b690d2c1ab5ae4871f9">FS_EOF</a> &amp; 0xFF) &amp;&amp; <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> != <a class="code" href="a00031.html#ca57c3036b23f86097252cfe4bb6b9c8" title="End of file.">FS_ERR_EOF</a>)
<a name="l00180"></a>00180            b_error = TRUE;
<a name="l00181"></a>00181          <span class="keywordflow">break</span>;
<a name="l00182"></a>00182 
<a name="l00183"></a>00183          <span class="keywordflow">case</span> <a class="code" href="a00054.html#64a1135a22b253eb478b4213249b9456">UNI_TYPE_UTF16LE</a>:
<a name="l00184"></a>00184          LSB(u16_unicode) = <a class="code" href="a00028.html#952fd54b2e49943d138e44d3bdf569bf" title="This function returns the next byte of file.">file_getc</a>();
<a name="l00185"></a>00185          MSB(u16_unicode) = <a class="code" href="a00028.html#952fd54b2e49943d138e44d3bdf569bf" title="This function returns the next byte of file.">file_getc</a>();
<a name="l00186"></a>00186          <span class="keywordflow">if</span> (MSB(u16_unicode) == (<a class="code" href="a00031.html#02e7b232f5280b690d2c1ab5ae4871f9">FS_EOF</a> &amp; 0xFF) &amp;&amp; <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> != <a class="code" href="a00031.html#ca57c3036b23f86097252cfe4bb6b9c8" title="End of file.">FS_ERR_EOF</a>)
<a name="l00187"></a>00187            b_error = TRUE;
<a name="l00188"></a>00188          <span class="keywordflow">break</span>;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190          <span class="keywordflow">default</span>: <span class="comment">// ASCII or other</span>
<a name="l00191"></a>00191          u16_unicode = <a class="code" href="a00028.html#952fd54b2e49943d138e44d3bdf569bf" title="This function returns the next byte of file.">file_getc</a>();
<a name="l00192"></a>00192          <span class="keywordflow">if</span> (u16_unicode == <a class="code" href="a00031.html#02e7b232f5280b690d2c1ab5ae4871f9">FS_EOF</a> &amp;&amp; <a class="code" href="a00031.html#3eebd84ddd08a3d4163af24e2722de3c">fs_g_status</a> != <a class="code" href="a00031.html#ca57c3036b23f86097252cfe4bb6b9c8" title="End of file.">FS_ERR_EOF</a>)
<a name="l00193"></a>00193            b_error = TRUE;
<a name="l00194"></a>00194          <span class="keywordflow">break</span>;
<a name="l00195"></a>00195       }
<a name="l00196"></a>00196 
<a name="l00197"></a>00197       <span class="comment">// Check character to remove</span>
<a name="l00198"></a>00198       <span class="keywordflow">if</span>( <span class="charliteral">'\r'</span> == u16_unicode )
<a name="l00199"></a>00199          <span class="keywordflow">continue</span>;   <span class="comment">// Ignore character</span>
<a name="l00200"></a>00200       
<a name="l00201"></a>00201       <span class="comment">// Check end of line</span>
<a name="l00202"></a>00202       <span class="keywordflow">if</span>((  0  == u16_unicode )
<a name="l00203"></a>00203       || (<span class="charliteral">'\n'</span> == u16_unicode ) )
<a name="l00204"></a>00204          <span class="keywordflow">break</span>;      <span class="comment">// End of line</span>
<a name="l00205"></a>00205 
<a name="l00206"></a>00206       u16_size_line++;
<a name="l00207"></a>00207       <span class="comment">// Fill string</span>
<a name="l00208"></a>00208       <span class="keywordflow">if</span>( 1 &lt; u16_str_size )
<a name="l00209"></a>00209       {
<a name="l00210"></a>00210          <span class="keywordflow">if</span>( b_unicode )
<a name="l00211"></a>00211          {
<a name="l00212"></a>00212             ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)<span class="keywordtype">string</span>)[0] = u16_unicode;
<a name="l00213"></a>00213          }<span class="keywordflow">else</span>{
<a name="l00214"></a>00214             <span class="keywordtype">string</span>[0] = u16_unicode;
<a name="l00215"></a>00215          }
<a name="l00216"></a>00216          <span class="keywordtype">string</span> += (b_unicode? 2 : 1 );
<a name="l00217"></a>00217          u16_str_size--;
<a name="l00218"></a>00218       }
<a name="l00219"></a>00219    }
<a name="l00220"></a>00220    <span class="comment">// HERE, the line is readed</span>
<a name="l00221"></a>00221    
<a name="l00222"></a>00222    <span class="keywordflow">if</span>( <a class="code" href="a00054.html#601edc3012275aa2753840f0bc83c850">UNI_TYPE_UTF8</a> == <a class="code" href="a00025.html#fcc9a3eb6084fd54807483346dfc5d09">fs_g_nav_entry</a>.<a class="code" href="a00010.html#1fa472bb197fe1edfa95b67fe66ea089" title="format of text used in selected file (only for reader_txt module)">u8_txt_format</a> )
<a name="l00223"></a>00223    {
<a name="l00224"></a>00224       <span class="comment">// Re position cursor on next UTF8</span>
<a name="l00225"></a>00225       <a class="code" href="a00028.html#2599f935c7e1b69f2650e0943091ddca" title="This function changes the position in the file.">file_seek</a>( (size_utf8_buf-size_utf8_dec) , <a class="code" href="a00029.html#f546c33414158e18f0a25b795f402ccf" title="start at the current position and rewind">FS_SEEK_CUR_RE</a> );
<a name="l00226"></a>00226    }
<a name="l00227"></a>00227 
<a name="l00228"></a>00228    <span class="comment">// Handle error cases</span>
<a name="l00229"></a>00229    <span class="keywordflow">if</span> (b_error)
<a name="l00230"></a>00230    {
<a name="l00231"></a>00231      <a class="code" href="a00047.html#e4c0e8aa28b3bd3fa3122a931c19eab9" title="This function enables the disk check before each actions on disk.">nav_checkdisk_enable</a>();
<a name="l00232"></a>00232      <span class="keywordflow">return</span> 0;
<a name="l00233"></a>00233    }
<a name="l00234"></a>00234 
<a name="l00235"></a>00235    <span class="comment">// Add Null terminate</span>
<a name="l00236"></a>00236    <span class="keywordflow">if</span>( 0 != u16_str_size )
<a name="l00237"></a>00237    {
<a name="l00238"></a>00238       <span class="keywordflow">if</span>( b_unicode )
<a name="l00239"></a>00239       {
<a name="l00240"></a>00240          ((<a class="code" href="a00031.html#4b07eeef6c66c629ec6708f8eee35f58">FS_STR_UNICODE</a>)<span class="keywordtype">string</span>)[0] = 0;
<a name="l00241"></a>00241       }<span class="keywordflow">else</span>{
<a name="l00242"></a>00242          <span class="keywordtype">string</span>[0] = 0;
<a name="l00243"></a>00243       }
<a name="l00244"></a>00244    }
<a name="l00245"></a>00245    <a class="code" href="a00047.html#e4c0e8aa28b3bd3fa3122a931c19eab9" title="This function enables the disk check before each actions on disk.">nav_checkdisk_enable</a>();
<a name="l00246"></a>00246    <span class="keywordflow">return</span> u16_size_line;
<a name="l00247"></a>00247 }
<a name="l00248"></a>00248 
<a name="l00249"></a>00249 
<a name="l00256"></a><a class="code" href="a00052.html#a294dece909ef8dc6c56dd13f1b78aa5">00256</a> Bool  <a class="code" href="a00051.html#a294dece909ef8dc6c56dd13f1b78aa5" title="This function jumps text lines.">reader_txt_jump_line</a>( U16 nb_line )
<a name="l00257"></a>00257 {
<a name="l00258"></a>00258    <span class="keywordflow">while</span>( 0 != nb_line )
<a name="l00259"></a>00259    {
<a name="l00260"></a>00260       <span class="keywordflow">if</span>( 0 != <a class="code" href="a00028.html#bed52ba7230c6eecf100a3709b9ed74e" title="This function checks the end of file.">file_eof</a>() )
<a name="l00261"></a>00261          <span class="keywordflow">return</span> FALSE;
<a name="l00262"></a>00262       <a class="code" href="a00051.html#29030022836887d64ee7b516b93f2d4e" title="This function fills an ASCII buffer with the current text line of opened file.">reader_txt_get_line</a>( FALSE, NULL, 0 );
<a name="l00263"></a>00263       nb_line--;
<a name="l00264"></a>00264    }
<a name="l00265"></a>00265    <span class="keywordflow">return</span> TRUE;
<a name="l00266"></a>00266 }
<a name="l00267"></a>00267 
<a name="l00268"></a>00268 
<a name="l00271"></a><a class="code" href="a00052.html#1859333aec56b71c6126da66452231c1">00271</a> <span class="keywordtype">void</span>  <a class="code" href="a00051.html#1859333aec56b71c6126da66452231c1" title="Close text file.">reader_txt_close</a>( <span class="keywordtype">void</span> )
<a name="l00272"></a>00272 {
<a name="l00273"></a>00273    <a class="code" href="a00028.html#7f4f3b65455595cb5be0f7cd7d12e02d" title="This function closes the file.">file_close</a>();
<a name="l00274"></a>00274 }
<a name="l00275"></a>00275 
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Dec 21 18:30:20 2009 for AVR32 - FAT Services by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
